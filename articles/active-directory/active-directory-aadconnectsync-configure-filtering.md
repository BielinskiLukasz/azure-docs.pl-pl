<properties
    pageTitle="Azure AD Connect Sync: フィルター処理の構成 | Microsoft Azure"
    description="Azure AD Connect Sync でフィルター処理を構成する方法を説明します。"
    services="active-directory"
    documentationCenter=""
    authors="markusvi"
    manager="stevenpo"
    editor=""/>

<tags
    ms.service="active-directory"
    ms.workload="identity"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/13/2015"
    ms.author="markusvi;andkjell"/>


# Azure AD Connect Sync: フィルター処理の構成

Azure AD Connect Sync では、いつでもフィルター処理を有効にできます。 ディレクトリ同期の既定の構成を既に実行していて、フィルター処理を構成済みの場合、フィルター処理により除外されるオブジェクトは、Azure AD に対する同期の対象外になります。 そのため、以前同期されてからフィルター処理された Azure AD のオブジェクトは、すべて Azure AD から削除されます。 フィルター処理のエラーが原因でオブジェクトが誤って削除された場合、フィルター処理構成を削除し、ディレクトリの同期を再実行することで、Azure AD 内にオブジェクトを再生成できます。

> [AZURE.IMPORTANT]Microsoft は、正式に記載されているアクションを除き、Azure AD Connect 同期の変更や操作をサポートしていません。 そのようなアクションを実行すると、Azure AD Connect Sync の状態に一貫性が失われたり、サポート対象外の状態になったりすることがあります。その結果、Microsoft はそのようなデプロイを技術的にサポートできなくなります。

送信の属性ベースのフィルター処理の場合を除き、新しいバージョンの Azure AD Connect のインストールまたはアップグレードを行っても構成は保持されます。 新しいバージョンにアップグレードした後は、常に構成が誤って変更されていないことを確認してから、最初の同期サイクルを実行することをお勧めします。


## フィルター処理オプション

> [AZURE.NOTE]このトピックでは、ソース AD が、Active Directory ドメイン サービス コネクタの名前として使用されます。 複数のフォレストがある場合、1 つのフォレストにつきコネクタ数は 1 つです。フォレストごとに構成を繰り返す必要があります。

ディレクトリ同期ツールには、次の 3 つのフィルター処理構成タイプが適用できます。

- [**ドメイン ベース**] (#configure ドメイン ベースのフィルター処理): はこれを使用するフィルター処理タイプ Azure AD Connect sync の SourceAD コネクタのプロパティを管理します。 このフィルター処理タイプを使用すると、どのドメインを Azure AD に同期させるかを選択できます。

- [**組織単位ベースのフィルター処理を構成する**] (#configure-組織単位ベースのフィルター処理): はこれを使用するフィルター処理タイプ Azure AD Connect sync の SourceAD コネクタのプロパティを管理します。 このフィルター処理タイプを使用すると、どの OU を Azure AD に同期させるかを選択できます。

- [**属性ベース**](#configure-attribute-based-filtering): はこれを使用するフィルター処理方式属性ベースのフィルターを指定します。 これにより、クラウドと同期するオブジェクトを制御できます。

> [AZURE.NOTE]フィルターの構成を変更して、パスワード同期を使用する場合は、構成を完了した後、すべてのパスワードの完全同期をトリガーする必要があります。 手順をパスワードをトリガーする方法については、完全な同期を参照してください [すべてのパスワードの完全同期をトリガー](active-directory-aadconnectsync-implement-password-synchronization.md#trigger-a-full-sync-of-all-passwords)

## ドメイン ベースのフィルター処理を構成する

このセクションでは、ドメイン フィルターの構成に必要な手順について説明します。

Azure AD Connect をインストールした後にフォレスト内のドメインを追加または削除した場合は、フィルター処理の構成も更新する必要があります。


### 既存ドメインのフィルターの変更

> [AZURE.NOTE] ドメイン フィルターを変更した場合、実行プロファイルを更新する必要があります。


**ドメイン フィルターを設定するには、次の手順を実行します。**

1. メンバーであるアカウントを使用して Azure AD Connect sync を実行しているコンピューターにログオン、 **ADSyncAdmins** セキュリティ グループ。

2.  **開始**, 、タップまたはクリックして **同期サービス** を開くには、 **Synchronization Service Manager**します。

3. コネクタ ビューを開くにはクリックして **コネクタ** で、 **ツール** メニュー。

4.  **コネクタ** 一覧を持つコネクタを選択 **Active Directory ドメイン サービス** として **型**します。

5. 開くには、 **プロパティ** ダイアログ ボックスで、をクリックして **プロパティ** で、 **アクション** メニュー。

6. クリックして **ディレクトリ パーティションの構成**します。

7.  **ディレクトリ パーティションの選択** ボックスの一覧で、同期するパーティションのみが選択されていることを確認します。 <br> 同期プロセスからドメインを除外するには、ドメインのチェック ボックスをオフにします。

8. 閉じるには、 **プロパティ** ダイアログ ボックスで、をクリックして **[ok]**します。


ドメイン フィルターを更新した場合、次の実行プロファイルも更新する必要があります。

- フル インポート
- 完全同期
- 差分インポート
- 差分同期
- エクスポート


使用していれば **削除** ディレクトリ パーティション リストからパーティションでは、このパーティションを参照しているすべての実行プロファイル手順も削除されることを確認する必要があります。

**実行プロファイルから手順を削除するには、次の手順を実行します。**

1.  **コネクタ** 一覧を持つコネクタを選択 **Active Directory ドメイン サービス** として **型**します。

2. 開くには、 **実行プロファイルの構成** ダイアログ ボックスで、をクリックして **実行プロファイルを構成する** で、 **アクション** ] メニューの [します。

3.  **コネクタ実行プロファイル** 一覧で、構成する場合、実行プロファイルを選択

4. 手順の詳細リストの各ステップでは、次の手順を実行します。

     4.1. 必要に応じて、手順をクリックして手順の詳細を展開します。

     4.2. 場合、 **値** の **パーティション** 属性は、GUID、手順の削除] をクリックします。

5. 閉じるには、 **実行プロファイルの構成** ダイアログ ボックスで、をクリックして **[ok]**します。

使用していれば **追加** 、パーティションをディレクトリ パーティション リストにするには、そのパーティションの実行プロファイル手順が上記の一覧で実行プロファイルのそれぞれで利用可能かどうかを確認する必要があります。

**実行プロファイルに手順を追加するには、次の手順を実行します。**

1.  **コネクタ** 一覧を持つコネクタを選択 **Active Directory ドメイン サービス** として **型**します。

2. 開くには、 **実行プロファイルの構成** ダイアログ ボックスで、をクリックして **実行プロファイルを構成する** で、 **アクション** ] メニューの [します。

3.  **コネクタ実行プロファイル** 一覧で、構成する場合、実行プロファイルを選択

4. 開くには、 **実行プロファイルの構成** ダイアログ ボックスで、をクリックして **新しいステップ**します。

5.  **手順の構成** ページの選択] ステップの種類一覧では、[ステップの種類をクリックして **次**します。

6.  **コネクタ構成** ] ページで、 **パーティション** ボックスの一覧で、ドメイン フィルターに追加したパーティションの名前を選択します。

7. 閉じるには、 **実行プロファイルの構成** ダイアログ ボックスで、をクリックして **完了**します。

8. 閉じるには、 **実行プロファイルを構成する** をクリックしてダイアログ ボックスで、 **OK**します。

### 新規ドメインまたは削除されたドメインのフィルターの変更
フォレストに新しいドメインを追加した場合またはフォレストからドメインを削除した場合は、ドメインのフィルター処理構成を更新する必要があります。

**ドメインを追加した場合の手順**

1. メンバーであるアカウントを使用して Azure AD Connect sync を実行しているコンピューターにログオン、 **ADSyncAdmins** セキュリティ グループ。

2.  **開始**, 、タップまたはクリックして **同期サービス** を開くには、 **Synchronization Service Manager**します。

3. コネクタ ビューを開くにはクリックして **コネクタ** で、 **ツール** メニュー。

4.  **コネクタ** 一覧を持つコネクタを選択 **Active Directory ドメイン サービス** として **型**します。

5. 開くには、 **プロパティ** ダイアログ ボックスで、をクリックして **プロパティ** で、 **アクション** メニュー。

6. クリックして **ディレクトリ パーティションの構成**します。

7. クリックして、 **更新** 、ページの上部にあるボタンをクリックします。

8.  **ディレクトリ パーティションの選択** 一覧で、新しいドメインを選択します。

9. 閉じるには、 **プロパティ** ダイアログ ボックスで、[ok] をクリックします。

同じコネクタが選択されたままであることを確認します。 ここでコネクタの実行プロファイルを構成する必要があります。


- フル インポート
- 完全同期
- 差分インポート
- 差分同期
- エクスポート


10. 開くには、 **実行プロファイルの構成** ダイアログ ボックスで、をクリックして **実行プロファイルを構成する** で、 **アクション** ] メニューの [します。

11.  **コネクタ実行プロファイル** 一覧で、構成する場合、実行プロファイルを選択

12. 開くには、 **実行プロファイルの構成** ダイアログ ボックスで、をクリックして **新しいステップ**します。

13.  **手順の構成** ページの選択] ステップの種類一覧では、[ステップの種類をクリックして **次**します。

14.  **コネクタ構成** ] ページで、 **パーティション** ボックスの一覧で、ドメイン フィルターに追加したパーティションの名前を選択します。

15. 閉じるには、 **実行プロファイルの構成** ダイアログ ボックスで、をクリックして **完了**します。

16. 閉じるには、 **実行プロファイルを構成する** をクリックしてダイアログ ボックスで、 **OK**します。

17. すべての実行プロファイルに対して、これらの手順を繰り返します。

**ドメインを削除した場合の手順**

1. メンバーであるアカウントを使用して Azure AD Connect sync を実行しているコンピューターにログオン、 **ADSyncAdmins** セキュリティ グループ。

2.  **開始**, 、タップまたはクリックして **同期サービス** を開くには、 **Synchronization Service Manager**します。

3. コネクタ ビューを開くにはクリックして **コネクタ** で、 **ツール** メニュー。

4.  **コネクタ** 一覧を持つコネクタを選択 **Active Directory ドメイン サービス** として **型**します。

5. 開くには、 **プロパティ** ダイアログ ボックスで、をクリックして **プロパティ** で、 **アクション** メニュー。

6. クリックして **ディレクトリ パーティションの構成**します。

7. クリックして、 **更新** 、ページの上部にあるボタンをクリックします。

8. 閉じるには、 **プロパティ** ダイアログ ボックスで、[ok] をクリックします。 ドメインが削除されたことを示すメッセージが表示され、その構成がクリーンアップされます。

## 組織単位ベースのフィルター処理を構成する

**組織単位ベースのフィルター処理を構成するには、次の手順を実行します。**

1. メンバーであるアカウントを使用して Azure AD Connect sync を実行しているコンピューターにログオン、 **ADSyncAdmins** セキュリティ グループ。

2.  **開始**, 、タップまたはクリックして **同期サービス** を開くには、 **Synchronization Service Manager**します。<br>

3.  **Synchronization Service Manager**, 、] をクリックして **コネクタ**, をダブルクリックし、 **SourceAD**します。

4. クリックして **ディレクトリ パーティションの構成**, 、構成、およびをクリックするドメインを選択して **コンテナー**します。

5. 内部設置型 Active Directory フォレストのドメイン資格情報の入力を求められたら、.<br> > [AZURE.NOTE]資格情報] ダイアログ ボックスが表示されたら、AD DS をインポートしたりエクスポートに使用するアカウントが表示されます。 アカウントのパスワードがわからない場合は、別のアカウントを入力して使用できます。 使用するアカウントには、現在構成しているドメインに対する読み取りアクセス許可が必要です。

6.  **コンテナーの選択** ] ダイアログ ボックスで、クラウド ディレクトリと同期したくない Ou をクリア **OK**します。

7. をクリックして **OK** 上、 **SourceAD プロパティ** ページです。

8. フル インポートと差分同期を実行するには、次の手順を実行します。

     8.1. コネクタの一覧で選択 **[sourcead]**

     8.2. 開くには、 **コネクタの実行** ダイアログで、 **実行** から、 **アクション** メニュー。

     8.3.  **実行プロファイル** 一覧で、[ **フル インポート**, 、し、実行プロファイルが完了するまで待機します。

     8.4. 開くには、 **コネクタの実行** ダイアログで、 **実行** から、 **アクション** メニュー。

     8.5.  **実行プロファイル** 一覧で、[ **差分同期**, 、し、実行プロファイルが完了するまで待機します。




## 属性ベースのフィルター処理を構成する

属性に基づくフィルター処理を構成する方法は複数あります。 AD からの受信の構成が推奨されます。この構成設定は、新しいバージョンにアップグレードしても維持されるためです。 AAD への送信の構成もサポートされていますが、この設定は新しいバージョンへのアップグレード後に維持されません。そのため、メタバース内の組み合わせられたオブジェクトを確認してフィルター処理を決定する必要がある場合にのみ使用してください。

### 受信のフィルター処理

受信ベースのフィルター処理は既定の構成を利用します。既定の構成では、AAD に送信されるオブジェクトに、値の設定されていないメタバース属性 cloudFiltered と、"User" または "Contact" に設定されたメタバース属性 sourceObjectType が必要です。

オブジェクトを Azure AD と同期せず、その他の場合に空のままにする必要があるときは、属性 cloudFiltered を True に設定してください。 この方法は、オブジェクトを確認し、オブジェクトを同期しないと判断する (ネガティブ フィルター処理) 場合に使用します。

次の例では、extensionAttribute15 の値が NoSync の場合、すべてのユーザーがフィルターで除外されます。

1. ADSyncAdmins セキュリティ グループに属するアカウントを使用して、Azure AD Connect Sync を実行しているコンピューターにログインします。
2. 開いている、 **同期規則エディター** から、 **[スタート] メニュー**します。
3. 確認 **受信** が選択されているし、をクリックして **新しいルールの追加**します。
4. ルールにわかりやすい名前をなど提供する"*で from AD – ユーザー DoNotSyncFilter*"、正しいフォレストを選択 **ユーザー** として、 **CS オブジェクトの種類**, 、および **人** として、 **MV オブジェクトの種類**します。 として **リンクの種類**, を選択 **参加** の優先順位に従って、現在使用していない別の同期ルールで値を入力します (例:: 50)、順にクリック **次**します。
5.  **スコープ フィルター**, 、クリックして **グループの追加**, 、] をクリックして **句の追加** と、属性の選択 **[extensionattribute15]**します。 必ず、演算子に設定されている **と等しい** と **型** 値] ボックスに nosync という値。 クリックして **次**します。
6. ままにして、 **参加** ルールは、空、クリックして **次**します。
7. クリックして **変換の追加**, を選択、 **FlowType** に **定数**, ターゲット属性 cloudFiltered を選択して、[ソース] ボックスは true を入力します。 [追加] をクリックしてルールを保存します。
8. 完全同期の実行: で、 **コネクタ** ] タブを右クリックして **[sourcead]**, 、] をクリックして **実行**, 、] をクリックして **完全な同期**, 、順にクリック **[ok]**します。


属性 **sourceObjectType** をプロビジョニング、 **ユーザー** または **連絡先** この属性に値が設定されている場合、Azure AD に **ユーザー** または **連絡先** それぞれします。 既定のルールよりも高い優先度の同期ルールを作成することで、既定の動作をオーバーライドできます。 この方法で、ポジティブ ルールとネガティブ ルールの両方を表現できます。

次の例ではのみを同期するユーザー、部門属性が"*Sales*"か、空です。

1. ADSyncAdmins セキュリティ グループに属するアカウントを使用して、Azure AD Connect Sync を実行しているコンピューターにログインします。
2. 開いている、 **同期規則エディター** から、 **[スタート] メニュー**します。
3. 確認 **受信** クリックして選択すると、 **新しいルールの追加**します。
4. 規則のわかりやすい名前を指定 (例::"*で from AD – ユーザー DoNotSyncFilter*")、正しいフォレストを選択 **ユーザー** として、 **CS オブジェクトの種類**, 、および **人** として、 **MV オブジェクトの種類**します。 として **リンクの種類**, [ **参加** し、[ **優先順位の種類**, 、現在使用していない別の同期ルールで値 (例:: 60)。 クリックして **次**します。
5. ままにして、 **スコープ フィルター** と **結合規則** 空にして、をクリックして **次** 2 回クリックします。
6. をクリックして **変換の追加**, を選択、 **FlowType** に **式** を選択し、 **ターゲット属性** に **sourceObjectType**します。  **ソース**, 、次の式を入力します。<br>`IIF(IsNullOrEmpty([department]),NULL,IIF([department]<>”Sales”,”DoNotSync”,NULL))`
7. [追加] をクリックしてルールを保存します。
8. 完全同期の実行: で、 **コネクタ** ] タブを右クリックして **[sourcead]**, 、] をクリックして **実行**, 、] をクリックして **完全な同期**, 、順にクリック **[ok]**します。 結果は次のようになります。<br>

> [AZURE.NOTE] AAD に同期するオブジェクトを決定するさまざまな cloudFiltered と sourceObjectType を起用する注意してください。

式を使用することで、強力なフィルター処理を実行できます。 上記の式では、部門が指定されておらず、部門が Sales だった場合にリテラルの NULL を指定しました。 これは、この属性で値を設定されず、既定のルールが評価されることを示します。 ようにしたいかどうかはそれらを特定できるように、 **ユーザー** または **連絡先** Azure AD で作成する必要があります。


## 送信ベースのフィルター処理

場合によっては、オブジェクトがメタバースに参加した後にのみ、フィルター処理を実行する必要があります。 たとえば、オブジェクトを同期する必要があるかどうかを確認するには、リソース フォレストの mail 属性と、アカウント フォレストの userPrincipalName 属性を確認する必要があります。 このような場合、送信ルールに関するフィルター処理を作成します。

> [AZURE.NOTE] このメソッドでは、既定の同期規則の変更が必要です。 同期ルールのスコープの変更はサポートされていませんが、新しいバージョンの Azure AD Connect にアップグレードした後、変更は保存されない可能性があります。 送信ベースのフィルター処理を使用する場合、変更内容を書き留め、アップグレード後にフィルター処理があることを確認し、必要に応じて再適用します。


この例では、フィルター処理を変更するので、mail と userPrincipalName の両方の末尾が @contoso.com であるユーザーのみが同期されます。

1. ADSyncAdmins セキュリティ グループに属するアカウントを使用して、Azure AD Connect Sync を実行しているコンピューターにログインします。
2. [スタート] メニューから、Synchronization Rules Editor を開きます。
3. [ルールの種類] の [送信] をクリックします。
4. [AAD への送信 - ユーザーの参加] というルールを検索します。 [編集] をクリックします。
5. 左側のナビゲーションの [スコープ フィルター] をクリックします。 [句の追加] をクリックし、[属性] で [mail] を選択し、[演算子] で [ENDSWITH] を選択し、[値] に「@contoso.com」と入力します。 [句の追加] をクリックし、[属性] で [userPrincipalName] を選択し、[演算子] で [ENDSWITH] を選択し、[値] に「@contoso.com」と入力します。
6. [保存] をクリックします。
7. 完全同期の実行: [コネクタ] タブで [SourceAD] を右クリックし、[実行]、[完全同期]、[OK] の順にクリックします。


## 次のステップ
詳細について、 [Azure AD Connect sync](active-directory-aadconnectsync-whatis.md) 構成します。

詳細について [内部設置型 id と Azure Active Directory の統合](active-directory-aadconnect.md)します。

