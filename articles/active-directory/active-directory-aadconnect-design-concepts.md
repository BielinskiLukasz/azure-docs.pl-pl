<properties
   pageTitle="Azure AD Connect: 設計概念 |Microsoft Azure"
   description="このトピックでは、特定の実装設計の領域について詳しく説明します。"
   services="active-directory"
   documentationCenter=""
   authors="AndKjell"
   manager="stevenpo"
   editor=""/>

<tags
   ms.service="active-directory"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="Identity"
   ms.date="12/02/2015"
   ms.author="andkjell"/>

# Azure AD Connect の設計概念
このトピックの目的は、Azure AD Connect の実装設計時に検討する必要がある部分について説明することです。 ここでは特定の部分について詳しく説明しますが、これらの概念については、他のトピックでも簡単に説明しています。

## sourceAnchor
SourceAnchor 属性とは見なさ *オブジェクトの有効期間中に変更できない属性*します。 この属性により、オブジェクトは、オンプレミスと Azure AD で同じオブジェクトとして一意に識別されます。 属性ともいいます **immutableId** し、2 つの名前を置き換えることに使用されます。

"immutable" (変更できない) という単語は、このトピックにとって重要です。 この属性の値は、一度設定すると変更できないため、シナリオに対応する設計を選ぶことが重要です。

この属性は、次のシナリオで使用されます。

- 新しい同期エンジン サーバーを構築する場合または障害復旧シナリオの後に再構築する場合、この属性によって、Azure AD 内の既存のオブジェクトがオンプレミスのオブジェクトとリンクされます。
- クラウド専用の ID から同期された ID モデルに移行する場合、この属性によって、Azure AD 内の既存のオブジェクトとオンプレミスのオブジェクトを "完全一致" させることができます。
- この属性と共にのフェデレーションを使用する場合、 **userPrincipalName** 、クレームに、ユーザーを一意に識別するために使用します。

このトピックでは、ユーザーとの関連において sourceAnchor について説明します。 すべてのオブジェクトの種類に同じ規則が適用されますが、通常これが問題になるのは、ユーザーに対してのみです。

### 適切な sourceAnchor 属性の選択
属性の値は、次の規則に従う必要があります。

- 60 文字未満であること
- 特殊文字が含まれていません。 (& a) #92; です。 # $ % & * + / = ? ^ &#96; { } | ~ < > ( ) ' ; : , [ ] " @ _
- グローバルに一意であること
- 文字列、整数、バイナリのいずれかであること
- ユーザーの名前に基づく変更ではないこと
- 大文字と小文字の区別がないこと、および大文字と小文字で異なる可能性がある値は避けること
- オブジェクトの作成時に割り当てる必要があること


選択した sourceAnchor が文字列型でない場合、Azure AD Connect では、特殊文字が表示されないように、属性値に対して Base64Encode を実行します。 ADFS とは別のフェデレーション サーバーを使用する場合、属性に対して Base64Encode を実行する機能がそのサーバーにも備わっていることを確認してください。

sourceAnchor 属性は、大文字小文字を区別します。 値 "JohnDoe" と "johndoe" は同じではありません。

ある場合、単一のフォレスト内部設置型属性を使用する必要がありますが、 **objectGUID**します。 これは、Azure AD Connect で簡単設定を使用する際に使用される属性でもあり、DirSync で使用される属性でもあります。

複数のフォレストがあるし、し、同じフォレスト内のドメイン間およびフォレスト間にユーザーを移動しないかどうかは **objectGUID** もここで使用する適切な属性です。

フォレスト間およびドメイン間でユーザーを移動する場合は、変更されない属性、または移動時にユーザーと共に移動できる属性を探す必要があります。 お勧めする方法は、合成属性を導入することです。 GUID に見える情報を保持する属性が適しています。 オブジェクトの作成中に、新しい GUID が作成され、ユーザーに設定されます。 に基づいてこの値を作成、同期エンジンのサーバーで、カスタム ルールを作成することができます、 **objectGUID** し、追加で選択された属性を更新します。 オブジェクトを移動するときは、この値の内容も必ずコピーしてください。

別のソリューションは、変更されないことがわかっている既存の属性を選択することです。 一般的に使用される属性には、 **employeeID**します。 文字が含まれる属性を検討する場合は、属性値の文字 (大文字と小文字) が変更される可能性がないことを確認します。 使用しない方がよい属性として、ユーザーの名前を含む属性があります。 名前は、結婚や離婚によって変更されることが予想されるため、この属性には使用できません。 これも理由の 1 つ理由などの属性 **userPrincipalName**, 、**メール**, と **targetAddress** も、Azure AD Connect インストール ウィザードで選択することはできません。 これらの属性に含まれる @ 文字も sourceAnchor では使用できません。

### sourceAnchor 属性の変更
Azure AD でオブジェクトを作成して、ID を同期した後に、sourceAnchor 属性の値を変更することはできません。

このような理由から、Azure AD Connect には次の制限が適用されます。

- sourceAnchor 属性を設定できるのは、初回インストール時のみです。 インストール ウィザードを再実行すると、このオプションは読み取り専用になります。 これを変更する必要がある場合は、アンインストールして再インストールする必要があります。
- 別の Azure AD Connect サーバーをインストールする場合は、前に使用したのと同じ sourceAnchor 属性を選択する必要があります。 使用する必要があるかどうかは、前の手順を使用している DirSync を Azure AD Connect へ移動する **objectGUID** はでは、DirSync によって使用される属性です。
- Azure AD にオブジェクトをエクスポートした後で sourceAnchor の値を変更すると、Azure AD Connect Sync によってエラーがスローされます。問題が解決され、ソース ディレクトリで sourceAnchor が元に戻されるまでは、そのオブジェクトをそれ以上変更できなくなります。

## 次のステップ
詳細について [内部設置型 id と Azure Active Directory の統合](active-directory-aadconnect.md)します。

