<properties 
   pageTitle="Azure App Service での B2B プロセスの作成 | Microsoft Azure" 
   description="企業間プロセスの作成方法の概要" 
   services="app-service\logic" 
   documentationCenter=".net,nodejs,java" 
   authors="rajram" 
   manager="dwrede" 
   editor=""/>

<tags
   ms.service="app-service-logic"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="integration" 
   ms.date="12/07/2015"
   ms.author="rajram"/>


# B2B プロセスを作成する


## ビジネス シナリオ 
Contoso 社と Northwind 社は、ビジネス パートナーの関係にあります。 Northwind (供給業者) には、Contoso (小売業者) から注文書が送付されます。このとき使用しているのは、AS2 などの業界水準の通信プロトコルです。 Northwind は受信する注文書をすべて、自社のクラウド ストレージに保存します。 両社の間では、注文書が XML メッセージとしてやり取りされています。 メッセージが Northwind のクラウド ストレージに保存された後は、Northwind 社内のプロセスがその注文書を処理していきます。
 
このチュートリアルの目的は、Northwind がパートナーである Contoso から AS2 を介してメッセージ (XML 形式の注文書) を受け取る際のビジネス プロセスを確立し、受信したメッセージをクラウド ストレージで保持する方法について説明することです。


## ここで取り上げる機能 
このチュートリアルでは、以下の機能を紹介します。 

- **メッセージのトランスポート**: 小売業者と供給をさまざまなプラットフォームで指定できますが、それらも、両者間で通信を実現することができます。 このチュートリアルでは、通信に AS2 (Applicability Statement 2) を使用します。 AS2 は、B2B の通信で取引パートナーどうしがデータをやり取りするときに広く採用されているプロトコルです。
- **データの永続性**: Northwind はさらに処理する前に保持しようとしていますし、AS2 経由でメッセージが受信されたとします。 コネクタを使用すれば、クラウド ストレージにメッセージを保存できます。 このチュートリアルでは、Northwind のクラウド ストレージとして Azure BLOB を使用します。
- **ビジネス プロセスを作成する**: フローではさまざまな API アプリは結合次に示すように、ビジネスの成果を実現するためにします。


## 開始する前に
このチュートリアルは、Azure App Services について基本的な知識があり、かつ API アプリを作成したり、それを組み合わせてフローを作成したりするノウハウをお持ちのユーザーを対象としています。


## ビジネス シナリオ実現の手順
**必要な API アプリを作成および構成する**

1. インスタンスを作成、 **Azure Storage Blob コネクタ**します。 これには、Azure Storage アカウントの資格情報が必要です。 インスタンスの作成前に、資格情報があることを確認してください。
2. インスタンスを作成、 **BizTalk 取引先管理**します。 これには、正常に機能する空の SQL Database が必要です。 インスタンスの作成前に、空の SQL データベースがあることを確認してください。
3. インスタンスを作成、 **AS2 コネクタ**します。 これにも、正常に機能する空の SQL Database が必要です。 インスタンスの作成前に、空の SQL データベースがあることを確認してください。 AS2 の処理の一環としてメッセージのアーカイブを作成する場合には、データベースの作成中に、併せて Azure BLOB の資格情報を指定します。
4. 作成した TPM (取引先管理) サービスを、以下のとおり構成します。  
    1. 上の手順で作成した TPM サービスのインスタンスを参照します。
    2. 使用して、 **パートナー** オプションで [ *コンポーネント* に **追加** という名前の新しいパートナー **Contoso** し、そのプロファイルで必要な AS2 id を追加します。
    3. 使用して、 **パートナー** オプションで [ *コンポーネント* に **追加** という名前の新しいパートナー **Northwind** し、そのプロファイルで必要な AS2 id を追加します。
    4. 使用して、 **契約** オプションで [ *コンポーネント* に **追加** Northwind と Contoso の間の AS2 アグリーメントを新たします。 ここでは、Northwind がホステッド パートナー、Contoso がゲスト パートナーとなります。 必要があれば、アグリーメントの作成時に署名、暗号化、圧縮、確認応答を構成してください。 使用してアップロードできる証明書を使用する必要がある、に備えて、 **証明書** オプションを作成した TPM サービスを参照するときにします。


## フロー / ビジネス プロセスを作成する
1. ここでは、最初のステップが AS2 のフローを新たに作成します。 ドラッグ アンド ドロップ、 **AS2 コネクタ** 既に作成しておいたインスタンスを選択します。 機能には、トリガーを選択します。  
    ![][1]  
2. ドラッグ アンド ドロップ **Azure Storage Blob コネクタ** 既に作成しておいたインスタンスを選択します。 アクションを選択機能としてその中で、選択 **Blob のアップロード** 、希望する機能として。 必要に応じて構成します。
3. フローを作成/デプロイします。


## メッセージの処理およびトラブルシューティング
1. 今度は、デプロイが終わったフローをテストしてみましょう。 (上で作成した AS2 アグリーメントに従って) AS2 でラップした XML メッセージを、作成した AS2Connector インスタンスが接点として置かれている AS2 エンドポイントに送信します。 エンドポイントには、公共の場所からアクセスできるように、認証を構成することが必要になる場合があります。
2. フローの実行に関する情報は、フローを参照し、実行が済んだフロー インスタンスを選ぶと確認できます。
3. AS2 の処理に関する情報は、AS2Connector インスタンスを参照し、[追跡] パートに移動すると確認できます。 フィルターを使用して、表示する情報を必要なものだけに絞ることもできます。

![][2]

<!--Image references-->
[1]: ./media/app-service-logic-create-a-b2b-process/Flow.png
[2]: ./media/app-service-logic-create-a-b2b-process/Tracking.png
 

