<properties 
    pageTitle="手動または自動によるインスタンス数のスケール変更" 
    description="Azure のサービスのスケールを変更する方法について説明します。" 
    authors="stepsic-microsoft-com" 
    manager="ronmart" 
    editor="" 
    services="azure-portal" 
    documentationCenter="na"/>

<tags 
    ms.service="azure-portal" 
    ms.workload="na" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="09/08/2015" 
    ms.author="stepsic"/>


# 手動または自動によるインスタンス数のスケール変更

[Azure ポータル](https://portal.azure.com/), に、サービスのインスタンスの数を手動で設定することができますか、することがパラメーターを指定して自動的にオンデマンドでスケールを変更します。 これは通常、*スケールアウト*または*スケールイン*と呼ばれます。

インスタンス数に基づいたスケール変更を行う前に、スケール変更は、インスタンス数に加えて**価格レベル**の影響を受けることを考慮する必要があります。 価格レベルに応じてコアとメモリの数も異なるため、インスタンス数が同じでもパフォーマンスが向上することがあります (これが*スケールアップ*または*スケールダウン*です)。 この記事では、特に、*スケールイン*と*スケールアウト*について説明します。

ポータルで、拡張可能、使用することも、 [REST API](https://msdn.microsoft.com/library/azure/dn931953.aspx) または [.NET SDK](https://www.nuget.org/packages/Microsoft.Azure.Insights/) を手動または自動でスケールを調整します。

## 手動によるスケール変更

1. [Azure ポータル](https://portal.azure.com/), 、] をクリックして **参照**, など、スケール変更するリソースに移動し、 **App Service プラン**します。

2. **スケール** タイルに **操作** スケール変更の状態が表示されます: **オフ** スケールを変更する、手動での **に** の 1 つまたは複数のパフォーマンス メトリックによってスケールします。
    ![Scale tile](./media/insights-how-to-scale/Insights_UsageLens.png)

3. このタイルをクリックすると、**[スケール]** ブレードに移動します。 [スケール] ブレードの上部には、自動スケール アクションの履歴に、サービスを参照できます。  
    ![[スケール] ブレード](./media/insights-how-to-scale/Insights_ScaleBladeDayZero.png)

>[AZURE.NOTE] このグラフに表示されるのは、自動スケールで実行されるアクションのみです。 インスタンス数を手動で調整した場合、このグラフに変更は反映されません。

4. スライダーを使用して、**[インスタンス]** の数を手動で調整できます。
5. **[保存]** コマンドをクリックすると、ほぼ即座にインスタンス数が調整されます。

## 事前設定されたメトリックに基づくスケール変更

メトリックに基づいてインスタンス数が自動的に調整されるようにするには、**[スケールの基準]** ボックスの一覧で目的のメトリックを選択します。 たとえば、**App Service プラン**の場合、**[CPU の割合]** でスケール変更できます。

1. メトリックを選択すると、スライダー、テキスト ボックス、またはその両方が表示されるので、スケールの範囲を示すインスタンス数を入力します。

    ![CPU 使用率が表示されている ](./media/insights-how-to-scale/Insights_ScaleBladeCPU.png)

    自動スケールでは、負荷に関係なく、サービスが、設定した範囲から外れることはありません。

2. 次に、メトリックの対象範囲を選択します。 たとえば、**[CPU の割合]** を選択した場合は、サービス内にあるすべてのインスタンスを対象とする平均 CPU に関するターゲットを設定することができます。 平均 CPU が定義した最大値を超えるとスケールアウトが発生し、同様に、平均 CPU が最小値を下回るとスケールインが発生します。

3. **[保存]** コマンドをクリックします。 自動スケールでは、メトリックのインスタンスの範囲とターゲットに収まっているかどうかが数分ごとに確認されます。 サービスは、余分なトラフィックを受け取る、何もしないで以上のインスタンスが表示されます。

## その他のメトリックに基づいたスケール

**[スケールの基準]** ボックスに表示されるプリセット以外のメトリックに基づいてスケール変更できます。また、スケールアウトとスケールインのルールを複雑に組み合わせることもできます。

### ルールの追加または変更

1. 選択、 **スケジュールおよびパフォーマンス ルール** で、 **して拡大縮小** ボックスの一覧。
![Performance rules](./media/insights-how-to-scale/Insights_PerformanceRules.png)

2. 既に自動スケールを設定済みの場合は、設定したルールが表示されます。

3. 別のメトリックに基づいてスケール変更するには、**[ルールの追加]** 行をクリックします。 以前設定したメトリックによってスケールを変更するメトリックをからに変更する既存の行のいずれかをクリックすることもできます。
![Add rule](./media/insights-how-to-scale/Insights_AddRule.png)

4. ここで、スケールの基準に使用するメトリックを選択する必要があります。 メトリックを選択する際は、次の点を考慮してください。
    * メトリックの基になる*リソース*。 通常、これは、スケール変更するリソースと同じです。 ただし、ストレージ キューの深さを基準にスケールを変更する場合、リソースは、スケール変更の基準に使用するキューになります。
    * *メトリック名*自体。
    * メトリックの*時間の集計*。 これは、データが結合される*期間*のことです。

5. メトリックを選択した後に、メトリックのしきい値と、演算子を選択します。 たとえば、**80%** **より大きい**とします。

6. 次に実行するアクションを選択します。 アクションには、次のようにいくつか種類があります。
    * 数を増やすまたは減らす: これにより、定義するインスタンスの **[値]** の数が追加または削除されます。
    * パーセントを増やすまたは減らす: これにより、インスタンス数がパーセントで変更されます。 たとえば、**[値]** フィールドに 25 を入力すると、現在のインスタンス数が 8 の場合は 2 つ追加されます。
    * 増やした後または減らした後の値: インスタンス数は、定義した **[値]** に設定されます。

7. 最後に、クール ダウンを選択できます。これは、直前のスケール アクションが実施された後、もう一度スケール変更を実施するまでにこのルールが待機する必要のある時間を示します。

8. ルールを構成した後、**[OK]** をクリックします。

9. 必要なルールをすべて構成したら、必ず **[保存]** コマンドをクリックしてください。

### 複数のステップによるスケール変更

上記の例は非常に基本的な内容です。 ただし、より積極的にスケールアップ (またはスケールダウン) する場合、同じメトリックで複数のスケール ルールを追加することもできます。 たとえば、CPU の割合について、次のような 2 つのスケール ルールを定義できます。

1. CPU の割合が 60% を超える場合は、インスタンス 1 つ分のスケールアウト
2. CPU の割合が 85% を超える場合は、インスタンス 3 つ分のスケールアウト

![複数のスケール ルール](./media/insights-how-to-scale/Insights_MultipleScaleRules.png)

後者の追加ルールにより、スケール アクションが実施される前にロードが 85% を超えた場合は、インスタンス 1 つ分だけではなく、さらに 2 つの追加インスタンスを取得することになります。

## スケジュールに基づくスケール変更

既定では、スケール ルールを作成するときに、常に適用されます。 プロファイルのヘッダーをクリックすると、その内容を確認できます。

![プロファイル](./media/insights-how-to-scale/Insights_Profile.png)

ただし、週末ではなく平日に、より積極的なスケール変更を行う必要がある場合もあります。 稼働時間中にサービスを完全に停止することもできます。

1. そのためには、プロファイルで、**[常に]** の代わりに **[繰り返し]** を選択し、プロファイルを適用する時刻を選択します。

2. たとえば、平日に適用するプロファイルを用意するには、**[日]** ボックスの一覧で **[土曜日]** と **[日曜日]** をオフにします。

3. 日中に適用されているプロファイルには、次のように設定します。、 **開始時刻** で開始する時刻をします。
    ![Default recurrence](./media/insights-how-to-scale/Insights_ProfileRecurrence.png)

4. **[OK]** をクリックします。

5. 次に、別の時間に適用するプロファイルを追加する必要があります。 クリックして、 **プロファイルの追加** 行です。 
    ![Off Work](./media/insights-how-to-scale/Insights_ProfileOffWork.png)

6. 2 つ目の新しいプロファイルに、「**業務時間外**」などの名前を付けます。

7. もう一度 **[繰り返し]** を選択し、この期間中のインスタンス数の範囲を選択します。

8. 既定のプロファイルと同様に、このプロファイルを適用する **[日]** と、その日の **[開始時刻]** を選択します。

>[AZURE.NOTE] 自動スケールでは、選択した **[タイム ゾーン]** に応じて夏時間ルールが使用されます。 ただし、夏時間の間、UTC オフセットには、夏時間の UTC オフセットではなく、基本のタイム ゾーン オフセットが表示されます。 

9. **[OK]** をクリックします。

10. ここで、2 つ目のプロファイルで適用するすべてのルールを追加する必要があります。 クリックして **ルールの追加**, と既定のプロファイルの中に同じ規則を作成する可能性があります。
    ![Add rule to off work](./media/insights-how-to-scale/Insights_RuleOffWork.png)

11. スケールアウトとスケールインの両方のルールを必ず作成してください。そうしないと、そのプロファイルの間は、インスタンス数は増加 (または減少) の一途をたどります。

12. 最後に、**[保存]** をクリックします。

## 次のステップ

* [サービス メトリックスを監視](insights-how-to-customize-monitoring.md) 、サービスの可用性と応答性を確認します。
* [監視を有効にし、診断](insights-how-to-use-diagnostics.md) 、サービスに関する詳細な頻度の高いメトリックを収集します。
* [警告通知を受け取る](insights-receive-alert-notifications.md) するたびに運用上のイベントが発生したり、メトリックがしきい値を超えます。
* [アプリケーションのパフォーマンスを監視](insights-perf-analytics.md) 、クラウド内に、コードが実行する方法に正確に理解したい場合。
* [イベントの表示し、監査ログ](insights-debugging-with-events.md) をサービスで発生したすべてのものを参照してください。
* [可用性と任意の web ページの応答性監視](../app-insights-monitor-web-app-availability.md) のかどうか、ページは停止検索できるように、Application Insights を使用します。





