<properties
    pageTitle="Visual Studio Team Services を使用してアプリケーションのロード テストを実行する | Microsoft Azure"
    description="Visual Studio Team Services を使用して Azure Service Fabric アプリケーションのストレス テストを実行する方法について説明します。"
    services="service-fabric"
    documentationCenter="na"
    authors="cawams"
    manager="timlt"
    editor="" />

<tags
    ms.service="multiple"
    ms.devlang="dotnet"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="multiple"
    ms.date="10/28/2015"
    ms.author="cawa" />


# Visual Studio Team Services を使用してアプリケーションのロード テストを実行する

この記事では、Visual Studio ロード テスト機能を使用して、アプリケーションのストレス テストを実行する方法について説明します。 この機能では、Service Fabric のステートフル サービス バックエンドとステートレス サービス Web フロントエンドが使用されます。 この記事で使用するサンプル アプリケーションは、飛行機の位置特定シミュレーターです。 ユーザーが飛行機の ID、出発地、および到着地を指定すると、 アプリケーションのバックエンドによって要求が処理され、フロントエンドによって条件に一致する飛行機がマップに表示されます。

次の図は、テストする Service Fabric アプリケーションを示しています。

![][0]

## 前提条件

始める前には、次の手順を実行する必要があります。

- Visual Studio Team Services (VSTS) アカウントを取得します。 無料で取得できます [Visual Studio Team Services](https://www.visualstudio.com)します。
- Visual Studio 2013 または Visual Studio 2015 を取得してインストールする。 この記事では、Visual Studio 2015 Enterprise エディションを使用しますが、Visual Studio 2013 など他のエディションも同様に機能します。
- ステージング環境にアプリケーションをデプロイする。 参照してください [Visual Studio を使用してリモート クラスターにアプリケーションを展開する方法](service-fabric-publish-app-remote-cluster.md) についてはこれです。
- アプリケーションの使用パターンを理解する。 この情報は、ロード パターンをシミュレートするために使用されます。
- ロード テストの目標を理解する。 これは、ロード テストの結果の解釈と分析に役立ちます。

## Web パフォーマンスとロード テストのプロジェクトの作成と実行

### Web パフォーマンスとロード テストのプロジェクトを作成する

1. Visual Studio 2015 を開きます。 メニュー バーで、**[ファイル]**、**[新規作成]**、**[プロジェクト]** の順に選択し、**[新しいプロジェクト]** ダイアログ ボックスを開きます。

1. **Visual C#** ノードを展開し、**[テスト]**、**[Web パフォーマンスとロード テストのプロジェクト]** を選択します。 プロジェクトの名前を入力し、**[OK]** をクリックします。

    ![][1]

    新しい Web パフォーマンスとロード テストのプロジェクトが表示されます。

    ![][2]

### Web パフォーマンス テストを記録する

1. .webtest プロジェクトを開きます。

1. **[記録の追加]** アイコンを選択して、ブラウザーで記録セッションを開始します。

    ![][3]

    ![][4]

1. Service Fabric アプリケーションを参照します。 記録パネルに Web 要求が表示されます。

    ![][5]

1. ユーザーが実行すると予想される一連のアクションを実行します。 これらのアクションは、負荷を生成するパターンとして使用されます。

1. 完了したら、**[停止]** をクリックして記録を停止します。

    ![][6]

    Visual Studio の .webtest プロジェクトで一連の要求がキャプチャされます。 動的パラメーターが自動的に置き換えられます。 この時点で、テスト シナリオに含まれていない余分な依存関係要求の繰り返しを削除できます。

1. プロジェクトを保存し、**[テストの実行]** を選択して Web パフォーマンス テストをローカルで実行し、すべてが正常に機能していることを確認します。

    ![][7]

### Web パフォーマンス テストをパラメーター化する

Web パフォーマンス テストをパラメーター化するには、コード化された Web パフォーマンス テストに変換し、そのコードを編集します。 または、テストでデータが反復処理されるように、データの一覧に Web パフォーマンス テストをバインドすることもできます。 参照してください [の生成とコード化された web パフォーマンス テストの実行](https://msdn.microsoft.com/library/ms182552.aspx) web パフォーマンスに変換する方法の詳細については、コード化されたテストにテスト用と [web パフォーマンス テストへのデータ ソースの追加](https://msdn.microsoft.com/library/ms243142.aspx) web パフォーマンス テストにデータをバインドする方法についてです。

この例では、GUID を生成して飛行機 ID と置き換え、フライトを複数の場所に送信するための要求を追加できるように、Web パフォーマンス テストをコード化されたテストに変換します。

### ロード テスト プロジェクトを作成する

ロード テスト プロジェクトは、Web パフォーマンス テストと単体テストで記述されている 1 つ以上のシナリオと、指定された追加のロード テスト設定で構成されます。 次の手順は、ロード テスト プロジェクトを作成する方法を示しています。

1. Web パフォーマンスとロード テストのプロジェクトのショートカット メニューで、**[追加]**、**[ロード テスト]** の順に選択します。 **ロード テスト** ウィザードで、**[次へ]** をクリックし、テストの設定を構成します。

1. **ロード パターン** セクションで、ユーザーの一定の負荷または少数のユーザーから開始して、ユーザーが時間と共に増加するステップ ロードするかどうかを選択します。

    ユーザー ロードの量について正確な見積もりがあり、システムの現在のパフォーマンスを確認したい場合は、**[持続ロード]** を選択します。 さまざまな量の負荷がある状況でシステムのパフォーマンスが一貫しているかどうかを把握したい場合は、**[ステップ ロード]** を選択します。

1. **[テスト ミックス]** セクションで、**[追加]** をクリックし、ロード テストに含めるテストを選択します。 **[配分]** 列で、合計テスト実行に対する各テストの割合を指定します。

1. **[実行設定]** セクションで、ロード テストの時間を指定します。
    >[AZURE.NOTE] **[テスト イテレーション]** オプションは、Visual Studio を使用してローカルでロード テストを実行する場合にのみ使用できます。

1. **[実行設定]** の **[場所]** で、ロード テストの要求が生成される場所を指定します。 ウィザードで、Team Services アカウントにログインするよう要求される場合があります。 Team Services アカウントを使用してログインし、地理的な場所を選択します。 完了したら、**[完了]** をクリックします。

1. ロード テストを作成したら、.loadtest プロジェクトを開き、**[実行設定]** の **[Run Settings1 [Active]]** など、現在の実行設定を選択します。 **[プロパティ]** ウィンドウの実行設定が開きます。

1. **[実行設定]** プロパティ ウィンドウの **[結果]** セクションで、**[タイミングの詳細ストレージ**] 設定の既定値が **[なし]** に設定されています。 ロード テスト結果の詳細情報を取得するために、この値を **[すべての個別詳細]** に変更します。 参照してください [テストを読み込む](https://www.visualstudio.com/load-testing.aspx) Visual Studio チームのサービスに接続して、ロード テストを実行する方法についての詳細。

### Visual Studio Team Services を使用してロード テストを実行する

**[ロード テストの実行]** を選択して、テストの実行を開始します。

![][8]

## ロード テスト結果の表示と分析

ロード テストの進行に合わせて、パフォーマンス情報がグラフ化されます。 次のようなグラフが表示されます。

![][9]

1. ページの上部にある **[レポートのダウンロード]** リンクを選択します。 レポートをダウンロードしたら、**[レポートの表示]** をクリックします。

    **[グラフ]** タブで、さまざまなパフォーマンス カウンターに対応したグラフを確認できます。 **[概要]** タブに、全体的なテスト結果が表示されます。 **[テーブル]** タブには、成功および失敗したロード テストの合計数が表示されます。

1. **[テスト]** の **[失敗]** 列と **[エラー]** の **[エラー数]** 列で数字のリンクを選択すると、エラーの詳細が表示されます。

    **[詳細]** タブには、失敗した要求の仮想ユーザーとテスト シナリオの情報が表示されます。 このデータは、ロード テストに複数のシナリオが含まれている場合に役立ちます。

参照してください [、ロード テスト アナライザーのグラフ ビューでロード テスト結果の分析](https://www.visualstudio.com/load-testing.aspx) 負荷を表示する方法の詳細については、テスト結果。

## ロード テストの自動化

Visual Studio Team Services のロード テストで提供されている API を使用して、Team Services アカウントでロード テストを管理し、結果を分析できます。 参照してください [クラウド ロード テストの Rest Api](http://blogs.msdn.com/b/visualstudioalm/archive/2014/11/03/cloud-load-testing-rest-apis-are-here.aspx) の詳細。

## 次のステップ

- [監視および開発設定ではローカル コンピューターのサービスの診断](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)


[0]: ./media/service-fabric-vso-load-test/OverviewDiagram.png 
[1]: ./media/service-fabric-vso-load-test/NewProjectDialog.png 
[2]: ./media/service-fabric-vso-load-test/Project.png 
[3]: ./media/service-fabric-vso-load-test/AddRecording.png 
[4]: ./media/service-fabric-vso-load-test/AddRecording2.png 
[5]: ./media/service-fabric-vso-load-test/ActionSequence.png 
[6]: ./media/service-fabric-vso-load-test/StopRecording.png 
[7]: ./media/service-fabric-vso-load-test/RunTest.png 
[8]: ./media/service-fabric-vso-load-test/RunTest2.png 
[9]: ./media/service-fabric-vso-load-test/Graph.png 

