<properties
    pageTitle="手順 4: 予測分析モデルをトレーニングして評価する | Microsoft Azure"
    description="予測ソリューションの開発に関するチュートリアルの中の、Azure Machine Learning Studio で複数のモデルのトレーニング、スコア付け、評価するステップの 4 番目の手順です。"
    services="machine-learning"
    documentationCenter=""
    authors="garyericson"
    manager="paulettm"
    editor="cgronlun"/>

<tags
    ms.service="machine-learning"
    ms.workload="data-services"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="09/08/2015"
    ms.author="garye"/>


# チュートリアル手順 4: 予測分析モデルをトレーニングして評価する

これは、4 番目の手順のチュートリアルでは、 [Azure ML を使用した予測ソリューションの開発](machine-learning-walkthrough-develop-predictive-solution.md)


1.  [Machine Learning ワークスペースの作成](machine-learning-walkthrough-1-create-ml-workspace.md)
2.  [既存のデータをアップロードする](machine-learning-walkthrough-2-upload-data.md)
3.  [新しい実験を作成する](machine-learning-walkthrough-3-create-new-experiment.md)
4.  **モデルをトレーニングして評価する**
5.  [Web サービスをデプロイする](machine-learning-walkthrough-5-publish-web-service.md)
6.  [Web サービスにアクセスする](machine-learning-walkthrough-6-access-web-service.md)

----------

この実験では、予測モデルを完成させるためにさまざまなアルゴリズムを試します。 2 種類の異なるモデルを作成し、これらのスコア結果を比較することで、最終的な実験で使用するアルゴリズムを決定します。  

選択できるモデルは数多くあります。 モデルを表示するには展開、 **Machine Learning** モジュール パレット内のノードを展開し、 **モデルの初期化** とその下にあるノードです。 実験の目的に合わせて、ここでは [サポート ベクター マシン (SVM)] と [2 クラス ブースト デシジョン ツリー] モジュールを選択します。 学習アルゴリズムの初期化し、[モデルのトレーニング] の [モデルのトレーニング] モジュールを使用してモデルをトレーニングする適切なモジュールを使用します。   

##モデルをトレーニングする
まず、ブースト デシジョン ツリー モデルを以下の手順で設定します。  

1.  モジュール パレットの [2 クラス ブースト デシジョン ツリー] [2 つのクラスのブーストのデシジョン ツリー] モジュールを見つけて、キャンバスにドラッグします。
2.  [モデルのトレーニング] [モデルのトレーニング] モジュールを見つけて、キャンバスにドラッグし、ブースト デシジョン ツリー モジュールの出力を [モデルのトレーニング] [モデルのトレーニング] モジュールの左側の入力ポート ([未トレーニングのモデル]) に接続します。
3.  [モデルのトレーニング] の [モデルのトレーニング] モジュールの右側の入力ポート ([データセット]) を左側の [R スクリプトの実行] [- r のスクリプトの実行] モジュールの左側の出力 ([結果データセット]) を接続します。

    > [AZURE.TIP] まま残してに結び付けられていないため、この実験の入力 2 つと [R スクリプトの実行] の [の r のスクリプトの実行] モジュールの出力の 1 つは必要ないです。 これはいくつかのモジュールではよくある処理です。


4.  [モデルのトレーニング] [モデルのトレーニング] モジュールを選択します。  **プロパティ** ] ウィンドウで、] をクリックして **列セレクターの起動**, を選択 **Include** 最初のドロップダウンで選択 **列のインデックス** 2 番目のドロップダウンでテキスト フィールドに「21」を入力し、(選択することも **列名** と"Credit Risk」を入力します). これによって、モデルが予測する列として、21 列目の信用リスク値が指定されます。


実験の一部は以下のようになっているはずです。  

![Training a model][1]

次に SVM モデルを設定します。  

ブースト デシジョン ツリーはあらゆる種類の特徴で問題なく使うことができます。 ただし、SVM モジュールは線形分類器を生成するため、これによって生成されるモデルでは、すべての数値特徴のスケールが同一である場合に最適なテスト エラーが得られます。 すべての数値特徴を同じスケールに変換するには、[データの正規化] [正規化データ] モジュールを使用して機能を [0, 1] の範囲に変換する Tanh 変換を使用します。 文字列特徴は SVM モジュールによってカテゴリ特徴に変換され、バイナリ 0/1 特徴に変換されます。このため文字列特徴を手動で変換する必要はありません。 また、[Credit Risk] 列 (21 列目) は変換しません。これは数値ですが、トレーニングによってモデルが予測する値です。このため、この値はそのままにしておきます。  

1.  モジュール パレットの [2 クラス サポート ベクター マシン] [2 つのクラスのサポート-ベクター-マシン] モジュールを見つけて、キャンバスにドラッグします。
2.  [モデルのトレーニング] [モデルのトレーニング] モジュールを右クリックし、選択 **コピー**, 、し、キャンバスを右クリックして **貼り付け**します。 [モデルのトレーニング] [モデルのトレーニング] モジュールのコピーが元の同じ列の選択があることに注意してください。
3.  [モデルのトレーニング] の [モデルのトレーニング] モジュールの左側の入力ポート ([未トレーニングのモデル]) には、SVM モジュールの出力を接続します。
4.  [データの正規化] [正規化データ] モジュールを見つけて、キャンバスにドラッグします。
5.  この変換モジュールの入力を左側の [R スクリプトの実行] [- r のスクリプトの実行] モジュールの出力に接続します。
6.  [モデルのトレーニング] の [モデルのトレーニング] モジュールの右側の入力ポート ([データセット]) の変換モジュールの左側の出力ポート (以下"変換済みデータセット]) を接続します。
7.   **プロパティ** 変換モジュールでは、[ウィンドウ **Tanh** の **変換メソッド** パラメーター。
8.  をクリックして **列セレクターの起動**, の [列なし] を選択 **値で始まる**, を選択 **Include** 最初のドロップダウンで [ **列の型** 2 つ目のドロップダウン リストで、し、[ **数値** 3 番目のドロップダウン リストにします。 これによって、すべての数値列が (そして数値列のみが) 変換されます。
9.  プラス記号 (+) をクリックして、ドロップダウンに新しい行を作成します。 選択 **を除外する** 最初のドロップダウンで選択 **列のインデックス** 2 番目のドロップダウンで、テキスト フィールドに「21」と入力します。 これによって 21 列目 ([Credit risk] 列) が無視されます。
10. Click **OK**.  


[データの正規化] [正規化データ] モジュールは Credit Risk 列以外のすべての数値列で Tanh 変換を実行には設定されているようになりました。  

実験の一部は以下のようになっているはずです。  

![Training the second model][2]  

##モデルにスコアを付け、評価する
によって分離されたスコア付けのデータを使用、 **分割** 、トレーニングされたモデルをスコア付けモジュールです。 その後、2 つのモデルの結果を比較して、どちらのモデルがより適した結果を生成したかを判断します。  

1.  [モデルのスコア付け] の [モデルのスコア付け] モジュールを見つけて、キャンバスにドラッグします。
2.  このモジュールの左側の入力ポートをブースト デシジョン ツリー モデルに接続 (つまり、それに接続 [2 クラス ブースト デシジョン ツリー] [2 つのクラスのブーストのデシジョン ツリー] モジュールに接続されている [モデルのトレーニング] [モデルのトレーニング] モジュールの出力ポート)。
3.  [R スクリプトの実行] [- r のスクリプトの実行] モジュールの右側の出力には、[モデルのスコア付け] の [モデルのスコア付け] モジュールの右側の入力ポートを接続します。
4.  コピーし、2 つ目のコピーを作成する [モデルのスコア付け] の [モデルのスコア付け] モジュールを貼り付け、または新しいモジュールをキャンバスにドラッグします。
5.  このモジュールの左側の入力ポートを SVM モデル (つまり、[2 クラス サポート ベクター マシン] [2 つのクラスのサポート-ベクター-マシン] モジュールに接続されている [モデルのトレーニング] [モデルのトレーニング] モジュールの出力ポートに接続) に接続します。
6.  SVM モデルでは、トレーニング用データに対する変換と同様の変換を、テスト用データにも実行する必要があります。 このため、コピーして、2 番目のコピーを作成し、[R スクリプトの実行] [- r のスクリプトの実行] モジュールの右側の出力に接続するには、[データの正規化] [正規化データ] モジュールに貼り付けます。
7.  [データの正規化] [正規化データ] モジュールの出力には、[モデルのスコア付け] の [モデルのスコア付け] モジュールの右側の入力ポートを接続します。  

2 つのスコア付けの結果を評価するには、[モデルの評価] [- モデルの評価] モジュールを使用します。  

1.  [モデルの評価] [- モデルの評価] モジュールを見つけて、キャンバスにドラッグします。
2.  左側の入力ポートをブースト デシジョン ツリー モデルに関連付けられている [モデルのスコア付け] の [モデルのスコア付け] モジュールの出力ポートに接続します。
3.  右側の入力ポートを他の [モデルのスコア付け] [モデルのスコア付け] モジュールに接続します。  

実験は以下のようになっているはずです。  

![Evaluating both models][3]

クリックして、 **実行** 、実験を実行する、キャンバスの下のボタンをクリックします。 これには数分かかることがあります。 実行中であることを示す各モジュールのインジケーターが回転して、モジュールが完了すると、緑色のチェック マークが表示されます。   

すべてのモジュールにチェック マークが付いたら、実験の実行は完了しています。 結果を確認するには、[モデルの評価] [- モデルの評価] モジュールの出力ポートをクリックし、選択 **結果を表示する**です。  

[モデルの評価] の [評価モデル] モジュールには、曲線と 2 つのスコア付けされたモデルの結果を比較するための測定値のペアが生成されます。 結果は、Receiver Operator Characteristic (ROC) 曲線、Precision/Recall 曲線、または Lift 曲線で表示できます。 表示されるその他の情報には、混同行列、累積の AUC (曲線下面積) 値、その他の測定値があります。 スライダーを左右に移動してしきい値を変更することで、変更が測定値に与える影響を確認することもできます。  

クリックして **スコア付けされたデータセット** または **比較対象のデータセットをスコア付けされた** を関連付けられた曲線が強調表示し、関連する測定値を表示します。 曲線の凡例でこの例では、[モデルの評価] [- モデルの評価] モジュールの左側の入力ポートに対応しています「スコア付けされたデータセット」、ブースト デシジョン ツリー モデルです。 [スコア付けされた比較対象のデータセット] は、右側の入力ポート (この場合、SVM モデル) に対応しています。 いずれかのラベルをクリックすると、そのモデルの曲線が強調表示され、関連する測定値が表示されます。  

![ROC curves for models][4]

これらの値を検証することで、求めている結果に最も近い結果が得られるモデルを判断することができます。 モデルと値を変えて実験を再度実行することもできます。  

> [AZURE.TIP] 実験のイテレーションの記録を実行するたびには、実行履歴に保持されます。 これらのイテレーションを表示しをクリックして、これらのいずれかに戻る **[実行履歴を** キャンバスの下です。 クリックすることも **前回の実行** で、 **プロパティ** 直前に、1 つのイテレーションに戻るにはウィンドウが開いています。 詳細については、次を参照してください。 [Azure Machine Learning Studio での実験イテレーションの管理](machine-learning-manage-experiment-iterations.md)します。

クリックして、実験のイテレーションのコピーを作成することもできます **名前を付けて保存** キャンバスの下です。 これによって、実験が複製され、イテレーションの複製バージョンの新しい実行履歴が作成されます。 新しいコピーが表示される、 **実験** 元のイテレーションと共に] ボックスの一覧です。 この機能は、実験のイテレーションを新しい分岐で開始する場合などに便利です。  

実験キャンバスのすべてのモジュールにコメントを追加できるため、モジュールのパラメーターに加えた変更も簡単に追跡できます。 モジュールをダブルクリックまたは右クリックし、選択 **コメントの編集**します。 これらのコメントは実験のイテレーションと共に保存されるため、作業に説明を追加する際に役立てることができます。


----------

**次: [web サービスの展開](machine-learning-walkthrough-5-publish-web-service.md)**

[1]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train1.png
[2]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train2.png
[3]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train3.png
[4]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train4.png


<!-- Module References -->
[evaluate-model]: https://msdn.microsoft.com/library/azure/927d65ac-3b50-4694-9903-20f6c1672089/
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/
[normalize-data]: https://msdn.microsoft.com/library/azure/986df333-6748-4b85-923d-871df70d6aaf/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[train-model]: https://msdn.microsoft.com/library/azure/5cc7053e-aa30-450d-96c0-dae4be720977/
[two-class-boosted-decision-tree]: https://msdn.microsoft.com/library/azure/e3c522f8-53d9-4829-8ea4-5c6a6b75330c/
[two-class-support-vector-machine]: https://msdn.microsoft.com/library/azure/12d8479b-74b4-4e67-b8de-d32867380e20/

