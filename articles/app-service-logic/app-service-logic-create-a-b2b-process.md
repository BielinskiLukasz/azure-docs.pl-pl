<properties 
   pageTitle="Azure App Service での B2B プロセスの作成 | Microsoft Azure" 
   description="企業間プロセスの作成方法の概要" 
   services="app-service\logic" 
   documentationCenter=".net,nodejs,java" 
   authors="rajram" 
   manager="dwrede" 
   editor=""/>

<tags
   ms.service="app-service-logic"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="integration" 
   ms.date="12/07/2015"
   ms.author="rajram"/>



# B2B プロセスを作成する

## ビジネス シナリオ

Contoso 社と Northwind 社は、ビジネス パートナーの関係にあります。 Northwind (供給業者) には、Contoso (小売業者) から注文書が送付されます。このとき使用しているのは、AS2 などの業界水準の通信プロトコルです。 Northwind は受信する注文書をすべて、自社のクラウド ストレージに保存します。 両社の間では、注文書が XML メッセージとしてやり取りされています。 メッセージが Northwind のクラウド ストレージに保存された後は、Northwind 社内のプロセスがその注文書を処理していきます。

このチュートリアルの目的は、Northwind がパートナーである Contoso から AS2 を介してメッセージ (XML 形式の注文書) を受け取る際のビジネス プロセスを確立し、受信したメッセージをクラウド ストレージで保持する方法について説明することです。


## ここで取り上げる機能

このチュートリアルでは、以下の機能を紹介します。

- **メッセージの通信**: 小売業者と仕入先がそれぞれ異なるプラットフォームを使用していても、両者の間で通信を実現することができます。 このチュートリアルでは、通信に AS2 (Applicability Statement 2) を使用します。 AS2 は、B2B の通信で取引パートナーどうしがデータをやり取りするときに広く採用されているプロトコルです。
- **データの保持**: Northwind は、AS2 を介してメッセージを受信してから処理するまでの間、そのメッセージを保持する必要があります。 コネクタを使用すれば、クラウド ストレージにメッセージを保存できます。 このチュートリアルでは、Northwind のクラウド ストレージとして Azure BLOB を使用します。
- **ビジネス プロセスの作成**: ここに示したビジネスの成果を実現するため、フローではさまざまな API アプリを関連付けることができます。


## 開始する前に

このチュートリアルは、Azure App Services について基本的な知識があり、かつ API アプリを作成したり、それを組み合わせてフローを作成したりするノウハウをお持ちのユーザーを対象としています。


## ビジネス シナリオ実現の手順

**必要な API アプリを作成および構成する**

1. **Azure ストレージ BLOB コネクタ**のインスタンスを作成します。 これには、Azure Storage アカウントの資格情報が必要です。 インスタンスの作成前に、資格情報があることを確認してください。
2. **BizTalk 取引先管理**のインスタンスを作成します。 これには、正常に機能する空の SQL Database が必要です。 インスタンスの作成前に、空の SQL データベースがあることを確認してください。
3. **AS2 Connector** のインスタンスを作成します。 これにも、正常に機能する空の SQL Database が必要です。 インスタンスの作成前に、空の SQL データベースがあることを確認してください。 AS2 の処理の一環としてメッセージのアーカイブを作成する場合には、データベースの作成中に、併せて Azure BLOB の資格情報を指定します。
4. 作成した TPM (取引先管理) サービスを、以下のとおり構成します。
    1. 上の手順で作成した TPM サービスのインスタンスを参照します。
    2. *[コンポーネント]* の下にある **[パートナー]** オプションを使用して、**Contoso** という名前のパートナーを新たに**追加**し、そのプロファイルに必要な AS2 ID を入力します。
    3. *[コンポーネント]* の下にある **[パートナー]** オプションを使用して、**Northwind** という名前のパートナーを新たに**追加**し、そのプロファイルに必要な AS2 ID を入力します。
    4. *[コンポーネント]* の下にある **[アグリーメント]** オプションを使用して、Northwind と Contoso の間の AS2 アグリーメントを新たに**追加**します。 ここでは、Northwind がホステッド パートナー、Contoso がゲスト パートナーとなります。 必要があれば、アグリーメントの作成時に署名、暗号化、圧縮、確認応答を構成してください。 証明書を使用する必要がある場合には、作成した TPM サービスを参照する際に **[証明書]** オプションを使ってアップロードできます。


## フロー / ビジネス プロセスを作成する

1. ここでは、最初のステップが AS2 のフローを新たに作成します。 **AS2 Connector** をドラッグ アンド ドロップし、あらかじめ作成しておいたインスタンスを選択します。 機能には、トリガーを選択します。  
    ![][1]
2. **Azure Storage Blob Connector** をドラッグ アンド ドロップし、あらかじめ作成しておいたインスタンスを選択します。 機能にはアクションを選択し、その中から希望する機能として **[BLOB のアップロード]** を選択します。 必要に応じて構成します。
3. フローを作成/デプロイします。


## メッセージの処理およびトラブルシューティング

1. 今度は、デプロイが終わったフローをテストしてみましょう。 (上で作成した AS2 アグリーメントに従って) AS2 でラップした XML メッセージを、作成した AS2Connector インスタンスが接点として置かれている AS2 エンドポイントに送信します。 エンドポイントには、公共の場所からアクセスできるように、認証を構成することが必要になる場合があります。
2. フローの実行に関する情報は、フローを参照し、実行が済んだフロー インスタンスを選ぶと確認できます。
3. AS2 の処理に関する情報は、AS2Connector インスタンスを参照し、[追跡] パートに移動すると確認できます。 フィルターを使用して、表示する情報を必要なものだけに絞ることもできます。

![][2]



[1]: ./media/app-service-logic-create-a-b2b-process/Flow.png 
[2]: ./media/app-service-logic-create-a-b2b-process/Tracking.png 

