- Sieć wirtualna musi znajdować się w tym samym **regionie** i tej samej **subskrypcji** platformy Azure, co konto usługi Batch.

- W przypadku pul utworzonych za pomocą konfiguracji maszyny wirtualnej obsługiwane są tylko sieci wirtualne oparte na usłudze Azure Resource Manager. W przypadku pul utworzonych za pomocą konfiguracji usługi w chmurze są obsługiwane tylko klasyczne sieci wirtualne.
  
- Aby można było użyć klasycznej sieci wirtualnej, jednostka usługi `MicrosoftAzureBatch` musi mieć rolę `Classic Virtual Machine Contributor` z kontrolą dostępu opartą na rolach (RBAC) dla określonej sieci wirtualnej. Aby móc korzystać z sieci wirtualnej opartej na usłudze Azure Resource Manager, musisz mieć uprawnienia dostępu do sieci wirtualnej i do wdrażania maszyn wirtualnych w podsieci.

- Podsieć określona dla puli musi mieć wystarczającą liczbę nieprzypisanych adresów IP do obsługi maszyn wirtualnych przeznaczony dla puli, czyli sumę właściwości puli `targetDedicatedNodes` i `targetLowPriorityNodes`. Jeśli podsieć nie ma wystarczającej liczby nieprzypisanych adresów IP, pula częściowo przydzieli węzły obliczeniowe, a następnie wystąpi błąd dotyczący zmiany rozmiaru. 

- Pule w konfiguracji maszyny wirtualnej wdrożone w sieci wirtualnej platformy Azure automatycznie przydzielają dodatkowe zasoby sieciowe platformy Azure. Następujące zasoby są potrzebne w poszczególnych 50 węzłach puli w sieci wirtualnej: 1 sieciowa grupa zabezpieczeń, 1 publiczny adres IP i 1 moduł równoważenia obciążenia. Te zasoby są ograniczone przez [limity przydziałów](../articles/batch/batch-quota-limit.md) w subskrypcji, która zawiera sieć wirtualną określoną podczas tworzenia puli usługi Batch.

- Sieć wirtualna musi zezwalać na komunikację z usługą Batch, aby umożliwiać planowanie zadań w węzłach obliczeniowych. Można to sprawdzić przez upewnienie się, że sieć wirtualna ma skojarzone sieciowe grupy zabezpieczeń. Jeśli komunikacja z węzłami obliczeniowymi w określonej podsieci zostanie odrzucona przez sieciową grupę zabezpieczeń, usługa Batch ustawi stan węzłów obliczeniowych na **nienadające się do użytku**. 

- Jeśli określona sieć wirtualna ma skojarzone sieciowe grupy zabezpieczeń i/lub zaporę, skonfiguruj porty przychodzące i wychodzące tak, jak pokazano w poniższych tabelach:


  |    Porty docelowe    |    Źródłowy adres IP      |   Port źródłowy    |    Czy usługa Batch dodaje sieciowe grupy zabezpieczeń?    |    Wymagane do korzystania z maszyny wirtualnej?    |    Akcja użytkownika   |
  |---------------------------|---------------------------|----------------------------|----------------------------|-------------------------------------|-----------------------|
  |   <ul><li>W przypadku pul utworzonych za pomocą konfiguracji maszyny wirtualnej: 29876, 29877</li><li>W przypadku pul utworzonych za pomocą konfiguracji usług w chmurze: 10100, 20100, 30100</li></ul>        |    * lub, w celu zapewnienia dodatkowego zabezpieczenia, podaj adresy IP usługi Batch. Aby uzyskać listę adresów IP usługi Batch, skontaktuj się z pomocą techniczną platformy Azure. | * lub 443 |    Tak. Usługa Batch dodaje sieciowe grupy zabezpieczeń na poziomie interfejsów sieciowych (kart sieciowych) dołączonych do maszyn wirtualnych. Te sieciowe grupy zabezpieczeń zezwalają tylko na ruch z adresów IP roli usługi Batch. Nawet jeśli otworzysz te porty dla całego Internetu, ruch zostanie zablokowany na poziomie karty sieciowej. |    Yes  |  Nie musisz określać sieciowej grupy zabezpieczeń, ponieważ usługa Batch zezwala tylko na adresy IP usługi Batch. <br /><br /> Jeśli jednak określisz sieciową grupę zabezpieczeń, upewnij się, że te porty zostały otwarte na potrzeby ruchu przychodzącego. <br /><br /> Jeśli wybierzesz * jako źródłowy adres IP w sieciowej grupie zabezpieczeń, usługa Batch również doda sieciowe grupy zabezpieczeń na poziomie kart sieciowych dołączonych do maszyn wirtualnych. |
  |    3389 (Windows), 22 (Linux)               |    Maszyny użytkownika używane dla celów debugowania, dzięki czemu można uzyskiwać zdalny dostęp do maszyny wirtualnej.    |   *  | Nie                                    |    Nie                    |    Dodaj sieciowe grupy zabezpieczeń, jeśli chcesz zezwolić na zdalny dostęp (RDP lub SSH) do maszyny wirtualnej.   |                                


  |    Porty ruchu wychodzącego    |    Element docelowy    |    Czy usługa Batch dodaje sieciowe grupy zabezpieczeń?    |    Wymagane do korzystania z maszyny wirtualnej?    |    Akcja użytkownika    |
  |------------------------|-------------------|----------------------------|-------------------------------------|------------------------|
  |    443    |    Azure Storage    |    Nie    |    Yes    |    Jeśli dodasz sieciowe grupy zabezpieczeń, sprawdź, czy ten port został otwarty na potrzeby ruchu wychodzącego.    |

   Upewnij się również, że punkt końcowy usługi Azure Storage może zostać rozpoznany przez dowolne niestandardowe serwery DNS, które obsługują sieć wirtualną. W szczególności rozpoznawalne powinny być adresy URL formularzy `<account>.table.core.windows.net`, `<account>.queue.core.windows.net` i `<account>.blob.core.windows.net`. 

   Jeśli dodano sieciową grupę zabezpieczeń opartą na usłudze Resource Manager, możesz użyć [tagów usług](../articles/virtual-network/security-overview.md#service-tags) w celu wybrania adresów IP usługi Storage w określonym regionie dla połączeń wychodzących. Należy pamiętać, że adresy IP usługi Storage muszą należeć do tego samego regionu co Twoje konto usługi Batch i sieć wirtualna. Tagi usług są obecnie dostępne w wersji zapoznawczej w wybranych regionach świadczenia usługi Azure.