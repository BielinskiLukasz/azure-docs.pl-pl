<properties 
    pageTitle="自動スケーリングと App Service Environment" 
    description="自動スケーリングと App Service Environment" 
    services="app-service"
    documentationCenter=""
    authors="btardif" 
    manager="wpickett" 
    editor="" 
/>

<tags 
    ms.service="app-service" 
    ms.workload="web" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="10/09/2015" 
    ms.author="byvinyal"
/>


# 自動スケーリングと App Service Environment

## はじめに

**App Service 環境**では自動スケールをサポートしています。 自動スケールの個人化することによりこれは、 
メトリックまたはスケジュールに基づいてワーカー プール。

![][intro]

自動スケールでは、自動的に拡大および縮小によって、リソース使用率を最適化することができます、 
**App Service 環境** 予算に合わせて、または読み込みをプロファイルします。

## ワーカー プールの自動スケールの構成

自動スケール機能には、**ワーカー プール**の[設定] タブからアクセスできます。

![][settings-scale]

そこからインターフェイスこれ以降はかなり使い慣れたは操作と同じスケールする場合は、 
**App Service プラン**します。 スケール値は手動で入力できます。

![][scale-manual]

または、次のように自動スケール プロファイルを構成することもできます。

![][scale-profile]

自動スケール プロファイルは、スケールに対して制限を設定するのに便利です。 このように両方一貫性があることができます。 
パフォーマンスの状態は下限スケール値 (1) および支出の予測可能な上限を設定し、 
上限値 (2) を設定します。

![][scale-profile2]

メトリックに基づいた自動スケール ルールを追加することができます、プロファイルを定義すると、スケール上または下に、 
インスタンスの数、 **ワーカー プール** プロファイルで定義されている範囲内です。

![][scale-rule]

 **ワーカー プール**または**フロントエンド**の任意のメトリックを使用して、自動スケール ルールを定義することができます。 この 
 同じメトリックス リソース ブレードのグラフ内の監視や、アラートを設定できます。

## 自動スケールの例

**App Service 環境**の自動スケールの説明は、シナリオを通して行うのが最も効果的です。 
この記事の内容を見ていくために必要なすべてを考慮自動スケールを設定する場合、 
自動スケーリングのことを考慮する場合に効果を発揮するすべての相互作用 **App Service 環境** を 
ASE でホストされます。

### シナリオの概要

Frank は、エンタープライズ システム管理者、彼に勤務し管理するワークロードの一部を移行します。 
**App Service 環境**します。

**App Service 環境** 次のように手動でのスケーリングするように構成されます。
* フロント エンド: 3
* ワーカー プール 1時 10分
* ワーカー プール 2: 5
* ワーカー プール 3: 5

**ワーカー プール 1** はときに使用すると、運用環境のワークロード、 **ワーカー プール 2** と **ワーカー プール 3** 
QA および開発のワークロードに使用されます。

**App Service プランの** 使用 QA およびデベロッパーが用に構成されている **手動でのスケーリング** が、運用環境 
**App Service プラン** に設定されている **自動スケール** 負荷とトラフィックの変動に対処します。

Frank は、アプリケーションに関する豊富な知識と間の負荷のピーク時間ことがわかっています 
午前 9時 00分と午後 6 時はこのため、 **LOB アプリケーション** は中に、従業員によって使用されます 
office です。 その後、ユーザーがその日の業務を終了すると、使用量は低下します。 まだいくつかの読み込み 
ユーザーがアクセスできるリモートでのモバイル デバイスや自宅のコンピューターのためです。 運用環境 
**App Service プラン** に既に構成されている **自動スケール** を次の CPU 使用率に基づく 
ルール:

![][asp-scale]

| **自動スケール プロファイル – 平日 – App Service プラン**| **自動スケール プロファイル – 週末 – App Service プラン**|
|   ----------------------------------------------------    |   ----------------------------------------------------    |
| **名前:** 平日のプロファイル| **名前:** 週末のプロファイル|
| **スケール:** スケジュールおよびパフォーマンスのルール| **スケール:** スケジュールおよびパフォーマンスのルール|
| **プロファイル:** 平日| **プロファイル:** 週末|
| **種類:** 繰り返し| **種類:** 繰り返し|
| **対象範囲:** 5 ～ 20 のインスタンス| **対象範囲:** 3 ～ 10 のインスタンス|
| **日:** 月曜日、火曜日、水曜日、木曜日、金曜日| **日:** 土曜日、日曜日|
| **開始時刻:** 午前 9 時 00 分| **開始時刻:** 午前 9 時 00 分|
| **タイム ゾーン:** UTC - 08| **タイム ゾーン:** UTC - 08|
| | |
| **自動スケール ルール (スケールアップ)**| **自動スケール ルール (スケールアップ)**|
| **リソース:** 運用環境 (App Service 環境)| **リソース:** 運用環境 (App Service 環境)|
| **メトリック:** CPU %| **メトリック:** CPU %|
| **操作:** 60% 超過| **操作:** 80% 超過|
| **期間:** 5 分| **期間:** 10 分|
| **集計時間:** 平均| **集計時間:** 平均|
| **アクション:** カウント数を 2 ずつ増加| **アクション:** カウント数を 1 ずつ増加|
| **クールダウン (分):** 15| **クールダウン (分):** 20|
| | |
| **自動スケール ルール (スケールダウン)**| **自動スケール ルール (スケールダウン)**|
| **リソース:** 運用環境 (App Service 環境)| **リソース:** 運用環境 (App Service 環境)|
| **メトリック:** CPU %| **メトリック:** CPU %|
| **操作:** 30% 未満| **操作:** 20% 未満|
| **期間:** 10 分| **期間:** 15 分|
| **集計時間:** 平均| **集計時間:** 平均|
| **アクション:** カウント数を 1 ずつ減少| **アクション:** カウント数を 1 ずつ減少|
| **クールダウン (分):** 20| **クールダウン (分):** 10|

### App Service プランの増加率

自動スケールに構成された **App Service プラン**は、1 時間あたりの最大レートで処理を行います。 このレート 
できますが、自動スケール ルールの指定された値にに基づいて計算されます。

理解し、計算、 **App Service プランが増加率** が重要 
**App Service 環境** **ワーカー プール** スケールからの自動スケールを変更する、 **ワーカー プール** は 
ない瞬間的な適用する時間がかかる操作を行います。

**App Service プラン**の増加率は次のように計算します。

![][asp-inflation]

に基づいて、 *スケール アップの自動スケール* に対するルール、 *平日* 、運用のプロファイル 
**App Service プラン** これは次のようになります。

![][equation1]

場合、 *スケール アップ: 自動スケール* に対するルール、 *週末* 、運用のプロファイル 
**App Service プラン** 数式を解決するには。

![][equation2]

この値は、スケールダウン操作についても計算できます。

に基づいて、 *スケール ダウンの自動スケール* に対するルール、 *平日* 、運用のプロファイル 
**App Service プラン** これは次のようになります。

![][equation3]

場合、 *スケール ダウン – 自動スケール* に対するルール、 *週末* 、運用のプロファイル 
**App Service プラン** 数式を解決するには。

![][equation4]

これにより、運用環境が **App Service プラン** 最大速度に大きくなる **8** 
1 週間に 1 時間あたりのインスタンスと **4** 週末に 1 時間あたりのインスタンス。 そのことができます、 
最大レートでインスタンスを解放 **4** 1 週間に 1 時間あたりのインスタンスと **6** インスタンス 
1 週末時間です。

複数の **App Service プランの** でホストされている、 **ワーカー プール**, 、 **合計が増加率** 
計算する必要がありますし、これは、として表す、 *合計* すべてが増加率の 
**App Service プランの** でホストされている **ワーカー プール**します。

![][asp-total-inflation]

### App Service プランの増加率を使用してワーカー プールの自動スケール ルールを定義する

**ワーカー プール** をホストする **App Service プランの** に構成されている自動スケールがする必要があります 
拡大/縮小する自動スケール操作を許可する容量のバッファーを確保する、 
**App Service プラン** 必要に応じて。 計算された最小バッファーになります 
**App Service プランが増加率の合計**します。

**App Service 環境** スケール操作の適用に時間がかかる、何らかの変更を考慮する必要があります 
評価中に発生する可能性がありますそれ以上の要求変更操作が進行中です。 この私たちの 
計算済みの使用が推奨 **合計アプリ サービス プランが増加率** の最小数 
インスタンスを自動スケール操作ごとに追加します。

フランクは、この情報を使用して次の自動スケール プロファイルとルールを定義することができます。

![][worker-pool-scale]

| **自動スケール プロファイル – 平日**| **自動スケール プロファイル – 週末**|
|   ----------------------------------------------------    |   --------------------------------------------    |
| **名前:** 平日のプロファイル| **名前:** 週末のプロファイル|
| **スケール:** スケジュールおよびパフォーマンスのルール| **スケール:** スケジュールおよびパフォーマンスのルール|
| **プロファイル:** 平日| **プロファイル:** 週末|
| **種類:** 繰り返し| **種類:** 繰り返し|
| **対象範囲:** 13 ～ 25 のインスタンス| **対象範囲:** 6 ～ 15 のインスタンス|
| **日:** 月曜日、火曜日、水曜日、木曜日、金曜日| **日:** 土曜日、日曜日|
| **開始時刻:** 午前 7 時 00 分| **開始時刻:** 午前 9 時 00 分|
| **タイム ゾーン:** UTC - 08| **タイム ゾーン:** UTC - 08|
| | |
| **自動スケール ルール (スケールアップ)**| **自動スケール ルール (スケールアップ)**|
| **リソース:** ワーカー プール 1| **リソース:** ワーカー プール 1|
| **メトリック:** WorkersAvailable| **メトリック:** WorkersAvailable|
| **操作:** 8 未満| **操作:** 3 未満|
| **期間:** 20 分| **期間:** 30 分|
| **集計時間:** 平均| **集計時間:** 平均|
| **アクション:** カウント数を 8 ずつ増加| **アクション:** カウント数を 3 ずつ増加|
| **クールダウン (分):** 90| **クールダウン (分):** 90|
| | |
| **自動スケール ルール (スケールダウン)**| **自動スケール ルール (スケールダウン)**|
| **リソース:** ワーカー プール 1| **リソース:** ワーカー プール 1|
| **メトリック:** WorkersAvailable| **メトリック:** WorkersAvailable|
| **操作:** 8 超過| **操作:** 3 未満|
| **期間:** 20 分| **期間:** 15 分|
| **集計時間:** 平均| **集計時間:** 平均|
| **アクション:** カウント数を 2 ずつ減少| **アクション:** カウント数を 3 ずつ減少|
| **クールダウン (分):** 90| **クールダウン (分):** 90|

定義されている最小インスタンスによって、プロファイルで定義されている対象範囲を計算します 
プロファイルを **App Service プラン** + バッファー。

最大範囲をすべてのすべての最大範囲の合計となる **App Service プランの** でホストされています。 
**ワーカー プール**します。

X は 1 以上であるにスケール アップ ルールの増加数を設定する必要があります、 
**アプリ サービス プランが増加率** のスケール アップします。

数が増減する数は、1/2 X または X 1 の間のものに調整できる、* * App Service のプランが増加 
レート * * のスケール ダウンします。

### フロントエンド プールの自動スケール

**フロント エンド** 自動スケール ルールはにとってよりも簡単 **ワーカー プール**, 、主な特徴を探しますが、 
スケール アウトするという事実を考慮に入れて測定および cooldown タイマー take のことを確認して期間を作成します。 
操作、 **App Service プラン** 瞬時ではありません。

このシナリオでは、Frank を知っているフロント エンドが CPU 使用率を 80% に達すると、エラー率が増加します。 
これを防ぐには、次のようにインスタンス数の増加を自動スケール ルール彼は設定します。

![][front-end-scale]

| **自動スケール プロファイル – フロントエンド**|
|   --------------------------------------------    |
| **名前:** 自動スケール – フロントエンド|
| **スケール:** スケジュールおよびパフォーマンスのルール|
| **プロファイル:** 毎日|
| **種類:** 繰り返し|
| **対象範囲:** 3 ～ 10 のインスタンス|
| **日:** 毎日|
| **開始時刻:** 午前 9 時 00 分|
| **タイム ゾーン:** UTC - 08|
| |
| **自動スケール ルール (スケールアップ)**|
| **リソース:** フロントエンド プール|
| **メトリック:** CPU %|
| **操作:** 60% 超過|
| **期間:** 20 分|
| **集計時間:** 平均|
| **アクション:** カウント数を 3 ずつ増加|
| **クールダウン (分):** 90|
| |
| **自動スケール ルール (スケールダウン)**|
| **リソース:** ワーカー プール 1|
| **メトリック:** CPU %|
| **操作:** 30% 未満|
| **期間:** 20 分|
| **集計時間:** 平均|
| **アクション:** カウント数を 3 ずつ減少|
| **クールダウン (分):** 90|



[intro]: ./media/app-service-environment-auto-scale/introduction.png 
[settings-scale]: ./media/app-service-environment-auto-scale/settings-scale.png 
[scale-manual]: ./media/app-service-environment-auto-scale/scale-manual.png 
[scale-profile]: ./media/app-service-environment-auto-scale/scale-profile.png 
[scale-profile2]: ./media/app-service-environment-auto-scale/scale-profile-2.png 
[scale-rule]: ./media/app-service-environment-auto-scale/scale-rule.png 
[asp-scale]: ./media/app-service-environment-auto-scale/asp-scale.png 
[asp-inflation]: ./media/app-service-environment-auto-scale/asp-inflation-rate.png 
[equation1]: ./media/app-service-environment-auto-scale/equation1.png 
[equation2]: ./media/app-service-environment-auto-scale/equation2.png 
[equation3]: ./media/app-service-environment-auto-scale/equation3.png 
[equation4]: ./media/app-service-environment-auto-scale/equation4.png 
[asp-total-inflation]: ./media/app-service-environment-auto-scale/asp-total-inflation-rate.png 
[worker-pool-scale]: ./media/app-service-environment-auto-scale/wp-scale.png 
[front-end-scale]: ./media/app-service-environment-auto-scale/fe-scale.png 

