<properties
   pageTitle="Azure Tools を使用したクラウド サービスの発行 | Microsoft Azure"
   description="Visual Studio を使用して Azure クラウド サービス プロジェクトを発行する方法について説明します。"
   services="visual-studio-online"
   documentationCenter="na"
   authors="TomArcher"
   manager="douge"
   editor="" />
<tags
   ms.service="multiple"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="multiple"
   ms.date="09/04/2015"
   ms.author="tarcher" />


# Azure Tools を使用したクラウド サービスの発行

Azure Tools for Microsoft Visual Studio を使用することで、Azure アプリケーションを Visual Studio から直接発行できます。 Visual Studio では、クラウド サービスのステージング環境または運用環境への統合された発行をサポートしています。

Azure アプリケーションを発行するには、Azure サブスクリプションが必要です。 また、アプリケーションで使用するようにクラウド サービスおよびストレージ アカウントを設定する必要があります。 設定できます、 [Azure 管理ポータル](http://go.microsoft.com/fwlink/?LinkID=213885)します。
>[AZURE.IMPORTANT] 発行時に、クラウド サービスのデプロイ環境を選択できます。 デプロイ用のアプリケーション パッケージの格納に使用するストレージ アカウントも選択する必要があります。 デプロイ後、アプリケーション パッケージはストレージ アカウントから削除されます。 これらのサービスを設定する方法の詳細については、次を参照してください。 [設定をサービスに必要なクラウド サービスを発行](vs-azure-tools-setting-up-services-required-to-publish-a-cloud-service-from-visual-studio.md) Visual Studio からです。

Azure アプリケーションを開発およびテストするときは、Web Deploy を使用して、Web ロールの変更を段階的に発行することができます。 アプリケーションをデプロイ環境に発行したら、Web Deploy を使用して、Web ロールを実行している仮想マシンに変更を直接デプロイできます。 変更をテストするために Web ロールを更新するたびに、Azure アプリケーション全体をパッケージ化して発行する必要はありません。 この方法では、アプリケーションがデプロイ環境に発行されるのを待たなくても、クラウドで Web ロールの変更をテストできます。

Azure アプリケーションを発行し、Web Deploy を使用して Web ロールを更新するには、次の手順に従います。

- Visual Studio からの Azure アプリケーションの発行またはパッケージ化

- 開発およびテスト サイクルの一環としての Web ロールの更新

## Visual Studio からの Azure アプリケーションの発行またはパッケージ化

Azure アプリケーションを発行するときは、次のいずれかの作業を行います。

- サービス パッケージを作成します。 このパッケージとサービス構成ファイルを使用するには、アプリケーションからのデプロイ環境を発行する、 [Azure 管理ポータル](http://go.microsoft.com/fwlink/?LinkID=213885)します。

- Visual Studio から Azure プロジェクトを発行する: アプリケーションを Azure に直接発行するには、発行ウィザードを使用します。 詳細については、次を参照してください。 [Azure アプリケーションの発行ウィザード](vs-azure-tools-publish-azure-application-wizard.md)します。

### Visual Studio からサービス パッケージを作成するには

1. アプリケーションを発行する準備ができたら、ソリューション エクスプローラーを開き、ロールを含む Azure プロジェクトのショートカット メニューを開いて、[発行] をクリックします。

1. サービス パッケージだけを作成するには、次の手順に従います。

  1. Azure プロジェクトのショートカット メニューで、**[パッケージ]** をクリックします。

  1. **[Azure アプリケーションのパッケージ化]** ダイアログ ボックスで、パッケージを作成するサービス構成を選択し、ビルド構成を選択します。

  1. (省略可能) 発行後にクラウド サービスのリモート デスクトップを有効にするには、**[すべてのロールのリモート デスクトップを有効にする]** チェック ボックスをオンにし、**[設定]** をクリックしてリモート デスクトップを構成します。 クラウド サービスを発行後にデバッグする場合は、**[すべてのロールのリモート デバッガーを有効にする]** を選択してリモート デバッグを有効にします。

      詳細については、次を参照してください。 [Azure ロールでリモート デスクトップを使用する](vs-azure-tools-using-remote-desktop-with-azure-roles.md)します。

  1. パッケージを作成するには、**[パッケージ]** リンクをクリックします。

      ファイル エクスプ ローラーに、新しく作成されたパッケージのファイルの場所が表示されます。 Azure 管理ポータルから使用できるように、この場所をコピーできます。

  1. このパッケージをデプロイ環境で発行する必要があります場所を使用するこのパッケージの場所としてクラウド サービスを作成して環境にこのパッケージを展開するときに、 [Azure 管理ポータル](http://go.microsoft.com/fwlink/?LinkID=213885)します。

1. (省略可能) デプロイ プロセスをキャンセルするには、アクティビティ ログの行項目のショートカット メニューで、**[取り消して削除]** を選択します。 これにより、デプロイ プロセスが停止し、Azure からデプロイ環境が削除されます。
    >[AZURE.NOTE] このデプロイ環境をデプロイ後に削除するには、Azure 管理ポータルを使用する必要があります。

1. (省略可能) ロール インスタンスが起動すると、Visual Studio のサーバー エクスプローラーの **[クラウド サービス]** ノードにデプロイ環境が自動的に表示されます。 ここから、個々のロール インスタンスの状態を確認できます。 参照してください [クラウド エクスプ ローラーで Azure の管理リソース](vs-azure-tools-resources-managing-with-cloud-explorer.md)します。次の図は、まだ初期化中状態ではロール インスタンスを示しています。

    ![VST_DeployComputeNode](./media/vs-azure-tools-publishing-a-cloud-service/IC744134.png)

## 開発およびテスト サイクルの一環としての Web ロールの更新

アプリケーションのバックエンド インフラストラクチャは安定していても、Web ロールを頻繁に更新する必要がある場合は、Web Deploy を使用してプロジェクトの Web ロールだけを更新できます。 これは、バックエンド worker ロールの再構築と再デプロイを避ける場合や、複数の Web ロールの中の 1 つだけを更新する場合に便利です。

### 必要条件

Web Deploy を使用して、Web ロールを更新するための要件を次に示します。

- **開発とテストのみを目的とする:** Web ロールが実行されている仮想マシンに直接変更が加えられます。 この仮想マシンをリサイクルする必要がある場合、発行済みの元のパッケージを使用してロールの仮想マシンが再作成されるため、変更は失われます。 Web ロールの最新の変更を取得するには、アプリケーションを再発行する必要があります。

- **Web ロールだけを更新できる:** ワーカー ロールは更新できません。 また、web role.cs で RoleEntryPoint を更新することもできません。

- **サポートできる Web ロールのインスタンスは 1 つに限られる:** デプロイ環境で Web ロールの複数のインスタンスを使用することはできません。 ただし、それぞれにインスタンスを 1 つだけ持つ複数の Web ロールがサポートされます。

- **リモート デスクトップ接続を有効にする必要がある:** これは、Web Deploy でユーザーとパスワードを使用して仮想マシンに接続し、インターネット インフォメーション サービス (IIS) を実行しているサーバーに変更をデプロイできるようにするために必要となります。 また、仮想マシンに接続して、その仮想マシン上の IIS に信頼された証明書を追加することが必要な場合もあります  (これにより、Web Deploy によって使用される IIS のリモート接続のセキュリティが確保されます)。

次の手順は、**Azure アプリケーションの公開**ウィザードを使用していることを前提としています。

### アプリケーションの発行時に Web Deploy を有効にするには

1. **[すべての Web ロールの Web 配置を有効にする]** チェック ボックスを有効にするには、リモート デスクトップ接続を構成しておく必要があります。 **[すべてのロールのリモート デスクトップを有効にする]** を選択し、表示される **[リモート デスクトップ構成]** ボックスに、リモート接続に使用する資格情報を入力します。 参照してください [Azure ロールでリモート デスクトップを使用する](vs-azure-tools-remote-desktop-roles.md) の詳細。

1. アプリケーションのすべての Web ロールの Web Deploy を有効にするには、**[すべての Web ロールの Web 配置を有効にする]** を選択します。

    警告を表す黄色の三角形が表示されます。 Web Deploy では、信頼されていない自己署名証明書が既定で使用されます。これは、機密データをアップロードする場合には推奨されません。 機密データのためにこのプロセスを保護する必要がある場合は、Web Deploy の接続に使用する SSL 証明書を追加できます。 この証明書は、信頼された証明書であることが必要です。 この方法については、このトピックで後述する「**Web Deploy のセキュリティを確保するには**」をご覧ください。

1. **[次へ]** をクリックして **[概要]** 画面を表示し、**[発行]** をクリックしてクラウド サービスをデプロイします。

    クラウド サービスが発行されます。 作成される仮想マシンでは IIS のリモート接続が有効になっているため、Web ロールを再発行しなくても、Web Deploy を使用してそれらのロールを更新できます。
    >[AZURE.NOTE] Web ロールの複数のインスタンスを構成している場合、アプリケーションを発行するために作成されるパッケージでは、Web ロールごとに 1 つのインスタンスに制限されることを示す警告メッセージが表示されます。 [OK] をクリックして続行します。 「必要条件」で説明したように、複数の Web ロールを使用できますが、インスタンスはロールごとに 1 つに限られます。

### Web Deploy を使用して Web ロールを更新するには

1. Web Deploy を使用するには、発行する Web ロールのプロジェクトに Visual Studio でコードの変更を加え、ソリューションでこのプロジェクト ノードを右クリックして、**[発行]** をポイントします。 **[Web の発行]** ダイアログ ボックスが表示されます。

1. (省略可能) IIS のリモート接続に使用する信頼された SSL 証明書を追加した場合は、**[信頼されていない証明書を許可する]** チェック ボックスをオフにすることができます。 証明書を追加して Web Deploy のセキュリティを確保する方法については、このトピックで後述する「**Web Deploy のセキュリティを確保するには**」をご覧ください。

1. Web Deploy を使用するには、パッケージを最初に発行したときにリモート デスクトップ接続用に設定したユーザー名とパスワードが必要です。

  1. **[ユーザー名]** に、ユーザー名を入力します。

  1. **[パスワード]** に、パスワードを入力します。

  1. (省略可能) このパスワードをこのプロファイルに保存する場合は、**[パスワードの保存]** を選択します。

1. Web ロールへの変更を発行するには、**[発行]** をクリックします。

    状態行に **[発行を開始しました]** と表示されます。 発行が完了すると、**[発行は成功しました]** と表示されます。 これで、仮想マシンの Web ロールに変更がデプロイされました。 Azure 環境で Azure アプリケーションを起動して変更をテストできます。

### Web Deploy のセキュリティを確保するには

1. Web Deploy では、信頼されていない自己署名証明書が既定で使用されます。これは、機密データをアップロードする場合には推奨されません。 機密データのためにこのプロセスを保護する必要がある場合は、Web Deploy の接続に使用する SSL 証明書を追加できます。 この証明書は、証明機関 (CA) から取得した信頼された証明書であることが必要です。

    Web Deploy のセキュリティ保護する仮想マシンごとに各 web ロール、web を使用する信頼された証明書をアップロードする必要がありますに展開、 [Azure 管理ポータル](http://go.microsoft.com/fwlink/?LinkID=213885)します。 これにより、アプリケーションの発行時に作成される Web ロールの仮想マシンに証明書が確実に追加されます。

1. リモート接続に使用する信頼された SSL 証明書を IIS に追加するには、次の手順を実行します。

  1. Web ロールを実行している仮想マシンに接続するには、**クラウド エクスプローラー**または**サーバー エクスプローラー**で Web ロールのインスタンスをクリックし、**[リモート デスクトップを使用して接続]** をクリックします。 仮想マシンに接続する方法の詳細については、次を参照してください。 [Azure ロールでリモート デスクトップを使用する](vs-azure-tools-remote-desktop-roles.md)します。

      ブラウザーに .RDP ファイルのダウンロードを求めるメッセージが表示されます。

  1. SSL 証明書を追加するには、IIS マネージャーで管理サービスを開きます。 IIS マネージャーで、**[操作]** ウィンドウの **[バインド]** リンクを開いて SSL を有効にします。 **[サイト バインドの追加]** ダイアログ ボックスが表示されます。 **[追加]** を選択し、**[種類]** ボックスの一覧の HTTPS を選択します。 **[SSL 証明書]** 一覧で、Azure 管理ポータルにアップロードした、CA による署名済みの SSL 証明書を選択します。 詳細については、次を参照してください。 [管理サービスの接続設定の構成](http://go.microsoft.com/fwlink/?LinkId=215824)します。
      >[AZURE.NOTE] 信頼された SSL 証明書を追加すると、**発行ウィザード**で警告を表す黄色の三角形が表示されなくなります。

## サービス パッケージにファイルを含める

作成されるロールの仮想マシンで特定のファイルを使用できるように、サービス パッケージにそれらのファイルを含めることが必要な場合があります。 たとえば、スタートアップ スクリプトで使用する .exe ファイルまたは .msi ファイルをサービス パッケージに追加する場合があります。 また、Web ロール プロジェクトまたは worker ロール プロジェクトに必要なアセンブリを追加することが必要な場合もあります。 ファイルを含めるには、そのファイルを Azure アプリケーションのソリューションに追加する必要があります。

### サービス パッケージにファイルを含めるには

1. サービス パッケージにアセンブリを追加するには、次の手順に従います。

  1. **ソリューション エクスプローラー**で、参照アセンブリが欠けているプロジェクトのプロジェクト ノードを開きます。

  1. アセンブリをプロジェクトに追加するには、**[参照]** フォルダーのショートカット メニューを開き、**[参照の追加]** をクリックします。 [参照の追加] ダイアログが表示されます。

  1. 追加する参照を選択し、**[OK]** をクリックします。

      **[参照]** フォルダーの下の一覧に参照が追加されます。

  1. 追加したアセンブリのショートカット メニューを開き、**[プロパティ]** をクリックします。 **[プロパティ]** ウィンドウが表示されます。

      このアセンブリをサービス パッケージに含めるには、**[ローカルにコピー]** 一覧で **[True]** を選択します。

1. **ソリューション エクスプローラー**で、参照アセンブリが欠けているプロジェクトのプロジェクト ノードを開きます。

1. アセンブリをプロジェクトに追加するには、**[参照]** フォルダーのショートカット メニューを開き、**[参照の追加]** をクリックします。 **[参照の追加]** ダイアログが表示されます。

1. 追加する参照を選択し、**[OK]** をクリックします。

    **[参照]** フォルダーの下の一覧に参照が追加されます。

1. 追加したアセンブリのショートカット メニューを開き、**[プロパティ]** をクリックします。 [プロパティ] ウィンドウが表示されます。

1. このアセンブリをサービス パッケージに含めるには、**[ローカルにコピー]** 一覧で **[True]** を選択します。

1. Web ロール プロジェクトに追加したサービス パッケージにファイルを含めるには、ファイルのショートカット メニューを開き、**[プロパティ]** をクリックします。 **[プロパティ]** ウィンドウで、**[ビルド アクション]** ボックスの一覧の **[コンテンツ]** をクリックします。

1. worker ロール プロジェクトに追加したサービス パッケージにファイルを含めるには、ファイルのショートカット メニューを開き、**[プロパティ]** をクリックします。 **[プロパティ]** ウィンドウで、**[出力ディレクトリにコピー]** ボックスの一覧の **[新しい場合はコピーする]** をクリックします。

## 次のステップ

Azure への発行の詳細を Visual Studio からについて、次を参照してください。 [Azure アプリケーションの発行ウィザード](vs-azure-tools-publish-azure-application-wizard.md)します。





