<properties 
   pageTitle="StorSimple デバイス コントローラーを交換する | Microsoft Azure"
   description="StorSimple デバイスの一方または両方のコントローラー モジュールを取り外して交換する方法について説明します。"
   services="storsimple"
   documentationCenter=""
   authors="alkohli"
   manager="carolz"
   editor="" />
<tags 
   ms.service="storsimple"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="TBD"
   ms.date="12/02/2015"
   ms.author="alkohli" />


# StorSimple デバイスのコントローラー モジュールを交換する

## 概要

このチュートリアルでは、StorSimple デバイスの一方または両方のコントローラー モジュールを取り外して交換する方法について説明します。 また、シングルまたはデュアル コントローラーの交換シナリオの基になるロジックも説明します。
>[AZURE.NOTE] コントローラーの交換を実行する前に、コントローラーのファームウェアを最新バージョンに更新することを常にお勧めします。
>
>StorSimple デバイスの損傷を防ぐため、LED が次のいずれかを示すまで、コントローラーを取り出さないでください。
>
>-すべて消灯しています。
>LED 3、 ![緑のチェック マーク アイコン](./media/storsimple-controller-replacement/HCS_GreenCheckIcon.png), 、および ![赤の十字アイコン](./media/storsimple-controller-replacement/HCS_RedCrossIcon.png) 点滅しているし、LED 0 と LED 7 が **ON**します。

次の表では、サポートされているコントローラー交換シナリオを示します。

| ケース| 交換シナリオ| 適用される手順|
|:---|:-------------------|:-------------------|
| 1| 1 つのコントローラーは障害状態で、他のコントローラーは正常でアクティブです。| [1 つのコント ローラーの交換](#replace-a-single-controller), 、説明なものを [シングル コント ローラー交換ロジック](#single-controller-replacement-logic), 、だけでなく、 [交換手順](#single-controller-replacement-steps)します。|
| 2| 両方のコントローラーが障害状態で交換が必要です。シャーシ、ディスク、ディスク エンクロージャは正常です。| [デュアル コント ローラー交換](#replace-both-controllers), 、説明なものを [デュアル コント ローラー交換ロジック](#dual-controller-replacement-logic), 、だけでなく、 [交換手順](#dual-controller-replacement-steps)します。|
| 3| 同じデバイスまたは異なるデバイスのコントローラーをスワップします。シャーシ、ディスク、ディスク エンクロージャは正常です。| スロット不一致の警告メッセージが表示されます。|
| 4| 1 つのコントローラーはなく、他のコントローラーは障害状態です。| [デュアル コント ローラー交換](#replace-both-controllers), 、説明なものを [デュアル コント ローラー交換ロジック](#dual-controller-replacement-logic), 、だけでなく、 [交換手順](#dual-controller-replacement-steps)します。|
| 5| 1 つまたは両方のコントローラーが障害状態です。シリアル コンソールまたは Windows PowerShell リモート処理でデバイスにアクセスできません。| [Microsoft サポートに問い合わせる](storsimple-contact-microsoft-support.md) 手動コント ローラーの交換手順のです。|
| 6| コント ローラーがある、別のビルド バージョン、原因が考えられます:<ul><li>コント ローラーには、別のソフトウェア バージョンがインストールされている</li>。<li>コント ローラーには、ファームウェアの異なるバージョンがインストールされています。</li></ul>| コント ローラーのソフトウェア バージョンが異なる場合、交換ロジックことを検出し、交換用コント ローラーのソフトウェアのバージョンを更新します。<br><br>かどうか、コント ローラーのファームウェア バージョンが異なると、古いファームウェア バージョンが **いない** 自動的にアップグレード可能な警告メッセージが表示 Azure クラシック ポータルで。更新をスキャンし、ファームウェアの更新プログラムをインストールする必要があります。</br></br>場合は、コント ローラーのファームウェア バージョンが異なると、古いファームウェア バージョンが自動的にアップグレード可能なコント ローラー交換ロジックが、これを検出およびファームウェアが自動的に更新されたコント ローラーが起動するとします。|

障害がある場合はコントローラー モジュールを取り外す必要があります。 一方または両方のコントローラー モジュールが故障する可能性があり、シングル コントローラー交換またはデュアル コントローラー交換が発生する場合があります。 交換手順と背景のロジックについては、以下を参照してください。

- [1 つのコント ローラーを交換します。](#replace-a-single-controller)
- [両方のコント ローラーを交換します。](#replace-both-controllers)
- [コント ローラーを取り外す](#remove-a-controller)
- [コント ローラーの挿入します。](#insert-a-controller)
- [デバイスのアクティブなコント ローラーを識別します。](#identify-the-active-controller-on-your-device)

>[AZURE.IMPORTANT] 削除して、コント ローラーを置き換えるの安全に関する情報を確認する前に [StorSimple ハードウェア コンポーネントの交換](storsimple-hardware-component-replacement.md)します。

## 1 台のコントローラーを交換する

正常に機能しない、またはが不足して Microsoft Azure StorSimple デバイスの 2 つのコント ローラーのいずれかが失敗した、1 つのコント ローラーを交換する必要があります。

### シングル コントローラー交換ロジック

シングル コントローラー交換では、最初に故障したコントローラーを取り外す必要があります  (デバイスの残りのコントローラーはアクティブなコントローラーです)。 交換したコントローラーを挿入すると、次の操作が行われます。

1. 交換したコントローラーはすぐに StorSimple デバイスとの通信を開始します。

2. アクティブなコントローラーの仮想ハード ドライブ (VHD) のスナップショットが、交換したコントローラーにコピーされます。

3. スナップショットは、交換したコントローラーがこの VHD から起動されるときはスタンバイ コントローラーとして認識されるように変更されます。

4. 変更が完了すると、交換したコントローラーはスタンバイ コントローラーとして起動します。

5. 両方のコントローラーが稼動すると、クラスターがオンラインになります。

### シングル コントローラー交換手順

Microsoft Azure StorSimple デバイスのコントローラーの一方が故障した場合は、次の手順を実行します  (他のコントローラーはアクティブで実行している必要があります。 両方のコント ローラーができないか、または正しく機能しない場合は、「 [デュアル コント ローラーの交換手順](#dual-controller-replacement-steps).)
>[AZURE.NOTE] コントローラーが再起動して、シングル コントローラー交換手順から完全に復旧するまでに 30 ～ 45 分かかることがあります。 ケーブルの接続を含む手順全体の合計時間は、およそ 2 時間です。

#### 故障した 1 台のコントローラー モジュールを取り外すには

1. StorSimple Manager サービスの Azure クラシック ポータルで、**[デバイス]** タブをクリックし、監視対象デバイスの名前をクリックします。

2. **[メンテナンス]** タブをクリックし、**[ハードウェアの状態]** に移動します。 コントローラー 0 またはコントローラー 1 のいずれかの状態が赤で故障を示している必要があります。
    >[AZURE.NOTE] シングル コントローラー交換では故障したコントローラーは常にスタンバイ コントローラーです。

3. 図 1 と次の表を使用して、故障したコントローラー モジュールを特定します。

    ![デバイスの主エンクロージャ モジュールのバックプレーン](./media/storsimple-controller-replacement/IC740994.png)

    **図 1** StorSimple デバイスの背面

   | ラベル| 説明|
   |:----|:----------|
   | 1| PCM 0|
   | 2| PCM 1|
   | 3| コントローラー 0|
   | 4| コントローラー 1|

4. 故障したコントローラーで、接続されているすべてのネットワーク ケーブルをデータ ポートから外します。 8600 モデルを使用している場合は、コントローラーを EBOD コントローラーに接続している SAS ケーブルも外します。

5. 手順に従います [コント ローラーを取り外す](#remove-a-controller) 故障したコント ローラーを削除します。

6. 故障したコントローラーを取り外した同じスロットに、ファクトリ交換品を取り付けます。 これにより、シングル コントローラー交換ロジックが開始します。 詳細については、次を参照してください。 [1 つのコント ローラー交換ロジック](#single-controller-replacement-logic)します。

7. シングル コントローラー交換ロジックがバックグラウンドで進行している間に、ケーブルを再接続します。 交換前の接続とまったく同じようにすべてのケーブルを接続するように注意してください。

8. コントローラーが再起動した後、Azure クラシック ポータルで **[コントローラーの状態]** と **[クラスターの状態]** を調べて、コントローラーが正常な状態に戻ってスタンバイ モードになっていることを確認します。

>[AZURE.NOTE] シリアル コンソールでデバイスを監視している場合は、交換手順からコントローラーが復旧している間に再起動が複数回表示される可能性があります。 シリアル コンソール メニューが表示されると、交換が完了したことがわかります。 コント ローラーの交換を開始してから 2 時間以内に、メニューが表示されない場合は、次のようにしてください。 [Microsoft サポートにお問い合わせ](storsimple-contact-microsoft-support.md)します。

## 両方のコントローラーを交換する

Microsoft Azure StorSimple デバイスの両方のコント ローラーが障害状態では、またはが欠落して、ときに、両方のコント ローラーを交換する必要があります。

### デュアル コントローラー交換ロジック

デュアル コントローラー交換では、最初に故障した両方のコントローラーを取り外した後、交換用コントローラーを挿入します。 2 台の交換用コントローラーを挿入すると、次の操作が行われます。

1. スロット 0 の交換したコントローラーで、次の項目が確認されます。

   1. 最新バージョンのファームウェアおよびソフトウェアを使用しているか。

   2. クラスターの一部か。

   3. ピア コントローラーは稼動していて、クラスター化されているか。

    いずれの項目も当てはまらない場合、コントローラーは最新の日次バックアップを検索します (ドライブ S の **nonDOMstorage** にあります)。 コントローラーは、バックアップから VHD の最新のスナップショットをコピーします。

2. スロット 0 のコントローラーは、スナップショットを使用して自分のイメージを作成します。

3. 一方、スロット 1 のコントローラーは、コントローラー 0 がイメージの作成を完了して開始するのを待ちます。

4. コントローラー 0 が起動した後、コントローラー 1 はコントローラー 0 によって作成されたクラスターを検出し、シングル コントローラー交換ロジックをトリガーします。 詳細については、次を参照してください。 [1 つのコント ローラー交換ロジック](#single-controller-replacement-logic)します。

5. その後、両方のコントローラーが稼動して、クラスターがオンラインになります。

>[AZURE.IMPORTANT] デュアル コントローラー交換に続き、StorSimple デバイスを構成した後で、必ず手動でデバイスのバックアップを作成します。 24 時間経過するまで、デバイス構成の日次バックアップはトリガーされません。 扱う [Microsoft サポート](storsimple-contact-microsoft-support.md) 、デバイスのバックアップを手動で作成します。

### デュアル コントローラー交換手順

Microsoft Azure StorSimple デバイスの両方のコントローラーが故障した場合、このワークフローが必要です。 このようなことは、データセンターで冷却システムが停止し、その結果、短時間で両方のコントローラーが故障した場合に、発生する可能性があります。 StorSimple デバイスがオフかオンか、および 8600 モデルと 8100 モデルのどちらを使用しているかにより、異なる手順が必要です。
>[AZURE.IMPORTANT] コントローラーが再起動して、デュアル コントローラー交換手順から完全に復旧するまでに 45 分～ 1 時間かかることがあります。 ケーブルの接続を含む手順全体の合計時間は、およそ 2.5 時間です。

#### 両方のコントローラー モジュールを交換するには

1. デバイスがオフの場合は、この手順をスキップして、次の手順に進みます。 デバイスがオンの場合はオフにします。

    1. 8600 モデルを使用している場合は、最初に主エンクロージャをオフにしてから、EBOD エンクロージャをオフにします。

    2. デバイスが完全にシャットダウンするまで待ちます。 デバイスの背面にあるすべての LED がオフになります。

2. データ ポートに接続されているすべてのネットワーク ケーブルを外します。 8600 モデルを使用している場合は、主エンクロージャを EBOD エンクロージャに接続している SAS ケーブルもすべて外します。

3. 両方のコントローラーを StorSimple デバイスから取り外します。 詳細については、次を参照してください。 [コント ローラーを取り外す](#remove-a-controller)します。

4. 最初にコントローラー 0 のファクトリ交換品を挿入し、次にコントローラー 1 を挿入します。 詳細については、次を参照してください。 [コント ローラーの挿入](#insert-a-controller)します。 これにより、デュアル コントローラー交換ロジックが開始します。 詳細については、次を参照してください。 [デュアル コント ローラー交換ロジック](#dual-controller-replacement-logic)します。

5. コントローラー交換ロジックがバックグラウンドで進行している間に、ケーブルを再接続します。 交換前の接続とまったく同じようにすべてのケーブルを接続するように注意してください。 ケーブルを接続、モデルの詳細な手順についてのデバイスのセクションを参照してください [StorSimple 8100 デバイスの取り付け](storsimple-8100-hardware-installation.md) または [StorSimple 8600 デバイスの取り付け](storsimple-8600-hardware-installation.md)します。

6. StorSimple デバイスをオンにします。 8600 モデルを使用している場合:

    1. 最初に、EBOD エンクロージャがオンになっていることを確認します。

    2. EBOD エンクロージャが動作するまで待機します。

    3. 主エンクロージャをオンにします。

    4. 最初のコントローラーが再起動して正常な状態になった後、システムが実行されます。
    >[AZURE.NOTE] シリアル コンソールでデバイスを監視している場合は、交換手順からコントローラーが復旧している間に再起動が複数回表示される可能性があります。 シリアル コンソール メニューが表示されると、交換が完了したことがわかります。 コント ローラーの交換を開始してから 2.5 時間以内に、メニューが表示されない場合は、次のようにしてください。 [Microsoft サポートにお問い合わせ](storsimple-contact-microsoft-support.md)します。

## コントローラーを取り外す

故障したコントローラー モジュールを StorSimple デバイスから取り外すには、次の手順を使用します。
>[AZURE.NOTE] 次の図はコントローラー 0 の場合です。 コントローラー 1 の場合は逆になります。

#### コントローラー モジュールを取り外すには

1. 親指と人差し指でモジュールのラッチをはさみます。

2. 親指と人差し指にゆっくり力を加えて、コントローラーのラッチを外します。

    ![Releasing controller latch](./media/storsimple-controller-replacement/IC741047.png)

    **図 2** コントローラーのラッチを解放する

2. ラッチをハンドルとして使用し、コントローラーをシャーシの外までスライドさせます。

    ![Sliding controller out of chassis](./media/storsimple-controller-replacement/IC741048.png)

    **図 3** コント ローラーをシャーシの外に

## コントローラーを挿入する

故障したモジュールを StorSimple デバイスから取り外した後、次の手順を使用して、ファクトリ供給コントローラー モジュールを取り付けます。

#### コントローラー モジュールを取り付けるには

1. インターフェイス コネクタに損傷がないかどうかを確認します。 いずれかのコネクタ ピンが損傷したり曲がっている場合は、モジュールを取り付けないでください。

2. ラッチを完全に解放した状態で、コントローラー モジュールをシャーシの中にスライドします。

    ![Sliding controller into chassis](./media/storsimple-controller-replacement/IC741053.png)

    **図 4** コント ローラーをシャーシに差し込む

3. コントローラー モジュールを挿入したら、コントローラー モジュールをシャーシに押しつけながら、ラッチを閉じる操作を開始します。 ラッチがはまって所定の位置にコントローラーをガイドします。

    ![Closing controller latch](./media/storsimple-controller-replacement/IC741054.png)

    **図 5** コントローラーのラッチを閉じる

4. ラッチが所定の位置にはまれば終了です。 **OK** LED が点灯するはずです。
    >[AZURE.NOTE] コントローラーと LED がアクティブになるまでに最大で 5 分かかります。

5. 交換が成功したことを確認するには、Azure クラシック ポータルで **[デバイス]**、**[メンテナンス]**、**[ハードウェアの状態]** に移動し、コントローラー 0 とコントローラー 1 の両方が正常であることを確認します (状態が緑)。

## デバイスのアクティブなコントローラーを識別する

初めてのデバイス登録時やコントローラーの交換時など、StorSimple デバイスでアクティブなコントローラーを確認することが必要になる場合が多くあります。 アクティブなコントローラーは、すべてのディスク ファームウェアとネットワーク操作を処理します。 次のいずれかの方法を使用して、アクティブなコントローラーを識別できます。

- [Azure クラシック ポータルを使用して、アクティブなコント ローラーを識別するために](#use-the-azure-classic-portal-to-identify-the-active-controller)

- [アクティブなコント ローラーを識別するために StorSimple 用 Windows PowerShell を使用します。](#use-windows-powershell-for-storsimple-to-identify-the-active-controller)

- [アクティブなコント ローラーを識別するために物理デバイスをチェックします](#check-the-physical-device-to-identify-the-active-controller)

次に、これらの手順について説明します。

### Azure クラシック ポータルを使用してアクティブなコントローラーを識別する

管理ポータルで **[デバイス]**、**[メンテナンス]** に移動し、**[コントローラー]** セクションまでスクロールします。 ここで、どのコントローラーがアクティブかを確認できます。

![Identify active controller in Management Portal](./media/storsimple-controller-replacement/IC752072.png)

**図 6** アクティブなコントローラーを示す Azure クラシック ポータル

### StorSimple 用の Windows PowerShell を使用してアクティブなコントローラーを識別する

シリアル コンソールでデバイスにアクセスしているときは、バナー メッセージが表示されます。 バナー メッセージには、モデル、名前、インストールされているソフトウェアのバージョン、アクセス中のコントローラーの状態などのデバイスの基本情報が含まれます。 次の図に、バナー メッセージの例を示します。

![Serial banner message](./media/storsimple-controller-replacement/IC741098.png)

**図 7** コントローラー 0 がアクティブと表示されているバナー メッセージ

バナー メッセージを使用して、接続中のコントローラーの状態 (アクティブまたはパッシブ) を特定できます。

### 物理デバイスを調べてアクティブなコントローラーを識別する

デバイスでアクティブなコントローラーを識別するには、主エンクロージャの背面の DATA 5 ポートの上にある青い LED に注目します。

この LED が点滅している場合、そのコントローラーがアクティブであり、他のコントローラーはスタンバイ モードです。 次の図と表を参考にしてください。

![Device primary enclosure backplane with dataports](./media/storsimple-controller-replacement/IC741055.png)

**図 8** データ ポートとモニタリング Led を備えたプライマリ エンクロージャの背面

| ラベル| 説明|
|:----|:----------|
| 1 ～ 6| DATA 0 ～ 5 のネットワーク ポート|
| 7| 青い LED|


## 次のステップ

詳細について [StorSimple ハードウェア コンポーネントの交換](storsimple-hardware-component-replacement.md)します。




