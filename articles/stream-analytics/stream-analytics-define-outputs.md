<properties
    pageTitle="データ変換出力: ストレージ、分析のオプション | Microsoft Azure"
    description="データ ストレージ オプションをターゲットにした Stream Analytics データ変換出力について説明します。 また、分析結果に Power BI を使用します。"
    keywords="data transformation, analysis results, data storage options"
    services="stream-analytics,documentdb,sql-database,event-hubs,service-bus,storage"
    documentationCenter=""
    authors="jeffstokes72"
    manager="paulettm"
    editor="cgronlun"/>

<tags
    ms.service="stream-analytics"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="data-services"
    ms.date="12/01/2015"
    ms.author="jeffstok"/>

# 分析ツールとデータ ストレージ オプションをターゲットにした Stream Analytics データ変換出力

Stream Analytics ジョブを作成するときは、データ変換出力の使用方法を考慮します。 Stream Analytics ジョブの結果はどのように表示しますか。 データ分析結果の表示にどのツールを使用しますか。 データ ストレージ オプションは要件ですか。

さまざまなアプリケーション パターンを有効にするために、Azure Stream Analytics には、出力を保存し、分析結果を表示するためのさまざまなオプションが用意されています。 そのため、ジョブ出力を簡単に確認したり、データのウェアハウジングやその他の用途でジョブ出力を柔軟に使用および保存したりすることができます。 ジョブで構成される出力は、ジョブが開始されてイベントがフローを開始する前に存在している必要があります。 たとえば、出力として BLOB Storage を使用する場合、ジョブはストレージ アカウントを自動的に作成しません。 ASA ジョブを開始する前に、ユーザーが作成する必要があります。


## SQL Database ##

[Azure SQL Database](http://azure.microsoft.com/services/sql-database/) 実質的にリレーショナルでは、データや、リレーショナル データベースでホストされているコンテンツに依存するアプリケーションの出力として使用できます。 Stream Analytics ジョブは、Azure SQL Database の既存のテーブルに書き込みます。  テーブル スキーマは、ジョブから出力されるフィールドとその型に正確に一致する必要があります。 次の表に、SQL Database の出力を作成するためのプロパティ名とその説明を示します。

| プロパティ名 | 説明 |
|---------------|-------------|
| 出力のエイリアス | クエリの出力をこのデータベースに出力するためにクエリで使用されるわかりやすい名前です。 |
| データベース | 出力を送信するデータベースの名前 |
| サーバー名 | SQL Database サーバー名 |
| ユーザー名 | データベースに書き込むためのアクセス権を持つユーザー名 |
| パスワード | データベースに接続するためのパスワード |
| テーブル | 出力の書き込み先のテーブル名です。 テーブル名は大文字小文字が区別されます。このテーブルのスキーマは、ジョブの出力によって生成されるフィールドの数とその型に正確に一致する必要があります。 |

## BLOB ストレージ ##

BLOB ストレージを使用すると、大量の非構造化データをクラウドに保存する場合に、コスト効率の高いスケーラブルなソリューションを実現できます。  Azure Blob ストレージとその使用状況の概要については、あるドキュメントを参照してください。 [Blob を使用する方法](./articles/storage-dotnet-how-to-use-blobs.md)します。

次の表に、BLOB 出力を作成するためのプロパティ名とその説明を示します。

<table>
<tbody>
<tr>
<td>プロパティ名</td>
<td>説明</td>
</tr>
<tr>
<td>出力のエイリアス</td>
<td>クエリの出力をこの BLOB ストレージに出力するためにクエリで使用されるわかりやすい名前です。</td>
</tr>
<tr>
<td>ストレージ アカウント</td>
<td>出力を送信するストレージ アカウントの名前。</td>
</tr>
<tr>
<td>ストレージ アカウント キー</td>
<td>ストレージ アカウントに関連付けられている秘密キー。</td>
</tr>
<tr>
<td>ストレージ コンテナー</td>
<td>コンテナーにより、Microsoft Azure BLOB サービスに格納される BLOB が論理的にグループ化されます。 BLOB を BLOB サービスにアップロードするとき、その BLOB のコンテナーを指定する必要があります。</td>
</tr>
<tr>
<td>パス プレフィックスのパターン [省略可能]</td>
<td>指定したコンテナー内の BLOB を書き込むために使用されるファイル パス。<BR>このパス内に、BLOB が書き込まれる頻度を指定するために、2 つの変数のいずれかまたは両方のインスタンスを使用できます。<BR>{date}、{time}<BR>例 1: cluster1/logs/{date}/{time}<BR>例 2: cluster1/logs/{date}</td>
</tr>
<tr>
<td>日付形式 [省略可能]</td>
<td>日付トークンがプレフィックス パスで使用されている場合、ファイルを編成する日付形式を選択できます。 例: YYYY/MM/DD</td>
</tr>
<tr>
<td>時刻形式 [省略可能]</td>
<td>時刻トークンがプレフィックス パスで使用されている場合、ファイルを編成する時刻形式を指定します。 現在唯一サポートされている値は HH です。</td>
</tr>
<tr>
<td>イベントのシリアル化の形式</td>
<td>出力データのシリアル化形式。  JSON、CSV、Avro がサポートされています。</td>
</tr>
<tr>
<td>エンコード</td>
<td>CSV または JSON 形式の場合、エンコードを指定する必要があります。 現在のところ、UTF-8 が、唯一サポートされているエンコード形式です。</td>
</tr>
<tr>
<td>区切り記号</td>
<td>CSV のシリアル化のみに適用されます。 Stream Analytics は、CSV データをシリアル化するために、一般的な区切り記号をサポートしています。 サポートしている値は、コンマ、セミコロン、スペース、タブ、および縦棒です。</td>
</tr>
<tr>
<td>形式</td>
<td>JSON のシリアル化のみに適用されます。 行区切りを指定すると、各 JSON オブジェクトを新しい行で区切ることで、出力が書式設定されます。 配列を指定すると、出力が JSON オブジェクトの配列として書式設定されます。</td>
</tr>
</tbody>
</table>

## イベント ハブ

[Event Hubs](https://azure.microsoft.com/services/event-hubs/) は高度にスケーラブルなパブリッシュ/サブスクライブ イベント インジェ スターでします。 1 秒あたり数百万のイベントを収集できます。  イベント ハブを出力として使用する一例として、Stream Analytics ジョブの出力が別のストリーミング ジョブの入力となる場合があります。

イベント ハブのデータ ストリームを出力として構成するために必要なパラメーターがいくつかあります。

| プロパティ名 | 説明 |
|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 出力のエイリアス | クエリの出力をこのイベント ハブに出力するためにクエリで使用されるわかりやすい名前です。 |
| Service Bus 名前空間 | Service Bus 名前空間は、一連のメッセージング エンティティのコンテナーです。 新しいイベント ハブを作成するときは、Service Bus 名前空間も作成します。 |
| イベント ハブ | イベント ハブ出力の名前 |
| イベント ハブ ポリシー名 | [イベント ハブの構成] タブで作成できる共有アクセス ポリシー。 各共有アクセス ポリシーには、名前、設定したアクセス許可、およびアクセス キーが含まれます。 |
| イベント ハブ ポリシー キー | Service Bus 名前空間へのアクセスを認証するために使用する共有アクセス キー。 |
| パーティション キー列 [省略可能] | この列には、Event Hub 出力のパーティション キーが含まれます。 |
| イベントのシリアル化の形式 | 出力データのシリアル化形式。  JSON、CSV、Avro がサポートされています。 |
| エンコード | CSV と JSON では、現在のところ、UTF-8 が唯一サポートされているエンコード形式です。 |
| 区切り記号 | CSV のシリアル化のみに適用されます。 Stream Analytics は、CSV 形式のデータをシリアル化するために、一般的な区切り記号をサポートしています。 サポートしている値は、コンマ、セミコロン、スペース、タブ、および縦棒です。 |
| 形式 | JSON 型のみに適用されます。 行区切りを指定すると、各 JSON オブジェクトを新しい行で区切ることで、出力が書式設定されます。 配列を指定すると、出力が JSON オブジェクトの配列として書式設定されます。 |
## Power BI

[Power BI](https://powerbi.microsoft.com/) 分析結果のリッチな視覚化エクスペリエンスを提供する Stream Analytics ジョブの出力として使用できます。 この機能は、操作ダッシュボード、レポート生成、およびメトリック ドリブン レポート作成に使用できます。

> [AZURE.NOTE] この時点での Power BI 出力の作成と構成はサポートされていません、Azure プレビュー ポータルで。

### Power BI アカウントを承認する

1.  Power BI を Microsoft Azure 管理ポータルで出力として選択すると、既存の Power BI ユーザーを承認するか、新しい Power BI アカウントを作成するように求められます。  

    ![Authorize Power BI User](./media/stream-analytics-define-outputs/01-stream-analytics-define-outputs.png)  

2.  まだアカウントを持っていない場合は新しいアカウントを作成し、[今すぐ承認] をクリックします。  次のような画面が表示されます。  

    ![Azure Account Power BI](./media/stream-analytics-define-outputs/02-stream-analytics-define-outputs.png)  

3.  このステップでは、Power BI の出力を承認するための、職場または学校のアカウントを指定します。 Power BI を使用するためのサインアップをまだ行っていない場合は、[今すぐサインアップ] を選択します。 Power BI で使用する職場または学校のアカウントは、現在ログインしている Azure サブスクリプション アカウントと異なるものを使用できます。

### Power BI 出力プロパティを構成する

Power BI アカウントを認証すると、Power BI 出力のプロパティを構成できます。 次の表は、Power BI 出力を構成するためのプロパティ名とその説明の一覧です。

| プロパティ名 | 説明 |
|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 出力のエイリアス | クエリの出力をこの PowerBI 出力に出力するためにクエリで使用されるわかりやすい名前です。 |
| データセット名 | Power BI 出力で使用する必要なデータセット名を指定します。 |
| テーブル名 | Power BI 出力のデータセットの下にテーブル名を入力します。 現在、Stream Analytics ジョブからの Power BI 出力では、1 つのデータセット内に 1 つのテーブルのみを保持できます。 |
| グループ名 | 他の Power BI ユーザーとのデータ共有を有効にするには、グループにデータを書き込みます。  グループに書き込まないようにするには、Power BI アカウント内のグループを選択するか、[個人用ワークスペース] を選択することができます。  既存のグループを更新するには、Power BI の認証を更新する必要があります。 |

Power BI 出力とダッシュ ボードを構成するチュートリアルについては、次を参照してください、 [Azure Stream Analytics & Power BI](stream-analytics-power-bi-dashboard.md) 記事です。

> [AZURE.NOTE] 明示的に作成しないで、データセットとテーブルの Power BI ダッシュ ボード。 ジョブが開始され、このジョブによって出力が Power BI に流し込まれるときに、データセットとテーブルが自動的に設定されます。 ジョブ クエリで結果が生成されない場合、データセットとテーブルは作成されません。 また、この Stream Analytics ジョブで指定したものと同じ名前のデータセットとテーブルが Power BI に既に存在する場合は、既存のデータが上書きされるので注意してください。

### Power BI の承認を更新する

Power BI 出力のあるすべてのジョブについて、90 日おきに認証トークンを手動で更新する必要があるという一時的な制限事項があります。  また、ジョブが作成されてから、または最後の認証以降にパスワードが変わっている場合、Power BI アカウントを再認証する必要もあります。  この問題の症状として、ジョブ出力が返されないことや、操作ログで "ユーザーの認証エラー" が発生することが挙げられます。

  ![Power BI refresh token error](./media/stream-analytics-define-outputs/03-stream-analytics-define-outputs.png)  

この問題を解決するには、実行中のジョブを停止し、Power BI 出力に移動します。  [承認の更新] リンクをクリックし、データの損失を避けるため、"最後に停止した時刻" からジョブを再開します。

  ![Power BI renew authorization](./media/stream-analytics-define-outputs/04-stream-analytics-define-outputs.png)  

## Table Storage

[Azure テーブル ストレージ](./articles/storage-introduction.md)  アプリケーションはユーザーの需要に自動的にスケールできるように、高可用性、非常にスケーラブルなストレージを提供しています。 テーブル ストレージは Microsoft の NoSQL キー/属性ストアであり、スキーマに対する制約を抑えながら、構造化されたデータに活用できます。 Azure テーブル ストレージを使用すると、永続化と効率的な取得のためにデータを保持できます。

次の表に、テーブル出力を作成するためのプロパティ名とその説明を示します。

| プロパティ名 | 説明 |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 出力のエイリアス | クエリの出力をこのテーブル ストレージに出力するためにクエリで使用されるわかりやすい名前です。 |
| ストレージ アカウント | 出力を送信するストレージ アカウントの名前。 |
| ストレージ アカウント キー | ストレージ アカウントに関連付けられているアクセス キー。 |
| テーブル名 | テーブルの名前。 存在しない場合は、テーブルが作成されます。 |
| Partition Key | パーティション キーが含まれる出力列の名前。 パーティション キーは、エンティティのプライマリ キーの最初の部分を形成する、特定のテーブル内のパーティションの一意の識別子です。 最大サイズが 1 KB の文字列値です。 |
| Row Key | 行キーが含まれる出力列の名前。 行キーは、特定のパーティション内のエンティティを示す一意の識別子です。 エンティティのプライマリ キーの 2 番目の部分を形成します。 行キーは、最大サイズが 1 KB の文字列値です。 |
| バッチ サイズ | バッチ操作のレコードの数です。 既定値はほとんどのジョブのための十分な通常を参照してください、 [tablebatchoperation](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.table.tablebatchoperation.aspx) この設定を変更する方法の詳細についてです。 |

## Service Bus キュー

[Service Bus キュー](https://msdn.microsoft.com/library/azure/hh367516.aspx) では、1 つまたは複数の競合するコンシューマーに先入れ先出し (FIFO) メッセージ配信を提供します。 通常、メッセージはキューに追加された順番に受信され、処理されます。このとき、メッセージを受信して処理できるメッセージ コンシューマーは、メッセージ 1 件につき 1 つだけです。

次の表に、キュー出力を作成するためのプロパティ名とその説明を示します。

| プロパティ名 | 説明 |
|----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 出力のエイリアス | クエリの出力をこの Service Bus キューに出力するためにクエリで使用されるわかりやすい名前です。 |
| Service Bus 名前空間 | Service Bus 名前空間は、一連のメッセージング エンティティのコンテナーです。 |
| キュー名 | Service Bus キューの名前。 |
| キュー ポリシー名 | キューを作成するとき、[キューの構成] タブで共有アクセス ポリシーを作成することもできます。 各共有アクセス ポリシーには、名前、設定したアクセス許可、およびアクセス キーが含まれます。 |
| キュー ポリシー キー | Service Bus 名前空間へのアクセスを認証するために使用する共有アクセス キー。 |
| イベントのシリアル化の形式 | 出力データのシリアル化形式。  JSON、CSV、Avro がサポートされています。 |
| エンコード | CSV と JSON では、現在のところ、UTF-8 が唯一サポートされているエンコード形式です。 |
| 区切り記号 | CSV のシリアル化のみに適用されます。 Stream Analytics は、CSV 形式のデータをシリアル化するために、一般的な区切り記号をサポートしています。 サポートしている値は、コンマ、セミコロン、スペース、タブ、および縦棒です。 |
| 形式 | JSON 型のみに適用されます。 行区切りを指定すると、各 JSON オブジェクトを新しい行で区切ることで、出力が書式設定されます。 配列を指定すると、出力が JSON オブジェクトの配列として書式設定されます。 |

## Service Bus トピック

Service Bus キューの送信者から受信者へ 1 対 1 の通信方法を提供する [Service Bus トピック](https://msdn.microsoft.com/library/azure/hh367516.aspx) 一対多形式の通信を提供します。

次の表に、テーブル出力を作成するためのプロパティ名とその説明を示します。

| プロパティ名 | 説明 |
|----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 出力のエイリアス | クエリの出力をこの Service Bus トピックに出力するためにクエリで使用されるわかりやすい名前です。 |
| Service Bus 名前空間 | Service Bus 名前空間は、一連のメッセージング エンティティのコンテナーです。 新しいイベント ハブを作成するときは、Service Bus 名前空間も作成します。 |
| トピック名 | トピックは、イベント ハブやキューと類似するメッセージ エンティティです。 多数のさまざまなデバイスやサービスからイベント ストリームを収集するように設計されています。 トピックが作成されるときに、特定の名前も付けられます。 トピックに送信されるメッセージはサブスクリプションが作成されなければ使用できないため、トピックの下に 1 つ以上のサブスクリプションがあることを確認してください。 |
| トピック ポリシー名 | トピックを作成するとき、[トピックの構成] タブで共有アクセス ポリシーを作成することもできます。 各共有アクセス ポリシーには、名前、設定したアクセス許可、およびアクセス キーが含まれます。 |
| トピック ポリシー キー | Service Bus 名前空間へのアクセスを認証するために使用する共有アクセス キー。 |
| イベントのシリアル化の形式 | 出力データのシリアル化形式。  JSON、CSV、Avro がサポートされています。 |
| エンコード | CSV または JSON 形式の場合、エンコードを指定する必要があります。 現在のところ、UTF-8 が、唯一サポートされているエンコード形式です。 |
| 区切り記号 | CSV のシリアル化のみに適用されます。 Stream Analytics は、CSV 形式のデータをシリアル化するために、一般的な区切り記号をサポートしています。 サポートしている値は、コンマ、セミコロン、スペース、タブ、および縦棒です。 |

## DocumentDB

[Azure DocumentDB](http://azure.microsoft.com/services/documentdb/) は完全に管理された NoSQL ドキュメント データベース サービスですはスキーマ フリー データ、予測可能な信頼性の高いパフォーマンス、および迅速な開発を介したクエリおよびトランザクションを提供します。

次の表に、DocumentDB 出力を作成するためのプロパティ名とその説明を示します。

<table>
<tbody>
<tr>
<td>プロパティ名</td>
<td>説明</td>
</tr>
<tr>
<td>アカウント名</td>
<td>DocumentDB アカウントの名前。  これは、アカウントのエンドポイントにすることもできます。</td>
</tr>
<tr>
<td>アカウント キー</td>
<td>DocumentDB アカウントの共有アクセス キー。</td>
</tr>
<tr>
<td>データベース</td>
<td>DocumentDB データベース名。</td>
</tr>
<tr>
<td>コレクション名のパターン</td>
<td>使用するコレクションのコレクション名のパターン。 コレクション名の形式は、オプションの {partition} トークンを使用して構成できます。この場合、パーティションは 0 から開始します。<BR>例:  有効な入力値は次のとおりです。<BR>MyCollection{partition}<BR>MyCollection<BR>Stream Analytics ジョブを開始するには、コレクションが存在している必要があります。これは自動的には作成されません。</td>
</tr>
<tr>
<td>Partition Key</td>
<td>コレクション全体で出力をパーティション分割するためのキーを指定するために使用される、出力イベント内のフィールドの名前。</td>
</tr>
<tr>
<td>ドキュメント ID</td>
<td>挿入または更新操作の基準となるプライマリ キーを指定するために使用される、出力イベント内のフィールドの名前。</td>
</tr>
</tbody>
</table>


## 問い合わせ
詳細については、参照してください、 [Azure Stream Analytics フォーラム](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics)

## 次のステップ
モ ノのインターネットからのデータをストリーム分析する管理サービスである、 Stream Analytics の概要です。 このサービスの詳細については、以下の情報をご覧ください。

- [Azure Stream Analytics の使用](stream-analytics-get-started.md)
- [Azure Stream Analytics ジョブのスケーリング](stream-analytics-scale-jobs.md)
- [Stream Analytics Query Language Reference (Stream Analytics クエリ言語リファレンス)](https://msdn.microsoft.com/library/azure/dn834998.aspx)
- [Azure Stream Analytics management REST API reference (Azure ストリーム分析の管理 REST API リファレンス)](https://msdn.microsoft.com/library/azure/dn835031.aspx)

<!--Link references-->
[stream.analytics.developer.guide]: ../stream-analytics-developer-guide.md
[stream.analytics.scale.jobs]: stream-analytics-scale-jobs.md
[stream.analytics.introduction]: stream-analytics-introduction.md
[stream.analytics.get.started]: stream-analytics-get-started.md
[stream.analytics.query.language.reference]: http://go.microsoft.com/fwlink/?LinkID=513299
[stream.analytics.rest.api.reference]: http://go.microsoft.com/fwlink/?LinkId=517301


