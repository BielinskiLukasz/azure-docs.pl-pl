<properties
   pageTitle="ExpressRoute のルーティングの要件 | Microsoft Azure"
   description="このページでは、ExpressRoute 回線のルーティングを構成および管理するための詳細な要件について説明します。"
   documentationCenter="na"
   services="expressroute"
   authors="cherylmc"
   manager="carolz"
   editor=""/>
<tags
   ms.service="expressroute"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="10/06/2015"
   ms.author="cherylmc"/>



# ExpressRoute のルーティングの要件

ExpressRoute を使用して Microsoft クラウド サービスに接続するには、ルーティングをセットアップして管理する必要があります。 一部の接続プロバイダーでは、ルーティングのセットアップと管理が管理されたサービスとして提供されています。 このサービスが提供されているかどうか、接続プロバイダーに問い合わせてください。 提供されていない場合は、次に示す要件に従う必要があります。

参照してください、 [回路とルーティング ドメイン](expressroute-circuit-peerings.md) 接続を容易にするための設定を有効にする必要があるルーティングのセッションの詳細については資料です。

**注:** Microsoft では、高可用性構成のためのルーター冗長化プロトコル (たとえば、HSRP、VRRP) をサポートしていません。 代わりに、ピアリングごとの BGP セッションの冗長ペアに依存して高可用性を実現します。

## ピアリングの IP アドレス

ネットワークと Microsoft のエンタープライズ エッジ (MSEE) ルーターの間のルーティングを構成するには、IP アドレスのいくつかのブロックを予約する必要があります。 このセクションでは、要件の一覧を示すと共に、これらの IP アドレスを取得および使用する方法に関する規則について説明します。

### Azure のプライベート ピアリング用の IP アドレス

ピアリングは、プライベート IP アドレスまたはパブリック IP アドレスを使用して構成できます。 ルートを構成するために使用されるアドレス範囲と Azure で仮想ネットワークを作成するために使用されるアドレス範囲とが重複しないようにする必要があります。

 - ルーティング インターフェイス用に、1 つの /29 サブネットまたは 2 つの /30 サブネットを予約する必要があります。
 - ルーティングに使用するサブネットには、プライベート IP アドレスまたはパブリック IP アドレスを指定できます。
 - サブネットと、Microsoft クラウドで使用するために顧客によって予約された範囲とが競合しないようにする必要があります。
 - /29 サブネットを使用すると、2 つの /30 サブネットに分割されます。
     - 最初の /30 サブネットはプライマリ リンク用に使用され、2 つ目の /30 サブネットはセカンダリ リンク用に使用されます。
     - それぞれの /30 サブネットに対し、ルーター上で /30 サブネットの最初の IP アドレスを指定する必要があります。 Microsoft は、/30 サブネットの 2 番目の IP アドレスを使用して BGP セッションをセットアップします。
     - 両方の BGP セッションをセットアップする必要があります、 [可用性 SLA](http://azure.microsoft.com/support/legal/sla/) を有効にします。

#### プライベート ピアリング用の例

a.b.c.d/29 を使用してピアリングをセットアップすることを選択した場合、このサブネットは 2 つの /30 サブネットに分割されます。 次の例では、a.b.c.d/29 サブネットがどのように使用されるかについて注目します。

a.b.c.d/29 は、a.b.c.d/30 と a.b.c.d+4/30 に分割され、プロビジョニング API を介して Microsoft に渡されます。 a.b.c.d+1 をプライマリ PE の VRF IP として使用すると、Microsoft は a.b.c.d+2 をプライマリ MSEE の VRF IP として使用します。 a.b.c.d+5 をセカンダリ PE の VRF IP として使用すると、Microsoft は a.b.c.d+6 をセカンダリ MSEE の VRF IP として使用します。

ここで、192.168.100.128/29 を選択してプライベート ピアリングをセットアップするとします。 192.168.100.128/29 には、192.168.100.128 ～ 192.168.100.135 の範囲のアドレスが含まれています。この中で、

- 192.168.100.128/30 192.168.100.129 と 192.168.100.130 を使用して Microsoft を使用するプロバイダーと link1 に割り当てられます。
- 192.168.100.132/30 192.168.100.133 と 192.168.100.134 を使用して Microsoft を使用するプロバイダーと link2 に割り当てられます。

### Azure パブリックおよび Microsoft ピアリング用の IP アドレス

ユーザーは、所有しているパブリック IP アドレスを使用して BGP セッションをセットアップする必要があります。 Microsoft は、ルーティング インターネット レジストリおよびインターネット ルーティング レジストリを介して IP アドレスの所有権を確認できる必要があります。

- ユーザーは、一意の /29 サブネットまたは 2 つの /30 サブネットを使用して、ExpressRoute 回線ごとに (複数存在する場合) それぞれのピアリングの BGP ピアリングをセットアップする必要があります。
- /29 サブネットを使用すると、2 つの /30 サブネットに分割されます。
    - 最初の /30 サブネットはプライマリ リンク用に使用され、2 つ目の /30 サブネットはセカンダリ リンク用に使用されます。
    - それぞれの /30 サブネットに対し、ルーター上で /30 サブネットの最初の IP アドレスを使用する必要があります。 Microsoft は、/30 サブネットの 2 番目の IP アドレスを使用して BGP セッションをセットアップします。
    - 両方の BGP セッションをセットアップする必要があります、 [可用性 SLA](http://azure.microsoft.com/support/legal/sla/) を有効にします。

以下のレジストリのいずれかで IP アドレスと AS 番号が自分に登録されていることを確認します。

- [ARIN](https://www.arin.net/)
- [APNIC](https://www.apnic.net/)
- [AFRINIC](https://www.afrinic.net/)
- [LACNIC](http://www.lacnic.net/)
- [成熟 NCC](https://www.ripe.net/)
- [RADB](http://www.radb.net/)
- [ALTDB](http://altdb.net/)
- [レベル 3](http://rr.Level3.net/)


## 動的なルート交換

ルーティングの交換は eBGP プロトコル上で実行されます。 MSEE とルーターとの間に EBGP セッションが確立されます。 BGP セッションの認証は必須ではありません。 必要な場合は、MD5 ハッシュを構成することができます。 参照してください、 [構成ルーティング](expressroute-howto-routing-classic.md) と [回線のプロビジョニング ワークフローと状態を回線](expressroute-workflows.md) BGP セッションを構成する方法についてです。

## 自律システム番号

Microsoft は、Azure パブリック、Azure プライベート、および Microsoft ピアリングのために AS 12076 を使用します。 AS 65515 は、内部使用のために予約されています。 16 ビットと 32 ビットの両方の AS 番号がサポートされています。 プライベート AS 番号は、Azure プライベート ピアリングに使用できます。 ユーザーは、自分に登録されているパブリック AS 番号を Azure パブリックと Microsoft ピアリングのために使用する必要があります。

データ転送の対称性に関する要件はありません。 転送パスとリターン パスは、異なるルーター ペアを通過することができます。 同じルートについては、自分に属している複数の回線ペアのどちらかの側からアドバタイズする必要があります。 ルートのメトリックは同一である必要はありません。

## ルート集約とプレフィックスの制限

Azure プライベート ピアリングを介してアドバタイズされるプレフィックスは、最大で 4,000 個がサポートされます。 ExpressRoute Premium アドオンが有効になっている場合、このプレフィックス数を 10,000 に増やすことができます。 Azure パブリックおよび Microsoft ピアリングの場合、BGP セッションあたり最大で 200 個のプレフィックスを使用できます。

プレフィックスの数がこの制限を超えると、BGP セッションは切断されます。 既定のルートは、プライベート ピアリング リンクのみで使用できます。 プロバイダーは、Azure パブリック パスと Microsoft ピアリング パスから既定のルートおよびプライベート IP アドレス (RFC 1918) をフィルターで除外する必要があります。

## トランジット ルーティングおよびリージョン間ルーティング

ExpressRoute をトランジット ルーターとして構成することはできません。 トランジット ルーティング サービスについては、接続プロバイダーに依存する必要があります。

## 既定のルートのアドバタイズ

既定のルートは、Azure プライベート ピアリング セッションでのみ許可されます。 その場合、Microsoft は、関連付けられている仮想ネットワークからのすべてのトラフィックをユーザーのネットワークにルーティングします。 プライベート ピアリングに既定のルートをアドバタイズすると、Azure からのインターネット パスがブロックされます。 Azure でホストされるサービスのトラフィックをインターネットとの間で送受信するには、会社のエッジに依存する必要があります。

 他の Azure サービスおよびインフラストラクチャ サービスへの接続を有効にするには、次のどちらかの条件が満たされている必要があります。

 - Azure パブリック ピアリングが有効になっていて、トラフィックをパブリック エンドポイントにルーティングするように設定されている。
 - ユーザー定義のルーティングを使用して、インターネット接続を必要とするすべてのサブネットに対してインターネット接続を許可している。

**注:** 既定のルートをアドバタイズすると、Windows およびその他の VM のライセンスの認証に失敗します。 指示に従って [ここ](http://blogs.msdn.com/b/mast/archive/2015/05/20/use-azure-custom-routes-to-enable-kms-activation-with-forced-tunneling.aspx) これを回避します。

## BGP コミュニティのサポート

ここでは、ExpressRoute で BGP コミュニティがどのように使用されるかについて概説します。 Microsoft は、パブリックおよび Microsoft ピアリング パスのルートに適切なコミュニティ値をタグ付けしてアドバタイズします。 その理由とコミュニティ値の詳細については以降に示します。 ただし、Microsoft は、Microsoft にアドバタイズされるルートにタグ付けされたすべてのコミュニティ値を無視します。

地理的リージョン内の任意の 1 つのピアリングの場所で ExpressRoute を介して Microsoft に接続する場合、地理的境界内のすべてのリージョンですべての Microsoft クラウド サービスにアクセスできます。

たとえば、ExpressRoute を介してアムステルダムの Microsoft に接続している場合、北ヨーロッパと西ヨーロッパでホストされているすべての Microsoft クラウド サービスにアクセスできます。

参照してください、 [ExpressRoute パートナーとピアリングの場所](expressroute-locations.md) 地理的リージョン、関連付けられている Azure リージョン、および対応する ExpressRoute のピアリングの場所の詳細な一覧についてのページです。

地理的リージョンごとに複数の ExpressRoute 回線を購入できます。 複数の接続を持つことで、geo 冗長性による高可用性が確保される大きなメリットがあります。 複数の ExpressRoute 回線がある場合、パブリック ピアリングおよび Microsoft ピアリング パスで Microsoft からアドバタイズされたプレフィックスの同じセットを受け取ります。 これは、ネットワークから Microsoft へのパスが複数あることを意味します。 これは、ネットワーク内で十分に最適化されないルーティングの決定が行われる可能性があることを示します。 その結果、さまざまなサービスに最適化されていない接続エクスペリエンスが発生する可能性があります。

Microsoft は、パブリック ピアリングと Microsoft ピアリングを介してアドバタイズされるプレフィックスに適切な BGP コミュニティ値をタグ付けして、プレフィックスがホストされるリージョンを示します。 ユーザーは、このコミュニティ値に依存して、最適なルーティングを顧客に提供するための適切なルーティングの決定を行うことができます。

| **地理的リージョン**| **Microsoft Azure リージョン (Office 365 の場合も同じ)**| **BGP コミュニティ値**|
|---|---|---|
| **北米**| | 12076:51201|
| | 米国東部| 12076:51004|
| | 米国東部 2| 12076:51005|
| | 米国西部| 12076:51006|
| | 米国中北部| 12076:51007|
| | 米国中南部| 12076:51008|
| | 米国中央部| 12076:51009|
| **南アメリカ**| | 12076:51202|
| | ブラジル南部| 12076:51014|
| **ヨーロッパ**| | 12076:51203|
| | 北ヨーロッパ| 12076:51003|
| | 西ヨーロッパ| 12076:51002|
| **アジア太平洋**| | 12076:51204|
| | 東アジア| 12076:51010|
| | 東南アジア| 12076:51011|
| **日本**| 東日本| 12076:51012|
| | 西日本| 12076:51013|
| **オーストラリア**| オーストラリア東部| 12076:51015|
| | オーストラリア南東部| 12076:51016|
| **インド**| インド南部| 12076:51019|
| | インド西部| 12076:51018|
| | インド中部| 12076:51017|
| **グローバル**| **Premium アドオンが有効になっている場合のみサポートされ、発行されます。**| 12076:51000|
| **エニーキャスト**| | 12076:51250|

Microsoft からアドバタイズされるすべてのルートには、適切なコミュニティ値がタグ付けされます。
>[AZURE.IMPORTANT] ExpressRoute Premium アドオンが有効になっている場合にのみ、グローバル プレフィックスに適切なコミュニティ値がタグ付けされてアドバタイズされます。


さらに、Microsoft は、所属先のサービスに基づいてプレフィックスにもタグ付けします。 これは、Microsoft ピアリングにのみ該当します。 次の表に、サービスと BGP コミュニティ値のマッピングを示します。

| **サービス**| **BGP コミュニティ値**|
|---|---|
| **Exchange**| 12076:5010|
| **SharePoint**| 12076:5020|
| **Skype For Business**| 12076:5030|
| **CRM Online**| 12076:5040|
| **その他の Office 365 サービス**| 12076:5100|


### ルーティングの基本設定の操作

Microsoft は、ユーザーによって設定されたすべての BGP コミュニティ値を無視します。 ごとのための要件を確実にピアリング BGP セッションのペアをセットアップに必要な [可用性 SLA](http://azure.microsoft.com/support/legal/sla/) が満たされています。 ただし、標準的な BGP ルートの操作手法に依存して、ネットワークで優先するリンクを構成できます。 各リンクにそれぞれ異なる BGP ローカル基本設定を適用して、ネットワークと Microsoft の間で優先するパスを設定できます。 ルートのアドバタイズの先頭に「AS-PATH」を付加して、Microsoft からネットワークへのトラフィック フローに影響を与えることができます。

## 次のステップ

- ExpressRoute 接続を構成します。

    - [ExpressRoute 回線を作成します。](expressroute-howto-circuit-classic.md)
    - [ルーティングを構成します。](expressroute-howto-routing-classic.md)
    - [VNet を ExpressRoute 回線にリンクします。](expressroute-howto-linkvnet-classic.md)







