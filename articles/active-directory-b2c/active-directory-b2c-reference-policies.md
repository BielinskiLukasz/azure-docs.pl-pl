<properties
    pageTitle="Azure Active Directory B2C プレビュー: 拡張可能なポリシー フレームワーク | Microsoft Azure"
    description="Azure Active Directory B2C の拡張可能なポリシー フレームワークと、さまざまなポリシー タイプの作成方法に関するトピック。"
    services="active-directory-b2c"
    documentationCenter=""
    authors="swkrish"
    manager="msmbaldwin"
    editor="curtand"/>

<tags
    ms.service="active-directory-b2c"
    ms.workload="identity"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="09/28/2015"
    ms.author="swkrish"/>

# Azure Active Directory B2C プレビュー: 拡張可能なポリシー フレームワーク

[AZURE.INCLUDE [active-directory-b2c-preview-note](../../includes/active-directory-b2c-preview-note.md)]

## 基本操作

Azure Active Directory (AD) B2C の拡張可能なポリシー フレームワークは、このサービスの中核となる強みです。 ポリシーには、サインアップ、サインイン、プロファイルの編集など、コンシューマーの ID エクスペリエンスが完全に記述されています。 たとえば、サインアップのポリシーを使用して次の設定を構成し、動作を制御できます。

- コンシューマーがアプリケーションにサインアップするために使用できるアカウント タイプ (Facebook や Google などのソーシャル アカウントまたは電子メール アドレスやユーザー名とパスワードなどのローカル アカウント)。
- サインアップ中にコンシューマーから収集される属性 (名、郵便番号、靴のサイズなど)。 
- 多要素認証の使用。
- すべてのサインアップ ページの外観。
- ポリシーの実行が完了したときにアプリケーションが受け取る情報 (要求内で要求として明示される)。

テナント内でさまざまな種類のポリシーを複数作成し、必要に応じてそれらをアプリケーションで使用できます。 ポリシーは、アプリケーション間で再利用することができます。 これにより、開発者はコードの変更を最小限に抑えるか、まったく変更を行わずに、コンシューマーの ID エクスペリエンスを定義および変更できます。 サービスにさらに豊富なポリシー タイプを追加し続けていく予定です。

ポリシーは、簡単な開発者インターフェイスを使用して入手できます。 アプリケーションは標準 HTTP 認証要求 (要求でポリシー パラメーターを渡す) を使用してポリシーをトリガーし、カスタマイズされたトークンを応答として受け取ります。 たとえば、サインアップ ポリシーを呼び出す要求と、サインイン ポリシーを呼び出す要求の唯一の相違点は、"p" クエリー文字列パラメーターで使用されるポリシー名です。

```

https://login.microsoftonline.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siup                                       // Your sign-up policy

```

```

https://login.microsoftonline.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siin                                       // Your sign-in policy

```

## サインアップのポリシーの作成方法

アプリケーションにサインアップできるようにするには、サインアップ ポリシーを作成する必要があります。 このポリシーは、サインアップ中のコンシューマーのエクスペリエンスと、サインアップが成功したときにアプリケーションが受け取るトークンのコンテンツを記述します。

1. [Azure プレビュー ポータルで B2C 機能ブレードに移動](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade)します。
2. クリックして **サインアップ ポリシー**します。
3. クリックして **+ 追加** ブレードの上部にあります。
4.  **名前** 、アプリケーションで使用サインアップ ポリシー名を決定します。 たとえば、「SiUp」を入力します。
5. クリックして **Id プロバイダー** 「電子メール アドレス」を選択します。 既に構成されている場合は、ソーシャル ID プロバイダーを選択することもできます。 Click **OK**.

    > [AZURE.NOTE]
    ローカル アカウントの場合、Azure AD B2C のサインアップ ポリシーで "強力な" パスワード ("期限なし" に設定されたパスワード) が使用されます。 参照してください [Azure AD パスワード ポリシー](https://msdn.microsoft.com/library/azure/jj943764.aspx) の他の設定 (現在 Azure AD B2C によって使用されていない)。

6. クリックして **サインアップ属性**します。 ここで、サインアップ中にコンシューマーから収集する属性を選択します。 たとえば、[市町村]、[表示名]、[郵便番号] などを選択します。 Click **OK**.
7. クリックして **アプリケーション クレーム**します。 ここで、サインアップ エクスペリエンスの成功後にアプリケーションに戻されるトークンで返される要求を選択します。 たとえば、"表示名"、"ID プロバイダー"、"郵便番号"、"ユーザーが新規"、"ユーザーのオブジェクト ID" などを選択します。
8. クリックして **作成**します。 注として作成したポリシーが表示される"**B2C_1_SiUp**"(、 **B2C\_1\_** フラグメントが自動的に事前に保留中) で、 **サインアップ ポリシー** ブレードです。
9. をクリックして、ポリシーを開いて"**B2C_1_SiUp**"です。
10. 「Contoso B2C アプリ」を選択、 **アプリケーション** ドロップダウンと `https://localhost:44321/` で、 **応答 URL/リダイレクト URI** ボックスの一覧です。 クリックして、 **を今すぐ実行** ] ボタンをクリックします。 新しいブラウザー タブが開き、アプリケーションへのサインアップのコンシューマー エクスペリエンスを確認できます。

    > [AZURE.NOTE]
    ポリシーの作成と更新が有効になるまで、最大で 1 分間かかります。

## サインインのポリシーの作成方法

アプリケーションにサインインできるようにするには、サインイン ポリシーを作成する必要があります。 このポリシーは、サインイン中のコンシューマーのエクスペリエンスと、サインインが成功したときにアプリケーションが受け取るトークンのコンテンツを記述します。

1. [Azure プレビュー ポータルで B2C 機能ブレードに移動](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade)します。
2. クリックして **サインイン ポリシー**します。
3. クリックして **+ 追加** ブレードの上部にあります。
4.  **名前** 、アプリケーションで使用される記号でポリシー名を決定します。 たとえば、「SiIn」を入力します。
5. クリックして **Id プロバイダー** 「電子メール アドレス」を選択します。 既に構成されている場合は、ソーシャル ID プロバイダーを選択することもできます。 Click **OK**.
6. クリックして **アプリケーション クレーム**します。 ここで、サインイン エクスペリエンスの成功後にアプリケーションに戻されるトークンで返される要求を選択します。 たとえば、「表示名」、"Identity Provider"、「郵便番号コード」および"ユーザーのオブジェクト ID"を選択します。 Click **OK**.
7. クリックして **作成**します。 注として作成したポリシーが表示される"**B2C_1_SiIn**"(、 **B2C\_1\_** フラグメントが自動的に追加) で、 **サインイン ポリシー** ブレードです。
8. をクリックして、ポリシーを開いて"**B2C_1_SiIn**"です。
9. 「Contoso B2C アプリ」を選択、 **アプリケーション** ドロップダウンと `https://localhost:44321/` で、 **応答 URL/リダイレクト URI** ボックスの一覧です。 クリックして、 **を今すぐ実行** ] ボタンをクリックします。 新しいブラウザー タブが開き、アプリケーションへのサインインのコンシューマー エクスペリエンスを確認できます。

    > [AZURE.NOTE]
    ポリシーの作成と更新が有効になるまで、最大で 1 分間かかります。

## プロファイル編集ポリシーの作成方法

アプリケーションでポリシーを編集できるようにするには、プロファイル編集ポリシーを作成する必要があります。 このポリシーは、プロファイル編集中のコンシューマーのエクスペリエンスと、正常に完了したときにアプリケーションが受け取るトークンのコンテンツを記述します。

1. [Azure プレビュー ポータルで B2C 機能ブレードに移動](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade)します。
2. クリックして **プロファイルのポリシーを編集**します。
3. クリックして **+ 追加** ブレードの上部にあります。
4.  **名前** プロファイル、アプリケーションで使用するポリシー名を編集を決定します。 たとえば、「SiPe」を入力します。
5. クリックして **Id プロバイダー** 「電子メール アドレス」を選択します。 既に構成されている場合は、ソーシャル ID プロバイダーを選択することもできます。 Click **OK**.
6. クリックして **属性のプロファイル**します。 ここで、コンシューマーが表示および編集できる属性を選択します。 たとえば、[市町村]、[表示名]、[郵便番号] などを選択します。 Click **OK**.
7. クリックして **アプリケーション クレーム**します。 ここで、プロファイル編集エクスペリエンスの成功後にアプリケーションに戻されるトークンで返される要求を選択します。 たとえば、"表示名" および "郵便番号" などを選択します。
8. クリックして **作成**します。 注として作成したポリシーが表示される"**B2C_1_SiPe**"(、 **B2C\_1\_** フラグメントが自動的に事前に保留中) で、 **プロファイルのポリシーを編集** ブレードです。
9. をクリックして、ポリシーを開いて"**B2C_1_SiPe**"です。
10. 「Contoso B2C アプリ」を選択、 **アプリケーション** ドロップダウンと `https://localhost:44321/` で、 **応答 URL/リダイレクト URI** ボックスの一覧です。 クリックして、 **を今すぐ実行** ] ボタンをクリックします。 新しいブラウザー タブが開き、アプリケーションでプロファイル編集のコンシューマー エクスペリエンスを確認できます。

    > [AZURE.NOTE]
    ポリシーの作成と更新が有効になるまで、最大で 1 分間かかります。

