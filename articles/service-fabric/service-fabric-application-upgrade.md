<properties
   pageTitle="Service Fabric アプリケーションのアップグレード | Microsoft Azure"
   description="この記事では、アップグレード モードの選択や正常性確認など、Service Fabric アプリケーションのアップグレードの概要を紹介します。"
   services="service-fabric"
   documentationCenter=".net"
   authors="mani-ramaswamy"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="07/17/2015"
   ms.author="subramar"/>


# Service Fabric アプリケーションのアップグレード

Service Fabric アプリケーションは、サービスのコレクションです。 アップグレードの際、Service Fabric を比較して、新しい [アプリケーション マニフェスト](service-fabric-application-model.md#describe-an-application) 以前のバージョンとし、[アプリケーションのアップグレードの必要があるサービスを決定します。 これは、サービス マニフェストのバージョン番号と以前のバージョンを比較して決定されます。 サービスが変更されていない場合は、そのサービスはアップグレードされません。

## ローリング アップグレードの概要

アプリケーションのローリング アップグレードでは、アップグレードは段階的に実行されます。 各段階では、アップグレードは、アップグレード ドメインと呼ばれる、クラスター内のノードのサブセットに適用されます。 その結果、アプリケーションはアップグレード全体を通して引き続き使用できます。 アップグレード中に、クラスターに古いバージョンと新しいバージョンが混在することがあります。 そのため、その 2 つのバージョンには上位互換性と下位互換性がある必要があります。 互換性がない場合は、アプリケーション管理者が複数フェーズのアップグレードを担当して可用性を維持します。 これは、最終バージョンにアップグレードする前に、以前のバージョンと互換性のあるアプリケーションの中間バージョンにアップグレードすることで実現されます。

アップグレード ドメインは、クラスターを構成するときに、クラスター マニフェストで指定されます。 アップグレード ドメインが、特定の順序で更新を受け取ると想定しないでください。 アップグレード ドメインは、アプリケーションのデプロイメントの論理単位です。 アップグレード ドメインがサービスに対して許可され、アップグレード時に高可用性が維持されます。

アップグレードがクラスター内のすべてのノードに適用されている場合 (アプリケーションに含まれているアップグレード ドメインが 1 つのみの場合) は、非ローリング アップグレードを行うことができます。 サービスがダウンしてアップグレード時に利用可能にならないため、非ローリング アップグレードは推奨されません。 さらに、Azure では、クラスターが 1 つだけのアップグレード ドメインでセットアップされた場合、一切保証をいたしません。

## アップグレード時の正常性チェック

アップグレードには、正常性ポリシーを設定する必要があります (既定値を使用することもできます)。 すべてのアップグレード ドメインが、指定されたタイムアウト内でアップグレードされ、すべてのアップグレード ドメインが正常であると判断された場合、アップグレードが成功したことになります。  正常なアップグレード ドメインは、正常性ポリシーで指定されているすべての正常性チェックに合格したことを意味します。たとえば、正常性ポリシーではアプリケーション インスタンス内のすべてのサービスが<em>正常</em>であることが要求されます。正常性は Service Fabric で定義されているとおりです。

アップグレード中の Service Fabric による正常性ポリシーと正常性チェックはサービスとアプリケーションに依存しません。 つまり、サービス固有のテストはチェックされません。  たとえば、サービスのスループットは最小限に抑える必要があります。 ただし、Service Fabric にはそれをテストする情報がないため、アプリケーションに対して定義されているスループットはチェックされません。   参照してください、 [ヘルス記事](service-fabric-health-introduction.md) 実行されるチェックについて、アップグレード中にチェックには、アプリケーション パッケージが正しくコピーされた場合、およびインスタンスの開始にが含まれます。

アプリケーションの正常性は、アプリケーションの子エンティティの集約です。 つまり、Service Fabric ではアプリケーションのサービスすべての正常性と、アプリケーションで報告された正常性によってアプリケーションの正常性が評価されます。 さらに、アプリケーション サービスの正常性は、サービスのレプリカなど、それらの子の正常性も集約して評価されます。 アプリケーションの正常性ポリシーを満たすと、アップグレードを続行できます。正常性ポリシーに違反していると、アプリケーションのアップグレードは失敗します。

## アップグレード モード

アップグレードに共通の (推奨される) モードは、Monitored です。  Monitored では、1 つのアップグレード ドメインでアップグレードを実行し、すべての正常性チェックに合格すると (指定されたポリシーに基づいて)、次のアップグレード ドメインに自動的に移動するなどが行われます。  正常性のチェックが失敗するか、タイムアウトに達すると、アップグレードはアップグレード ドメインにロールバックされるか、アップグレード時に選択してある場合には、UnmonitoredManual モードに切り換えられます。

UnmonitoredManual は、アップグレード ドメインですべてのアップグレードが行われた後、次のアップグレード ドメインでのアップグレードを開始するために手動による介入が必要です。 実行する Service Fabric の正常性チェックはありません。次のアップグレード ドメインでアップグレードを開始する前に、正常性や状態のチェックを行うには、ユーザーの介入が必要になります。

## アプリケーション アップグレードのフローチャート

Service Fabric アプリケーションのアップグレード プロセスの理解に役立つフローチャートを以下に示します。 具体的には、フローの記述方法含むタイムアウト *HealthCheckStableDuration*, 、*HealthCheckRetryTimeout* と *UpgradeHealthCheckInterval* コントロールを使用して 1 つのアップグレード ドメインのアップグレードは、成功または失敗と見なされます。

![Service Fabric アプリケーションのアップグレード プロセス][image]


## 次のステップ

[アップグレード チュートリアル](service-fabric-application-upgrade-tutorial.md)

[アップグレード パラメーター](service-fabric-application-upgrade-parameters.md)

[データのシリアル化](service-fabric-application-upgrade-data-serialization.md)

[手動アップグレードと差分のパッケージを使用したアップグレード](service-fabric-application-upgrade-advanced.md)

[アプリケーション アップグレードのトラブルシューティング ](service-fabric-application-upgrade-troubleshooting.md)



[image]: media/service-fabric-application-upgrade/service-fabric-application-upgrade-flowchart.png
 


