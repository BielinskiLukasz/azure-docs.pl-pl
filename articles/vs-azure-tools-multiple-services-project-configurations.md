<properties
   pageTitle="複数のサービス構成を使用した Azure プロジェクトの構成"
   description="ServiceDefinition.csdef および ServiceConfiguration.cscfg ファイルを変更して、Azure クラウド サービス プロジェクトを構成する方法について説明します。"
   services="visual-studio-online"
   documentationCenter="na"
   authors="TomArcher"
   manager="douge"
   editor="" />
<tags
   ms.service="multiple"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/29/2015"
   ms.author="tarcher" />

# 複数のサービス構成を使用した Azure プロジェクトの構成

Azure クラウド サービス プロジェクトには、ServiceDefinition.csdef と ServiceConfiguration.cscfg の 2 つの構成ファイルが含まれています。 これらのファイルは、Azure クラウド サービス アプリケーションと共にパッケージ化され、Azure にデプロイされます。

-  **ServiceDefinition.csdef** ファイルに含まれているどのようなロールを含む、クラウド サービス アプリケーションの要件については、Azure 環境で必要なメタデータが含まれています。 このファイルには、すべてのインスタンスに適用される構成設定も含まれます。 これらの構成設定は、Azure サービス ホスト ランタイム API を使用して実行時に読み込むことができます。 このファイルは、Azure でサービスを実行しているときには更新できません。

-  **ServiceConfiguration.cscfg** ファイルは、サービス定義ファイルで定義されている構成設定の値を設定し、各ロールに対して実行するインスタンスの数を指定します。 このファイルは、Azure でクラウド サービスを実行しているときに更新できます。

Azure Tools for Microsoft Visual Studio は、これらのファイルに格納されている構成設定を設定するために使用できるプロパティ ページを備えています。 プロパティ ページにアクセスするソリューション エクスプ ローラーで Azure クラウド サービス プロジェクトの下にあるロールへの参照をダブルクリックするかロールへの参照を右クリックして選択 **プロパティ**, 、次の図に示すようにします。

![VS_Solution_Explorer_Roles_Properties](./media/vs-azure-tools-multiple-services-project-configurations/IC784076.png)

サービス定義ファイルおよびサービス構成ファイルの基になるスキーマについては、次を参照してください。、 [スキーマ リファレンス](https://msdn.microsoft.com/library/azure/dd179398.aspx)します。 サービス構成の詳細については、次を参照してください。 [クラウド サービスの構成方法](cloud-services-how-to-configure.md)します。

## ロール プロパティの構成

Web ロールと worker ロールのプロパティ ページは似ていますが、以降のセクションで説明するように、いくつかの違いがあります。

 **キャッシュ** ] ページで、Azure のキャッシュ サービスを構成することができます。

### [構成] ページ

 **構成** ] ページで、これらのプロパティを設定することができます。

**インスタンス**

設定、 **インスタンス** プロパティをサービスが実行するこのロールのインスタンスの数をカウントします。

設定、 **VM サイズ** プロパティを **極小**, 、**小さな**, 、**中**, 、**大**, 、または **特大**します。  詳細については、次を参照してください。 [クラウド サービスのサイズ](cloud-services-sizes-specs.md)します。

**スタートアップ アクション** (Web ロールのみ)

このプロパティを設定して、デバッグの開始時に Visual Studio が HTTP エンドポイントと HTTPS エンドポイントのいずれか、または両方のエンドポイント用に Web ブラウザーを起動するように指定します。

[HTTPS エンドポイント] オプションは、ロールの HTTPS エンドポイントを既に定義している場合のみ使用できます。 HTTPS エンドポイントを定義する、 **エンドポイント** プロパティ ページです。

HTTPS エンドポイントを既に追加している場合は、既定で [HTTPS エンドポイント] オプションが有効になり、Visual Studio はデバッグ開始時にこのエンドポイント用のブラウザーと HTTP エンドポイント用のブラウザーを起動します。 これは、両方のスタートアップ オプションが有効になっていることを前提としています。

**診断**

既定では、Web ロールに対して診断が有効になっています。 Azure クラウド サービス プロジェクトとストレージ アカウントは、ローカル ストレージ エミュレーターを使用するように設定されています。 Azure にデプロイする準備ができたらは、ビルダー ボタンをクリックすることができます (**...**) をクラウドで Azure ストレージを使用するストレージ アカウントを更新します。 要求時に、または自動的にスケジュールされた間隔で、ストレージ アカウントに診断データを転送できます。 Azure 診断の詳細については、次を参照してください。 [Azure クラウド サービスおよび仮想マシンで診断を有効にすると](cloud-services-dotnet-diagnostics.md)です。

## [設定] ページ

 **設定** ] ページで、サービスの構成設定を追加することができます。 構成設定は、名前と値のペアです。 ロールで実行されるコードが用意されているクラスを使用して実行時に、構成設定の値を読み取ることができます、 [Azure マネージ ライブラリ](http://go.microsoft.com/fwlink?LinkID=171026)します。 具体的には、 [GetConfigurationSettingValue](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.getconfigurationsettingvalue.aspx) メソッドの実行時に名前付き構成設定の値を返します。

### ストレージ アカウントへの接続文字列の構成

接続文字列とは、ストレージ エミュレーターまたは Azure ストレージ アカウントの接続情報と認証情報を提供する構成設定です。 ロール内で実行されているコードから Azure Storage サービス データ (BLOB データ、キュー データ、またはテーブル データ) にアクセスする必要がある場合、そのストレージ アカウントの接続文字列を定義する必要があります。

Azure ストレージ アカウントを指す接続文字列には、定義された書式を使用する必要があります。 接続文字列を作成する方法については、次を参照してください。 [Azure ストレージ接続文字列の構成](storage-configure-connection-string.md)します。

Azure Storage サービスに対してサービスをテストする準備、またはクラウド サービスを Azure にデプロイする準備ができたら、Azure ストレージ アカウントを指すように任意の接続文字列の値を変更できます。 をクリックして (**...**)、[ **ストレージ アカウントの資格情報を入力**します。 アカウント名とアカウント キーを含むアカウント情報を入力します。  **ストレージ アカウント接続文字列** ] ダイアログ ボックスでも指定できます (既定のオプション) 既定の HTTPS エンドポイントでは、既定の HTTP エンドポイント、またはカスタム エンドポイントを使用するかどうか。 」の説明に従って、サービスのカスタム ドメイン名を登録している場合、カスタム エンドポイントを使用することもできます [Azure ストレージ アカウントに blob データのカスタム ドメイン名を構成する](storage-custom-domain-name.md)です。

>[AZURE.IMPORTANT] サービスをデプロイする前に、Azure ストレージ アカウントを指すために接続文字列を変更する必要があります。 変更していないと、ロールの起動に失敗したり、初期化状態、ビジー状態、停止状態を順に繰り返す可能性があります。

## [エンドポイント] ページ

worker ロールは、任意の数の HTTP、HTTPS、TCP エンドポイントを含むことができます。 エンドポイントには、外部のクライアントが利用できる入力エンドポイント、またはサービスで実行されている他のロールが利用できる内部エンドポイントを指定できます。

- HTTP エンドポイントを外部クライアントおよび Web ブラウザーから利用できるようにするには、エンドポイントの種類を [入力] に変更し、名前とパブリック ポート番号を指定します。

- HTTPS エンドポイントを外部クライアントおよび Web ブラウザーを使用できるようにするにエンドポイントの種類を変更 **入力**, 、名前、パブリック ポート番号と管理証明書の名前を指定します。

    管理証明書を指定するには、定義、証明書に注意してください、 **証明書** プロパティ ページです。

- クラウド サービス内の他のロールからエンドポイントを内部利用できるようにするには、エンドポイントの種類を [内部] に変更し、名前とこのエンドポイントに使用可能なプライベート ポートを指定します。

## [ローカル ストレージ] ページ

使用することができます、 **ローカル記憶域** ロールの 1 つまたは複数のローカル ストレージ リソースを占有する] プロパティ ページです。 ローカル ストレージ リソースは、ロールのインスタンスが実行されている Azure 仮想マシンのファイル システム内の予約されたディレクトリです。 ローカル ストレージ リソースを操作する方法の詳細については、次を参照してください。 [ローカル ストレージ リソースの構成](cloud-services-configure-local-storage-resources.md)します。

## [証明書] ページ

 **証明書** ] ページで、証明書は、ロールに関連付けることができます。 HTTPS エンドポイントに構成を追加する証明書を使用できます、 **エンドポイント** プロパティ ページです。

 **証明書** プロパティ ページは、証明書に関する情報をサービスの構成に追加します。 証明書が、サービスでパッケージ化されませんに注意してください。Azure に証明書を個別にアップロードする必要があります、 [Azure 管理ポータル](http://go.microsoft.com/fwlink/?LinkID=213885)します。

証明書をロールに関連付けるには、証明書の名前を指定します。 HTTPS エンドポイントを構成するときに、証明書を参照する名前を使用する、 **エンドポイント** プロパティ ページです。 次に、証明書ストアがあるかどうかを指定 **ローカル マシン** または **現在のユーザー** とストアの名前。 最後に、証明書のサムプリントを入力します。 証明書が Current User\Personal (My) ストアに存在する場合、表示されたリストから証明書を選択することで、証明書のサムプリントを入力できます。 他の場所に存在する場合は、サムプリントの値を手動で入力します。

証明書ストアから証明書を追加すると、すべての中間証明書は自動的に構成設定に追加されます。 SSL に対してサービスを適切に構成するために、これらの中間証明書も Azure にアップロードする必要があります。

サービスに関連付けられた管理証明書がサービスに適用されるのは、サービスがクラウドで実行されている場合のみです。 サービスがローカル開発環境で実行されている場合には、コンピューティング エミュレーターが管理する標準の証明書が使用されます。

## Azure クラウド サービス プロジェクトの構成

Azure クラウド サービス プロジェクト全体に適用される設定を構成するには、まずそのプロジェクト ノードのショートカット メニューを開き、次に [プロパティ] を選択し、プロパティ ページを開きます。 これらのプロパティ ページを次の表に示します。

|プロパティ ページ|説明|
|---|---|
|アプリケーション|このページでは、このクラウド サービス プロジェクトが使用する Azure Tools のバージョン情報を表示したり、ツールを最新バージョンにアップグレードすることができます。|
|ビルド イベント|このページでは、ビルド前およびビルド後のイベントを設定できます。|
|開発|このページでは、ビルド構成の手順や、ビルド後イベントを実行する条件を指定できます。|
|Web|このページでは、Web サーバーに関連する設定を構成できます。|

