<properties 
    pageTitle="DocumentDB 容量の管理 | Microsoft Azure" 
    description="アプリケーションの容量のニーズを満たすために DocumentDB を拡張する方法について説明します。" 
    services="documentdb" 
    authors="mimig1" 
    manager="jhubbard" 
    editor="cgronlun" 
    documentationCenter=""/>

<tags 
    ms.service="documentdb" 
    ms.workload="data-services" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="10/28/2015" 
    ms.author="mimig"/>


# DocumentDB 容量のニーズの管理

DocumentDB は、完全に管理された、拡張性の高いドキュメント志向の NoSQL データベース サービスです。 DocumentDB 内では、仮想マシンのレンタル、ソフトウェアのデプロイ、データベースの監視などを行ったり、障害復旧の心配をしたりする必要はありません。 Microsoft のエンジニアによって運用され、継続的な監視が行われる DocumentDB は、卓越した可用性、パフォーマンス、データ保護を提供します。

DocumentDB を使用開始することができます [データベース アカウントを作成する](documentdb-create-account.md) を通じて、 [Azure ポータル](https://portal.azure.com/)します。 DocumentDB は、ソリッド ステート ドライブ (SSD) ベースのストレージとスループットから構成される単位で提供されます。 これらの単位はデータベース コレクションを作成することにより、データベース アカウントでプロビジョニングされます。 各コレクションには 10 GB のデータベース ストレージが予約済みのスループットと共に含まれます。 アプリケーションのスループット要件を変更する場合、動的に変更を設定して、 [パフォーマンス レベル](documentdb-performance-levels.md) コレクションごとにします。

1 つ以上のコレクションでアプリケーションがパフォーマンス レベルを超えると、コレクションごとに要求が調整されます。 つまり、アプリケーションの要求が成功する場合と調整される場合があります。

## データベース アカウントと管理リソース

Azure の利用者であるお客様は、1 つまたは複数の DocumentDB データベース アカウントをプロビジョニングできます。 各データベース アカウントには、データベース、ユーザー、アクセス許可を含む管理リソースのクォータが設定されます。 これらのリソースが対象には [制限とクォータ](documentdb-limits.md)します。 管理リソースを追加する場合は、次のようにしてください。 [サポートにお問い合わせ](documentdb-increase-limits.md)します。

## ドキュメント ストレージが無制限のデータベース

1 つの DocumentDB データベースには、実質的に容量が無限の、コレクション別に区切られたドキュメント ストレージを格納できます。 コレクションは、その中に含まれているドキュメントのトランザクション ドメインを構成します。 DocumentDB データベースのサイズは柔軟で、数 GB から、場合によっては数テラバイトに上る SSD ベースのドキュメント ストレージとプロビジョニング済みスループットが用意されています。 従来の RDBMS データベースとは異なり、DocumentDB のデータベースはその範囲が単一のコンピューターに制限されません。

DocumentDB では、アプリケーションの規模を拡大することが必要になった時点で、さらに多くのコレクション、データベース、またはその両方を作成できます。 Microsoft 社内のさまざまなファースト パーティ アプリケーションでは、それぞれ数百、数千個のコレクションと数テラバイトのドキュメント ストレージを含むきわめて大規模な DocumentDB データベースを作成することにより、コンシューマー規模で DocumentDB を使用しています。 データベースは、アプリケーションの規模要件に合わせてコレクションを追加または削除することにより、拡大または縮小できます。

## データベース コレクション

各 DocumentDB データベースには 1 つまたは複数のコレクションを格納できます。 コレクションはドキュメント ストレージやドキュメント処理の際に、可用性の高いデータ パーティションとして機能します。 各コレクションには多種多様なスキーマを持つドキュメントを保存できます。 DocumentDB の自動インデックス作成機能やクエリ機能により、ドキュメントを簡単にフィルター処理して取得できます。 コレクションは、ドキュメント ストレージとクエリ実行のスコープを提供します。 コレクションは、そこに含まれるすべてのドキュメントのトランザクション ドメインでもあります。 コレクションは、指定したパフォーマンス レベルに基づいた割り当てスループットです。 パフォーマンス レベルは Azure ポータルか SDK のいずれかにより動的に調整できます。

アプリケーションのストレージやスループット スケールの要件に合うように、何個でもコレクションを作成できます。 コレクションを作成してから、 [Azure ポータル](https://portal.azure.com/) またはのいずれか、 [DocumentDB Sdk](https://msdn.microsoft.com/library/azure/dn781482.aspx)します。
>[AZURE.NOTE] 各コレクションは、最大 10 GB のドキュメント データのストレージをサポートします。 

## 要求単位とデータベース操作

DocumentDB では、UDF、ストアド プロシージャ、トリガーを使用したリレーショナル クエリと階層クエリなど、さまざまなデータベース操作をデータベース コレクション内のドキュメントに対して実行できます。 これらの各操作に関連付けられる処理コストは、CPU、IO、操作の完了に必要なメモリによって異なります。 ハードウェア リソースの管理について考える代わりに、各種のデータベース操作を実行しアプリケーション要求を処理するのに必要なリソースに関する単一の測定単位として要求単位 (RU) を考えることができます。

要求単位は、コレクションに設定したパフォーマンス レベルに基づいてプロビジョニングおよび割り当てが行われます。 各コレクションは、作成時にパフォーマンス レベルが指定されています。 パフォーマンス レベルによりコレクションの処理能力が決定し、毎秒の要求単位数が変わります。 パフォーマンス レベルは、そのコレクションの有効期間にわたって、アプリケーションの処理ニーズの変化やアクセス パターンに合わせて調整できます。 詳細については、次を参照してください。 [DocumentDB のパフォーマンス レベル](documentdb-performance-levels.md)します。
>[AZURE.IMPORTANT] コレクションは課金対象のエンティティです。 コストは、コレクションに割り当てられたパフォーマンス レベルにより決まります。 

要求単位の消費は、1 秒あたりのレートとして評価されます。 コレクションに対してプロビジョニングされた要求単位レートをアプリケーションが超過した場合、そのレートが予約されたレベルを下回るまで、コレクションに対する要求は制限されます。 アプリケーションで高レベルなスループットが必要な場合、既存のコレクションのパフォーマンス レベルを調整するか、新規のコレクションにアプリケーションの要求を分散することができます。

要求単位は、要求の処理コストを標準化した測定単位です。 1 つの要求単位は、10 個の一意のプロパティ値で構成される 1 KB JSON ドキュメントの読み取り (self リンクによる) に必要な処理能力を表します。 要求単位の負担は、整合性レベルが既定の "セッション" に設定され、すべてのドキュメントに自動的にインデックスが作成されることを前提としています。 同じドキュメントを挿入、置換、または削除する要求では、必要になるサービスの処理が多くなるため、使用される要求単位も多くなります。 サービスからの各応答には、要求で使用される要求単位を測定するカスタム ヘッダー (x-ms-request-charge) が含まれます。 このヘッダーは使用してアクセスも、 [Sdk](https://msdn.microsoft.com/library/azure/dn781482.aspx)します。 .NET SDK では、RequestCharge は ResourceResponse オブジェクトのプロパティです。
>[AZURE.NOTE] 1KB のドキュメントに対する 1 つの要求単位のベースラインは self リンクによるドキュメントの簡単な GET に対応します。 

DocumentDB データベース アカウントに対する操作に使用される要求単位に影響を及ぼす要因はいくつかあります。 その要因には次のものがあります。

- ドキュメント サイズ。 ドキュメントのサイズが増大すると、データの読み取りまたは書き込みに使用される単位も増加します。
- プロパティの数。 すべてのプロパティに既定でインデックスが作成されると想定すると、プロパティ数の増加に伴って、ドキュメントの書き込みに使用される単位が増加します。
- データの整合性。 Strong または Bounded Staleness のデータの整合性レベルを使用すると、ドキュメントの参照に使用される単位が増加します。
- インデックス付きプロパティ。 各コレクションのインデックス ポリシーによって、既定でインデックスが作成されるプロパティが決まります。 インデックス付きプロパティの数を制限することで、使用する要求単位を削減できます。
- ドキュメントのインデックス作成。 各ドキュメントには既定で自動的にインデックスが作成されます。一部のドキュメントにインデックスを作成しないようにすると、使用される要求単位が少なくなります。

クエリ、ストアド プロシージャ、トリガーは、実行する操作の複雑さに基づいて要求単位を使用します。 アプリケーションを開発するときは、ヘッダーを調べて、各操作で使用される要求単位の量を詳しく把握するようにしてください。

## 整合性レベルの選択とスループット

既定の一貫性レベルの選択内容により、スループットと待機時間が影響を受けます。 既定の一貫性レベルは、プログラムで設定することも Azure ポータルを通じて設定することもできます。 また、要求ベースで一貫性レベルをオーバーライドすることもできます。 既定の一貫性レベルは、モノトニックな読み取り/書き込みおよび書き込みの読み取り保証を提供する "Session" 一貫性レベルとなります。 "Session" 整合性レベルは、ユーザー中心のアプリケーションに効果的で、整合性とパフォーマンスのトレードオフが優れたバランスで実現されます。

Azure ポータルで一貫性レベルを変更する方法の詳細については、次を参照してください。 [DocumentDB アカウントを管理する方法](documentdb-manage-account.md#consistency)します。 一貫性レベルの詳細については、次を参照してください。 または、 [一貫性レベルを使用して](documentdb-consistency-levels.md)します。

## プロビジョニング済みドキュメント ストレージとインデックス オーバーヘッド

作成したコレクションごとに、10 GB の SSD ベースのドキュメント ストレージがプロビジョニングされます。 10 GB のドキュメント ストレージには、ドキュメントとインデックス用のストレージが含まれます。 既定では、DocumentDB コレクションは、セカンダリ インデックスまたはスキーマを明示的に必要とすることなくすべてのドキュメントのインデックスを自動的に作成するように構成されます。 DocumentDB を使用するアプリケーションに基づくと、一般的なインデックス オーバーヘッドは 2 ～ 20% です。 DocumentDB で使用しているインデックス作成テクノロジでは、プロパティの値に関係なく、既定の設定でインデックス オーバーヘッドがドキュメント サイズの 80% を超えることはありません。

既定では、DocumentDB によって自動的にすべてのドキュメントのインデックスが作成されます。 ただし、インデックス オーバーヘッドを調整することを選択した場合」の説明に従って時の挿入または置換、ドキュメントのインデックス作成から、特定のドキュメントを削除する [DocumentDB インデックス作成ポリシー](documentdb-indexing-policies.md)します。 コレクション内のすべてのドキュメントをインデックス作成の対象から除外するように DocumentDB コレクションを構成できます。 選択的に特定のプロパティのみインデックスを作成する DocumentDB コレクションを構成することもできます。 または、JSON のワイルドカードを含むパスをドキュメントに記載されて [コレクションのインデックス作成ポリシーを構成する](documentdb-indexing-policies.md#configuring-the-indexing-policy-of-a-collection)します。 プロパティまたはドキュメントを除外すると書き込みスループットが向上し、消費する要求単位が少なくなります。

## 次のステップ

Azure ポータルでのパフォーマンス レベルを監視する方法については、次を参照してください。 [DocumentDB アカウントの監視](documentdb-monitor-accounts.md)します。

コレクションのパフォーマンス レベルを選択する方法については、次を参照してください。 [DocumentDB のパフォーマンス レベル](documentdb-performance-levels)します。





