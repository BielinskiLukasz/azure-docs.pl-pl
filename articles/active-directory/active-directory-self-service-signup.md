<properties
    pageTitle="Azure のセルフサービス サインアップについて | Microsoft Azure"
    description="Azure のセルフサービス サインアップの概要、およびサインアップ プロセスの管理方法と DNS ドメイン名の引き継ぎ方法"
    services="active-directory"
    documentationCenter=""
    authors="curtand"
    manager="stevenpo"
    editor=""/>

<tags
    ms.service="active-directory"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="identity"
    ms.date="09/21/2015"
    ms.author="stevenpo"/>


# Azure のセルフサービス サインアップについて

このトピックでは、セルフサービス サインアップ プロセス (場合によってはバイラル サインアップと呼ばれる) および DNS ドメイン名を引き継ぐ方法について説明します。  

## セルフサービス サインアップを使用する理由

- 顧客が求めるサービスを迅速に提供できる。
- サービス提供の電子メール ベース (バイラル) プランを構築できる。
- 覚えやすい職場の電子メールの別名を使用した迅速な ID 作成を可能にする、電子メール ベースのサインアップ フローを作成できる。
- 管理されていない Azure テナントを拡張して後に管理対象テナントに変換することが可能で、他のサービスへの再利用もできる。

## 用語と定義

+ **セルフ サービス サインアップ**: これは、ユーザーがクラウド サービスにサインアップし、電子メール ドメインに基づいたが自動的に作成して Azure Active Directory (AD) の id がする方法です。
+ **管理されていない Azure テナント**: これは、その id が作成されるディレクトリです。 管理されていないテナントは、グローバル管理者がいないディレクトリです。 
+ **電子メール検証済みユーザー**: これは、Azure AD でのユーザー アカウントの種類。 セルフサービス プランへのサインアップ後に自動作成された ID を持つユーザーは、電子メール検証済みユーザーです。 電子メール検証済みユーザーは、creationmethod=EmailVerified でタグ付けされたディレクトリの通常メンバーです。

## ユーザー エクスペリエンス

たとえば、電子メール経由で機密性の高いファイルを受信する、電子メールを持つユーザー Dan@BellowsCollege.com とします。 これらのファイルは、Azure Rights Management (Azure RMS) によって保護されています。 しかしダンが所属するべロウズ大学は、 Azure RMS にサインアップしていないだけでなく、Active Directory RMS もデプロイしていません。 この場合、ダンは個人向け RMS の無料サブスクリプションにサインアップして、保護されたファイルを参照することができます。

ダンが、BellowsCollege.com の電子メール アドレスを使用してこのセルフサービス プランにサインアップした最初のユーザーであるならば、BellowsCollege.com の管理されていないテナントが  Azure AD に作成されます。 BellowsCollege.com ドメインの他のユーザーがこのプランまたは類似のセルフサービス プランにサインアップすると、Azure にある管理されていない同じテナントに、電子メール検証済みアカウントが作成されます。

## 管理者エクスペリエンス

管理されていない Azure テナントの DNS ドメイン名を所有する管理者は、所有権の証明後にテナントを引き継ぐか、マージすることができます。 次のセクションでは管理者エクスペリエンスを詳細に説明しますが、概要を以下に示します。

- 管理されていない Azure テナントを引き継ぐと、その管理されていないテナントのグローバル管理者になります。 これは、内部の引き継ぎとも呼ばれます。
- 管理されていない Azure テナントをマージすると、その管理されていないテナントの DNS ドメイン名が管理対象の Azure テナントに追加され、ユーザーが引き続き中断されずにサービスにアクセスできるように、ユーザーからリソースへのマッピングが作成されます。 これは、外部の引き継ぎとも呼ばれます。

## Azure Active Directory 内に作成されるもの

#### テナント

- 1 つのドメインにつき 1 つの Azure Active Directory テナントが作成されます。
- Azure AD テナントのディレクトリにはグローバル管理者はいません。

#### ユーザー

- サインアップするユーザーごとに、Azure AD テナント内にユーザー オブジェクトが作成されます。
- 各ユーザー オブジェクトはバイラルとしてマークされます。
- 各ユーザーは、サインアップしたサービスにアクセスできます。

### 所有ドメインのセルフサービス Azure AD テナントの要求方法

セルフサービス Azure AD テナントを要求するには、ドメイン検証を実行します。 ドメイン検証では、DNS レコードの作成によってドメインを所有していることを証明できます。

Azure AD テナントの DNS 引き継ぎを行うには 2 つの方法があります。

- 内部の引き継ぎ (管理者が管理されていない Azure のテナントを検出し、管理対象テナントに変更する)
- 外部の引き継ぎ (管理者が管理対象 Azure テナントへの新しいドメインの追加を試みる)

ユーザーがセルフサービス サインアップした後に、管理されていないテナントを引き継ぐか、あるいは新しいドメインを既存の管理対象テナントに追加するには、ドメインを所有していることを検証する必要があります。 たとえば、contoso.com という名前のドメインがあり、contoso.co.uk または contoso.uk という新しいドメインを追加する場合などにこれを実行します。

## ドメインの引き継ぎについて  

このセクションでは、ドメインを所有していることを検証する方法を説明します。

### ドメインの検証とその使用目的について

Azure AD のテナントで作業するには、DNS ドメインの所有権を検証する必要があります。  ドメインを検証するとテナントを要求でき、セルフサービスのテナントを管理対象テナントに昇格するか、既存の管理対象テナントにマージできます。

## ドメイン検証の例

テナントの DNS 引き継ぎを行うには 2 つの方法があります。

+ 内部の引き継ぎ (たとえば、管理者、セルフ サービス、管理されていないテナントを検出および管理対象テナントに変更する)
+ 外部の引き継ぎ (たとえば、管理者が管理対象テナントへの新しいドメインの追加を試みる)

### 内部の引き継ぎ - セルフサービスの管理されていないテナントを管理対象テナントに昇格

内部の引き継ぎを実行すると、管理されていないテナントが、管理対象テナントに変換されます。 DNS ドメイン名の検証を完了する必要があります。このとき、DNS ゾーンに MX レコードまたは TXT レコードを作成します。 この操作によって以下を実行できます。

+ ドメインを所有していることを検証
+ テナントが管理対象になる
+ テナントのグローバル管理者になる

たとえば、ベロウズ大学の IT 管理者が、この大学のユーザーたちがセルフサービス プランにサインアップしたことを知ったとします。 その IT 管理者は、BellowsCollege.com という DNS 名の登録所有者として、 Azure で DNS 名の所有権を検証してから、管理されていないテナントを引き継ぐことができます。 そのテナントは管理対象テナントになり、IT 管理者は BellowsCollege.com ディレクトリのグローバル管理者ロールに割り当てられます。

### 外部の引き継ぎ - セルフサービスのテナントを既存の管理対象テナントにマージ

外部の引き継ぎでは、既に管理対象テナントを持っているため、2 つの異なるテナントを所有する代わりに、すべてのユーザーとグループにその管理対象テナントに参加させます。

管理対象テナントの管理者としてドメインを追加したとき、そのドメインに、管理されていないテナントが偶然関連付けられていたと考えてくだだい。

たとえば IT 管理者が、contoso.com の管理対象テナントをすでに所有しているとします。contoso.com は IT 管理者の所属組織に登録されています。 組織のユーザーがサインアップを実行セルフ サービス ソリューションの組織が所有する別のドメイン名は、電子メール ドメイン名 user@contoso.co.uk を使用して検出します。 これらのユーザーは現在、contoso.co.uk の管理されていないテナントのアカウントを持っています。

2 つのテナントの管理は避けたいため、 IT 管理者は contoso.co.uk の管理されていないテナントを、contoso.com の既存の IT 管理対象テナントにマージします。

外部の引き継ぎでも、内部の引き継ぎと同じ DNS 検証プロセスに従います。  異なる点は、ユーザーおよびサービスが、IT 管理対象テナントに再マッピングされることです。

#### 外部の引き継ぎの実行から受ける影響について

外部の引き継ぎを実行すると、ユーザーからリソースへのマッピングが作成されるため、ユーザーは引き続き中断されることなくサービスにアクセスできます。 個人向け RMS を含む多くのアプリケーションでは、ユーザーからリソースへのマッピングがうまく処理されるため、ユーザーはこれらのサービスに以前と同じようにアクセスできます。 ユーザーからリソースへのマッピングが効果的に処理されないアプリケーションの場合は、ユーザー エクスペリエンスの低下を回避するために、外部の引き継ぎが明示的にブロックされている場合があります。

#### サービスごとのテナント引き継ぎのサポート

現在、次のサービスで引き継ぎがサポートされています。

- RMS


次のサービスでは、まもなく引き継ぎがサポートされます。

- PowerBI

次のサービスでは、外部の引き継ぎの後に、ユーザー データを移行するための追加の管理操作は必要ありません。

- SharePoint および OneDrive


## DNS ドメイン名の引き継ぎの実行方法

ドメイン検証 (および必要に応じて引き継ぎ) の実行方法はいくつかあります。 

1.  Microsoft Azure 管理ポータル

    引き継ぎは、ドメインの追加によってトリガーされます。  ドメインのテナントが既に存在する場合は、オプションで外部の引き継ぎを実行できます。

    資格情報を使用して、Azure ポータルにサインインします。  既存のテナントに移動し、続いて **ドメインの追加**します。

2.  Office 365

    オプションを使用することができます、 [ドメインの管理](https://support.office.com/article/Navigate-to-the-Office-365-Manage-domains-page-026af1f2-0e6d-4f2d-9b33-fd147420fac2/) ドメインと DNS レコードを使用する Office 365 でのページです。 参照してください [Office 365 でドメインを確認](https://support.office.com/article/Verify-your-domain-in-Office-365-6383f56d-3d09-4dcb-9b41-b5f5a5efd611/)します。

3.  Windows PowerShell

    Windows PowerShell を使用して検証を実行するには、次の手順に従ってください。

    手順    |   使用するコマンドレット
    ------- | -------------
    資格情報オブジェクトの作成 | Get-Credential
    Azure への接続 | Connect-MsolService
    ドメイン一覧の取得   | Get-MsolDomain
    チャレンジの作成  | Get-MsolDomainVerificationDns
    DNS レコードの作成   | DNS サーバー上でこれを実行
    チャレンジの確認    | Confirm-MsolEmailVerifiedDomain

次に例を示します。

1. セルフ サービス プランに対応するために使用された資格情報を使用して Azure AD に接続します。
        import-module MSOnline
        $msolcred = 資格情報の取得
        接続 msolservice-$msolcred に資格情報

2. ドメイン一覧を、次のコマンドレットで取得します。

    Get-MsolDomain

3. そして、次のように Get-MsolDomainVerificationDns コマンドレットを実行してチャレンジを作成します。

    Get-msoldomainverificationdns-DomainName *your_domain_name* – モード dnstxtrecord です

    次に例を示します。

    Get-MsolDomainVerificationDns –DomainName contoso.com –Mode DnsTxtRecord

4. このコマンドから返される値 (チャレンジ) をコピーします。

    例: 

    MS=32DD01B82C05D27151EA9AE93C5890787F0E65D9

5. パブリック DNS 名前空間で、前の手順でコピーした値を含む DNS txt レコードを作成します。

    この レコードの名前は親ドメインの名前です。このリソース レコードを Windows Server の DNS ロールを使用して作成する場合は、[レコード名] を空のままにして、テキスト ボックスに値を貼り付けます。

6. 次のように Confirm-MsolDomain コマンドレットを実行してチャレンジを確認します。

    Confirm-msolemailverifieddomain DomainName *your_domain_name*

    例:

    Confirm-MsolEmailVerifiedDomain -DomainName contoso.com

チャレンジがクリアされると、エラーなしでプロンプトに戻ります。

## セルフサービス設定の管理方法

管理者は、セルフサービスの 2 種類の管理を実行できます。 管理できる対象は次のとおりです。

- ユーザーが電子メール経由でテナントに参加できるかどうか。
- ユーザー自身がアプリケーションやサービスのライセンスを取得できるかどうか。


### これらの機能の管理方法

管理者は、Azure AD コマンドレット Set-MsolCompanySettings パラメータを使用してこれらの機能を構成できます。

+ **AllowEmailVerifiedUsers** ユーザーが作成または管理されていないテナントに参加するかどうかを制御します。 このパラメータを $false に設定すると、電子メール検証済みのユーザーはテナントに参加できません。
+ **AllowAdHocSubscriptions** ユーザーのセルフ サービス サインアップを実行するための機能を制御します。 このパラメータを $false に設定すると、ユーザーはセルフサービス サインアップを実行できません。


### これらの管理機能の連携について

これら 2 つのパラメーターを組み合わせて使用すると、セルフサービス サインアップをさらに細かく管理できるようになります。 たとえば、次のコマンドによりユーザーはセルフサービス サインアップを実行できますが、 Azure AD のアカウントを既に持っている場合に限定されます (つまり、電子メール検証済みのアカウントを作成する必要があるユーザーは、セルフサービス サインアップを実行できません)。

    Set-MsolCompanySettings -AllowEmailVerifiedUsers $false -AllowAdHocSubscriptions $true

次のフローチャートでは、これらのパラメーターのさまざまな組み合わせと、結果として得られるテナントとセルフサービス サインアップの状態を示しています。

![][1]

詳細とこれらのパラメーターを使用する方法の例については、「 [Set-msolcompanysettings](https://msdn.microsoft.com/library/azure/dn194127.aspx)します。

## 関連項目

-  [Azure PowerShell のインストールおよび構成方法](../powershell-install-configure/)

-  [Azure PowerShell](https://msdn.microsoft.com/library/azure/jj156055.aspx)

-  [Azure コマンドレット リファレンス](https://msdn.microsoft.com/library/azure/jj554330.aspx)

-  [Set-MsolCompanySettings](https://msdn.microsoft.com/library/azure/dn194127.aspx)

<!--Image references-->
[1]: ./media/active-directory-self-service-signup/SelfServiceSignUpControls.png

