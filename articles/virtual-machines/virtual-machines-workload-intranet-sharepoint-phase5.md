<properties
    pageTitle="SharePoint Server 2013 ファームのフェーズ 5 | Microsoft Azure"
    description="可用性グループを作成し、SharePoint データベースをそのグループに追加します。"
    documentationCenter=""
    services="virtual-machines"
    authors="JoeDavies-MSFT"
    manager="timlt"
    editor=""
    tags="azure-resource-manager"/>

<tags
    ms.service="virtual-machines"
    ms.workload="infrastructure-services"
    ms.tgt_pltfrm="Windows"
    ms.devlang="na"
    ms.topic="article"
    ms.date="12/11/2015"
    ms.author="josephd"/>

# SharePoint イントラネット ファーム ワークロードのフェーズ 5: 可用性グループの作成と SharePoint データベースの追加

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-rm-include.md)] 従来のデプロイ モデルです。

イントラネット専用 SharePoint 2013 ファームと SQL Server AlwaysOn 可用性グループを Azure インフラストラクチャ サービスにデプロイする作業のこの最終フェーズでは、新しい AlwaysOn 可用性グループを作成し、SharePoint ファームのデータベースを追加します。

参照してください [SharePoint と SQL Server AlwaysOn 可用性グループで、Azure のデプロイ](virtual-machines-workload-intranet-sharepoint-overview.md) の全フェーズ。

## 可用性グループの作成とデータベースの追加

SharePoint では、初期構成の一環として複数のデータベースを作成します。 次の手順を使用して、これらのデータベースを準備する必要があります。

1.  プライマリ コンピューターで、データベースの完全バックアップとトランザクション ログ バックアップを作成します。
2.  バックアップ コンピューターで、完全バックアップとログ バックアップを復元します。

データベースのバックアップと復元が完了したら、可用性グループに追加できます。 SQL Server では、(少なくとも 1 回は) バックアップされ、別のコンピューターで復元されたデータベースだけをグループに追加できます。

### バックアップ フォルダーの共有

バックアップと復元を有効にするには、セカンダリ SQL Server VM からバックアップ ファイル (.bak) にアクセスできるようにしておく必要があります。 次の手順に従います。

1.  としてプライマリ SQL Server ホストにログオン **[domain] \sp_farm_db**します。
2.  F:\disk に移動します。
3.  右クリックし、 **バックアップ** フォルダーをクリックして **と共有**, 、順にクリック **特定のユーザー**します。
4.   **ファイルの共有** ダイアログで、「 **[domain] \sqlservice**, 、クリックして **追加**します。
5.  クリックして、 **アクセス許可レベル** の列、 **sqlservice** アカウント名をクリックして **読み取り/書き込み**します。
6.  クリックして **共有**, 、] をクリックし、 **実行**します。

セカンダリ SQL Server ホストで、sqlservice アカウントに与えます点を除いて、上記の手順を実行 **読み取り** 手順 5 で [F:\Backup] フォルダーのアクセスを許可します。

### データベースのバックアップと復元する

可用性グループに追加する必要があるすべてのデータベースに対して、次の手順を繰り返す必要があります。 SQL Server AlwaysOn 可用性グループをサポートしていない SharePoint 2013 データベースもあります。 詳細については、次を参照してください。 [SharePoint データベース用の高可用性と災害復旧のオプションをサポートされている](http://technet.microsoft.com/library/jj841106.aspx)します。

データベースをバックアップするには、次の手順に従います。

1.  プライマリ SQL Server コンピューターのスタート画面で「 **SQL Studio**, 、クリックして **SQL Server Management Studio**します。
2.  クリックして **接続**します。
3.  左側のペインで、展開、 **データベース** ノードです。
4.  バックアップを順にポイントするデータベースを右クリックして **タスク**, 、] をクリックし、 **バックアップ**します。
5.   **宛先** ] をクリックして **削除** 、バックアップ ファイルの既定のファイル パスを削除します。
6.  クリックして **追加**します。  **ファイル名**, 、型 **\\[machineName]\backup\[databaseName].bak**, 、machineName はプライマリ SQL Server コンピューターの名前、databaseName はデータベースの名前。 をクリックして **[ok]**, 、順にクリック **OK** バックアップの成功に関するメッセージの後にもう一度です。
7.  左側のウィンドウで右クリック **[databaseName]**, 、] をポイント **タスク**, 、] をクリックし、 **バックアップ**します。
8.   **バックアップの種類**, [ **トランザクション ログ**, 、] をクリックし、 **[ok]** 2 回クリックします。
9.  このリモート デスクトップ セッションを開いたままにしておきます。

データベースを復元には、次の手順に従います。

1.  セカンダリ SQL Server コンピューターにログオン **[domainName] \sp_farm_db**します。
2.  スタート画面から次のように入力します。 **SQL Studio**, 、クリックして **SQL Server Management Studio**します。
3.  クリックして **接続**します。
4.  左側のウィンドウで右クリック **データベース**, 、] をクリックし、 **Restore Database**します。
5.   **ソース** ] セクションの [ **デバイス**, 、省略記号 (...) ボタンをクリックします。
6.   **バックアップ デバイスの選択**, 、クリックして **追加**します。
7.   **バックアップ ファイルの場所**, 、型 **\\[machineName]\backup**, 、Enter キーを押して、選択 **[databaseName] .bak**, 、順にクリック **OK** 2 回クリックします。 確認、完全バックアップとログ バックアップ、 **復元するバックアップ セット** セクションです。
8.   **ページの選択**, をクリックして **オプション**します。  **復元オプション** セクションで **の復旧状態**, [ **RESTORE WITH NORECOVERY**, 、] をクリックし、 **[ok]**します。
9.  クリックして **OK** 入力を求められたらします。

### 可用性グループの作成

(バックアップと復元の方法で) 1 つ以上のデータベースを準備したら、可用性グループを作成します。

1.  プライマリ SQL Server コンピューターのリモート デスクトップ セッションに戻ります。
2.   **SQL Server Management Studio**, 、左側のウィンドウで右クリック **AlwaysOn 高可用性**, 、クリックして **新しい可用性グループ ウィザード**します。
3.   **概要** ] ページで [ **次**します。
4.   **[可用性グループ名** ] ページで、可用性グループの名前を入力 **可用性グループ名** (例: AG1)、順にクリック **次**します。
5.   **データベースの選択** ] ページで、バックアップされた SharePoint ファームのデータベースを選択してクリックして **次**します。 対象とするプライマリ レプリカで完全バックアップを少なくとも 1 つは作成しているので、これらのデータベースは可用性グループの前提条件を満たしています。
6.   **レプリカの指定** ] ページで [ **のレプリカ追加**します。
7.   **サーバーへの接続**, をセカンダリ SQL Server コンピューターの名前を入力して、クリックして **接続**します。
8.   **レプリカの指定** ] ページで、セカンダリ SQL Server ホストとして記載されて **可用性レプリカ**します。 両方のインスタンスについて、次のオプション値を設定します。

初期ロール | オプション | 値
--- | --- | ---
プライマリ | [自動フェールオーバー (上限 2)] | オン
セカンダリ | [自動フェールオーバー (上限 2)] | オン
プライマリ | [同期コミット (上限 3)] | オン
セカンダリ | [同期コミット (上限 3)] | オン
プライマリ | [読み取り可能なセカンダリ] | あり
セカンダリ | [読み取り可能なセカンダリ] | あり

9.  クリックして **次**します。  
10.  **[初期データの同期** ] ページで [ **参加のみ**, 、順にクリック **次**します。 データの同期は、プライマリ サーバーで完全バックアップとトランザクション バックアップを作成し、バックアップで復元することによって手動で実行します。 代わりを選択することができます **完全** 新しい可用性グループ ウィザードがデータの同期を実行できるようにします。 ただし、一部の企業で使用されている大規模なデータベースでは同期はお勧めしません。  
11.  **検証** ] ページで [ **次**します。 可用性グループ リスナーを構成していないため、リスナー構成が見つからないことを示す警告が表示されます。
12.  **概要** ] ページで [ **完了**します。 ウィザードを終了する、検査、 **結果** ページを可用性グループが正常に作成されたことを確認します。 必要な場合は、[クリックして **閉じる** ウィザードを終了します。
13. スタート画面から次のように入力します。 **フェールオーバー**, 、クリックして **フェールオーバー クラスター マネージャー**します。 左側のウィンドウで、クラスター名を開き、クリックして **ロール**します。 可用性グループの名前が付いた新しいロールが表示されます。  

SharePoint データベースの SQL Server AlwaysOn 可用性グループが正常に構成されました。

## AlwaysOn 可用性グループのリスナーの構成

必要に応じて、AlwaysOn 可用性グループのリスナー構成を作成することもできます。 手順については、次を参照してください。 [チュートリアル: AlwaysOn 可用性グループのリスナー構成](https://msdn.microsoft.com/library/dn425027.aspx)します。 リスナーを 1 つだけ作成し、内部負荷分散インスタンスの仮想 IP アドレスを使用するように構成します。

リスナーを作成したら、クラスターの最初の SQL サーバーの名前ではなく、リスナーを使用するようにすべての SharePoint 仮想マシンを構成する必要があります。 名前を使用するのではなく、SQL エイリアスを使用するように SharePoint 仮想マシンを構成します。 詳細と手順では、次を参照してください。 [SharePoint の SQL エイリアス](http://blogs.msdn.com/b/priyo/archive/2013/09/13/sql-alias-for-sharepoint.aspx)します。

SharePoint と SQL Server AlwaysOn 可用性グループの追加については、次を参照してください。 [を構成する SQL Server 2012 AlwaysOn 可用性グループを SharePoint 2013 用](https://technet.microsoft.com/library/jj715261.aspx)します。


## 次のステップ

- [構成](https://technet.microsoft.com/library/ee836142.aspx) SharePoint ファーム。

