<properties 
   pageTitle="Azure キューと Service Bus キューの比較 | Microsoft Azure"
   description="Azure によって提供される 2 種類のキューの相違点と共通点について説明します。"
   services="service-bus"
   documentationCenter="na"
   authors="sethmanheim"
   manager="timlt"
   editor="tysonn" />
<tags 
   ms.service="service-bus"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="tbd"
   ms.date="11/18/2015"
   ms.author="sethm" />

# Azure キューと Service Bus キューの比較

この記事では、現在 Microsoft Azure によって提供されている Azure キューと Service Bus キューという 2 種類のキューの相違点と共通点について説明します。 この情報を使用すると、それぞれのテクノロジを比較対照して、現在のニーズに最適なのはどちらのソリューションかを十分な情報に基づいて判断できるようになります。

## はじめに

Microsoft Azure は、2 つの種類のキュー メカニズムをサポートしています: **Azure キュー** と **Service Bus キュー**します。

**Azure キュー**, 、含まれています、 [Azure ストレージ](http://azure.microsoft.com/services/storage/) インフラストラクチャ、機能、単純な Get または Put/ピーク (REST) ベースのインターフェイス内およびサービス間を信頼性の高い、永続的なメッセージングを提供します。

**Service Bus キュー** より大きなの一部である [Azure のメッセージング](http://azure.microsoft.com/services/service-bus/) キューおよびトピック発行/サブスクライブ、Web サービスのリモート処理、および統合パターンをサポートするインフラストラクチャ。 Service Bus キュー、トピック/サブスクリプション、およびリレーの詳細については、次を参照してください。、 [Service Bus メッセージングの概要](service-bus-messaging-overview.md)します。

この 2 つのキュー テクノロジは共存していますが、最初に Azure キューが、Azure ストレージ サービス上に構築された専用のキュー ストレージ メカニズムとして導入されました。 Service Bus キューは、より大きな「ブローカー メッセージング」インフラストラクチャ上に構築されています。このインフラストラクチャは、複数の通信プロトコル、データ コントラクト、信用ドメイン、ネットワーク環境などにまたがるアプリケーションやアプリケーション コンポーネントの統合を目的としています。

この記事では、Azure によって提供されるこの 2 つのキュー テクノロジを比較するために、各テクノロジの機能の動作と実装の違いについて説明します。 また、アプリケーション開発のニーズに最適な機能を選択する方法についても説明します。

## テクノロジの選択に関する考慮事項

Azure キューと Service Bus キューは、どちらも、現在 Microsoft Azure で提供されているメッセージ キュー サービスの実装です。 機能に若干の違いがあるため、個々のソリューションの要件や、解決する必要があるビジネス上または技術上の問題に応じて、いずれかまたは両方を使用できます。

特定のソリューションの目的に合うキュー テクノロジを判断する場合、ソリューション設計者および開発者は次の推奨事項を検討する必要があります。 詳細については、次のセクションをご覧ください。

ソリューション設計者または開発者、として **Azure キューを使用する必要がある** とき。

- アプリケーションでキューに格納する必要があるメッセージの量が 80 GB を超えており、メッセージの有効期間が 7 日未満の場合。

- アプリケーションでキュー内のメッセージ処理の進行状況を追跡する必要がある場合。 これは、メッセージを処理している worker がクラッシュした場合に役に立ちます。 後続の worker でその情報を使用して、前の worker が中断した時点から処理を再開できます。

- キューに対して実行されたすべてのトランザクションのサーバー側のログが必要な場合。

ソリューション設計者または開発者、として **Service Bus キューを使用する必要がある** とき。

- キューをポーリングせずにメッセージを受信できる必要がある場合。 Service Bus では、Service Bus でサポートする TCP ベースのプロトコルを使用し、長いポーリングの受信操作を使用することによってこれを実現できます。

- キューによるメッセージの配信が先入れ先出し (FIFO) の順序で行われることが保証される必要がある場合。

- Azure と Windows Server (プライベート クラウド) 上で対称的なエクスペリエンスが必要な場合。 詳細については、次を参照してください。 [Service Bus for Windows Server](https://msdn.microsoft.com/library/dn282144.aspx)します。

- 自動重複検出をサポートする必要がある場合。

- 実行時間の長い並列ストリームとしてアプリケーションにメッセージを処理する (メッセージがストリームを使用して、関連付け、 [SessionId](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.sessionid.aspx) メッセージのプロパティ)。 このモデルでは、処理を行うアプリケーションの各ノードは、メッセージではなくストリームに対して競合します。 処理を行うノードにストリームが渡されると、そのノードはトランザクションを使用してアプリケーション ストリームの状態を確認できます。

- 複数のメッセージをキューに送信したりキューから受信したりする際にトランザクション動作と原子性が必要な場合。

- アプリケーション固有のワークロードの TTL (time-to-live) が 7 日間を超える場合。

- アプリケーションで処理するメッセージのサイズが 64 KB を超えることはあっても 256 KB の制限に到達することはないと考えられる場合。

- ロールベースのアクセス モデルを提供して、キューの送信側と受信側に異なる権限/アクセス許可を与える必要がある場合。

- キューのサイズが 80 GB を超えることはない場合。

- AMQP 1.0 標準ベースのメッセージング ブローカーを使用する必要がある場合。 AMQP の詳細については、次を参照してください。 [Service Bus AMQP の概要](service-bus-amqp-overview.md)します。

- いずれは、キュー ベースのポイント ツー ポイントの通信から、キューに送信されたメッセージの一部またはすべての独立したコピーを受信する追加の受信側 (サブスクライバー) をシームレスに統合できるメッセージ交換パターンに移行することを考えている場合。 後者は、Service Bus によってネイティブで提供される発行/サブスクライブ機能を指します。

- 追加のインフラストラクチャ コンポーネントを作成しなくても「At-Most-Once」の配信保証をサポートできる必要がある場合。

- バッチ メッセージの発行および使用が必要な場合。

- Windows Communication Foundation (WCF) の .NET Framework 通信スタックとの完全な統合が必要な場合。

## Azure キューと Service Bus のキューの比較

次のセクションの表では、キューの機能を論理的にグループ化しており、Azure キューと Service Bus キューの両方で使用できる機能を一目で比較することができます。

## 基本的な機能

このセクションでは、Azure キューと Service Bus キューで提供される基本的なキュー機能の一部を比較します。

|比較条件|Azure キュー|Service Bus キュー|
|---|---|---|
|順序の保証|**いいえ** <br/><br>詳細については、「追加情報」セクションでは、最初メモを参照してください。</br>|**○ - 先入れ最初出し (FIFO)**<br/><br>(メッセージング セッション) を使用|
|配信保証|**At-Least-Once**|**At-Least-Once**<br/><br/>**ほとんど 1 回**|
|トランザクションのサポート|**いいえ**|**あり**<br/><br/>(ローカル トランザクション) を使用|
|受信動作|**非ブロッキング**<br/><br/>(が完了するとすぐに新しいメッセージが存在しない場合)|**タイムアウトなしのブロック**<br/><br/>(長いポーリングの提供、または [「Comet 手法」](http://go.microsoft.com/fwlink/?LinkId=613759))<br/><br/>**非ブロッキング**<br/><br/>(.NET マネージ API のみ)|
|プッシュ型 API|**いいえ**|**あり**<br/><br/>[OnMessage](https://msdn.microsoft.com/library/azure/jj908682.aspx) と **OnMessage** セッション .NET API です。|
|受信モード|**Peek & Lease**|**Peek & Lock**<br/><br/>**受信して削除するには.**|
|排他アクセス モード|**リース ベース**|**ロック ベース**|
|リース/ロックの期間|**30 秒 (既定)**<br/><br/>**7 日間 (最大)** (更新またはを使用してメッセージ リースを解放できます、 [UpdateMessage](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.updatemessage.aspx) API です)。|**60 秒 (既定)**<br/><br/>使用してメッセージ ロックを更新する、 [RenewLock](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.renewlock.aspx) API です。|
|リース/ロックの粒度|**メッセージ レベル**<br/><br/>(各メッセージを使用して、メッセージの処理中で必要に応じて更新できる、別のタイムアウトの値を設定できます、 [UpdateMessage](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.updatemessage.aspx) API)|**キュー レベル**<br/><br/>(各キューのメッセージの一部に適用されるロックの有効桁数を使用してロックを更新することができますが、 [RenewLock](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.renewlock.aspx) API です)。|
|一括受信|**あり**<br/><br/>(最大 32 個のメッセージのメッセージを取得するときに明示的にメッセージの数を指定する)|**あり**<br/><br/>(プレフェッチ プロパティを暗黙的に有効化またはトランザクションを使用して明示的に)|
|一括送信|**いいえ**|**あり**<br/><br/>(トランザクションまたはクライアント側のバッチ処理) を使用|

### 追加情報

- Azure キューのメッセージは一般的に先入れ先出しですが、メッセージの表示タイムアウト期限を過ぎたとき (たとえば処理中にクライアント アプリケーションがクラッシュした場合) などに順番が変わることがあります。 表示タイムアウトが過ぎると、別の worker がデキューするために、メッセージがキューに再度表示されます。 そのとき、もともとエンキュー時に後ろにあったメッセージの後にメッセージが (再デキューのために) 配置されることがあります。

- Azure Storage の BLOB またはテーブルを既に使用している場合にキューの使用を開始すると、99.9% の可用性が保証されます。 BLOB またはテーブルを Service Bus キューと使用する場合は、可用性が低下します。

- Service Bus キューで FIFO パターンを保証するには、メッセージング セッションを使用する必要があります。 受信したメッセージの処理中に、アプリケーションがクラッシュすること、 **ピーク/ロック** モードでは、キューの受信側は、メッセージング セッションを受け入れる次の時間は開始し、失敗したメッセージ (の有効期間 TTL) 内に期限が切れるとします。

- Azure キューは、アプリケーション コンポーネントを分離してスケーラビリティや耐障害性を向上させ、負荷平準化やプロセス ワークフロー構築を容易にするなどの、標準的なキュー シナリオをサポートするように設計されています。

- Service Bus キューのサポート、 *に-少なくとも 1 回* 配信保証します。 さらに、 *、ほとんどの 1 回* セマンティック アプリケーションの状態を格納するセッション状態を使用して、アトミックにメッセージを受信し、セッション状態を更新するトランザクションを使用して、サポートされていることができます。 Azure Workflow Service では、この方法を使用して At-Most-Once の配信を保証しています。

- Azure キューでは、開発者とオペレーション チームの双方に対し、キュー、テーブル、BLOB で一貫性のあるプログラミング モデルを提供します。

- Service Bus キューは、1 つのキューのコンテキストでローカル トランザクションをサポートします。

-  *受信して削除* Service Bus でサポートされているモードが低減配信の確実メッセージング操作の数 (および関連するコスト) を軽減する機能を提供します。

- Azure キューではメッセージのリースを延長することのできるリースを提供します。 これにより、メッセージのリースを短くして、 worker がクラッシュした場合にすぐに別の worker がメッセージを再度処理できるようにしたり、 メッセージで現在のリース時間より長い処理時間が必要になった場合にメッセージのリースを延長したりすることができます。

- Azure キューでは、メッセージをエンキューまたはデキューするときに表示のタイムアウトを設定できます。 また、実行時にメッセージを別のリース値で更新したり、同じキューのメッセージを別の値で更新したりすることもできます。 Service Bus のロック タイムアウト数がキューのメタデータで定義されています。ただしを呼び出してロックを更新できます、 [RenewLock](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.renewlock.aspx) メソッドです。

- Service Bus キューのブロッキング受信操作の最大タイムアウトは 24 日です。 ただし、REST ベースのタイムアウトの最大値は 55 秒です。

- Service Bus でサポートされているクライアント側のバッチ処理を使用すると、キュー クライアントで複数のメッセージをバッチ処理して 1 回の送信操作で処理を完了できます。 バッチ処理は非同期送信操作でのみ使用できます。

- 200 TB が上限の Azure キュー (アカウントを仮想化すればさらに確保可能) や無制限キューのような機能により、Azure は SaaS プロバイダーにとって理想的なプラットフォームになります。

- Azure キューでは、柔軟性が高くパフォーマンスに優れた委任アクセス制御メカニズムを提供します。

## 高度な機能

このセクションでは、Azure キューと Service Bus キューで提供される高度な機能を比較します。

|比較条件|Azure キュー|Service Bus キュー|
|---|---|---|
|スケジュールされた配信|**あり**|**あり**|
|自動的な配信不能レタリング|**いいえ**|**あり**|
|キューの有効期間の増加|**あり**<br/><br/>(表示のタイムアウトのインプレース更新) を使用|**あり**<br/><br/>(専用の API 関数を使用して提供されます)|
|有害なメッセージのサポート|**あり**|**あり**|
|インプレース更新|**あり**|**あり**|
|サーバー側のトランザクション ログ|**あり**|**いいえ**|
|Storage のメトリック|**あり**<br/><br/>**分単位のメトリック**: 測定値をリアルタイムの可用性、TPS、API の呼び出し数、エラー数、その詳細は、すべて (分単位で集計され、運用環境での発生から数分以内にレポート リアルタイムで提供します。 詳細については、次を参照してください。 [Storage Analytics Metrics について](https://msdn.microsoft.com/library/azure/hh343258.aspx)します。|**あり**<br/><br/>(呼び出しによる一括クエリ [GetQueues](https://msdn.microsoft.com/library/azure/hh293128.aspx))|
|状態管理|**いいえ**|**あり**<br/><br/>[Microsoft.ServiceBus.Messaging.EntityStatus.Active](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.entitystatus.aspx), 、[Microsoft.ServiceBus.Messaging.EntityStatus.Disabled](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.entitystatus.aspx), 、[Microsoft.ServiceBus.Messaging.EntityStatus.SendDisabled](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.entitystatus.aspx), 、[Microsoft.ServiceBus.Messaging.EntityStatus.ReceiveDisabled](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.entitystatus.aspx)|
|メッセージの自動転送|**いいえ**|**あり**|
|キューの消去機能|**あり**|**いいえ**|
|メッセージ グループ|**いいえ**|**あり**<br/><br/>(メッセージング セッション) を使用|
|メッセージ グループ単位のアプリケーション状態|**いいえ**|**あり**|
|重複検出|**いいえ**|**あり**<br/><br/>(送信側で構成可能)|
|WCF の統合|**いいえ**|**あり**<br/><br/>(既定の WCF バインドを提供しています)|
|WF の統合|**カスタム**<br/><br/>(カスタム WF アクティビティを作成する必要があります)|**ネイティブ**<br/><br/>(既定の WF 活動を提供しています)|
|メッセージ グループの参照|**いいえ**|**あり**|
|ID によるメッセージ セッションの取得|**いいえ**|**あり**|

### 追加情報

- 両方のキュー テクノロジには、メッセージを後で配信するようにスケジュールできる機能があります。

- キューの自動転送を使用すると、数千のキューのメッセージを 1 つのキューに自動転送して、受信側アプリケーションはそのキューからメッセージを処理することができます。 このメカニズムを使用して、各メッセージ パブリッシャー間でセキュリティの確保、フロー制御、ストレージ分離を実現できます。

- Azure キューでは、メッセージの内容の更新がサポートされています。 この機能を使用すると、状態情報と進行状況の増分更新をメッセージに永続化して、メッセージの処理を最初からではなく前回のチェックポイントから開始することができます。 Service Bus キューでは、メッセージ セッションを使用することで同じ機能を実現できます。 セッションが有効にして、保存して、アプリケーションの処理状態を取得する (を使用して [SetState](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagesession.setstate.aspx) と [GetState](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagesession.getstate.aspx))。

- Service Bus キューでのみサポートされている配信不能レタリングは、受信側のアプリケーションで正しく処理できないメッセージを分離する場合や、TTL (time-to-live) プロパティが期限切れになったためにメッセージが宛先に届かない場合に役立ちます。 TTL の値は、メッセージがキューに保持される期間を指定します。 Service Bus では、TTL が期限切れになると、メッセージが $DeadLetterQueue という特殊なキューに移動されます。

- Azure キューで「有害な」メッセージを検出するには、アプリケーションでメッセージをデキューするときにメッセージの DequeueCount プロパティを確認します。 DequeueCount が一定のしきい値を超えている場合は、そのメッセージをアプリケーション定義の「配信不能」キューに移動します。

- Azure キューでは、キューに対して実行されたすべてのトランザクションの詳細なログとメトリックの集計値を取得できます。 これらのオプションはいずれも、デバッグや、アプリケーションでの Azure キューの使い方を理解するのに役立ちます。 また、アプリケーションのパフォーマンス チューニングやキューの使用コストの削減にも役立ちます。

- Service Bus でサポートされている「メッセージ セッション」の概念を使用すると、特定の論理グループに属するメッセージを特定の受信側に関連付けて、メッセージとその受信側の間にセッションのような関係を作成できます。 この Service Bus の機能を設定して高度な有効にすることができます、 [SessionID](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.sessionid.aspx) メッセージのプロパティです。 受信側では、特定のセッション ID をリッスンして、指定したセッション ID を共有するメッセージを受信できます。

- Service Bus キューで自動的にサポートされている重複検出機能は、キューまたはトピックの値を基に送信された重複するメッセージを削除、 [MessageID](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.messageid.aspx) プロパティです。

## 容量およびクォータ

このセクションでは、容量および適用可能なクォータの観点から Azure キューと Service Bus キューを比較します。

|比較条件|Azure キュー|Service Bus キュー|
|---|---|---|
|最大キュー サイズ|**200 TB**<br/><br/>(1 つのストレージ アカウントの容量に制限されます)|**1 GB ~ 80 GB**<br/><br/>(キューの作成時に定義し、 [パーティション分割を有効にする](service-bus-partitioning.md) –「追加情報」を参照してください)|
|最大メッセージ サイズ|**64 KB**<br/><br/>(を使用する場合は 48 KB **Base64** エンコード)<br/><br/>Azure は、キューおよび blob をエンキューできますを組み合わせることでサイズの大きいメッセージをサポートしている 1 つの項目には、最大で 200 GB です。|**256 KB**<br/><br/>(ヘッダーと本文、ヘッダーの最大サイズの両方を含む: 64 KB)|
|メッセージの最大 TTL|**7 日**|**無制限**|
|キューの最大数|**無制限**|**10,000**<br/><br/>(サービス名前空間あたり増やすことができます)|
|同時クライアントの最大数|**無制限**|**無制限**<br/><br/>(100 の同時接続数は制限は TCP プロトコル ベースの通信にのみ適用されます)|

### 追加情報

- Service Bus では、キューのサイズが制限されます。 キューの最大サイズは、キューの作成時に 1 ～ 80 GB の値を指定できます。 キューの作成時に設定したキュー サイズの値に達すると、その後の受信メッセージは拒否され、呼び出し元のコードが例外を受け取ります。 Service Bus のクォータの詳細については、次を参照してください。 [Service Bus のクォータ](service-bus-quotas.md)します。

- Service Bus キューは、1 GB、2 GB、3 GB、4 GB、5 GB で作成できます (既定値は 1 GB)。 パーティション分割を有効にすると (既定)、Service Bus は指定した各 GB あたりに 16 個のパーティションを作成できます。 そのため、5 GB のキューを作成すると、16 個のパーティションで、キューの最大サイズは (5 * 16) = 80 GB になります。 パーティション分割されたキューまたはトピックの最大サイズを確認するに対応するエントリを見て、 [Azure クラシック ポータル][]します。

- Azure キューでメッセージの内容が XML セーフでない場合があります **Base64** エンコードします。 場合する **Base64**-メッセージのエンコード、ユーザー ペイロードが 64 KB ではなく、最大 48 KB にすることができます。

- Service Bus キューでは、キューに格納される各メッセージはヘッダーおよび本文で構成されます。 メッセージの合計サイズが 256 KB を超えることはできません。

- クライアントが TCP プロトコルで Service Bus キューと通信する場合は、1 つの Service Bus キューに対する同時接続の最大数が 100 に制限されます。 この数は送信側と受信側で共有されます。 このクォータに達すると、その後の接続要求は拒否され、呼び出し元のコードが例外を受け取ります。 この制限は、REST ベースの API を使用してキューに接続するクライアントには適用されません。

- 1 つの Service Bus Service の名前空間で 10,000 を超える数のキューが必要な場合は、Azure サポート チームに連絡してキューの数を増やすことができます。 Service Bus のキューの数を 10,000 より多くする、作成することも追加の名前空間を使用して、 [Azure クラシック ポータル][]します。

## 管理と操作

このセクションでは、Azure キューと Service Bus キューで提供される管理機能を比較します。

|比較条件|Azure キュー|Service Bus キュー|
|---|---|---|
|管理プロトコル|**HTTP/HTTPS 経由の REST**|**HTTPS 経由の REST**|
|ランタイム プロトコル|**HTTP/HTTPS 経由の REST**|**HTTPS 経由の REST**<br/><br/>**AMQP 1.0 Standard (TCP と TLS)**|
|.NET マネージ API|**あり**<br/><br/>(.NET managed Storage Client API)|**あり**<br/><br/>(.NET の仲介型メッセージング API)|
|ネイティブ C++|**あり**|**いいえ**|
|Java API|**あり**|**あり**|
|PHP API|**あり**|**あり**|
|Node.js API|**あり**|**あり**|
|任意のメタデータのサポート|**あり**|**いいえ**|
|キューの名前付け規則|**最大 63 文字の長さ**<br/><br/>(キューの名前に含まれる文字は小文字である必要があります)|**上限は 260 文字**<br/><br/>(キュー名は小文字を区別しない)|
|キューの長さを取得する機能|**あり**<br/><br/>(メッセージは、削除されて、TTL を超える有効期限が切れる場合は概算値)|**あり**<br/><br/>(、特定の時点の正確な値)|
|Peek 機能|**あり**|**あり**|

### 追加情報

- Azure キューでは、キューの説明に名前と値のペアの形式の任意の属性を適用できます。

- 両方のキュー テクノロジには、メッセージをロックせずに表示できる機能も用意されています。この機能は、キューのエクスプローラー/ブラウザー ツールを実装する際に便利です。

- Service Bus の .NET ブローカー メッセージング API は、全二重 TCP 接続を使用して HTTP 経由の REST より高いパフォーマンスを発揮します。また、AMQP 1.0 標準プロトコルもサポートしています。

- Azure のキュー名は 3 ～ 63 文字の間で指定でき、小文字、数字、ハイフンを使用できます。 詳細については、次を参照してください。 [名前付けのキューおよびメタデータの](https://msdn.microsoft.com/library/azure/dd179349.aspx)です。

- Service Bus のキュー名は最大 260 文字までの長さで指定でき、名前付け規則の制限は厳しくありません。 Service Bus のキュー名には、文字、数字、ピリオド (.)、ハイフン (-)、アンダースコア (_) を使用できます。

## パフォーマンス

このセクションでは、パフォーマンスの観点から Azure キューと Service Bus キューを比較します。

|比較条件|Azure キュー|Service Bus キュー|
|---|---|---|
|最大スループット|**最大 2,000 メッセージ/秒**<br/><br/>(1 KB のメッセージをベンチマークに基づく)|**最大 2,000 メッセージ/秒**<br/><br/>(1 KB のメッセージをベンチマークに基づく)|
|平均待機時間|**10 ms**<br/><br/>(と [TCP Nagle](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/06/25/nagle-s-algorithm-is-not-friendly-towards-small-requests.aspx) 無効になっています)|**20 ～ 25 ms**|
|調整動作|**HTTP 503 コードによる拒否します。**<br/><br/>(調整された要求は扱われません、課金対象)|**例外/HTTP 503 による拒否します。**<br/><br/>(調整された要求は扱われません、課金対象)|

### 追加情報

- 1 つの Azure キューで 1 秒間に最大 2,000 トランザクションを処理できます。 トランザクションは、いずれか、 **配置**, 、**取得**, 、または **削除** 操作します。 キューに 1 つのメッセージを送信する (**配置**) は 1 つのトランザクションとしてカウントされますが多くの場合、検索に関連する 2 段階のプロセスでは、メッセージの受信 (**取得**)、要求をキューからメッセージを削除すると、その後 (**削除**)。 そのため、成功したデキュー操作には 2 つのトランザクションが含まれるのが一般的です。 できるだけ、この影響を軽減できますバッチ内の複数のメッセージを取得する **取得** 後に単一のトランザクションで最大 32 個のメッセージ、 **削除** それぞれのです。 スループットを改善するために、複数のキューを作成することができます (1 つのストレージ アカウントで作成できるキューの数は無制限です)。

- アプリケーションが Azure キューの最大スループットに達すると、通常、Queue サービスから HTTP 503 (サーバーがビジー状態) 応答が返されます。 この場合、アプリケーションで、指数関数的なバックオフ遅延を使用する再試行ロジックを開始する必要があります。

- ストレージ アカウントと同じ場所 (リージョン) にあるホストされるサービスからの小さなメッセージ (10 KB 未満) を処理する場合の Azure キューの待機時間は平均 10 ミリ秒です。

- Azure キューとService Bus キューの両方で、要求の拒否による調整動作が適用されます。 ただし、どちらのキューでも、調整された要求は課金可能な操作として扱われません。

- Service Bus キューに対するベンチマークによると、1 つのキューのメッセージ スループットは、約 1 KB のメッセージで最大 2,000 メッセージ/秒です。 より高いスループットを達成するには複数のキューを使用します。 Service Bus によるパフォーマンスの最適化の詳細については、次を参照してください。 [仲介型メッセージング サービス バスを使用して、パフォーマンス向上のためのベスト プラクティス](service-bus-performance-improvements.md)します。

- Service Bus キューのスループットを最大に達したときに、 [ServerBusyException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.serverbusyexception.aspx) (.net 仲介型メッセージング API 場合) または HTTP 503 (REST ベースの API を使用) する場合の応答がキューが調整されていることを示す、キュー クライアントに返されます。

## 認証と権限承認

このセクションでは、Azure キューと Service Bus キューでサポートされる認証および承認機能について説明します。

|比較条件|Azure キュー|Service Bus キュー|
|---|---|---|
|認証|**対称キー**|**対称キー**|
|セキュリティ モデル|SAS トークンを介した委任アクセス。|SAS|
|ID プロバイダー フェデレーション|**いいえ**|**あり**|

### 追加情報

- どちらのキュー テクノロジでも、すべての要求を認証する必要があります。 匿名アクセスを使用するパブリック キューはサポートされていません。 SAS を使用すると、書き込み専用 SAS、読み取り専用 SAS、フルアクセス SAS を発行することで、このシナリオに対応できます。

- Azure キューによって提供される認証方式は、これは、ハッシュ ベース メッセージ認証コード (HMAC)、sha-256 アルゴリズムを使用して計算し、エンコードされた対称キーの使用、 **Base64** 文字列。 各プロトコルの詳細については、次を参照してください。 [Azure ストレージ サービスの認証](https://msdn.microsoft.com/library/azure/dd179428.aspx)します。 Service Bus キューでは、対称キーを使用する類似のモデルをサポートします。 詳細については、次を参照してください。 [Service Bus での共有アクセス署名認証](service-bus-shared-access-signature-authentication.md)します。

## コスト

このセクションでは、コストの観点から Azure キューと Service Bus キューを比較します。

|比較条件|Azure キュー|Service Bus キュー|
|---|---|---|
|キュー トランザクションのコスト|**$0.0036**<br/><br/>(あたり 100,000 トランザクション)|**Basic レベル**: **$0.05**<br/><br/>(あたり 100万回の処理)|
|課金可能な操作|**すべて**|**送信/受信のみ**<br/><br/>(その他の操作の料金は不要)|
|アイドル状態のトランザクション|**課金対象**<br/><br/>(課金可能なトランザクションとしてカウントは、空のキューに対するクエリ)|**課金対象**<br/><br/>(空のキューに対する受信と見なされますが課金対象メッセージ)|
|Storage コスト|**$0.07**<br/><br/>(GB/月あたり)|**$0.00**|
|送信データ転送のコスト|**$0.12 - $0.19**<br/><br/>(地理的な場所によって異なる)|**$0.12 - $0.19**<br/><br/>(地理的な場所によって異なる)|

### 追加情報

- データ転送の料金は、特定の課金期間に Azure データ センターからインターネット経由で送信されたデータの総量に基づいて決まります。

- 同じリージョンにある Azure サービス間のデータ転送には料金はかかりません。

- このドキュメントの作成時点では、受信データ転送には料金はかかりません。

- Service Bus キューでは長いポーリングがサポートされているため、待機時間の短い配信が必要な状況でこのキューを使用すると、コスト効率が向上する可能性があります。

>[AZURE.NOTE] すべてのコストは、変更されることができます。 上記の表は、このドキュメントの作成時点の価格を反映しています。ここには、現在利用できるキャンペーン プランは含まれていません。 Azure の料金の最新の状態については、次を参照してください。、 [Azure の料金](http://azure.microsoft.com/pricing/) ページです。 Service Bus の料金の詳細については、次を参照してください。 [Service Bus 料金](http://azure.microsoft.com/pricing/details/service-bus/)します。

## まとめ

2 つのテクノロジをより深く理解することにより、使用するキュー テクノロジとその状況について、より多くの十分な情報を得たうえでの決定を行うことができます。 Azure キューと Service Bus キューを使用する状況についての判断は明らかにさまざまな要因に依存します。 それらの要因がアプリケーションとそのアーキテクチャの個々のニーズに大きく依存している場合もあります。 アプリケーションで既に Microsoft Azure のコア機能を使用している場合 (特にサービス間の基本的な通信およびメッセージングや、80 GB を超えるサイズのキューが必要な場合) は、Azure キューを選択できます。

Service Bus キューには高度な機能が数多く用意されているため (セッション、トランザクション、重複検出、自動的な配信不能レタリング、持続性のある発行/サブスクライブの機能など)、ハイブリッド アプリケーションを作成する場合や、アプリケーションでこれらの機能が必要な場合は、Service Bus キューを選択できます。

## 次のステップ

次の記事では、Azure キューや Service Bus キューの使用に関する詳細情報を提供します。

- [Service Bus キューの使用方法](service-bus-dotnet-how-to-use-queues.md)
- [キュー Storage Service を使用する方法](../storage/storage-dotnet-how-to-use-queues.md)
- [Service Bus の仲介型メッセージングを使用したパフォーマンス向上のためのベスト プラクティス](service-bus-performance-improvements.md)
- [Introducing Queues and Topics in Azure Service Bus (Azure Service Bus のキューとトピックの概要)](http://www.code-magazine.com/article.aspx?quickid=1112041)
- [サービス バスの開発者向けガイド](http://www.cloudcasts.net/devguide/)
- ["Azure Tables and Queues Deep Dive (Azure のテーブルとキューの詳細)"](http://www.microsoftpdc.com/2009/SVC09)
- [Azure Storage のアーキテクチャ (ブログの投稿)](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)
- [Using the Queuing Service in Azure (Azure でのキュー サービスの使用) ](http://www.developerfusion.com/article/120197/using-the-queuing-service-in-windows-azure/)
- [Azure Storage の課金について - 帯域幅、トランザクション、容量 (ブログの投稿)](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx)


[Azure classic portal]: http://manage.windowsazure.com
 

