<properties
    pageTitle="手順 4: 予測分析モデルをトレーニングして評価する | Microsoft Azure"
    description="予測ソリューションの開発に関するチュートリアルの中の、Azure Machine Learning Studio で複数のモデルのトレーニング、スコア付け、評価するステップの 4 番目の手順です。"
    services="machine-learning"
    documentationCenter=""
    authors="garyericson"
    manager="paulettm"
    editor="cgronlun"/>

<tags
    ms.service="machine-learning"
    ms.workload="data-services"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="09/08/2015"
    ms.author="garye"/>



# チュートリアル手順 4: 予測分析モデルをトレーニングして評価する

これは、4 番目の手順のチュートリアルでは、 [Azure ML を使用した予測ソリューションの開発](machine-learning-walkthrough-develop-predictive-solution.md)


1.  [Machine Learning ワークスペースを作成します。](machine-learning-walkthrough-1-create-ml-workspace.md)
2.  [既存のデータをアップロードします。](machine-learning-walkthrough-2-upload-data.md)
3.  [新しい実験を作成します。](machine-learning-walkthrough-3-create-new-experiment.md)
4.  **モデルをトレーニングして評価する**
5.  [Web サービスを展開します。](machine-learning-walkthrough-5-publish-web-service.md)
6.  [Web サービスにアクセスします。](machine-learning-walkthrough-6-access-web-service.md)

----------


この実験では、予測モデルを完成させるためにさまざまなアルゴリズムを試します。 2 種類の異なるモデルを作成し、これらのスコア結果を比較することで、最終的な実験で使用するアルゴリズムを決定します。

選択できるモデルは数多くあります。 これらのモデルを表示するには、モジュール パレットの **[機械学習]** ノードを展開して、**[モデルの初期化]** とその下にあるノードを展開します。 実験の目的に合わせて、ここでは [サポート ベクター マシン (SVM)] と [2 クラス ブースト デシジョン ツリー] モジュールを選択します。 学習アルゴリズムの初期化を使用する適切なモジュールを使用し [[モデルのトレーニング] モデルのトレーニング][train-model] モデルをトレーニングするモジュールです。

## モデルをトレーニングする

まず、ブースト デシジョン ツリー モデルを以下の手順で設定します。

1.  検索、 [2 クラス ブースト デシジョン ツリー ][two-class-boosted-decision-tree] モジュール パレットでモジュールをキャンバスにドラッグします。
2.  検索、 [[モデルのトレーニング] モデルのトレーニング][train-model] モジュールでは、キャンバスにドラッグしの左側の入力ポート ([未トレーニングのモデル]) に、ブースト デシジョン ツリー モジュールの出力を接続、 [[モデルのトレーニング] モデルのトレーニング][train-model] モジュールです。
3.  左側の左側の出力 ([結果データセット]) を接続 [R スクリプトの実行 ][execute-r-script] の入力ポート ([データセット]) を右にモジュール、 [[モデルのトレーニング] モデルのトレーニング][train-model] モジュールです。
    > [AZURE.TIP] 2 つの入力と出力の 1 つは必要ない、 [R スクリプトの実行 ][execute-r-script] のまま残してに結び付けられていないため、この実験のモジュール。 これはいくつかのモジュールではよくある処理です。

4.  選択、 [[モデルのトレーニング] モデルのトレーニング][train-model] モジュールです。 **[プロパティ]** ウィンドウの **[列セレクターの起動]** をクリックし、最初のドロップダウンにある **[含める]** を選択します。次に、2 番目のドロップダウンにある **[列インデックス]** を選択し、テキスト フィールドに「21」と入力します (**[列名]** を選択して「Credit risk」と入力してもかまいません)。 これによって、モデルが予測する列として、21 列目の信用リスク値が指定されます。


実験の一部は以下のようになっているはずです。

![Training a model][1]

次に SVM モデルを設定します。

ブースト デシジョン ツリーはあらゆる種類の特徴で問題なく使うことができます。 ただし、SVM モジュールは線形分類器を生成するため、これによって生成されるモデルでは、すべての数値特徴のスケールが同一である場合に最適なテスト エラーが得られます。 使用してすべての数値特徴を同じスケールに変換する、 [データの正規化 ][normalize-data] モジュールと Tanh 変換をこれによって特徴を [0, 1] の範囲に変換します。 文字列特徴は SVM モジュールによってカテゴリ特徴に変換され、バイナリ 0/1 特徴に変換されます。このため文字列特徴を手動で変換する必要はありません。 また、[Credit Risk] 列 (21 列目) は変換しません。これは数値ですが、トレーニングによってモデルが予測する値です。このため、この値はそのままにしておきます。

1.  検索、 [2 クラス サポート ベクター マシン ][two-class-support-vector-machine] モジュール パレットでモジュールをキャンバスにドラッグします。
2.  右クリックし、 [[モデルのトレーニング] モデルのトレーニング][train-model] モジュールで、[ **コピー**, 、し、キャンバスを右クリックして **貼り付け**します。 注意のコピー、 [[モデルのトレーニング] モデルのトレーニング][train-model] モジュールには、同じ列の選択元とします。
3.  SVM モジュールの出力の左側の入力ポート ([未トレーニングのモデル]) に接続、 [[モデルのトレーニング] モデルのトレーニング][train-model] モジュールです。
4.  検索、 [データの正規化 ][normalize-data] モジュールをキャンバスにドラッグします。
5.  この変換モジュールの入力を左側の出力に接続 [R スクリプトの実行 ][execute-r-script] モジュールです。
6.  右側の入力ポート ([データセット]) の変換モジュールの左側の出力ポート (以下"変換済みデータセット]) を接続、 [[モデルのトレーニング] モデルのトレーニング][train-model] モジュールです。
7.  変換モジュールの **[プロパティ]** ウィンドウで、**[変換メソッド]** パラメーターに **[Tanh]** を選択します。
8.  **[列セレクターの起動]** をクリックし、**[が次の値で始まる]** で [列なし] を選択し、最初のドロップダウンで **[含める]** を選択し、2 つ目のドロップダウンで **[列の型]** を選択します。3 つ目のドロップダウンで **[数値]** を選択します。 これによって、すべての数値列が (そして数値列のみが) 変換されます。
9.  プラス記号 (+) をクリックして、ドロップダウンに新しい行を作成します。 最初のドロップダウンで **[除外]** を選択し、2 つ目のドロップダウンで **[列インデックス]** を選択して、テキスト フィールドに「21」と入力します。 これによって 21 列目 ([Credit risk] 列) が無視されます。
10. **[OK]** をクリックします。


[データの正規化 ][normalize-data] Credit Risk] 列以外のすべての数値列で Tanh 変換を実行するモジュールが設定されました。

実験の一部は以下のようになっているはずです。

![Training the second model][2]

## モデルにスコアを付け、評価する

**分割**モジュールによって分離されたスコア付けデータを使用して、トレーニングされたモデルにスコアを付けます。 その後、2 つのモデルの結果を比較して、どちらのモデルがより適した結果を生成したかを判断します。

1.  検索、 [モデルのスコア付け ][score-model] モジュールをキャンバスにドラッグします。
2.  このモジュールの左側の入力ポートをブースト デシジョン ツリー モデルに接続 (の出力ポートには、接続、 [[モデルのトレーニング] モデルのトレーニング][train-model] モジュールに接続されている、 [2 クラス ブースト デシジョン ツリー ][two-class-boosted-decision-tree] モジュール)。
3.  右側の入力ポートを接続、 [モデルのスコア付け ][score-model] モジュール右側の出力を [R スクリプトの実行 ][execute-r-script] モジュールです。
4.  コピーして貼り付け、 [モデルのスコア付け ][score-model] モジュールの 2 番目のコピーを作成または新しいモジュールをキャンバスにドラッグします。
5.  このモジュールの左側の入力ポートを SVM モデルに接続 (の出力ポートに接続、 [[モデルのトレーニング] モデルのトレーニング][train-model] モジュールに接続されている、 [2 クラス サポート ベクター マシン ][two-class-support-vector-machine] モジュール)。
6.  SVM モデルでは、トレーニング用データに対する変換と同様の変換を、テスト用データにも実行する必要があります。 のでコピーし、貼り付け、 [データの正規化 ][normalize-data] モジュール 2 番目のコピーを作成し、右側の出力に接続する [R スクリプトの実行 ][execute-r-script] モジュールです。
7.  右側の入力ポートを接続、 [モデルのスコア付け ][score-model] モジュールの出力を [データの正規化 ][normalize-data] モジュールです。

使用して 2 つのスコア付けの結果を評価する、 [モデルの評価 ][evaluate-model] モジュールです。

1.  検索、 [モデルの評価 ][evaluate-model] モジュールをキャンバスにドラッグします。
2.  左側の入力ポートの出力ポートに接続、 [モデルのスコア付け ][score-model] ブースト デシジョン ツリー モデルに関連付けられているモジュールです。
3.  別の右側の入力ポートを接続 [モデルのスコア付け ][score-model] モジュールです。

実験は以下のようになっているはずです。

![Evaluating both models][3]

キャンバスの下にある **[実行]** ボタンをクリックすると実験が実行されます。 これには数分かかることがあります。 実行中であることを示す各モジュールのインジケーターが回転して、モジュールが完了すると、緑色のチェック マークが表示されます。

すべてのモジュールにチェック マークが付いたら、実験の実行は完了しています。 確認するには、結果の出力ポートをクリックして、 [モデルの評価 ][evaluate-model] モジュールと選択 **結果を表示する**します。

[モデルの評価 ][evaluate-model] モジュールには、曲線と 2 つのスコア付けされたモデルの結果を比較するための測定値のペアが生成されます。 結果は、Receiver Operator Characteristic (ROC) 曲線、Precision/Recall 曲線、または Lift 曲線で表示できます。 表示されるその他の情報には、混同行列、累積の AUC (曲線下面積) 値、その他の測定値があります。 スライダーを左右に移動してしきい値を変更することで、変更が測定値に与える影響を確認することもできます。

**[スコア付けされたデータセット]** または **[スコア付けされた比較対象のデータセット]** をクリックすると、関連付けられた曲線が強調表示され、関連する測定値が下部分に表示されます。 曲線の凡例で「スコア付けされたデータセット」の左側の入力ポートに対応して、 [モデルの評価 ][evaluate-model] モジュール - ここでは、これは、ブースト デシジョン ツリー モデルです。 [スコア付けされた比較対象のデータセット] は、右側の入力ポート (この場合、SVM モデル) に対応しています。 いずれかのラベルをクリックすると、そのモデルの曲線が強調表示され、関連する測定値が表示されます。

![ROC curves for models][4]

これらの値を検証することで、求めている結果に最も近い結果が得られるモデルを判断することができます。 モデルと値を変えて実験を再度実行することもできます。
> [AZURE.TIP] 実験を実行するたびに、イテレーションの記録が実行履歴に保存されます。 キャンバスの下にある **[実行履歴を表示]** をクリックすると、これらのイテレーションをいつでも表示し、いつでも実験に戻ることができます。 また、**[プロパティ]** ウィンドウの **[前回の実行]** をクリックすると、現在開いているイテレーションの前のイテレーションがすぐに表示されます。 詳細については、次を参照してください。 [Azure Machine Learning Studio での実験イテレーションの管理](machine-learning-manage-experiment-iterations.md)します。

また、キャンバスの下にある **[名前を付けて保存]** をクリックすると、実験のイテレーションのコピーを作成できます。 これによって、実験が複製され、イテレーションの複製バージョンの新しい実行履歴が作成されます。 新しいコピーは **[実験]** の一覧に元のイテレーションと共に表示されます。 この機能は、実験のイテレーションを新しい分岐で開始する場合などに便利です。

実験キャンバスのすべてのモジュールにコメントを追加できるため、モジュールのパラメーターに加えた変更も簡単に追跡できます。 コメントは、モジュールをダブルクリックするか、右クリックして **[コメントの編集]** を選択するだけで追加できます。 これらのコメントは実験のイテレーションと共に保存されるため、作業に説明を追加する際に役立てることができます。


----------


* * 次: [web サービスを配置](machine-learning-walkthrough-5-publish-web-service.md)* *



[1]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train1.png 
[2]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train2.png 
[3]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train3.png 
[4]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train4.png 
[evaluate-model]: https://msdn.microsoft.com/library/azure/927d65ac-3b50-4694-9903-20f6c1672089/ 
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/ 
[normalize-data]: https://msdn.microsoft.com/library/azure/986df333-6748-4b85-923d-871df70d6aaf/ 
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/ 
[train-model]: https://msdn.microsoft.com/library/azure/5cc7053e-aa30-450d-96c0-dae4be720977/ 
[two-class-boosted-decision-tree]: https://msdn.microsoft.com/library/azure/e3c522f8-53d9-4829-8ea4-5c6a6b75330c/ 
[two-class-support-vector-machine]: https://msdn.microsoft.com/library/azure/12d8479b-74b4-4e67-b8de-d32867380e20/ 

