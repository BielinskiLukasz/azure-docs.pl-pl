<properties 
    pageTitle="CDN を使用する方法 | Microsoft Azure" 
    description="Azure Content Delivery Network (CDN) を使用して、BLOB と静的コンテンツをキャッシュすることにより、高帯域幅コンテンツを配信する方法について説明します。" 
    services="cdn" 
    documentationCenter=".net" 
    authors="camsoper" 
    manager="dwrede" 
    editor=""/>

<tags 
    ms.service="cdn" 
    ms.workload="tbd" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="12/02/2015" 
    ms.author="casoper"/>



# ストレージ アカウントと CDN の統合

CDN を使用して、Azure ストレージのコンテンツをキャッシュできます。 CDN は、米国、ヨーロッパ、アジア、オーストラリア、および南米にある物理ノードで、コンピューティング インスタンスの BLOB と静的コンテンツをキャッシュすることで、高帯域幅コンテンツを配信するグローバル ソリューションを開発者に提供します。


## ステップ 1: ストレージ アカウントを作成する

Azure サブスクリプションの新しいストレージ アカウントを作成するには、
として機能します。 ストレージ アカウントによって、 
Azure ストレージ サービスにアクセスできます。 ストレージ
アカウント
コンポーネント: Blob サービス、キュー サービス、およびテーブル サービスです。 詳細についてを参照してください、 [Microsoft Azure Storage の概要](../storage-introduction.md)します。

ストレージ アカウントを作成するには、
関連付けられているサブスクリプションのサービス管理者または共同管理者であることが必要です。
> [AZURE.NOTE] Azure ポータルや Powershell など、ストレージ アカウントの作成に使用できる方法はいくつかあります。 このチュートリアルでは Azure ポータルを使用します。  

**Azure サブスクリプションのストレージ アカウントを作成するには**

1.  サインイン、 [Azure ポータル](https://portal.azure.com)します。
2.  左上隅にある **[新規]** を選択します。  **新規** ] ダイアログ ボックスで選択 **データ + ストレージ**, 、クリックして **ストレージ アカウント**します。 デプロイ モデルとして選択した **[クラシック]** はそのままにして、**[作成]** をクリックします。

    **ストレージ アカウント** ブレードが表示されます。

    ![ストレージ アカウントの作成][create-new-storage-account]

4. **[ストレージ]** フィールドにサブドメイン名を入力します。 文字数は 3 ～ 24 文字とし、アルファベット小文字と数字を使用できます。

    この値は、対応するサブスクリプションの
    BLOB リソース、キュー リソース、またはテーブル リソースのアドレス指定に使用される URI 内でホスト名になります。 To
    サービスでコンテナー リソースをアドレス指定するには、
    次の形式で URI を *< StorageAccountLabel >* 参照
    入力した値に **URL を入力**:

    http://*< StorageAcountLabel >*.blob.core.windows.net/*< mycontainer >*

    **重要:** URL ラベルには、記憶域のサブドメイン
    URI のサブドメインとなるため、Azure のすべてのホステッド サービスで一意である必要が 
    Azure。

    この値は、このストレージ アカウントの名前として、ポータルやプログラムでこのアカウントにアクセスするときにも使用されます。

5.  **[価格レベル]** を選択するか、既定値を使用します。 価格レベルの詳細については、次を参照してください。 [Azure Storage 料金](../../pricing/details/storage)します。

6.  **リソース グループ**を選択または作成します。 リソース グループの詳細については、次を参照してください。 [Azure リソース マネージャーの概要](resource-group-overview/#resource-groups)します。

7. ストレージ アカウントを使用する**サブスクリプション**を選択します。

8.  **[作成]** をクリックします。 ストレージ アカウントを作成するプロセスは、完了までに数分かかる場合があります。

9.  ストレージ アカウントが正常に作成されたことを確認するには、アカウントが **[ストレージ]** の一覧に表示され、状態が **[オンライン]** になっていることを確かめます。


## ステップ 2: 新しい CDN プロファイルを作成する

CDN プロファイルは、CDN エンドポイントのコレクションです。 各プロファイルには、1 つ以上の CDN エンドポイントが含まれます。 複数のプロファイルを使って、インターネット ドメイン、Web アプリケーション、またはその他の一部の基準別に CDN エンドポイントを整理する必要が生じる場合があります。
> [AZURE.TIP] このチュートリアルで使用する CDN プロファイルが既にあるを場合に進みます [手順 3](#step-3-create-a-new-cdn-endpoint)します。

**新しい CDN プロファイルを作成するには**

1. [Azure 管理ポータル](https://portal.azure.com), 、左上でクリックして **新規**します。 **[新規]** ブレードで、**[メディア + CDN]**、**[CDN]** の順に選択します。

    新しい CDN プロファイル ブレードが表示されます。

    ![新しい CDN プロファイル][new-cdn-profile]

2. CDN プロファイルの名前を入力します。

3. **[価格レベル]** を選択するか、既定値を使用します。

4. **リソース グループ**を選択または作成します。 これは、ストレージ アカウントと同じリソース グループである必要はありません。

5. この CDN プロファイルの**サブスクリプション**を選択します。 この場合は、このチュートリアルでの便宜上、ストレージ アカウントと同じサブスクリプションである必要があります。

6. **[場所]** を選択します。 これは、CDN プロファイル情報が格納される Azure の場所です。 CDN エンドポイントの場所には影響しません。 ストレージ アカウントと同じ場所である必要はありません。

7. **[作成]** ボタンをクリックして、新しいプロファイルを作成します。

## ステップ 3: 新しい CDN エンドポイントを作成する

**ストレージ アカウントに対する新しい CDN エンドポイントを作成するには**

1. [Azure 管理ポータル](https://portal.azure.com), 、CDN プロファイルに移動します。 これは、前の手順でダッシュボードにピン留めしている可能性があります。 ピン留めしていない場合は、**[参照]**、**[CDN プロファイル]** の順にクリックし、エンドポイントの追加先のプロファイルをクリックします。

    CDN プロファイル ブレードが表示されます。

    ![CDN プロファイル][cdn-profile-settings]

2. **[エンドポイントの追加]** ボタンをクリックします。

    ![[エンドポイントの追加] ボタン][cdn-new-endpoint-button]

    **[エンドポイントの追加]** ブレードが表示されます。

    ![[エンドポイントの追加] ブレード][cdn-add-endpoint]

3. この CDN エンドポイントの**名前**を入力します。この名前は、ドメインでキャッシュされたリソースにアクセスするために使用が `< EndpointName >. azureedge.net`します。

4. **[配信元の種類]** ドロップダウンで、*[ストレージ]* を選択します。

5. **[配信元ホスト名]** ドロップダウンで、ストレージ アカウントを選択します。

6. **[元のパス]**、**[配信元のホスト ヘッダー]**、および **[プロトコル/配信元ポート]** の既定値はそのまま使用します。 少なくとも 1 つのプロトコル (HTTP または HTTPS) を指定する必要があります。
    > [AZURE.NOTE] この構成により、ストレージ アカウントで公開されているすべてのコンテナーの CDN でのキャッシュが可能になります。 範囲を 1 つのコンテナーに限定する場合は、**配信元パス**を使用します。 コンテナーの表示設定は公開に指定されている必要があります。

7. **[追加]** ボタンをクリックして、新しいエンドポイントを作成します。

8. エンドポイントが作成されると、プロファイルのエンドポイントの一覧に表示されます。 一覧には、キャッシュされたコンテンツへのアクセスに使用する URL と元のドメインが表示されます。

    ![CDN エンドポイント][cdn-endpoint-success]
    > [AZURE.NOTE] エンドポイントはすぐには使用できません。 登録が CDN ネットワークに反映されるまでに最大で 90 分かかる場合があります。 CDN ドメイン名を直ちに使用しようとするユーザーは、CDN を経由してコンテンツを取得できるようになるまでは状態コード 404 を受け取る場合があります。


## ステップ 4: CDN コンテンツにアクセスする

CDN にキャッシュされたコンテンツにアクセスするには、ポータルで提供される CDN URL を使用します。 キャッシュされた BLOB のアドレスは、次のようになります。

http://<*EndpointName*\>.azureedge.net/<*myPublicContainer*\>/<*BlobName*\>
> [AZURE.NOTE] ストレージ アカウントまたはホストされるサービスへの CDN アクセスを有効にすると、パブリックにアクセスできるオブジェクトは CDN エッジ キャッシュの対象になります。 CDN で現在キャッシュされているオブジェクトを変更する場合、キャッシュされたコンテンツの有効期限終了時に CDN によりそのコンテンツが更新されるまでは、CDN を通じて新しいコンテンツを使用することはできません。

## ステップ 5: CDN からコンテンツを削除する

Azure コンテンツ配信ネットワーク (CDN) にオブジェクトをキャッシュする必要がなくなった場合は、
次のいずれかの手順を実行できます。

-   コンテナーをパブリックではなくプライベートに設定できます。 参照してください [コンテナーと blob への匿名読み取りアクセスを管理](../storage-manage-access-to-resources/) の詳細。
-   管理ポータルを使用して CDN エンドポイントを無効にしたり削除したりできます。
-   オブジェクトの要求に応答しなくなるようにホストされるサービスを変更できます。

CDN に既にキャッシュされているオブジェクトは、オブジェクトの有効期限が切れるまで、またはエンドポイントが消去されるまでキャッシュに残ったままとなります。 有効期限が切れると、CDN エンドポイントがまだ有効で、オブジェクトがまだ匿名アクセス可能かどうかが CDN によって確認されます。 CDN エンドポイントが無効になり、オブジェクトに匿名でアクセスできなくなった場合、オブジェクトはキャッシュされなくなります。


## その他のリソース

-   [CDN コンテンツをカスタム ドメインにマップする方法](cdn-map-content-to-custom-domain.md)


[create-new-storage-account]: ./media/cdn-create-a-storage-account-with-cdn/CDN_CreateNewStorageAcct.png 
[new-cdn-profile]: ./media/cdn-create-a-storage-account-with-cdn/cdn-new-profile.png 
[cdn-profile-settings]: ./media/cdn-create-a-storage-account-with-cdn/cdn-profile-settings.png 
[cdn-new-endpoint-button]: ./media/cdn-create-a-storage-account-with-cdn/cdn-new-endpoint-button.png 
[cdn-add-endpoint]: ./media/cdn-create-a-storage-account-with-cdn/cdn-add-endpoint.png 
[cdn-endpoint-success]: ./media/cdn-create-a-storage-account-with-cdn/cdn-endpoint-success.png 

