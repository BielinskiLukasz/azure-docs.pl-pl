<properties
    pageTitle="Azure リソース マネージャー テンプレートを設計するためのベスト プラクティス"
    description="Azure リソース マネージャー テンプレートの設計パターンについて説明します。"
    services="azure-resource-manager"
    documentationCenter=""
    authors="mmercuri"
    manager="georgem"
    editor="tysonn"/>

<tags
    ms.service="azure-resource-manager"
    ms.workload="multiple"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="08/13/2015"
    ms.author="mmercuri"/>

# Azure リソース マネージャー テンプレートを設計するためのベスト プラクティス

企業、システム インテグレーター (Si)、クラウド サービス ベンダー (Csv)、およびオープン ソース ソフトウェア (OSS) プロジェクト チームでの作業で必要がある多くの場合にすばやく 
環境、ワークロード、またはスケール ユニットを展開します。 そのデプロイ作業は、実績のある手法と決められた方針に沿って行うことが大切です。サポートも必要となります。 柔軟なを使用します。 
Azure リソース マネージャーのテンプレートに基づくアプローチ迅速かつ一貫して複雑なトポロジを展開し、これらの展開に結び付けるとして簡単に 
コア サービスの進化のような特殊な状況や顧客の要因に対応したりします。

このトピックは大型のホワイト ペーパーの一部です。 フルのペーパーを参照するには、ダウンロード [世界クラスの ARM テンプレートの考慮事項と実証済みプラクティス] (http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World クラス ARM テンプレートの考慮事項と実証済みの Practices.pdf)。

Azure リソース マネージャー テンプレートは、Azure リソース マネージャーそのものの利点に加えて、JavaScript Object Notation (JSON) の順応性と可読性を兼ね備えているのが特徴です。 キューにメッセージがないときに 
テンプレートを実行できます。

- トポロジとそのワークロードのデプロイに一貫性を保つ。
- リソース グループを使用してアプリケーション内のすべてのリソースを管理する。
- ロールベースのアクセス制御 (RBAC) を適用し、ユーザー、グループ、サービスに適切なアクセス権を付与する。
- タグの関連付けによって、請求額の集計などの作業を省力化する。

利用シナリオ、アーキテクチャ、および、設計のセッションと実際のテンプレートの中に特定の実装パターンについて詳しくはこの記事 
Azure Customer Advisory Team (AzureCAT) の顧客との実装です。 決して学術、これらは実証済みプラクティス通知テンプレートの開発 
などの一番上の Linux ベースの OS テクノロジの 12: Apache Kafka、Apache Spark、Cloudera、Couchbase、Hortonworks HDP、DataStax Enterprise 
Apache Cassandra、Elasticsearch、Jenkins、MongoDB、Nagios、PostgreSQL、Redis、Nagios これらのテンプレートの大部分がのよく知られているベンダーで開発しました。 
分布し、最近のプロジェクトで、Microsoft のエンタープライズ顧客と SI 顧客の要件を受けます。

この記事で紹介するのは、そこで培われた手法です。高品質の Azure リソース マネージャー テンプレートを設計する一助となればさいわいです。  

私たちは、企業、システム インテグレーター (SI)、CSV など、さまざまな顧客と連携する中で、さまざまなリソース マネージャー テンプレートを活用してきました。 
それでは、顧客のタイプごとの一般的なシナリオとパターンを以降のセクションで簡単に紹介していきます。

## 大企業とシステム インテグレーター

大規模な組織では、Azure リソース マネージャー テンプレートの主な利用者は、社内ソフトウェア開発チームと社内 IT です。 シナリオ、 
SIs 作業しましたので、同じ考慮事項が適用、大企業にマップします。

### 社内ソフトウェア開発チーム

皆さんのチームが自社事業を支援するソフトウェアを開発する場合、テンプレートを使用することで、その事業のソリューションに必要なテクノロジを短時間で簡単にデプロイすることができます。 
必要なスキルをチーム メンバーが身に付けるためのトレーニング環境も、テンプレートを使用すればすぐに作成できます。

テンプレートはそのまま使うこともできますが、必要に応じて拡張したり新たに作成することも可能です。 テンプレート内でタグ付けを使用して、請求情報を提供できます。 
チーム、プロジェクト、個人、および教育などのさまざまなビューです。

企業が必要な多くの場合、ソフトウェア開発チームもそのために特定の制約を提供しているときに、ソリューションの一貫性のある展開のテンプレートを作成するには 
その環境内でのアイテムは固定され、オーバーライドすることはできません。 たとえば、銀行が、テンプレートに RBAC を含めるため、プログラマは変更できませんを必要があります、 
銀行の個人のストレージ アカウントにデータを送信するソリューション

### 社内 IT

通常、社内 IT 部門は、テンプレートを使用してクラウドの容量やクラウドでホストされる機能を提供します。

#### クラウドの容量

「T シャツ サイズ」は標準のサイズを提供すると、組織内のチームに対してクラウドの容量を提供する企業の IT グループの一般的な方法は、します。 
このようなとして s、m、および大規模です。 T シャツ サイズ製品混在させることが別のリソースの種類と数を一定の基準を提供するときに 
テンプレートを使用できるようなります。 テンプレートは、企業のポリシーを適用し、タグ付けを使用して提供するための一貫した方法で容量を提供します。 
消費している組織にチャージ バックします。

たとえば、開発環境、テスト環境、運用環境を用意し、そこにソフトウェア開発チームがソリューションをデプロイできるように環境を整える必要があるとします。 
環境が、定義済みのネットワーク トポロジと、パブリックにアクセスを制御する規則など、ソフトウェア開発チームは変更できない要素 
インターネットとパケット検査します。 これらの環境に使用する組織ごとのロールを設け、環境へのアクセス権を個別に設定することもできます。

#### クラウドでホストされる機能

個々 のソフトウェア パッケージまたは内部の行に対して提供される複合ソリューションを含む、クラウドでホストされる機能をサポートするためにテンプレートを使用することができます。 
ビジネスです。 複合ソリューションの例にはサービスとしての分析があります: 分析、視覚化、およびその他のテクノロジなどで、最適化された配信 
定義済みのネットワーク トポロジに接続されている構成します。

クラウドでホストされる機能は、その構築先となるクラウドの容量を提供する際に設定されたセキュリティとロールの影響下にあります (前述の説明を参照)。
これらの機能は、そのままの形で提供される場合と、管理されたサービスとして提供される場合とがあります。 用の環境にアクセスできるようにする、アクセス制限付きのロールが必要 
管理の目的です。

## クラウド サービス ベンダー

私たちはさまざまな CSV から話を聞く中で、顧客向けのサービスやそれに関連した要件をデプロイするための、いくつかのアプローチを特定しました。

### 提供物を CSV 側でホスト

2 つのホスティング方法が一般的な Azure サブスクリプション内のサービスをホストしている場合: すべての顧客用の個別の展開の展開または展開します。 
すべての顧客に対して使用される共有のインフラストラクチャを補強するスケール単位です。

- **顧客ごとに区別されたデプロイします。**顧客ごとにデプロイを区別するには、既製の構成のひな形となる複数の固定トポロジが必要です。 これらが異なる必要があります。 
仮想マシン (VM) のサイズ、ノード数、および関連する記憶域の容量の変更します。 顧客ごとの請求額の集計には、デプロイのタグ付けが使用されます。 
顧客がそのクラウド環境のさまざまな領域にアクセスできるようにするために、RBAC を有効にします。
- **共有のマルチ テナント環境でのスケール単位です。**マルチテナント環境のスケール ユニットをテンプレートで表現することができます。 この場合、同じインフラストラクチャ 
すべての顧客をサポートするために使用されます。 展開がユーザーの数など、ホストされているサービスの容量のレベルを提供するリソースのグループを表します 
トランザクションの数。 需要に応じてこれらのスケール ユニットが増減されます。

### CSV の提供物を顧客のサブスクリプションに注入

エンド カスタマーが所有するサブスクリプションに貴社のソフトウェアをデプロイします。 テンプレートを使用して、別個のデプロイを顧客の Azure アカウントにデプロイすることができます。

デプロイを顧客のアカウント内で更新、管理できるように、これらのデプロイには RBAC を使用します。

### Azure Marketplace

広告および Azure Marketplace などのマーケットプ レースを通して、製品を販売する場合は、種類の区別を配信するテンプレートを作成することができます。 
顧客の Azure アカウントで実行される展開。 この区別されたデプロイを t シャツのサイズ (s、m、l)、として通常記述できます。 
製品/利用者タイプ (コミュニティ、開発者、エンタープライズ)、または機能タイプ (基本、高可用性) します。  場合によっては、これらの型が指定すること 
VM の種類またはディスクの数など、展開の特定の属性です。

## OSS プロジェクト

オープン ソース プロジェクトでリソース マネージャー テンプレートを使用すると、コミュニティは、実績に裏付けられた手法でソリューションをすばやくデプロイできます。 テンプレートを保存することができます、 
GitHub リポジトリが時間の経過と共に、コミュニティが修正できるようにします。 エンド ユーザーは、それぞれの Azure サブスクリプションでそれらのテンプレートをデプロイすることができます。

以降のセクションでは、ソリューションを設計する前に考慮する必要のある事柄を明らかにしていきます。

## VM の外側と内側

テンプレートを設計する際は、仮想マシン (VM) の内側と外側の観点から要件に注目することをお勧めします。

- 外側とは、目的とするデプロイの VM やその他のリソースを意味します (ネットワーク トポロジ、タグ付け、証明書/シークレットへの参照、ロールベースのアクセス制御など)。 これらのリソースはすべて、テンプレートに組み込むことになります。
- 内側とは、インストールするソフトウェアと、望ましい状態にするための全体的な構成を意味します。 その他、VM 拡張機能やスクリプトなどの機構が全体で使用されるか、部分的に使用されます。 これらの機構がテンプレートで識別され実行される場合もありますが、テンプレートに組み込まれることはありません。

以下に示したのは、"内側" の作業の一般的な例です。  

- サーバーのロールや機能をインストールまたは削除する。
- ノード レベルまたはクラスター レベルでソフトウェアをインストールして構成する。
- Web サーバーに Websites をデプロイする。
- データベース スキーマをデプロイする。
- レジストリや各種の構成設定を管理する。
- ファイルとディレクトリを管理する。
- プロセスとサービスを開始、停止、管理する。
- ローカル グループとユーザー アカウントを管理する。
- パッケージをインストールして管理する (.msi、.exe、yum など)。
- 環境変数を管理する。
- ネイティブ スクリプトを実行する (Windows PowerShell、bash など)。

### 望ましい状態への構成 (DSC: Desired state configuration)

デプロイだけでなく、Vm の内部状態を考えておくこの展開しない「誤差」から、構成したことを確認するには 
定義済みおよびにチェックインされてソース コントロールです。 これにより、開発者や運用スタッフ手動で変更しないでください、アドホック調査されませんが、環境に 
テストまたはで録画したソース管理します。 これは重要では、手動で変更がソース管理内にないため、ものではありませんから標準展開の一部 
ソフトウェアの今後の自動化された展開に影響します。

望ましい状態への構成は、社内の従業員だけでなくセキュリティの観点からも重要となります。  ハッカーは定期的を探し、攻略しようとしています。 
ソフトウェア システムです。 それに成功すると、浸入したシステムにファイルをインストールしたり、システムの状態を変更したりするのが普通です。 目的の状態の構成を使用することができます。 
必要な実際の状態間の差異を特定し、既知の構成を復元します。

DSC のメカニズムを備えたリソース拡張機能としては、PowerShell DSC、Chef、Puppet などが広く普及しています。 これらの各仮想マシンの初期状態を展開することができ、 
使用目的の状態が維持されるかどうかを確認することもできます。

## 一般的なテンプレートのスコープ

経験上、ソリューション テンプレートの主なスコープは 3 つあります。 – 容量、機能、およびエンド ツー エンドのソリューション – これら 3 つのスコープについては、「します。 
以下に詳述します。

### 容量スコープ

容量スコープでは、法令やポリシーに沿ってあらかじめ構成された標準トポロジで一連のリソースを提供することに主眼が置かれます。 最も一般的です 
例は、企業の IT や SI のシナリオでは、標準的な開発環境を配置しています。

### 機能スコープ

機能スコープで重視されるのは、特定のテクノロジに適したトポロジのデプロイと構成です。 SQL Server などのテクノロジの一般的なシナリオ 
Cassandra、Hadoop などです。

### エンド ツー エンド ソリューション スコープ

エンド ツー エンド ソリューション スコープは、単一の機能の枠を越えて、さまざまな機能から成るエンド ツー エンドのソリューションを提供することを目的とします。  

ソリューション スコープのテンプレートは、機能スコープのテンプレートの集まりに、そのソリューション固有のリソースやロジック、望ましい状態を併せたものとなります。 ソリューション スコープ テンプレートの例は、ソリューション固有のトポロジとを使用して状態を混在させることがあります、エンド ツー エンドのデータ パイプライン ソリューション テンプレート 
複数の機能では、Kafka、Storm、Hadoop などのソリューション テンプレート スコープ設定されます。

## 自由形式の構成と既製の構成

最初に思うかもしれませんテンプレートでも、コンシューマーを最大限の柔軟性、与える必要がありますが、自由形式を使用するかどうかの選択に影響をさまざまな考慮事項 
構成と既製の構成。 このセクションでは、主要な顧客の要件を特定し、共有アプローチを整形する技術的な考慮事項 
このドキュメントです。

### 自由形式の構成

自由形式の構成は一見、理想的です。 VM の種類を選択し、任意のノードの数を指定することは、それらのノードのディスクを接続していてと 
テンプレートにパラメーターとしてようになります。 しかし、よく、確認し、さまざまなサイズ、その他の複数の仮想マシンを展開するテンプレートを検討してください。 
さまざまなシナリオであまり適切な選択をする考慮事項が表示されます。

この資料で [仮想マシンと Azure のクラウド サービスのサイズ](http://msdn.microsoft.com/library/azure/dn641267.aspx) Azure の web サイトの別の VM 
型と利用可能なサイズを識別し、持続性の数の各ディスク (2、4、8、16、または 32) の値を関連付けることができます。 接続された各ディスク 500 IOPS を提供します。 
その数の IOPS の乗数のこれらのディスクの倍数をプールすることができます。 たとえば、16 台のディスクをプールすれば、処理能力は 8,000 IOPS となります。 プールで実行されます。 
Linux で Microsoft Windows 記憶域スペースまたは redundant array of inexpensive (RAID) を使用して、オペレーティング システムで構成します。

自由形式の構成が選択できるように VM インスタンスの数が、別の VM の種類とそれらのインスタンスのサイズの数値の場合は、多数のディスク 
VM の内容を構成するには、VM の種類と 1 つまたは複数のスクリプトに基づいて変化します。

デプロイに複数のノード タイプ (マスター ノードとデータ ノードなど) が存在する、というのはよくあることです。そのためノード タイプごとに同様の選択肢が存在することになります。

デプロイするクラスターがどのような規模であれ、その倍数単位の作業が必要になります。 たとえば、Hadoop クラスターをデプロイした場合 
8 のマスター ノードと 200 のデータ ノードとマスター ノードごとにプールされている 4 つのアタッチされたディスクとデータ ノードあたり 16 アタッチされたディスクのプールされた、208 の Vm をした場合、 
3,232 ディスクを管理します。

ストレージ アカウントを制限する要求を上記の 20,000 トランザクション/秒を制限する、ストレージ アカウントのパーティション分割を見るし、使用する必要があります。 
このトポロジに対応するためのストレージ アカウントの適切な数を決定する計算です。 自由形式でサポートされる組み合わせの多数の指定 
アプローチでは、動的な計算は、適切なパーティションを決定する必要があります。 Azure リソース マネージャー テンプレートの言語が用意されていません。 
数学関数、ため、ハード コーディングされた一意のテンプレートは、適切な詳細情報を生成するコードでは、これらの計算を実行する必要があります。

大企業の IT や SI のシナリオでは、だれかがテンプレートを管理し、デプロイしたトポロジのサポートを行う必要があります。サポート対象の組織も 1 つとは限りません。 
このように、構成内容やテンプレートが顧客ごとに異なることで別途生じるオーバーヘッドは、決して望ましいものではありません。

これらのテンプレートを使用するには、顧客の Azure サブスクリプションでは、環境の展開を社内 IT チームも Csv の両方展開一般的には、 
独自のサブスクリプション、チャージ バック機能を使用して、顧客の請求を行う。 これらのシナリオで、目標は、プール全体にわたる複数の顧客用の容量を展開するには 
サブスクリプションとサブスクリプションを最小限に抑えるサブスクリプションに密集 keep 展開の次のように増加します。-他のサブスクリプションは、管理します。 本当に 
動的な展開のサイズにこの種類の密度を実現するため慎重な計画とその他の開発、組織を代表してスキャフォールディング作業が必要です。

加えて、サブスクリプションの作成は、API 呼び出しで行うことはできず、ポータルから手動で行う必要があります。 サブスクリプションの数が多いほど、その結果、 
サブスクリプションの増加には、ユーザーの介入が必要です: 自動化することはできません。 デプロイの規模で多くの可変性を事前に準備する必要が、 
サブスクリプションを確認するには、手動でサブスクリプションの数があります。

これらの事情をすべて加味すると、自由度の高い構成というものは、その響きとは裏腹に、さほど魅力的ではないことがわかります。

### 既製の構成 — T シャツ サイズ型のアプローチ

合計の柔軟性と無数のバリエーションを提供するテンプレートを提供するのではなく経験から言う一般的なパターンでは、選択する機能を提供するには 
既製の構成-サンド ボックスでは、小規模、中規模および大規模など標準の t シャツのサイズを有効にします。 T シャツのサイズには、その他の例は、製品の提供 
community edition または enterprise edition など。  また、MapReduce、NoSQL など、テクノロジのワークロードに基づく構成で大中小を決める場合もあります。

多くの企業の IT 組織、OSS ベンダー、Si その内容で使用できるように現在この方法でオンプレミスで仮想化環境 
(企業) またはサービスとしてのソフトウェア (SaaS) 製品 (Csv や Osv)。

このアプローチの特徴は、さまざまなサイズの構成を顧客向けにあらかじめ用意しておき、良質な既製の構成を提供できることです。 顧客を終了せず、認識されている構成 
プラットフォーム リソースの制約では、お客様自身で要因でクラスターのサイズを決定し、ストレージ アカウントの結果として得られるパーティション分割を識別するために数値演算を行う必要があります。 
その他のリソース (クラスターのサイズとリソースの制約) のためです。 既知の構成には、お客様は、適切な t シャツ サイズを簡単に選択が有効にする、つまり、 
指定した展開などです。 顧客のより優れたエクスペリエンスを行うだけでなく少数の既製の構成は簡単にできるし、サポート 
高度な密度を提供します。

既製の構成というサイズの標準化に主眼を置いたアプローチでも、特定のサイズ内のノードの数に幅を設けることはできます。 たとえば、t シャツ サイズの小さい可能性があります。 
間で 3 から 10 できます。  最大 10 個のノードに対応するをコンシューマーにまで自由形式の選択内容を適用する機能を提供することに設計される t シャツのサイズ 
特定の最大サイズ。  

ワークロードの種類に基づく t シャツ サイズは、配置できますが、個別のワークロードを持つノードの数を元の本質的に複数の自由形式 
ノードのサイズと、ノード上のソフトウェアの構成。

コミュニティなど、企業の製品に基づいた t シャツのサイズを配置できますが、ノードの最大数とリソースの種類が適用される場合があります。 
さまざまな製品にわたってライセンスの条件や使用可能な機能に関連付けられた通常です。

特殊な変動要因を抱えた顧客には、JSON ベースのテンプレートを使用して要求に応えることもできます。 外れ値を扱う場合、適切な計画を組み込むことができます。 
開発、サポート、およびコストに関する考慮事項です。

顧客テンプレート消費のシナリオ、このドキュメントと、実践、数多くのテンプレートの作成の開始時に特定された要件に基づいた 
テンプレートの分解パターンがわかりました。

## 容量スコープと機能スコープのソリューション テンプレート

テンプレート作成において再利用、拡張性、テスト、ツール導入を促進するモジュール式のアプローチは、テンプレートを細かく分けることによって実現します。 このセクションでは、方法の詳細情報を提供します。 
分解手法は、容量または機能スコープのテンプレートに適用できます。

この方法でメイン テンプレートはテンプレートの利用者からパラメーター値を受信し、いくつかの種類のテンプレートとスクリプトがダウン ストリームとしてへのリンク 
次に示します。 関連付けられているテンプレートの内外には、パラメーターと静的変数、生成された変数を使用して値が渡されます。

![Template parameters](./media/best-practices-resource-manager-design-templates/template-parameters.png)

**メイン テンプレートに渡されたパラメーターが関連テンプレートに渡されるようす**

以降のセクションに 1 つのテンプレートを分解する、テンプレートとスクリプトの種類に集中し、状態を渡すための方法を調べます 
テンプレート間で情報です。 図中の各タイプのテンプレートとスクリプトについて例を交えながら説明します。 コンテキストの例では、次を参照してください。 
"それをまとめる: サンプルの実装"このドキュメントで後述します。

### Template metadata

テンプレート メタデータ (metadata.json ファイル) には、JSON 形式でテンプレートを表すキー/値のペアが記述されています。人間とソフトウェア システムが読み取れる形式となっています。

![Template metadata](./media/best-practices-resource-manager-design-templates/template-metadata.png)

**テンプレート メタデータは metadata.json ファイルに記述される**

ソフトウェア エージェントは metadata.json ファイルを取得して、その情報とテンプレートへのリンクを Web ページまたはディレクトリに発行することができます。 要素 
含める *itemDisplayName*, 、*説明*, 、*概要*, 、*githubUsername*, 、および *dateUpdated*します。

以下に示したのは、このファイル全体の例です。

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. The database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### メイン テンプレート

メイン テンプレート (azuredeploy.json ファイル) は、エンド ユーザーによって呼び出されます。ユーザー定義の一連のパラメーターが、このテンプレートを通じて与えられます。

![Main template](./media/best-practices-resource-manager-design-templates/main-template.png)

**メイン テンプレートはユーザーからパラメーターを受け取る**

このテンプレートの役割は、ユーザーからパラメーターを受け取る、複合オブジェクト変数のセットを作成し、適切な実行、その情報を使用するには 
テンプレート リンクを使用して関連するテンプレートのセット。

小規模ななどの標準化された値により提供されている 1 つのパラメーターが、既製の構成型 t シャツ サイズ パラメーターとも呼ばれます 
中規模、または大規模です。 実際には、このパラメーターはさまざまな使い方ができます。 詳細については、このドキュメントの「既製構成リソース テンプレート」を参照してください。

一部のリソースは、ユーザー パラメーターを通じて指定された既製の構成に関係なくデプロイされます。 これらのリソースは、単一の共有を使用してプロビジョニングされます。 
リソース テンプレートとはで共有されるその他のテンプレートのため、共有リソース テンプレートが最初に実行します。

指定された既製の構成に関係なく、オプションとしてデプロイされるリソースもあります。

### 共有リソース テンプレート

このテンプレートは、既製の構成すべてに共通のリソースを提供します。 仮想ネットワーク、可用性セット、およびその他のリソースが含まれていること 
展開されている既製構成テンプレートに関係なく必要です。

![Template resources](./media/best-practices-resource-manager-design-templates/template-resources.png)

**共有リソース テンプレート**

リソースの名前 (仮想ネットワーク名など) は、メイン テンプレートに基づきます。 テンプレートの中で変数として指定することまたはとしてそれらを受信することができます、 
組織で必要に応じて、ユーザーからのパラメーターです。

### オプション リソース テンプレート

オプション リソース テンプレートには、パラメーターまたは変数の値に基づいてプログラム的にデプロイされるリソースが含まれます。

![Optional resources](./media/best-practices-resource-manager-design-templates/optional-resources.png)

**オプション リソース テンプレート**

たとえば、デプロイされた環境にパブリック ネットワークからの間接アクセスできる jumpbox を構成するのにオプション リソース テンプレートを使用することができます。 
Internet。 パラメーターまたは変数を jumpbox を有効にするかどうかを識別するために使用すると、 *concat* のターゲット名を作成する関数、 
テンプレートなど *jumpbox_enabled.json*します。 それによって得られた変数をテンプレートの関連付けで使用し、Jumpbox をインストールします。

オプション リソース テンプレートは、複数の場所から関連付けることができます。

-   すべてのデプロイに適用できるときは、パラメーターによって決定されるリンクを共有リソース テンプレートから作成します。
-   構成に該当する場合、たとえば、大規模な展開にのみインストール-からパラメーターに基づくまたは変数によって決まるリンクを作成、 
既製構成テンプレートです。

特定のリソースがオプションであるかどうかを決めるのはテンプレートの提供者であり、テンプレートの利用者側で決めることはできません。 たとえばを満たす必要があります、 
特定の製品の要件や製品のアドオン (一般に Csv) またはポリシーを適用する (一般に Si や企業の IT グループ)。 このような場合は、使用することができます、 
リソースを展開する必要があるかどうかを識別する変数です。

### 既製構成リソース テンプレート

メイン テンプレートでパラメーターを公開すると、デプロイする既製の構成をテンプレートの利用者が指定できます。 多くの場合、既知のこの 
構成では、一連の固定構成サイズなど、サンド ボックス、s、m、および大規模の t シャツ サイズのアプローチを使用します。

![Known configuration resources](./media/best-practices-resource-manager-design-templates/known-config.png)

**既製構成リソース テンプレート**

T シャツ サイズ型は万人向けのアプローチですが、あらゆる既製構成をそのパラメーターで表すことができます。 たとえば、一連の環境を指定できます。 
エンタープライズ アプリケーション開発、テスト、および製品などです。 さまざまなスケール ユニット、製品バージョンを表すためにクラウド サービスを使用する可能性がありますか 
または、コミュニティ、開発者は、エンタープライズなど製品の構成。

共有リソース テンプレートと同様、既製構成テンプレートには、次のいずれかの方法で変数が渡されます。

-   エンド ユーザー — メイン テンプレートに与えられたパラメーターを受け取ります。
-   組織 — 社内の要件やポリシーを表す変数がメイン テンプレートに記述されます。

### メンバー リソース テンプレート

既製の構成に、各種のメンバー ノードが含まれていることは少なくありません。 たとえば、Hadoop では通常、マスター ノードとデータ ノードが必要です。 
MongoDB をインストールするのであれば、データ ノードとアービターを含めることになります。 DataStax を展開している場合は、データ ノードだけではなく、VM を必要があります。 
opscenter がインストールされています。

![Members resources](./media/best-practices-resource-manager-design-templates/member-resources.png)

**メンバー リソース テンプレート**

ノードの種類ごとの仮想マシンの数がアタッチされたディスクをインストールし、ノードは、VM のポート構成を設定するスクリプトのさまざまなサイズであることができます。 
インスタンスの数、およびその他の詳細。 ノードの種類ごと、独自のメンバーを取得するようにリソース テンプレートは、展開、および構成の詳細を含む、 
インフラストラクチャだけでなく、VM 内でソフトウェアを展開および構成スクリプトを実行します。

VM に関しては通常、2 種類のスクリプトが使用されます。広範囲に再利用できるスクリプトとカスタム スクリプトです。

### 広範囲に再利用できるスクリプト

広範囲に再利用できるスクリプトとは、テンプレートの種類に関係なく使用できるスクリプトです。 Linux で RAID を広く再利用可能なスクリプトの適切な例のいずれかの設定します。 
ディスクをプールしより多くの IOPS を取得します。 VM にインストールするソフトウェアに関係なく、共通の目的において実績のある手法を再利用することができます。

![Reusable scripts](./media/best-practices-resource-manager-design-templates/reusable-scripts.png)

**広範囲に再利用できるスクリプトはメンバー リソース テンプレートから呼び出すことが可能**

### カスタム スクリプト

VM 内にソフトウェアをインストールして構成するスクリプトは通常、テンプレートから呼び出されます。 大規模なトポロジの一般的なパターンが表示される、複数 
1 つまたは複数のメンバー型のインスタンスは展開されます。 インストール スクリプトが並列で実行できるすべての VM に対して開始された後にセットアップ スクリプト 
すべての Vm (または指定されたメンバーの種類のすべての Vm) が展開されると呼び出されます。

![カスタム スクリプト](./media/best-practices-resource-manager-design-templates/custom-scripts.png)

**メンバー リソース テンプレートは特定の目的 (VM の構成など) を持ったスクリプトを呼び出すことができる**

## 機能スコープのソリューション テンプレートの例 - Redis

表示するには、実装をどのように動作する可能性があります例を見てみましょう、実践的な展開と構成を容易にするテンプレートの作成 
Redis では標準の t シャツ サイズ。  

このデプロイには、一連の共有リソース (仮想ネットワーク、ストレージ アカウント、可用性セット) とオプション リソース (Jumpbox) を使用します。 クラウド アプリケーションでは、 
t シャツ サイズ (s、m、l) として認識されている複数の構成が表されますが、それぞれ 1 つのノードに入力します。 2 つの目的固有のスクリプトもあります。 
(インストール、構成)。

### テンプレート ファイルの作成

azuredeploy.json という名前のメイン テンプレートを作成します。

shared-resources.json という名前の共有リソース テンプレートを作成します。

Jumpbox をデプロイするための、jumpbox_enabled.json という名前のオプション リソース テンプレートを作成します。

Redis で使用されるノード タイプは 1 つだけなので、ここでは node-resources.json という名前のメンバー リソース テンプレートを 1 つだけ作成することになります。

Redis と共に個々のノードをインストールし、すべてのノードがインストールされた後で、クラスターのセットアップを行います。  スクリプトがあります。 
redis クラスターの install.sh および redis 実体これらの両方に対応します。

### テンプレートの関連付け

テンプレートの関連付けを使用して、メイン テンプレートを (仮想ネットワークを構築する) 共有リソース テンプレートに接続します。

メイン テンプレートには、デプロイする Jumpbox をテンプレートの利用者が指定できるようにするためのロジックが追加されています。  *有効になっている* の値として、 *EnableJumpbox* 
パラメーターは、顧客は、jumpbox をデプロイすることを示します。 この値を指定した場合、連結 *_enabled* ベースのテンプレートにサフィックスとして 
jumpbox 機能の名前です。

メイン テンプレートが適用される、 *大きな* t シャツのサイズを使用してベース テンプレート名にサフィックスとしてその値の中、テンプレートに値のパラメーター 
*technology_on_os_large.json*します。

このトポロジの全体像は次の図のようになります。

![Redis template](./media/best-practices-resource-manager-design-templates/redis-template.png)

**Redis テンプレートの構造**

### 状態の構成

クラスター内のノードの状態を構成する 2 つの手順は、特定のスクリプトの目的で表される両方します。  "redis クラスター install.sh"には 
Redis のインストールを実行して、「redis クラスター実体」は、クラスターに設定されます。

### 異なるサイズのデプロイのサポート

T シャツ サイズ テンプレートを変数には指定されたサイズに展開するには、各種類のノードの数を指定します (*大きな*)。 その数をデプロイし、 
数値のシーケンス番号を持つノードの名前を追加することによってリソースに一意な名前を提供するリソースをループを使用して VM インスタンス *copyIndex()*します。 に対して行われます。 
ホットし、の両方を t シャツ名テンプレートで定義されているゾーン Vm の準備

## 分解とエンド ツー エンドのソリューション スコープのテンプレート

エンド ツー エンドのソリューション スコープを持ったソリューション テンプレートは、全体的なソリューションを提供することが主な役割です。  通常は複数の機能の合成指定します。 
その他のリソース、ロジックの状態とスコープを持つテンプレートです。

以下の画像で強調されている部分を見てください。機能スコープのテンプレートと同じモデルが、エンド ツー エンド ソリューション スコープのテンプレート用に拡張されていることがわかります。

共有リソース テンプレートおよびオプション リソース テンプレートは、容量と同じ関数を提供し、機能スコープのテンプレートが、 
エンド ツー エンド ソリューションのスコープ設定されます。

必要なものものエンド ツー エンド ソリューション スコープ テンプレートには、t シャツのサイズの機能が通常する、既製構成リソース テンプレートに反映して、 
ソリューションの既知の構成を指定します。

既製構成リソース テンプレートが 1 つにリンクするリンクまたは機能スコープ ソリューション テンプレートも、エンド ツー エンド ソリューションに関連します。 
メンバー リソース テンプレートとして、エンド ツー エンド ソリューションに必要なのです。

T シャツとして、ソリューションのサイズが、個々 の機能スコープ テンプレート、既製構成リソース内の変数のものとは異なる可能性があります。 
テンプレートを使用して、ダウン ストリームの機能スコープ ソリューション テンプレートを適切な t シャツのサイズを展開するための適切な値を提供します。

![End-to-end](./media/best-practices-resource-manager-design-templates/end-to-end.png)

**容量スコープまたは機能スコープのソリューション テンプレートに使用されるモデルは、エンド ツー エンド ソリューション テンプレート スコープ用に簡単に拡張可能**

## Marketplace を対象としたテンプレートの準備

上記の方法は企業、Si、Csv をテンプレート自体を展開するか、により、お客様に必要なシナリオもすぐに対応します。 
独自に展開します。

もう一つの選択肢となるシナリオは、Marketplace を経由してテンプレートをデプロイする方法です。  この分解手法は、少しの変更を加えるだけで、Marketplace にも応用できます。

先ほども少し触れましたが、テンプレートを使用すると、さまざまな種類のデプロイを提供し、Marketplace で販売することができます。 個別の展開の種類があります。 
t シャツ サイズ (s、m、l)、製品/利用者タイプ (コミュニティ、開発者、エンタープライズ)、または機能タイプ (基本、高可用性)。

以下に示したように、エンド ツー エンド ソリューション スコープまたは機能スコープを持った既存のテンプレートを再利用して、さまざまな既製構成を Marketplace で公開することができます。

ここでは、メイン テンプレートの入力パラメーターのうち、tshirtSize というパラメーターが削除されています。

個別の展開の種類は、既製構成リソース テンプレートにマップして、共通のリソースも必要なについては、構成 
共有リソース テンプレートと可能性のあるオプション リソース テンプレートにします。

置き換える、以前使用可能なメイン テンプレートの別個のコピーを確立するだけで、テンプレートを marketplace に発行する場合は、 
テンプレート内に埋め込まれている変数に tshirtSize のパラメーターを受信します。

![Marketplace](./media/best-practices-resource-manager-design-templates/marketplace.png)

**Marketplace 用に調整したソリューション スコープのテンプレート**

## 次のステップ

- このトピックで紹介した設計の原則を取り入れる方法の具体的な例を参照してください [テンプレート実装のベスト プラクティスの具体的な例](best-practices-resource-manager-examples.md)します。
- Azure リソース マネージャーのセキュリティを処理する方法に関する推奨事項について、次を参照してください [Azure リソース マネージャーのセキュリティの考慮事項。](best-practices-resource-manager-security.md)
- テンプレートに出入りする状態の共有については、次を参照してください。 [Azure リソース マネージャー テンプレートの状態共有](best-practices-resource-manager-state.md)します。

