<properties 
    pageTitle="Azure Multi-Factor Authentication と Active Directory 間のディレクトリ統合" 
    description="ディレクトリを同期できるように Azure Multi-Factor Authentication Server と Active Directory を統合する方法を説明する Azure Multi-Factor Authentication のページです。" 
    services="multi-factor-authentication" 
    documentationCenter="" 
    authors="billmath" 
    manager="stevenpo" 
    editor="curtand"/>

<tags 
    ms.service="multi-factor-authentication" 
    ms.workload="identity" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="11/19/2015" 
    ms.author="billmath"/>


# Azure MFA Server と Active Directory 間のディレクトリ統合

[ディレクトリ統合] セクションを使用して、Active Directory または別の LDAP ディレクトリと統合するようにサーバーを構成できます。 属性をディレクトリ スキーマと一致するように構成し、ユーザーの自動同期を設定できます。

## [設定]

既定では、Azure Multi-Factor Authentication Server は、Active Directory からユーザーをインポートするか同期するように構成されます。 このタブでは、この既定の動作をオーバーライドして、別の LDAP ディレクトリ、ADAM ディレクトリ、または特定の Active Directory ドメイン コントローラーにバインドできます。 LDAP を委任するため、RADIUS ターゲットとしての LDAP バインドのため、IIS 認証のための事前認証、またはユーザー ポータルのためのプライマリ認証としての LDAP 認証の使用も提供します。 次の表で、個々の設定について説明します。

![設定](./media/multi-factor-authentication-get-started-server-dirint/dirint.png)

| 機能| 説明|
| ------- | ----------- |
| Active Directory を使用する| インポートと同期のために Active Directory を使用するには、[Active Directory を使用する] オプションを選択します。 これは、既定の設定です。<br>注: コンピューターがドメインに参加する必要があり、適切に機能する Active Directory の統合のドメイン アカウントを使用してサインオンする必要があります。|
| 信頼できるドメインを含める| エージェントに、現在のドメイン、フォレスト内の別のドメイン、またはフォレストの信頼に関係するドメインによって信頼されているドメインへの接続を試行させるには、[信頼できるドメインを含める] チェックボックスをオンにします。信頼できるドメインからユーザーをインポートしないまたは同期しない場合は、パフォーマンスを向上させるためにチェックボックスをオフにします。既定値はオンです。|
| 指定の LDAP 構成を使用する| インポートと同期のために特定の LDAP 設定を使用する場合は、この LDAP を使用するオプションを選択します。注: LDAP を使用することを選択した場合、ユーザー インターフェイスの参照が Active Directory から LDAP に変更されます。|
| [編集] ボタン| [編集] ボタンを使用して、現在の LDAP 構成設定を変更できます。|
| 属性スコープ クエリを使用する| 属性スコープ クエリを使用するかどうかを示します。 属性スコープ クエリを使用すると、別のレコードの属性内のエントリに基づいてレコードを制限する効率的なディレクトリ検索を実行できます。 Azure Multi-Factor Authentication Server は、属性スコープ クエリを使用して、セキュリティ グループのメンバーであるユーザーを効率的にクエリします。 <br>注: 属性スコープ クエリがサポートされますが、使用されてはならない場合があります。 たとえば、セキュリティ グループに 1 つ以上のドメインのメンバーが含まれている場合、Active Directory で属性スコープ クエリを実行すると問題が発生する可能性があります。 この場合は、チェックボックスをオフにする必要があります。|

次の表で、LDAP 構成設定について説明します。

| 機能| 説明|
| ------- | ----------- |
| サーバー| LDAP ディレクトリを実行するサーバーのホスト名または IP アドレスを入力します。 セミコロンで区切ることで、バックアップ サーバーも指定できます。<br>注: バインドの種類が SSL の場合、完全修飾ホスト名が一般に必要です。|
| ベース DN| すべてのディレクトリ クエリの開始元となるベース ディレクトリ オブジェクトの識別名を入力します。例: dc=abc、dc=com|
| バインドの種類 - クエリ| LDAP ディレクトリの検索にバインドする際に使用する適切なバインドの種類を選択します。 これは、インポート、同期、およびユーザー名の解決のために使用されます。<br><br>  匿名 - 匿名のバインドが実行されます。 バインド DN とバインド パスワードは使用されません。 これは、LDAP ディレクトリで匿名バインドが許可され、適切なレコードと属性のクエリの実行できるアクセス許可がある場合にのみ機能します。<br><br> シンプル - バインド DN とバインド パスワードは、LDAP ディレクトリにバインドするためのプレーン テキストとして渡されます。 これは、サーバーに到達可能か、およびバインド アカウントに適切なアクセス権があるかを検証するテスト目的でのみ使用してください。 適切な証明書のインストール後は、SSL を使用することをお勧めします。<br><br> SSL - バインド DN とバインド パスワードは、SSL、LDAP ディレクトリにバインドを使用して暗号化されます。 これを行うには、LDAP ディレクトリが信頼する証明書がローカルにインストールされている必要があります。<br><br> バインド ユーザー名とバインド パスワードは、Active Directory ドメイン コント ローラーまたは ADAM ディレクトリに安全に接続されます。 バインド ユーザー名が空白の場合、ログオンしたユーザーのアカウントがバインドするために使用されます。|
| バインドの種類 - 認証| LDAP バインド認証を実行するときに使用する適切なバインドの種類を選択します。バインドの種類については、「バインドの種類 - クエリ」の説明を参照してください。たとえば、クエリで匿名バインドを、セキュリティで保護された LDAP バインド認証で SSL バインドを使用できます。|
| バインド DN またはバインド ユーザー名| LDAP ディレクトリにバインドするときに使用するアカウントのユーザー レコードの識別名を入力します。<br><br>バインドの識別名は、バインドの種類がシンプルまたは SSL 場合のみ使用します。<br><br>バインドの種類が Windows の場合、LDAP ディレクトリへのバインドを使用する Windows アカウントのユーザー名を入力します。 空白にした場合、ログオンしたユーザーのアカウントがバインドするために使用されます。|
| バインド パスワード| LDAP ディレクトリへのバインドに使用されるバインド DN またはユーザー名のバインド パスワードを入力します。 Multi-Factor Auth Server AdSync Service のパスワードを構成するには、同期を有効にし、ローカル コンピューターでサービスを実行しておく必要があります。 パスワードは、Multi-Factor Auth Server AdSync Service を実行しているアカウントの [Windows に格納されているユーザーおよびパスワード] に保存されます。 パスワードは、Multi-Factor Auth Server ユーザー インターフェイスを実行しているアカウントと、Multi-Factor Auth Server Service を実行しているアカウントにも保存されます。<br><br> 注: パスワードはのみ保存されるため、ローカル サーバーの Windows 保管ユーザー名とパスワード、この手順は必要があります、パスワードへのアクセスが必要な各 Multi-factor Auth Server で実行します。|
| クエリ サイズの上限| ディレクトリ検索で返されるユーザーの最大数のサイズ制限を指定します。この制限は、LDAP ディレクトリの構成と一致する必要があります。ページングがサポートされない大規模な検索では、インポートと同期は、バッチでユーザーの取得を試みます。ここで指定されるサイズ制限が、LDAP ディレクトリで構成された制限より大きい場合、一部のユーザーが欠落する可能性があります。|
| テスト ボタン| LDAP サーバーへのバインドをテストするには [テスト] ボタンをクリックします。<br><br> 注: LDAP を使用オプションは、バインドをテストするために選択する必要はありません。 これにより、LDAP 構成を使用する前にバインドをテストできます。|

## フィルター

フィルターを使用して、ディレクトリ検索の実行時にレコードを制限する条件を設定できます。 フィルターを設定することで、同期するオブジェクトの範囲を指定できます。

![フィルター](./media/multi-factor-authentication-get-started-server-dirint/dirint2.png)

Azure Multi-Factor Authentication には、次の 3 つのオプションがあります。

- **コンテナー フィルター** - ディレクトリ検索の実行時にコンテナー レコードを制限するために使用するフィルター条件を指定します。 Active Directory と ADAM の場合、通常は (|(objectClass=organizationalUnit)(objectClass=container)) が使用されます。 その他の LDAP ディレクトリでは、ディレクトリ スキーマに応じて、各コンテナー オブジェクトの種類を制限するフィルター条件を使用する必要があります。<br>注: 空白のままの場合 ((objectClass=organizationalUnit)(objectClass=container)) はする既定で使用します。

- **セキュリティ グループ フィルター** - ディレクトリ検索の実行時にセキュリティ グループ レコードを制限するために使用するフィルター条件を指定します。 Active Directory と ADAM の場合、通常は (&(objectCategory=group)(groupType:1.2.840.113556.1.4.804:=-2147483648)) が使用されます。 その他の LDAP ディレクトリでは、ディレクトリ スキーマに応じて、各セキュリティ グループ オブジェクトの種類を制限するフィルター条件を使用する必要があります。<br>注: 空白のままの場合 (&(objectCategory=group) (&(objectcategory=group)(grouptype:1.2.840.113556.1.4.804:=-2147483648))) 既定で使用されます。

- **ユーザー フィルター** - ディレクトリ検索の実行時にユーザー レコードを制限するために使用するフィルター条件を指定します。 Active Directory と ADAM の場合、通常は (&(objectClass=user)(objectCategory=person)) が使用されます。 その他の LDAP ディレクトリでは、ディレクトリ スキーマに応じて、(objectClass=inetOrgPerson) またはそれに類似する条件を使用する必要があります。<br>注: 空白の場合、(& (objectclass = user)) がありますが使用既定です。

## 属性

特定のディレクトリの属性を必要に応じてカスタマイズできます。 カスタム属性を追加し、必要な属性のみを対象とするように同期を微調整できます。 各属性フィールドの値は、ディレクトリ スキーマに定義されている属性の名前にする必要があります。 詳細については、次の表を参照してください。

![属性](./media/multi-factor-authentication-get-started-server-dirint/dirint3.png)

| 機能| 説明|
| ------- | ----------- |
| 一意識別子| コンテナー、セキュリティ グループ、およびユーザー レコードの一意識別子として機能する属性の属性名を入力します。Active Directory では、これは通常は objectGUID です。その他の LDAP 実装では、entryUUID またはそれに類似する名前です。既定値は objectGUID です。|
| ...(属性の選択) ボタン| 各属性フィールドには、その横に [...] ボタンがあります。これをクリックすると、属性を一覧から選択できる [属性の選択] ダイアログが表示されます。<br><br>属性] ダイアログ ボックスを選択します。<br><br>注: 属性は手動で入力し、属性リスト内の属性に一致する必要はありません。|
| 一意識別子の型| 一意識別子属性の型を選択します。 Active Directory では、objectGUID 属性の型は GUID です。 他の LDAP 実装では、ASCII バイト配列型または文字列型の場合があります。 既定値は [GUID] です。<br><br>注: 同期項目は一意の識別子によって参照され、一意の識別子の型が、ディレクトリ内のオブジェクトを直接検索に使用されますのでを正しく設定する必要があります。 ディレクトリに実際に保存されている値が ASCII 文字のバイト配列のときに型を [文字列] に設定すると、同期が正常に機能しなくなります。|
| 識別名| 各レコードの識別名を含む属性の属性名を入力します。 Active Directory では、これは通常は distinguishedName です。 その他の LDAP 実装では、entryDN または類似する名前です。 既定値は distinguishedName です。<br><br>注: 識別名のみを含む属性が存在しない場合は、adspath 属性を使用することがあります。 "LDAP://<server>/"パスの部分が自動的に削除されて、オブジェクトの識別名のみ残ります。|
| コンテナー名| コンテナー レコード内の名前を含む属性の属性名を入力します。 この属性の値は、Active Directory からインポートするとき、または同期項目を追加するときに、コンテナー階層に表示されます。 既定値は name です。<br><br>注: 場合は、異なるコンテナーでは、その名前の異なる属性を使用して、複数のコンテナー名属性可能性がありますで区切って指定できますセミコロンで区切ります。 コンテナー オブジェクトで見つかった最初のコンテナー名の属性が、名前を表示するために使用されます。|
| セキュリティ グループ名| セキュリティ グループ レコード内の名前を含む属性の属性名を入力します。この属性の値は、Active Directory からインポートするとき、または同期項目を追加するときに、セキュリティ グループ リストに表示されます。既定値は name です。|
| ユーザー| 次の属性は、ディレクトリに対してユーザー情報の検索、表示、インポート、および同期を実行するために使用されます。|
| ユーザー名| ユーザー レコード内のユーザー名を含む属性の属性名を入力します。この属性の値は、Multi-Factor Auth Server ユーザー名として使用されます。2 つ目の属性を 1 つ目の属性のバックアップとして指定できます。2 つ目の属性は、1 つ目の属性にユーザーの値が含まれていない場合にのみ使用されます。既定値は userPrincipalName と sAMAccountName です。|
| 名| ユーザー レコード内の名を含む属性の属性名を入力します。既定値は givenName です。|
| 姓| ユーザー レコード内の姓を含む属性の属性名を入力します。既定値は sn です。|
| 電子メール アドレス| ユーザー レコード内の電子メール アドレスを含む属性の属性名を入力します。電子メール アドレスは、ようこそメールと更新メールをユーザーに送信するために使用されます。既定値は mail です。|
| ユーザー グループ| ユーザー レコード内のユーザー グループを含む属性の属性名を入力します。ユーザー グループを使用して、Multi-Factor Auth Server 管理ポータルでエージェントとレポートのユーザーをフィルター処理できます。|
| 説明| ユーザー レコード内の説明を含む属性の属性名を入力します。説明は、検索にのみ使用されます。既定値は description です。|
| 音声通話の言語| ユーザーに対する音声通話で使用する言語の短縮名を含む属性の属性名を入力します。|
| SMS テキストの言語| ユーザーに対する SMS テキスト メッセージで使用する言語の短縮名を含む属性の属性名を入力します。|
| 電話アプリの言語| ユーザーに対する電話アプリのテキスト メッセージで使用する言語の短縮名を含む属性の属性名を入力します。|
| OATH トークンの言語| ユーザーに対する OATH トークンのテキスト メッセージで使用する言語の短縮名を含む属性の属性名を入力します。|
| 電話| 次の属性は、ユーザーの電話番号をインポートまたは同期するために使用されます。電話の種類の属性名が指定されない場合、Active Directory からインポートするとき、または同期項目を追加するときに、電話の種類は使用されません。|
| 勤務先| ユーザー レコード内の勤務先の電話番号を含む属性の属性名を入力します。既定値は telephoneNumber です。|
| ホーム| ユーザー レコード内の自宅の電話番号を含む属性の属性名を入力します。既定値は homePhone です。|
| ポケットベル| ユーザー レコード内のポケットベルの番号を含む属性の属性名を入力します。既定値は pager です。|
| Mobile| ユーザー レコード内の携帯電話の番号を含む属性の属性名を入力します。既定値は mobile です。|
| Fax| ユーザー レコード内の Fax 番号を含む属性の属性名を入力します。既定値は facsimileTelephoneNumber です。|
| IP 電話| ユーザー レコード内の IP 電話の番号を含む属性の属性名を入力します。既定値は ipPhone です。|
| カスタム| カスタム電話番号を含む属性の属性名を入力します。|
| | 入力します。既定値は空白です。|
| 内線番号| ユーザー レコード内の内線番号を含む属性の属性名を入力します。 内線番号フィールドの値は、代表電話番号に対する内線番号としてのみ使用されます。 既定値は空白です。<br><br>注: 拡張属性が指定されていない場合は、拡張機能できます電話属性の一部として含めるです。 内線番号はその前に 'x' をつけて、解析できるようにする必要があります。 たとえば 555-123-4567 x 890 は、555-123-4567 が電話番号として、890 が内線番号として解析されます。|
| [既定値に戻す] ボタン| すべての属性を既定値に戻すには、[既定値に戻す] ボタンをクリックします。既定値は、通常の Active Directory または ADAM スキーマで正常に動作します。|

属性を編集するには、[属性] タブの [編集] ボタンをクリックします。 属性を編集できるウィンドウが表示されます。

![属性の編集](./media/multi-factor-authentication-get-started-server-dirint/dirint4.png)

## 同期

Active Directory または別のライトウェイト ディレクトリ アクセス プロトコル (LDAP) Lightweight Directory Access Protocol ディレクトリ内のユーザーと同期して、Azure Multi-factor ユーザー データベースの同期が維持されます。 このプロセスは Active Directory からユーザーを手動でインポートすることと似ていますが、Active Directory に対してユーザーとセキュリティ グループの変更を定期的にポーリングします。 さらに、コンテナーまたはセキュリティ グループから削除されたユーザーを無効にするか削除し、Active Directory から削除されたユーザーを除去します。

Multi-Factor Auth ADSync サービスは、Active Directory の定期的なポーリングを実行する Windows サービスです。 Azure AD Sync または Azure AD Connect と混同ではありません。 Multi-factor Auth ADSync のようなコード ベースに基づいて構築されたが、Azure Multi-factor Authentication Server に固有です。 このサービスは停止状態でインストールされ、実行するように構成されたときに Multi-Factor Auth Server サービスによって開始されます。 複数のサーバーを対象とする Multi-Factor Auth Server 構成がある場合でも、Multi-Factor Auth ADSync は単一のサーバーでのみ実行できます。

Multi-Factor Auth ADSync サービスは、変更を効率的にポーリングするために Microsoft によって提供された DirSync LDAP サーバー拡張機能を使用します。 この DirSync コントロールの呼び出し元は、"ディレクトリの変更を取得する" 権限と、DS-Replication-Get-Changes 拡張コントロール アクセス権を持っている必要があります。 既定では、これらの権限は、ドメイン コントローラーの管理者と LocalSystem アカウントに割り当てられます。 Multi-Factor Auth AdSync サービスは、既定で LocalSystem として実行するように構成されます。 したがって、最も簡単な方法は、サービスをドメイン コントローラーで実行することです。 サービスを常に完全同期を実行するように構成した場合は、より低いアクセス許可を持つアカウントで実行できます。 効率は落ちますが、要求されるアカウント権限が低くなります。

LDAP を使用するように構成したときに、LDAP ディレクトリが DirSync コントロールをサポートする場合、ユーザーとセキュリティ グループの変更に対するポーリングは、Active Directory の場合と同じように動作します。 LDAP ディレクトリが DirSync コントロールをサポートしていない場合、完全同期は各サイクル中に実行されます。

![同期](./media/multi-factor-authentication-get-started-server-dirint/dirint5.png)

[同期] タブの個々の設定の詳細は、次の表を参照してください。

| 機能| 説明|
| ------- | ----------- |
| Active Directory との同期を有効にする| オンにした場合、Multi-Factor Auth Server サービスは、Active Directory の変更の定期的なポーリングを開始します。<br><br>メモ: 少なくとも 1 つの同期項目を追加する必要がありますおよび、今すぐ同期、多要素認証サーバーのサービスは、変更の処理を開始する前に実行する必要があります。|
| 同期間隔:| Multi-Factor Auth Server サービスが、ポーリングと変更の処理を実行するために待機する時間間隔を指定します。<br><br> 注: 指定した間隔は、各サイクルの開始までの時間です。 変更の処理時間が間隔時間を超過した場合、サービスは次のポーリングをすぐに実行します。|
| Active Directory にないユーザーを削除する| オンにした場合、Multi-Factor Auth Server サービスは、Active Directory で削除されたユーザーの廃棄状態を処理し、関連する Multi-Factor Auth Server ユーザーを削除します。|
| 常に完全同期を実行する| オンにした場合、Multi-Factor Auth Server サービスは常に完全同期を実行します。 オフにした場合、Multi-Factor Auth Server サービスは、変更されているユーザーのみをクエリすることで増分同期を実行します。 既定の設定はオフです。<br><br> 注: オフの場合、増分同期できる場合のみ実行できるディレクトリが DirSync コントロールをサポートし、ディレクトリへのバインドに使用されているアカウントに DirSync の増分クエリを実行する適切なアクセス許可。 アカウントに適切なアクセス許可がない場合、または複数のドメインが同期に関係している場合は、完全同期を実行することをお勧めします。|
| 無効なユーザーまたは削除するユーザーがしきい値を超えたときに管理者の承認を必須にする| 同期項目は、項目のコンテナーまたはセキュリティ グループのメンバーでなくなったユーザーを無効にするか削除するように構成できます。 安全のために、無効にするか削除するユーザーの数がしきい値を超えたときに、管理者の承認を要求することができます。 オンにした場合、指定したしきい値に達したとき承認が要求されます。 既定値は 5 で、指定範囲は 1 ～ 999 です。<br><br> 承認は、管理者に電子メール通知を送信して容易になります。電子メール通知により、ユーザーの無効化と削除を確認して承認するための指示が出されます。 Multi-Factor Auth Server ユーザー インターフェイスが起動され、承認を求めるメッセージが表示されます。|

**[今すぐ同期]** ボタンを使用して、指定した同期項目の完全同期を実行できます。 完全同期は、同期項目の追加、変更、削除、または順序変更を行った場合に、常に実行する必要があります。 また、Multi-Factor Auth AdSync サービスは、増分変更用のポーリングを開始する時点を設定するため、そのサービスを運用する前にも実行する必要があります。 同期項目が変更されているときに、完全同期が実行されていない場合は、別のセクションに移動するとき、またはユーザー インターフェイスを閉じるときに、今すぐ同期することが求められます。

管理者は、**[削除]** ボタンを使用して、1 つ以上の同期項目を Multi-Factor Auth Server の同期項目の一覧から削除できます。
>[AZURE.WARNING]削除された同期項目レコードは復元できません。 同期項目レコードを誤って削除した場合は、追加し直す必要があります。

同期項目は、Multi-Factor Auth Server から削除されています。 Multi-Factor Auth Server サービスは、それらの同期項目を処理しません。

管理者は、[上へ移動] ボタンと [下へ移動] ボタンを使用して、同期項目の順序を変更できます。 同じユーザーが 1 つ以上の同期項目 (コンテナーとセキュリティ グループなど) のメンバーである場合があるため、順序は重要です。 同期中にユーザーに適用される設定は、ユーザーが関連付けられている一覧の最初の同期項目から使用されます。 このため、同期項目は優先順位に従って配置する必要があります。
>[AZURE.TIP]同期項目を削除した後、完全同期を実行する必要があります。 同期項目を並べ替えた後、完全同期を実行する必要があります。 完全同期を実行するには、[今すぐ同期] ボタンをクリックします。

## Multi-Factor Auth Server

追加の Multi-factor Auth Server を、バックアップ RADIUS プロキシ、LDAP プロキシ、または IIS 認証として機能するように設定できます。 同期構成は、すべてのエージェント間で共有されます。 ただし、Multi-Factor Auth Server サービスは、これらのエージェントのいずれかのみで実行できます。 このタブで、同期するために有効にする必要がある Multi-Factor Auth Server を選択できます。

![Multi-Factor-Auth Server](./media/multi-factor-authentication-get-started-server-dirint/dirint6.png)




