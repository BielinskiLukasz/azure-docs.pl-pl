<properties
   pageTitle="SQL Database 動的データ マスクの使用 (Azure ポータル)"
   description="Azure ポータルでの SQL Database 動的データ マスクの使用方法"
   services="sql-database"
   documentationCenter=""
   authors="ronitr"
   manager="jeffreyg"
   editor="v-romcal"/>

<tags
   ms.service="sql-database"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="10/20/2015"
   ms.author="ronitr; ronmat; v-romcal; sstein"/>


# SQL Database 動的データ マスクの使用 (Azure ポータル)

> [AZURE.SELECTOR]
- [動的データ マスク - Azure クラシック ポータル](sql-database-dynamic-data-masking-get-started-portal.md)

## 概要

SQL Database 動的データ マスクは、特権のないユーザーに対してデリケートなデータをマスクし、データの公開を制限します。 Azure SQL Database の V12 バージョンでは、動的データ マスクがサポートされています。

動的データ マスクでは、公開するデリケートなデータの量を指定することで、デリケートなデータに対する未承認のアクセスを防ぎ、アプリケーション レイヤーへの影響は最小限に抑えられます。 これはポリシー ベースのセキュリティ機能であり、指定されたデータベース フィールドに対するクエリの結果セットに含まれるデリケートなデータが表示されないようにします。データベース内のデータは変更されません。

たとえば、コール センターのサポート担当者は、社会保障番号やクレジット カード番号の一部の数字から電話の相手を特定できますが、このようなデータ項目をサポート担当者にすべて公開してはなりません。 クエリの結果セットの社会保障番号やクレジット カード番号の末尾 4 桁を除くすべての数字をマスクするマスク ルールを定義できます。 別の例として、開発者は、適切なデータ マスクを定義し、個人を特定できる情報 (PII) データを保護し、法令遵守規定に違反することなくトラブルシューティングの目的で運用環境に対して照会を行うことができます。

## SQL Database 動的データ マスクの基礎

SQL Database の構成ブレードまたは設定ブレードの動的データ マスク操作を選択することで、Azure ポータルで動的データ マスク ポリシーを設定します。


### 動的データ マスクのアクセス許可

動的データ マスクを構成できるのは、Azure Database 管理者、サーバー管理者、またはセキュリティ責任者の各ロールです。

### 動的データ マスク ポリシー

* **マスクから除外された SQL ユーザー** - SQL ユーザーのセットまたはクエリの結果を SQL にマスクされていないデータを取得する AAD の id。 管理者特権を持つユーザーは常にマスクから除外され、マスクのない元のデータを見ることができることに注意してください。

* **マスク ルール** -マスクされる指定のフィールドを定義する規則と使用されるマスク関数のセットです。 データベースのスキーマ名、テーブル名、列名を使用し、指定のフィールドを定義できます。

* **マスク関数** -さまざまなシナリオのデータの公開を制御する方法のセットです。

| マスク関数 | マスク ロジック |
|----------|---------------|
| **既定値**  |**指定のフィールドのデータ型に応じたフル マスク**<br/><br/>• 使用 XXXX またはより少ない Xs、フィールドのサイズが 4 未満の文字の文字列データ型 (nchar、ntext、nvarchar) である場合。<br/>• 数値データ型 (bigint、bit、decimal、int、money、numeric、smallint、smallmoney、tinyint、float、real) の場合は、値 0 を使用します。<br/>• 日付/時刻データ型 (date、datetime2、datetime、datetimeoffset、smalldatetime、時刻) の 1900-01-01 を使用します。<br/>• SQL バリアントの場合は、現在の型の既定値が使用されます。<br/>• XML ドキュメント <masked/> 使用されます。<br/>• 特殊なデータ型の空の値を使用して (タイムスタンプ テーブル、hierarchyid、GUID、binary、image、varbinary 空間型)。
| **クレジット カード** |**指定のフィールドの末尾 4 桁を公開するマスク方法** し、クレジット_カードのフォームでプレフィックスとして定数文字列を追加します。<br/><br/>XXXX XXXX XXXX 1234|
| **社会保障番号** |**指定のフィールドの末尾 4 桁を公開するマスク方法** し、米国の社会保障番号のフォームでプレフィックスとして定数文字列を追加します。<br/><br/>XXX XX-1234 |
| **電子メール** | **マスクを最初の文字を公開し、ドメインを xxx.com に交換する方法** 電子メール アドレスのフォームでプレフィックスとして定数文字列を使用します。<br/><br/>aXX@XXXX.com |
| **ランダムな数値** | **乱数を生成するマスク方法** 選択した境界と実際のデータ型に応じて。 指定された境界が等しい場合、マスク関数は定数になります。<br/><br/>![ナビゲーション ウィンドウ](./media/sql-database-dynamic-data-masking-get-started/1_DDM_Random_number.png) |
| **カスタム テキスト** | **最初と最後の文字を公開するマスク方法** し、中央にカスタム埋め込み文字列を追加します。 元の文字列が公開されているプレフィックスとサフィックスよりも短い場合は、埋め込み文字列のみが使用されます。 <br/>プレフィックス [埋め込み] サフィックス<br/><br/>![ナビゲーション ウィンドウ](./media/sql-database-dynamic-data-masking-get-started/2_DDM_Custom_text.png) |


<a name="Anchor1"></a>
### マスクが推奨されるフィールド

DDM の推奨エンジンでは、データベースの特定のフィールドに「機密データの可能性あり」の注意が付けられます。この注意を参考にマスク候補を選択できます。 ポータルの動的データ マスク ブレードには、データベースの推奨列が表示されます。 クリックを行うには必要なは **マスクの追加** 1 つ以上の列にし、 **保存** 、これらのフィールドのマスクを適用するためにします。

## Azure ポータル使用によるデータベースの動的データ マスク設定

1. Azure ポータルを起動 [https://portal.azure.com](https://portal.azure.com)します。

2. マスクするデリケートなデータを含むデータベースの設定ブレードに移動します。

3. クリックして、 **動的データ マスク** タイルを起動、 **動的データ マスク** 構成ブレードです。

    * または、下にスクロールすることができます、 **操作** セクションを **動的データ マスク**します。

    ![ナビゲーション ウィンドウ](./media/sql-database-dynamic-data-masking-get-started/4_ddm_settings_tile.png)<br/><br/>


4.  **動的データ マスク** 構成ブレードの推奨エンジンのマスキングのフラグが設定をいくつかのデータベース列が表示されます。 推奨事項をそのまま使用するのにはクリックしてだけ **マスクの追加** の 1 つまたは複数の列と、マスクが方が、この列の既定の型を基に作成されます。 マスク機能を変更できます。その場合、マスク ルールをクリックし、マスク フィールド形式を別の形式に変更します。 オンに **保存** して設定を保存します。

    ![ナビゲーション ウィンドウ](./media/sql-database-dynamic-data-masking-get-started/5_ddm_recommendations.png)<br/><br/>


5. 上部にある、データベース内の任意の列のマスクを追加する、 **動的データ マスク** 構成ブレードをクリックして **マスクの追加** を開くには、 **[マスク ルールの** 構成ブレード

    ![ナビゲーション ウィンドウ](./media/sql-database-dynamic-data-masking-get-started/6_ddm_add_mask.png)<br/><br/>

6. 選択、 **スキーマ**, 、**テーブル** と **列** マスクされる指定したフィールドを定義します。

7. 選択、 **マスク フィールド形式** 機密性の高いデータのマスク カテゴリの一覧からです。

    ![ナビゲーション ウィンドウ](./media/sql-database-dynamic-data-masking-get-started/7_ddm_mask_field_format.png)<br/><br/>     

8. をクリックして **保存** にデータ マスク ルール ブレード マスク ポリシーの動的データ マスク ルールのセットを更新します。

9. マスクから除外し、マスクされていない機密データへのアクセスを与える SQL ユーザーまたは AAD の ID を入力します。 ユーザーをセミコロンで区切った一覧にします。 管理者特権を持つユーザーは常にマスクされていない元のデータにアクセスできることに注意してください。

    ![ナビゲーション ウィンドウ](./media/sql-database-dynamic-data-masking-get-started/8_ddm_excluded_users.png)

    >[AZURE.TIP] アプリケーション レイヤーがデリケートなデータをアプリケーションの特権を持つユーザーを表示できるようにして、SQL ユーザーまたはアプリケーションをデータベースにクエリを使用して AAD id を追加します。 デリケートなデータの公開を最小限に抑えるには、この一覧に含める特権ユーザーの数を最小限にすることを強くお勧めします。

10. クリックして **保存** 、データ マスク構成ブレードで保存する新しいまたは更新されたマスク ポリシーです。

## Powershell コマンドレットを使用して、データベースの動的データ マスクを設定する

参照してください [Azure SQL Database コマンドレット](https://msdn.microsoft.com/library/azure/mt574084.aspx)します。


## REST API を使用してデータベース用の動的データ マスクを設定する

参照してください [Azure SQL データベースの操作](https://msdn.microsoft.com/library/dn505719.aspx)します。


