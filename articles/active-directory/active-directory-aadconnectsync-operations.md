<properties
   pageTitle="Azure AD Connect Sync: 操作タスクおよび考慮事項 | Microsoft Azure"
   description="このトピックでは、Azure AD Connect Sync の運用タスクと、このコンポーネントを操作するための準備方法について説明します。"
   services="active-directory"
   documentationCenter=""
   authors="AndKjell"
   manager="StevenPo"
   editor=""/>

<tags
   ms.service="active-directory"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="identity"
   ms.date="11/24/2015"
   ms.author="andkjell"/>


# Azure AD Connect Sync: 操作タスクおよび考慮事項

このトピックでは、Azure AD Connect Sync の操作タスクについて説明します。

## ステージング モード

ステージング モードは、次のシナリオを含むいくつかのシナリオに使用できます。

-   高可用性:
-   新しい構成の変更をテストおよびデプロイする。
-   新しいサーバーを導入し、古いサーバーの使用を中止する。

ステージング モードのサーバーでは、構成を変更した後、そのサーバーをアクティブにする前に変更内容をプレビューできます。 また、フル インポートおよび完全同期を実行して、変更を運用環境に加える前に、すべての変更が予定どおりに加えられていることを確認できます。

インストール時、サーバーを**ステージング モード**に設定することを選択できます。 これにより、サーバーでインポートと同期が有効になりますが、エクスポートは行われません。 ステージング モードのサーバーでは、パスワード同期やパスワード ライトバックを選択した場合でも、パスワード同期は実行されず、パスワード ライトバックも有効になりません。 ステージング モードを無効にすると、サーバーはエクスポートを開始し、パスワード同期とパスワード ライトバックを実行します (有効になっている場合)。

ステージング モードのサーバーは、Active Directory と Azure AD から変更を受信し続けます。 そのため、常に最新の変更のコピーを保持し、別のサーバーの役割を高速に引き継ぐことができます。 プライマリ サーバーの構成を変更する場合、ステージング モードのサーバーに同じ変更を適用するのは管理者の責任です。

従来の同期テクノロジの知識を持つ管理者にとっては、サーバーが独自の SQL Database を持つ点で、ステージング モードは異なるテクノロジに思えることでしょう。 これにより、ステージング モードのサーバーを別のデータ センターに配置できます。

### サーバーの構成の確認

この方法を適用するには、次の手順に従います。

1. 準備
2. インポートおよび同期
3. 確認
4. アクティブなサーバーの切り替え

**準備**

1. Azure AD Connect をインストールし、**[ステージング モード]** を選択します。インストール ウィザードの最後のページで、**[同期の開始]** を選択解除します。 これにより、同期エンジンを手動で実行することができます。
![ReadyToConfigure](./media/active-directory-aadconnectsync-operations/readytoconfigure.png)
2. いったんログオフして、ログオンし直します。[スタート] メニューの **[同期サービス]** を選択します。

**インポートおよび同期**

1. **[コネクタ]** を選択します。種類が "**Active Directory ドメイン サービス**" の 1 つ目のコネクタを選択します。 **[実行]**、**[フル インポート]**、**[OK]** の順にクリックします。 この種類のすべてのコネクタに対して、この操作を繰り返します。
2. 種類が "**Azure Active Directory (Microsoft)**" のコネクタを選択します。 **[実行]**、**[フル インポート]**、**[OK]** の順にクリックします。
4. [コネクタ] が選択されていることを確認します。種類が "**Active Directory ドメイン サービス**" の各コネクタに対し、**[実行]**、**[差分同期]**、**[OK]** の順にクリックします。
5. 種類が "**Azure Active Directory (Microsoft)**" のコネクタを選択します。 **[実行]**、**[差分同期]**、[OK] の順にクリックします。

これで、Azure AD とオンプレミスの AD (Exchange ハイブリッド デプロイを使用している) へのエクスポートの変更がステージングされました。 次の手順では、実際にディレクトリへのエクスポートを開始する前に、変更される内容を確認できます。

**確認**

1. コマンド プロンプト ウィンドウを起動し、移動 `% プログラム Files%\Microsoft Azure AD Sync\bin`
2. 実行: `csexport「コネクタの名前」%temp%\export.xml/f:x`<BR/>
コネクタの名前は、同期サービスではあります。 Azure AD の場合は、"contoso.com - AAD" のような名前が表示されます。
3. 実行: `CSExportAnalyzer %temp%\export.xml > %temp%\export.csv`
4. %temp% に export.csv という名前のファイルが生成されます。このファイルは、Microsoft Excel で開くことができます。 このファイルには、エクスポートの対象となるすべての変更が含まれています。
5. データまたは構成に必要な変更を加え、エクスポートの対象となる変更が希望どおりになるまで、(「インポートおよび同期」と「確認」の) 手順を実行します。

**export.csv ファイルを理解する**

ファイルのほとんどの部分は、一目瞭然です。 内容の理解に役立つ省略形のいくつかを次に示します。

- OMODT - オブジェクトの変更の種類。 オブジェクト レベルでの操作が追加、更新、または削除のいずれかであるかを示します。
- AMODT - 属性の変更の種類。 属性レベルでの操作が追加、更新、または削除のいずれかであるかを示します。

属性の値が複数値の場合は、すべての変更が表示されるとは限りません。 追加および削除された値の数のみが表示されます。

**アクティブなサーバーの切り替え**

1. 現在アクティブなサーバーで、サーバー (DirSync、FIM、または Azure AD Sync) をオフにして Azure AD にエクスポートしないように設定するか、ステージング モード (Azure AD Connect) を設定します。
2. サーバー上で、インストール ウィザードを実行 **ステージング モード** を無効にして **ステージング モード**します。
![ReadyToConfigure](./media/active-directory-aadconnectsync-operations/additionaltasks.png)

## 障害復旧

実装の設計には、同期サーバーを喪失する障害の発生時の対処方法を計画することが含まれます。 モデルにはさまざまなものがあり、どのモデルを使用するかは、次の要素を含むいくつかの要素に依存します。

-   ダウンタイム中に Azure AD のオブジェクトを変更できないことに関してどれだけ許容できますか?
-   パスワード同期を使用する場合、オンプレミスでパスワードを変更する場合に備えて Azure AD で古いパスワードを使用することが求められることについてユーザーの同意が得られますか?
-   パスワード ライトバックなどのリアルタイムの操作に依存していますか?

これらの質問の回答と組織のポリシーに応じて、次の戦略のいずれかを実装することができます。

-   必要に応じて再構築する。
-   予備のスタンバイ サーバーを用意する ("**ステージング モード**" と呼ばれます)。
-   仮想マシンを使用する。

Azure AD Connect Sync は SQL Database に依存するため、Azure AD Connect に含まれる SQL Express を使用しない場合は [SQL 高可用性] セクションも確認する必要があります。

### 必要に応じて再構築する

実行可能な戦略は、必要に応じてサーバーの再構築を計画することです。 多くの場合、同期エンジンのインストールと最初のインポートおよび同期操作は、数時間以内に完了します。 予備のサーバーが利用できない場合は、一時的にドメイン コントローラーを使用して同期エンジンをホストすることができます。

オブジェクトに関する状態は同期エンジン サーバーには保存されないため、Active Directory と Azure AD 内のデータからデータベースを再構築することができます。 **sourceAnchor** 属性は、オンプレミスとクラウドからのオブジェクトを結合するために使用されます。 オンプレミスとクラウドの既存のオブジェクトを使ってサーバーを再構築する場合、同期エンジンは、再インストール時にこれらをもう一度まとめて適合させます。
ドキュメント化して保存する必要があることは、フィルター規則、同期規則など、サーバーに行った構成の変更です。 これらの変更は、同期を開始する前にもう一度適用する必要があります。

### 予備のスタンバイ サーバーを用意する - ステージング モード

環境がより複雑な場合は、1 つまたは複数のスタンバイ サーバーを持つことをお勧めします。 インストール時、サーバーを**ステージング モード**に設定できます。

詳細については、次を参照してください。 [ステージング モード](#staging-mode)します。

### 仮想マシンを使用する

一般的なサポートされている方法は、仮想マシンで同期エンジンを実行する方法です。 ホストに問題が発生した場合、同期エンジン サーバーを含むイメージを別のサーバーに移行できます。

### SQL 高可用性

Azure AD Connect に付属している SQL Server Express を使用しない場合は、SQL Server の高可用性も考慮する必要があります。 サポートされている高可用性ソリューションは SQL クラスタリングのみです。 サポートされていないソリューションには、ミラーリングと Always On があります。

## 次のステップ

詳細について、 [Azure AD Connect sync](active-directory-aadconnectsync-whatis.md) 構成します。

詳細について [内部設置型 id と Azure Active Directory の統合](active-directory-aadconnect.md)します。





