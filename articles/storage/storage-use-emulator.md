<properties 
    pageTitle="開発とテストのための Azure ストレージ エミュレーター使用 | Microsoft Azure" 
    description="Azure ストレージ エミュレーターは、Azure Storage に対する開発とテストのための無料のローカル開発環境を提供します。要求の認証方法、アプリケーションからエミュレーターへの接続方法、コマンド ライン ツールの使用方法など、ストレージ エミュレーターについて説明します。" 
    services="storage" 
    documentationCenter="" 
    authors="tamram" 
    manager="adinah" 
    editor=""/>
<tags 
    ms.service="storage" 
    ms.workload="storage" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="09/23/2015" 
    ms.author="tamram"/>


# 開発とテストのための Azure のストレージ エミュレーター使用

## 概要

Microsoft Azure ストレージ エミュレーターでは、Azure の BLOB、キュー、テーブル サービスを開発用にエミュレートするローカル環境が利用できます。 ストレージ エミュレーターを使用すると、ストレージ サービスに対するアプリケーションのローカル テストが、Azure サブスクリプションを作成したりコストをかけたりせずに実施できます。 エミュレーターでのアプリケーションの動作に満足できたら、クラウドでの Azure ストレージ アカウントの使用に切り替えることができます。
> [AZURE.NOTE] ストレージ エミュレーターとして利用可能なの一部では、 [Microsoft Azure SDK](https://azure.microsoft.com/downloads/)します。 また、スタンドアロンのパッケージとしてストレージ エミュレーターをインストールすることも可能です。 ストレージ エミュレーターを構成するには、ローカル コンピューターで管理者権限が与えられている必要があります。
>  
> ストレージ エミュレーターの特定のバージョンで作成されたデータには、別のバージョンを使用しているとアクセスできない場合があります。 データを永続化して長期にわたって保持する必要がある場合、そのデータはストレージ エミュレーターではなく Azure ストレージ アカウントに格納することをお勧めします。

## ストレージ エミュレーターのしくみ

ストレージ エミュレーターは、ローカルの Microsoft SQL Server インスタンスとローカル ファイル システムを使用して、Azure ストレージ サービスをエミュレートします。 既定では、ストレージ エミュレーターは、Microsoft SQL Server 2012 Express LocalDB のデータベースを使用します。 LocalDB インスタンスではなく、SQL Server のローカル インスタンスにアクセスするようにストレージ エミュレーターを構成することもできます。 参照してください [ストレージ エミュレーター起動と初期化](#start-and-initialize-the-storage-emulator) の下の詳細。

LocalDB のインストールを管理するには、SQL Server Management Studio Express をインストールします。 ストレージ エミュレーターは、Windows 認証を使用して SQL Server または LocalDB に接続します。

ストレージ エミュレーターと Azure のストレージ サービスには、いくつかの機能上の違いがあります。 これらの違いの詳細については、次を参照してください。 [ストレージ エミュレーターと Azure ストレージの間の相違点](#differences-between-the-storage-emulator-and-azure-storage)します。

## ストレージ エミュレーターに対する要求の認証

クラウドの Azure Storage の場合と同様に、ストレージ エミュレーターに対する各要求は、匿名である場合を除いて、認証される必要があります。 ストレージ エミュレーターに対する要求の認証には、共有キー認証を使用するか、共有アクセス署名 (SAS) を使用することができます。

### 共有キー資格情報での認証

[AZURE.INCLUDE [storage-emulator-connection-string-include](../../includes/storage-emulator-connection-string-include.md)]

接続文字列の詳細については、次を参照してください。 [Azure ストレージへの接続文字列を構成する](storage-configure-connection-string.md)します。

### 共有アクセス署名での認証

Xamarin ライブラリなど、一部の Azure ストレージ クライアント ライブラリでは、共有アクセス署名 (SAS) トークンでの認証だけがサポートされています。 この SAS トークンを、共有キー認証をサポートしているツールまたはアプリケーションを使用して作成する必要があります。 SAS トークンは、Azure PowerShell を通じて、簡単に生成することができます。

1. Azure PowerShell がまだインストールされていない場合は、インストールします。 Azure PowerShell コマンドレットの最新バージョンを使用することをお勧めします。 参照してください [をインストールして、Azure PowerShell を構成する方法](../articles/powershell-install-configure.md#Install) 手順についてはインストールします。

2. Azure PowerShell を開き、次のコマンドを実行します。 *ACCOUNT_NAME* と *ACCOUNT_KEY==* を自分の資格情報に置き換えてください。 *CONTAINER_NAME* を自分で選択した名前に置き換えます。

     $context = New-AzureStorageContext -StorageAccountName "ACCOUNT_NAME" -StorageAccountKey "ACCOUNT_KEY=="
    
     New-AzureStorageContainer CONTAINER_NAME -Permission Off -Context $context
    
     $now = Get-Date 
    
     New-AzureStorageContainerSASToken -Name CONTAINER_NAME -Permission rwdl -ExpiryTime $now.AddDays(1.0) -Context $context -FullUri


新しいコンテナーの共有アクセス署名 URI は、次のようになります。

    https://storageaccount.blob.core.windows.net/sascontainer?sv=2012-02-12&se=2015-07-08T00%3A12%3A08Z&sr=c&sp=wl&sig=t%2BbzU9%2B7ry4okULN9S0wst%2F8MCUhTjrHyV9rDNLSe8g%3Dsss

この例で作成した共有アクセス署名は、1 日間有効です。 この署名は、コンテナー内の BLOB へのフル アクセス (つまり、読み取り、書き込み、削除、一覧表示) を許可します。

共有アクセス署名に関する詳細については、次を参照してください。 [共有アクセス署名: SAS モデルについて](storage-dotnet-shared-access-signature-part-1.md)します。


## ストレージ エミュレーターの起動と初期化

Azure ストレージ エミュレーターを起動するには、[スタート] ボタンをクリックするか、Windows キーを押します。 「**Azure ストレージ エミュレーター**」と入力し始め、アプリケーションの一覧からエミュレーターを選択します。

エミュレーターの実行中は、Windows タスク バーの通知領域にアイコンが表示されます。

ストレージ エミュレーターが起動すると、コマンド ライン ウィンドウが表示されます。 このコマンド ライン ウィンドウを使用して、ストレージ エミュレーターを起動または停止したり、現在の状態の取得やエミュレーターの初期化を実行したりできます。 詳細については、次を参照してください。 [ストレージ エミュレーター コマンド ライン ツールのリファレンス](#storage-emulator-command-line-tool-reference)します。

コマンド ラインを終了しても、ストレージ エミュレーターは引き続き実行されています。 コマンド ラインを再度表示するには、ストレージ エミュレーターを起動する場合と同じように上の手順に従います。

ストレージ エミュレーターを初めて実行すると、ローカル ストレージ環境が初期化されます。 初期化プロセスでは、LocalDB にデータベースが作成され、各ローカル ストレージ サービス用として HTTP ポートが予約されます。

ストレージ エミュレーターは、既定で C:\Program Files(x86)\Microsoft SDKs\Azure\Storage Emulator ディレクトリにインストールされています。

### 別の SQL データベースを使用するための、ストレージ エミュレーターの初期化

既定の LocalDB インスタンスとは別の SQL データベース インスタンスを参照するようにストレージ エミュレーターを初期化するには、ストレージ エミュレーター コマンド ライン ツールを使用します。 ストレージ エミュレーターのためのバックエンド データベースを初期化するには、管理者特権でコマンド ライン ツールを実行している必要があります。

1. **[スタート]** ボタンをクリックするか、**[Windows]** キーを押します。 入力を開始 `Azure ストレージ エミュレーター` してストレージ エミュレーター コマンド ライン ツールに表示されるときに選択します。
2. コマンド プロンプト ウィンドウで、次のコマンドを入力、 `< SQLServerInstance >` SQL Server インスタンスの名前を指定します。LocalDb を使用するのには、指定 `(localdb) \v11.0` SQL Server インスタンスとして。

        AzureStorageEmulator init /server <SQLServerInstance> 

    次のコマンドを使うこともできます。このコマンドを指定すると、エミュレーターは既定の SQL Server インスタンスを使用します。

        AzureStorageEmulator init /server .\\ 

    または、データベースを既定の LocalDB インスタンスに再初期化する次のコマンドを使うこともできます。

        AzureStorageEmulator init /forceCreate 


これらのコマンドの詳細については、次を参照してください。 [ストレージ エミュレーター コマンド ライン ツールのリファレンス](#storage-emulator-command-line-tool-reference)します。

## ストレージ エミュレーターでのリソースのアドレス指定

ストレージ エミュレーターのサービス エンドポイントは、Azure ストレージ アカウントのものとは異なります。 異なる理由は、ローカル コンピューターがドメイン名解決を行わず、ストレージ エミュレーターのエンドポイントがドメイン名ではなくローカル アドレスを必要とする点にあります。

Azure ストレージ アカウントのリソースをアドレス指定する場合は、以下のスキームを使用します。このスキームでは、アカウント名が URI ホスト名の一部であり、アドレス指定されるリソースが URI パスの一部です。

    <http|https>://<account-name>.<service-name>.core.windows.net/<resource-path>

たとえば、以下の URI は、Azure ストレージ アカウント内の BLOB の有効なアドレスです。

    https://myaccount.blob.core.windows.net/mycontainer/myblob.txt

ストレージ エミュレーターでは、ローカル コンピューターがドメイン名の解決を実行しないため、アカウント名は、ホスト名ではなく URI パスの一部になります。 ストレージ エミュレーターで実行されているリソースには、次のスキームを使用します。

    http://<local-machine-address>:<port>/<account-name>/<resource-path>

たとえば、ストレージ エミュレーターの BLOB にアクセスするには次のアドレスを使用します。

    http://127.0.0.1:10000/myaccount/mycontainer/myblob.txt

ストレージ エミュレーターのサービス エンドポイントは、次のとおりです。

    Blob Service: http://127.0.0.1:10000/<account-name>/<resource-path>
    Queue Service: http://127.0.0.1:10001/<account-name>/<resource-path>
    Table Service: http://127.0.0.1:10002/<account-name>/<resource-path>

### RA-GRS を使用した、アカウントのセカンダリ拠点のアドレス指定

Version 3.1 以降では、ストレージ エミュレーター アカウントで読み取りアクセスの geo 冗長レプリケーション (RA-GRS) がサポートされます。 クラウド内のストレージ リソースとローカル エミュレーター内のストレージ リソースの場合、2 次拠点にアクセスするにはアカウント名に -secondary を付加します。 たとえば、ストレージ エミュレーターで読み取り専用の 2 次拠点を使用して BLOB にアクセスするには、次のアドレスを使用します。

    http://127.0.0.1:10000/myaccount-secondary/mycontainer/myblob.txt 

> [AZURE.NOTE] ストレージ エミュレーターを使用した、プログラムによるセカンダリへのアクセスには、.NET 用ストレージ クライアント ライブラリの Version 3.2 以降を使用してください。 参照してください、 [ストレージ クライアント ライブラリ リファレンス](https://msdn.microsoft.com/library/azure/dn261237.aspx) 詳細です。

## ストレージ エミュレーター コマンド ライン ツールのリファレンス

バージョン 3.0 からは、ストレージ エミュレーターの起動時にコマンド ライン ウィンドウがポップアップ表示されます。 このコマンド ライン ウィンドウを使用して、エミュレーターを起動または停止したり、状態のクエリやその他の操作を実行したりします。
> [AZURE.NOTE] Microsoft Azure コンピューティング エミュレーターがインストール済みの場合は、ストレージ エミュレーターの起動時にシステム トレイ アイコンが表示されます。 このアイコンを右クリックすると、直感的な方法でストレージ エミュレーターを起動や停止できます。

### コマンド ライン構文

    AzureStorageEmulator [start] [stop] [status] [clear] [init] [help]

### オプション

オプションの一覧を表示する次のように入力します。 `/help` コマンド プロンプト。

| オプション| 説明| コマンド| 引数|
|--------|----------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|
| **Start**| ストレージ エミュレーターを起動します。| `AzureStorageEmulator 開始 [-inprocess]`| *-inprocess*: 新しいプロセスを作成せずに、現在のプロセスでエミュレーターを起動します。|
| **Stop**| ストレージ エミュレーターを停止します。| `AzureStorageEmulator 停止`| |
| **状態**| ストレージ エミュレーターの状態を出力します。| `AzureStorageEmulator ステータス`| |
| **Clear**| コマンド ラインで指定されたすべてのサービス内のデータを消去します。| `[Blob] [table] [のすべて] [キュー] をオフに AzureStorageEmulator                                                    `| *blob*: blob データを消去します。<br/>*キュー*: キュー データを消去します。<br/>*テーブル*: テーブル データを消去します。<br/>*すべて*: すべてのサービスのすべてのデータを消去します。|
| **Init**| エミュレーターをセットアップするために、1 回限りの初期化を実行します。| `AzureStorageEmulator.exe init [--server serverName] [-sqlinstance instanceName] [-forcecreate] [-inprocess]`| *-サーバー servername \instancename*: SQL インスタンスをホストするサーバーを指定します。<br/>*- sqlinstance instanceName*: 既定のサーバー インスタンスで使用する SQL インスタンスの名前を指定します。<br/>*- forcecreate*: 既に存在する場合でも、SQL データベースの作成を強制します。<br/>*-inprocess*: 新しいプロセスを生成せずに現在のプロセスで初期化を実行します。初期化を実行するために管理者特権のアクセス許可で現在のプロセスを起動する必要があります。|

## ストレージ エミュレーターと Azure Storage との違い

ストレージ エミュレーターは、ローカルの SQL インスタンスで実行される、エミュレートされた環境であるため、エミュレーターとクラウド上の Azure ストレージ アカウントには機能にいくつかの違いがあります。

- ストレージ エミュレーターでは、単一の固定アカウントと既知の認証キーのみがサポートされます。

- ストレージ エミュレーターは拡張可能なストレージ サービスではなく、多数の同時クライアントはサポートされません。

- 」の説明に従って [ストレージ エミュレーターでのリソースのアドレス指定](#addressing-resources-in-the-storage-emulator), 、リソースは Azure ストレージ アカウントとストレージ エミュレーターで異なる方法でアドレス指定されます。 この違いは、クラウドではドメイン名解決が使用できても、ローカル コンピューターでは使用できないことが原因です。

- Version 3.1 以降では、ストレージ エミュレーター アカウントで読み取りアクセスの geo 冗長レプリケーション (RA-GRS) がサポートされます。 エミュレーターでは、すべてのアカウントで RA-GRS が有効になっていて、プライマリ レプリカとセカンダリ レプリカの間に時間差が生じることはありません。 Get Blob Service Stats、Get Queue Service Stats、および Get Table Service Stats 操作は、アカウントのセカンダリ拠点でサポートされておりの値が常に返します、 `LastSyncTime` 応答要素を基になる SQL データベースに準じた現在時刻として。

    ストレージ エミュレーターを使用した、プログラムによるセカンダリへのアクセスには、.NET 用ストレージ クライアント ライブラリの Version 3.2 以降を使用してください。 参照してください、 [ストレージ クライアント ライブラリ リファレンス](https://msdn.microsoft.com/library/azure/dn261237.aspx) 詳細です。

- File サービスおよび SMB プロトコル サービス エンドポイントは、ストレージ エミュレーターでは現在サポートされていません。

- 使用するエミュレーターのバージョンでサポートされていないストレージ サービスのバージョンを使用する場合、ストレージ エミュレーターは VersionNotSupportedByEmulator エラー (HTTP ステータス コード 400 - Bad Request) を返します。

### BLOB ストレージに対する相違点

以下の相違点が、エミュレーターの BLOB ストレージに該当します。

- ストレージ エミュレーターでは、最大で 2 GB のサイズの BLOB だけがサポートされます。

- ストレージ エミュレーター内に存在し、アクティブなリースを持つ BLOB に対する Put Blob 操作が、要求の一部としてリース ID が指定されなかった場合でも、成功することがあります。

- エミュレーターでは追加 BLOB の操作はサポートされません。 追加 BLOB で操作をしようとすると、FeatureNotSupportedByEmulator エラー (HTTP ステータス コード 400 - Bad Request) が返されます。

### テーブル ストレージに対する相違点

以下の相違点が、エミュレーターのテーブル ストレージに該当します。

- ストレージ エミュレーターの Table サービスでの日付プロパティは、SQL Server 2005 でサポートされている範囲だけをサポートします (*つまり*、1753 年 1 月 1 日より後である必要があります)。 1753 年 1 月 1 日より前のすべての日付は、この値に変更されます。 日付の精度は、SQL Server 2005 の精度までに制限されます。つまり、日付の精度は 1/300 秒です。

- ストレージ エミュレーターでは、それぞれ 512 バイト未満のパーティション キーと行キーのプロパティ値がサポートされます。 また、アカウント名、テーブル名、およびキー プロパティ名の合計サイズが 900 バイトを超えることはできません。

- ストレージ エミュレーターのテーブル内の行の合計サイズは、1 MB 未満に制限されます。

- データのプロパティを入力、ストレージ エミュレーターで `Edm.Guid` または `Edm.Binary` だけをサポートして、 `等号 (eq)` と `NotEqual (ne)` クエリで比較演算子が文字列をフィルター処理します。

### キュー ストレージに対する相違点

エミュレーターのキュー ストレージに固有の違いはありません。

## ストレージ エミュレーター リリース ノート

### バージョン 4.2

- ストレージ エミュレーターで、BLOB、Queue、および Table サービス エンドポイント上のストレージ サービスのバージョン 2015-04-05 がサポートされるようになりました。

### Version 4.1

- ストレージ エミュレーターでは、新しい追加 BLOB 機能を除く BLOB、Queue、Table サービス エンドポイント上のストレージ サービスのバージョン 2015-02-21 がサポートされるようになりました。

- エミュレーターのバージョンでサポートされていないストレージ サービスのバージョンを使用する場合でも、ストレージ エミュレーターでは意味のあるエラー メッセージを返すようになりました。 最新バージョンのエミュレーターの使用をお勧めします。 VersionNotSupportedByEmulator エラー (HTTP ステータス コード 400 - Bad Request) が発生する場合、最新バージョンのストレージ エミュレーターをダウンロードしてください。

- 競争状態のバグが原因となる同時マージ操作時のテーブル エンティティ データの間違いが修正されました。

### Version 4.0

- ストレージ エミュレーターの実行可能ファイルの名前が *AzureStorageEmulator.exe* に変更されました。

### Version 3.2

- ストレージ エミュレーターで、BLOB、Queue、および Table サービス エンドポイント上のストレージ サービスのバージョン 2014-02-14 がサポートされるようになりました。 File サービス エンドポイントは、ストレージ エミュレーターでは現在サポートされていません。 参照してください [Azure ストレージ サービスのバージョン管理](https://msdn.microsoft.com/library/azure/dd894041.aspx) バージョン 2014年-02-14 に関する詳細。

### Version 3.1

- 読み取りアクセス地理冗長ストレージ (RA-GRS) が、ストレージ エミュレーターでサポートされるようになりました。 Get Blob Service Stats、Get Queue Service Stats、および Get Table Service Stats API は、アカウントのセカンダリ拠点でサポートされており、常に LastSyncTime 応答要素の値を、基になる SQL データベースに準じた現在時刻として返します。 ストレージ エミュレーターを使用した、プログラムによるセカンダリへのアクセスには、.NET 用ストレージ クライアント ライブラリの Version 3.2 以降を使用してください。 詳細については、「ストレージ クライアント ライブラリ リファレンス」をご覧ください。

### Version 3.0

- Azure ストレージ エミュレーターが、コンピューティング エミュレーターと同じパッケージには同梱されないようになりました。

- ストレージ エミュレーターのグラフィカル ユーザー インターフェイスが、スクリプト可能なコマンド ライン インターフェイスを優先して、廃止されました。 コマンド ライン インターフェイスの詳細については、ストレージ エミュレーター コマンド ライン ツールのリファレンスをご覧ください。 グラフィカル インターフェイスはバージョン 3.0 までは引き続き存在しますが、コンピューティング エミュレーターがインストールされている場合にシステム トレイ アイコンを右クリックして [ストレージ エミュレーター UI の表示] を選択することによってのみアクセスできます。

- Azure ストレージ サービスのバージョン 2013-08-15 が、完全にサポートされるようになりました。 (以前は、このバージョンはストレージ エミュレーター バージョン 2.2.1 プレビューだけでサポートされていました。)





