<properties
    pageTitle="Hudson で Azure BLOB サービスを使用する方法 | Microsoft Azure"
    description="Hudson で Azure BLOB ストレージをビルド アーティファクトのリポジトリとして使用する方法について説明します。"
    services="storage"
    documentationCenter="java"
    authors="rmcmurray"
    manager="wpickett"
    editor="jimbe"/>

<tags
    ms.service="storage"
    ms.workload="storage"
    ms.tgt_pltfrm="na"
    ms.devlang="Java"
    ms.topic="article"
    ms.date="10/12/2015" 
    ms.author="robmcm"/>

# Hudson 継続的インテグレーション ソリューションでの Azure Storage の使用

## 概要

ここでは、Hudson 継続的インテグレーション (CI) ソリューションで作成されるビルド アーティファクトのリポジトリとして、または、ビルド プロセスで使用されるダウンロード可能なファイルのソースとして Azure BLOB サービスを使用する方法について説明します。 この方法が有用になるシナリオの 1 つが、アジャイル開発環境で (Java などの言語を使って) コーディングをしており、継続的インテグレーションに基づいてビルドを実行するとき、ビルド アーティファクト用のリポジトリが必要な場合です。このリポジトリがあれば、ビルド アーティファクトを他の組織のメンバーや顧客と共有したり、そのアーカイブを保存したりできます。  もう 1 つのシナリオとしては、ビルド ジョブ自体にその他のファイルが必要になる場合、たとえば、ビルドの入力で依存関係のダウンロードが必要になる場合などが考えられます。

このチュートリアルでは、Microsoft が公開している Hudson CI 用の Azure Storage プラグインを使用します。

## Hudson の概要 ##

Hudson では、開発者がコードの変更を簡単に統合し、ビルドを自動的に頻繁に生成できるようになり、ソフトウェア プロジェクトの継続的な統合が実現されます。これにより、開発者の生産性が向上します。 ビルドはバージョン管理され、ビルド アーティファクトをさまざまなリポジトリにアップロードできます。 この記事では、Azure BLOB ストレージをビルド アーティファクトのリポジトリとして使用する方法について説明します。 また、Azure BLOB ストレージから依存関係をダウンロードする方法も紹介します。

Hudson の詳細については掲載されて [Meet Hudson][]します。

## BLOB サービスを使用するメリット ##

BLOB サービスを使用してアジャイル開発のビルド アーティファクトをホストするメリットには、次の点が挙げられます。

- ビルド アーティファクトやダウンロード可能な依存関係に高可用性を実現。
- Hudson CI ソリューションでビルド アーティファクトをアップロードする際のパフォーマンスを改善。
- 顧客およびパートナーがビルド アーティファクトをダウンロードする際のパフォーマンスを改善。
- 匿名アクセス、有効期限ベースの Shared Access Signature によるアクセス、プライベート アクセスなどから 1 つを選んでユーザー アクセス ポリシーを制御。

## 前提条件 ##

Hudson CI ソリューションで BLOB サービスを使用するには、次のものが必要です。

- Hudson 継続的インテグレーション ソリューション。

    Hudson CI ソリューションがない場合には、次の方法によって Hudson CI ソリューションを実行できます。

    1. Java が有効なコンピューターでは、ダウンロードから Hudson WAR を <http://hudson-ci.org/>します。
    2. コマンド プロンプトを開いて Hudson WAR が格納されているフォルダーに移動し、Hudson WAR を実行します。 たとえば、version 3.1.2 をダウンロードした場合は、次のコマンドを実行します。

        `java -jar hudson-3.1.2.war`

    3. ブラウザーで `http://localhost:8080/` を開きます。 これで Hudson ダッシュボードが開かれます。

    4. Hudson を初めて使用するときに、`http://localhost:8080/` で初期セットアップを完了します。

    5. 初期セットアップの完了、取り消し、Hudson WAR の実行中のインスタンス、Hudson WAR を再度起動すると Hudson ダッシュ ボードを再度開く `http://localhost:8080/`, 、インストールして、Azure ストレージ プラグインを構成するときに使用します。

        通常の Hudson CI ソリューションであればサービスとして実行されるように設定しますが、このチュートリアルではコマンド ラインで Hudson war を実行するだけで十分です。

- Azure アカウント。 Azure アカウントにサインアップすることができます <http://www.azure.com>します。

- Azure ストレージ アカウント。 ストレージ アカウントがない場合の手順を使用してを作成できます [をストレージ アカウントを作成する方法][]します。

- 以降では、Hudson CI のビルド アーティファクトで BLOB サービスをリポジトリとして使用するうえで必要な手順を、基本的な例を使って説明しています。Hudson CI ソリューションにある程度習熟していることが望ましいものの、必須ではありません。

## Hudson CI で BLOB サービスを使用する方法 ##

Hudson で BLOB サービスを使用するには、Azure Storage プラグインをインストールし、そのプラグインを構成してストレージ アカウントを使用するようにしたうえで、ビルド後にビルド アーティファクトをストレージ アカウントにアップロードするアクションを作成する必要があります。 以降のセクションでは、ここに挙げた手順について説明します。

## Azure Storage プラグインのインストール方法 ##

1. Hudson ダッシュ ボードで、次のようにクリックします。 **Manage Hudson**します。
2.  **Manage Hudson** ] ページで [ **Manage Plugins**します。
3. クリックして、 **利用可能な** ] タブをクリックします。
4. クリックして **他**します。
5.  **Artifact Uploaders** ] セクションの [ **Microsoft Azure ストレージ プラグイン**します。
6. クリックして **インストール**します。
7. インストール完了後、Hudson を再起動します。

## Azure Storage プラグインを構成してストレージ アカウントを使用する方法 ##

1. Hudson ダッシュ ボードで、次のようにクリックします。 **Manage Hudson**します。
2.  **Manage Hudson** ] ページで [ **システムの構成**します。
3.  **Microsoft Azure Storage Account Configuration** セクション。

    a. 取得した、ストレージ アカウント名を入力して、 [Azure ポータル](portal.azure.com)します。

    b. ストレージ アカウント キーを入力します同様に、 [Azure ポータル](portal.azure.com)します。

    c. 既定値を使用して **Blob Service Endpoint URL** 、パブリック Azure クラウドを使用している場合。 異なる Azure クラウドを使用している場合で指定されているエンドポイントを使用して、 [Azure ポータル](portal.azure.com) 、ストレージ アカウント用です。

    d. クリックして **ストレージ資格情報の検証** ストレージ アカウントを検証します。

    e. [省略可能]追加する場合を利用できるストレージ アカウント Hudson ci をクリックして **ストレージ アカウントを追加**します。

    f. クリックして **保存** して設定を保存します。

## ビルド後にビルド アーティファクトをストレージ アカウントにアップロードするアクションの作成方法 ##

説明のため、ストレージ アカウントにファイルをアップロードするためのビルド後のアクションを追加する前に、複数のファイルを作成するジョブを作成する必要があります。

1. Hudson ダッシュ ボードで、次のようにクリックします。 **新しいジョブ**します。
2. ジョブの名前を **MyJob**, 、] をクリックして **空きスタイルのソフトウェアのジョブを作成**, 、順にクリック **OK**します。
3.  **ビルド** セクションをクリックして、ジョブの構成の **ビルド ステップの追加** を選択し、 **Execute Windows batch コマンド**します。
4.  **コマンド**, 、次のコマンドを使用します。

        md text
        cd text
        echo Hello Azure Storage from Hudson > hello.txt
        date /t > date.txt
        time /t >> date.txt

5.  **Post-build Actions** セクションをクリックして、ジョブの構成の **成果物を Microsoft Azure Blob ストレージにアップロード**します。
6.  **ストレージ アカウント名**, を使用するストレージ アカウントを選択します。
7.  **コンテナー名**, 、コンテナー名を指定します。 (コンテナーは、ビルド アーティファクトをアップロードする時点で存在していなければ、自動で作成されます)。環境変数を使用する場合を次の使用例」と入力 **${job_name}** 、コンテナー名。

    **ヒント**

    下、 **コマンド** セクションのスクリプトを入力する **Execute Windows batch コマンド** Hudson が認識できる環境変数へのリンクです。 環境変数の名前および説明を確認するには、リンクをクリックします。 環境変数を含む特殊な文字など、 **BUILD_URL** 環境変数は、コンテナー名および共通仮想パスとして使用できません。

8. クリックして **既定で新しいコンテナーを公開する** この例です。 (プライベート コンテナーを使用する場合には、Shared Access Signature を作成してアクセスを許可する必要があります。 ただし、この点についてはこの記事では取り扱いません。 共有アクセス署名に関する詳細については、 [共有アクセス署名の作成](http://go.microsoft.com/fwlink/?LinkId=279889).)
9. [省略可能]クリックして **Clean container before** ビルド アーティファクトをアップロードする前の内容をクリアするためのコンテナーの場合 (オフのままにして、コンテナーの内容をクリーンアップしたくない場合)。
10.  **をアップロードする List of Artifacts**, 、入力 **テキスト/*.txt** します。
11.  **アップロードされたアーティファクトの共通仮想パス**, 、入力 **${build \_id}/${build \_number}**します。
12. クリックして **保存** して設定を保存します。
13. Hudson ダッシュ ボード] をクリックして **Build Now** を実行する **MyJob**します。 コンソール出力でステータスを確認します。 ビルド後のアクションによってビルド アーティファクトのアップロードが開始されると、コンソール出力に Azure Storage に関するステータス メッセージが表示されます。
14. ジョブが正常に完了すると、パブリック BLOB を開いてビルド アーティファクトを確認できます。

    a. サインイン、 [Azure ポータル](portal.azure.com)します。

    b. クリックして **ストレージ**します。

    c. Hudson に使用したストレージ アカウント名をクリックします。

    d. クリックして **コンテナー**します。

    e. という名前のコンテナーをクリックして **myjob**, 、これは、Hudson ジョブを作成したときに割り当てたジョブ名の小文字版です。 Azure Storage では、コンテナー名と BLOB 名は小文字です (大文字と小文字は区別されます)。 という名前のコンテナーの blob の一覧内で **myjob** はず **hello.txt** と **date.txt**します。 そのどちらかの URL をコピーして、ブラウザーで開きます。 このテキスト ファイルがビルド アーティファクトとしてアップロードされていることがわかります。

アーティファクトを Azure BLOB ストレージにアップロードするビルド後のアクションは、ジョブごとに 1 つのみ作成できます。 こと、アーティファクトを Azure Blob ストレージにアップロードするビルド後のアクションが 1 つ指定できます (ワイルドカードを含む) 複数のファイルとファイル パスを **をアップロードする List of Artifacts** でセミコロンを区切り記号として使用します。 たとえば、Hudson ビルドする場合 JAR ファイルとファイルが生成 TXT ワークスペースの **ビルド** ] フォルダーは、両方を Azure Blob ストレージにアップロードするには、次を使用する、 **の Artifacts to upload] の一覧** 値: **build/\*.jar;build/\*.txt**します。 また、2 重コロンの構文を使用すると、BLOB 名で使用するパスを指定できます。 たとえば、jar ファイルのアップロードを使用して **バイナリ** blob パスと、TXT ファイルを使用してアップロード **通知** blob パスでは、次を使用して、 **の Artifacts to upload] の一覧** 値: **build/\*.jar::binaries;build/\*.txt::notices**します。

## Azure BLOB ストレージからのダウンロードを実行するビルド手順の作成方法 ##

次の手順では、Azure BLOB ストレージから項目をダウンロードするビルド手順を構成する方法を示します。 この手順は、Azure BLOB ストレージに保持している JAR ファイルなどの項目をビルドに含める場合に便利です。

1.  **ビルド** セクションをクリックして、ジョブの構成の **ビルド ステップの追加** を選択し、 **Azure Blob ストレージからダウンロード**します。
2.  **ストレージ アカウント名**, を使用するストレージ アカウントを選択します。
3.  **コンテナー名**, をダウンロードする blob があり、コンテナーの名前を指定します。 環境変数を使用できます。
4.  **Blob 名**, 、blob 名を指定します。 環境変数を使用できます。 また、アスタリスクを使用して、BLOB 名の先頭文字 (複数可) の後にワイルドカードを指定できます。 たとえば、 **プロジェクト *** で始まる名前のすべての blob を指定 **プロジェクト**します。
5. [省略可能] **ダウンロード パス**, 、Hudson を Azure Blob ストレージからファイルをダウンロードするコンピューター上のパスを指定します。 環境変数も使用できます (値を指定しない場合 **ダウンロード先のパス**, 、Azure Blob ストレージからファイルをジョブのワークスペースにダウンロードされます)。

Azure BLOB ストレージからダウンロードする項目が他にもある場合は、追加のビルド手順を作成できます。

目的の BLOB が正常にダウンロードされていることを確かめるには、ビルドを実行した後に、ビルド履歴のコンソール出力またはダウンロード先を確認します。

## BLOB サービスが使用するコンポーネント ##

以下では、BLOB サービス コンポーネントの概要を説明します。

- **ストレージ アカウント**: Azure ストレージにすべてのアクセス、ストレージ アカウントを通して行われます。 これは、アクセスする BLOB の名前空間の 中でも最高レベルに位置するものです。 アカウントに格納できるコンテナーの数は、コンテナーの合計サイズが 100 TB (テラバイト) 未満である限り無制限です。
- **コンテナー**: コンテナーは、blob のセットをグループ化します。 すべての BLOB はコンテナーに格納されている必要があります。 1 つのアカウントに格納できるコンテナーの数は無制限です。 また、1 つのコンテナーに保存できる BLOB の数も無制限です。
- **Blob**: 任意の型とサイズのファイルです。 Azure Storage に格納できる BLOB には、ブロック BLOB とページ BLOB の 2 種類があります。 ほとんどのファイルは ブロック BLOB です。 1 つのブロック BLOB には、最大で 200 GB までのデータを格納できます。 このチュートリアルでは、 ブロック BLOB を使用します。 もう 1 つの種類の BLOB であるページ BLOB には、最大 1 TB までのデータを格納できます。ファイルのバイト数の範囲が頻繁に変更される場合には、こちらの方が効率的です。 Blob の詳細については、次を参照してください。 [ブロック Blob およびページ Blob について](http://msdn.microsoft.com/library/azure/ee691964.aspx)します。
- **URL 形式**: Blob は次の URL 形式を使用してアドレス指定できます。

    `http://storageaccount.blob.core.windows.net/container_name/blob_name`

    (ここに挙げた形式は、パブリック Azure クラウドに適用されるものです。 異なる Azure クラウドを使用している場合は、内のエンドポイントを使用して、 [Azure ポータル](portal.azure.com) URL エンドポイントを指定します)。

    この形式では、`storageaccount` はストレージ アカウントの名前、`container_name` はコンテナーの名前、`blob_name` は BLOB の名前をそれぞれ表します。 コンテナー名に含まれる、スラッシュで区切られた複数のパスが持てる **/**します。 このチュートリアルではコンテナー名の例が **MyJob**, 、および **${build \_id}/${build \_number}** 共通仮想パスは、blob の url は次のように使用されました。

    `http://example.blob.core.windows.net/myjob/2014-05-01_11-56-22/1/hello.txt`

## 次のステップ

  [How to Create a Storage Account]: http://go.microsoft.com/fwlink/?LinkId=279823
  [Meet Hudson]: http://wiki.eclipse.org/Hudson-ci/Meet_Hudson

