<properties
   pageTitle="コンテンツ配信ネットワーク (CDN) のガイダンス |Microsoft Azure"
   description="コンテンツ配信ネットワーク (CDN) で Azure でホストされている広帯域幅コンテンツを配信するためのガイダンス"
   services=""
   documentationCenter="na"
   authors="dragon119"
   manager="masimms"
   editor=""
   tags=""/>

<tags
   ms.service="best-practice"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="04/28/2015"
   ms.author="masashin"/>


# コンテンツ配信ネットワーク (CDN) のガイダンス

![](media/best-practices-cdn/pnp-logo.png)

## 概要

Microsoft Azure コンテンツ配信ネットワーク (CDN) は、Azure でホストされている高帯域幅コンテンツを配信するためのグローバル ソリューションを開発者に提供します。 CDN は、Azure BLOB ストレージまたは戦略的に配置された場所に保存されているアプリケーション フォルダーから、一般公開されているオブジェクトを読み込み、キャッシュしておくことで、ユーザーへのコンテンツ配信に最大限の帯域幅を提供しています。 CDN は、通常、イメージ、スタイル シート、ドキュメント、ファイル、クライアント側スクリプトでは、HTML ページなどの静的コンテンツの配信に使用されます。

CDN を使用する主要な利点は、待機時間が短縮されること、ユーザーの利用場所 (アプリケーションがホストされているデータセンターに関連する) に左右されることなくユーザーへのコンテンツ配信が高速になること、コンテンツのアクセスと配信に必要な処理が軽減されるためアプリケーション自体にかかる負荷も軽減されることです。 負荷が軽減されることで、アプリケーションのパフォーマンスとスケーラビリティが向上します。また、一定レベルのパフォーマンスと可用性を達成するために必要な処理リソースが削減されるので、ホスト用のコストも最小限に抑えられます。

Azure CDN がニーズを満たしていない場合は、Azure で実装されていない他のコンテンツ配信ネットワーク システムをアプリケーションで使用することもできます。 また、Azure ストレージまたは Azure コンピューティング インスタンスで静的コンテンツを公開することで、他のプロバイダーでホストされているアプリケーションに Azure CDN を使用することもできます。  
![](media/best-practices-cdn/CDN.png)

## CDN の使用方法と使用する理由

一般的に、CDN は次のように使用されています。

- クライアント アプリケーション用の静的リソースの配信 (多くの場合、Web サイトから)。 たとえば、イメージ、スタイル シート、ドキュメント、ファイル、クライアント側スクリプト、HTML ページ、HTML フラグメントなど、個々の要求に応じてサーバー側が変更する必要がないコンテンツの配信に利用できます。 アプリケーションでは、実行時にアイテムを作成し、CDN から使用できるようにすることもできますが (たとえば、最新ニュースの見出し一覧を作成するなど)、個々の要求に応じて実行することはありません。

- 静的な共有パブリック コンテンツを、API をクライアントに提供する Web サービスであるアプリケーションを利用するデバイス (携帯電話、タブレット コンピューターなど) に配信。 その他のサーバーが個々の要求に応じて変更する必要がないコンテンツに加え、CDN は、クライアント UI の生成などの目的で、クライアントが使用する静的データセットを配信することもできます。 たとえば、JSON または XML ドキュメントの配信に使用することができます。

- 専用のコンピューティング リソースを使用することなく、静的パブリック コンテンツのみで構成されている Web サイト全体をクライアントに提供。

- オンデマンドでビデオ ファイルをクライアントにストリーミング。 ビデオの場合、CDN 接続を提供するデータセンターは世界各国にあるため、短い待機時間、信頼性の高い接続という利点があります。

- ユーザー エクスペリエンスを全般的に改善。特に、アプリケーションのデータセンターから離れた場所で利用していて、他のシステムであれば待機時間が長くなるユーザーにお勧めです。 多くの場合、Web アプリケーションに含まれるコンテンツのうち、大部分は静的コンテンツです。CDN を使用することで、パフォーマンスと全体的なユーザー エクスペリエンスを維持することができます。また、アプリケーションを複数のデータセンターにデプロイする必要がなくなります。

- モノのインターネット (IoT) の一部であるモバイル デバイスと固定デバイスにサービスを提供するために、増え続けるアプリケーションの負荷に対処。 このようなデバイスやアプライアンスが多数あり、ブロードキャスト メッセージを処理し、ファームウェア更新プログラムの配布を直接間する必要がある場合、アプリケーションはすぐに処理できなくなります。

- アプリケーションを拡張することなく、ピーク時や需要の急騰に対処。結果として、運用コストの増加を防ぐことができます。 たとえば、オペレーティング システム、特定モデルのルーターなどのハードウェア デバイス、スマート TV などのコンシューマー デバイスの更新プログラムがリリースされた場合、短期間で数百万単位のユーザーやデバイスがダウンロードするので、需要が大きく跳ね上がります。

- 次の表は、さまざまな場所の 1 バイト目の配信にかかる平均時間の例です。 ターゲット Web ロールは、Azure 米国西部にデプロイされています。 CDN を利用して時間が大きく短縮された場所と、CDN ノードとの近さには強い相関関係があります。 Azure CDN ノードの場所の一覧については、「 [Azure コンテンツ配信ネットワーク (CDN) ノードの場所](http://msdn.microsoft.com/library/azure/gg680302.aspx)します。



| City| 1 バイト目にかかる時間 (配信元)| 1 バイト目にかかる時間 (CDN)| CDN の時間短縮率 (%)|
|---|---|---|---|
| カリフォルニア州サンノゼ<sub>1</sub>| 47.5| 46.5| 2%|
| ダレス バージニア州<sub>2</sub>| 109| 40.5| 169%|
| ブエノス アイレス (アルゼンチン)| 210| 151| 39%|
| ロンドン (英国)<sub>1</sub>| 195| 44| 343%|
| 上海 (中国)| 242| 206| 17%|
| シンガポール<sub>1</sub>| 214| 74| 189%|
| 東京 (日本)<sub>1</sub>| 163| 48| 240%|
| ソウル (韓国)| 190| 190| 0%|

同じ都市に Azure CDN ノードがあります。<sub>1</sub>  
隣接する都市に Azure CDN ノードがあります。<sub>2</sub>


## 課題

CDN の使用を計画する際には、いくつかの課題を考慮する必要があります。

- **デプロイ** CDN のコンテンツを読み込む場所 (CDN がコンテンツを取得する元の場所) を決定する必要があります。また、複数のストレージ システム (CDN と代替の場所など) にあるコンテンツをデプロイする必要があるかどうかを決定する必要があります。

- アプリケーションのデプロイ メカニズムでは、静的なコンテンツとリソースのデプロイだけでなく、ASPX ページなどのアプリケーション ファイルのデプロイも考慮する必要があります。 たとえば、Azure BLOB ストレージにコンテンツを読み込むには、個別の手順が必要になる場合もあります。

- **バージョン管理とキャッシュ制御** 静的コンテンツを更新する方法と、新しいバージョンをデプロイする方法を検討する必要があります。 現在、CDN では、コンテンツを消去して、新しいバージョンを使用できるようにするメカニズムを提供していません。 これは、Web ブラウザーなどでクライアント側キャッシュを管理する場合と同様の課題です。

- **テスト** アプリケーションをローカル環境やステージング環境で開発し、テストしている場合、CDN の設定をローカルでテストすることは困難になる可能性があります。

- **SEO** CDN を使用すると、イメージやドキュメントなどのコンテンツは、複数のドメインから提供されるので、そのコンテンツの SEO に影響が出ます。

- **セキュリティ** Azure などの多くの CDN サービスは、現在のところ、どのような種類のコンテンツのアクセス制御も提供していません。

- **回復力** CDN は、アプリケーションの単一障害点になる可能性があります。 CDN の可用性に関する SLA は BLOB ストレージよりも低いので (BLOB ストレージはコンテンツの直接配信に使用できます)、必要に応じて、重要なコンテンツ用にフォールバック メカニズムの実装を検討します。

- クライアントは、CDN 上のリソースにへのアクセスを許可していない環境から接続している可能性があります。 たとえば、既知のリソースにのみアクセスが制限されているセキュリティに制約のある環境や、ページの提供元以外から配信されたリソースを読み込まない環境などです。 そのため、フォールバックの実装が必要になります。

- CDN 経由のコンテンツの可用性を監視するメカニズムを実装することをお勧めします。

CDN が適していないシナリオを次に示します。

- コンテンツの有効期間中に、コンテンツのヒット率が低く、ほとんどアクセスされないかアクセス回数が 1 回のみの場合。 アイテムが初めてダウンロードされると、2 つのトランザクション料金が発生します (提供元から CDN、次に CDN からユーザー)。

- データが非公開の場合。たとえば、大規模な企業やサプライ チェーンのエコシステムなどです。


## 一般的なガイドラインと推奨される方法

CDN は、アプリケーションの負荷を最小限に抑え、可用性とパフォーマンスを最大限にするために有効な方法です。 アプリケーションが使用する適切なコンテンツとリソースのすべてを考慮する必要があります。 CDN の使用戦略を立てるときは、次の点を考慮してください。

- **オリジン** CDN 経由でコンテンツを展開する必要があります CDN サービスがアクセスし、コンテンツをキャッシュに使用する HTTP (ポート 80) エンドポイントを指定できます。 +、エンドポイントは、CDN 経由で配信する静的なコンテンツが格納されている Azure blob ストレージ コンテナーを指定できます。 コンテナーは、パブリックと指定する必要があります。 CDN 経由で使用できるのは、パブリック読み取りアクセス権を持つパブリック コンテナー内の BLOB のみです。

- エンドポイントは、アプリケーションのいずれかのコンピューティング層 (Web ロール、仮想マシンなど) のルートにある **cdn** というフォルダーを指定できます。 ASPX ページなどの動的リソースを含め、リソースに対する要求の結果は、CDN にキャッシュされます。 最短のキャッシュ可能期間は 300 秒です。 短い期間により、コンテンツを CDN にデプロイされている (セクションを参照して"<a href="#cachecontrol" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">キャッシュ制御</a>"の詳細)。

- Azure の Web サイトを使用している場合、エンドポイントは、CDN インスタンスを作成するときに選択したサイトのルート フォルダーに設定されます。 サイトのすべてのコンテンツは、CDN を介して使用できるようになります。

- ほとんどの場合、アプリケーションのコンピューティング層のいずれかにあるフォルダーの CDN エンドポイントを指定すると、より柔軟に細かく制御できます。 たとえば、現在と将来のルーティング要件の管理、イメージのサムネイルなどの静的コンテンツの動的生成が簡単になります。

- ASPX ページなどの動的ソースからコンテンツを配信する場合、キャッシュ内のオブジェクトを区別するためにクエリ文字列を使用することができます。 また、管理ポータルの設定で CDN エンドポイントを指定するときに、この動作を無効にすることもできます。 BLOB ストレージからコンテンツを配信する場合、クエリ文字列は文字列リテラルとして扱われるので、名前が同じでクエリ文字列が同じアイテムが 2 つある場合、CDN では別のアイテムとして保存されます。

- スクリプトや他のコンテンツなどのリソースの URL 書き換えを利用すると、ファイルが CDN の配信元フォルダーに移動されることを回避できます。

- Azure ストレージ BLOB を使用して CDN のコンテンツを保存する場合、BLOB 内にあるリソースの URL で、コンテナーと BLOB の名前の大文字と小文字は区別されます。

- Azure Web サイトを使用している場合は、リソースへのリンクに CDN インスタンスのパスを指定します。 次の例では、CDN を介して配信されるサイトの **Images** フォルダー内のイメージ ファイルを指定しています。

  ```
  <img src="http://[your-cdn-instance].vo.msecnd.net/Images/image.jpg" />
  ```

- **デプロイ** アプリケーション デプロイ パッケージまたはプロセスに静的コンテンツを含めない場合は、必要に応じて、アプリケーションとは別に静的コンテンツをプロビジョニングおよびデプロイします。 アプリケーション コンポーネントと静的リソース コンテンツの両方を管理するために使用するバージョン管理アプローチに対して、どのような影響があるかを考慮してください。

- スクリプトと CSS ファイルのバンドル (複数のファイルを 1 つにまとめる処理) と縮小 (空白、改行文字、コメントなどの不要な文字の削除) を処理する方法について考慮します。 このような一般的に使用される手法によって、クライアントの読み込み時間を短縮することができます。また、CDN を介したコンテンツ配信と互換性がある手法です。 詳細については、次を参照してください。 [バンドルと縮小](http://www.asp.net/mvc/tutorials/mvc-4/bundling-and-minification)します。

- コンテンツを追加の場所にデプロイする必要がある場合、デプロイメント プロセスの手順が増えます。 アプリケーションが、定期的に、またはイベントに応じて CDN のコンテンツを更新すると、更新されたコンテンツを CDN のエンドポイントだけでなく追加の場所にも保存する必要があります。

- Azure のステージング環境または Visual Studio のローカルの Azure エミュレーターにデプロイしたアプリケーションの場合、CDN エンドポイントを設定できません。 この問題は、単体テスト、機能テスト、最終的なデプロイ前テストに影響があります。 代替メカニズムを実装して、この問題に対応する必要があります。 たとえば、一時的なカスタム アプリケーションまたはユーティリティを使用して CDN にコンテンツを事前デプロイして、キャッシュされている期間にテストを実行する方法があります。 また、コンパイル ディレクティブまたはグローバル定数を使用して、アプリケーションがリソースを読み込む場所を制御する方法もあります。 たとえば、デバッグ モードで実行するときは、クライアント側スクリプト バンドルや他のコンテンツなどのリソースをローカル フォルダーから読み込み、リリース モードで実行するときは CDN を使用することができます。

- CDN は、ネイティブ圧縮機能をサポートしていません。 ただし、zip や gzip ファイルなど、既に圧縮されているコンテンツを配信することはできます。 CDN エンドポイントとしてアプリケーション フォルダーを使用する場合、サーバーの既定では、Web ブラウザーまたは他の種類のクライアントに直接配信するときと同じ方法で、一部のコンテンツを圧縮することができます。 この処理は、クライアントから送信される **Accept-Encoding** 値によって変わります。 Azure の既定では、CPU 使用率が 50% を下回るとコンテンツが自動的に圧縮されます。 アプリケーションのホストにクラウド サービスを使用している場合にこの設定を変更すると、IIS で動的出力の圧縮を有効にするスタートアップ タスクの使用が必要になる可能性があります。 参照してください [Web ロールを介して Azure CDN で gzip 圧縮を有効にすると](http://blogs.msdn.com/b/avkashchauhan/archive/2012/03/05/enableing-gzip-compression-with-windows-azure-cdn-through-web-role.aspx) の詳細。

- **ルーティングとバージョン管理** 複数の CDN インスタンスが必要になることがあります。たとえば、新しいバージョンのアプリケーションをデプロイするときは、別の CDN が必要になることがあります。 コンテンツ配信元として Azure BLOB ストレージを使用している場合は、別のストレージ Azure 管理ポータルまたは別のコンテナーを作成し、CDN エンドポイントでその場所を指定するだけです。 CDN エンドポイントとしてアプリケーション内で **cdn** ルート フォルダーを使用している場合、要求を別のフォルダーに送信する URL の書き換え手法を使用できます。

- Azure BLOB ストレージからコンテンツを取得するときに、クエリ文字列はリソース名 (BLOB 名) の一部になるので、CDN 上のリソースに対するリンクで、クエリ文字列を使用してアプリケーションの別バージョンを指定しないでください。 また、クエリ文字列はクライアントがリソースをキャッシュする方法にも影響があります。

- 以前のリソースが CDN にキャッシュされている場合、アプリケーションの更新時に新しいバージョンの静的コンテンツをデプロイすることが困難になる可能性があります。 詳細については、セクションを参照してください。"<a href="#cachecontrol" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">キャッシュ制御</a>"です。

<a name="cachecontrol" href="#" xmlns:xlink="http://www.w3.org/1999/xlink"><span /></a>**キャッシュ制御**+ する方法を管理する、キャッシュと、アプリケーションの層を検討してください。 たとえば、CDN 配信元としてフォルダーを使用している場合、コンテンツを生成するページのキャッシュ可能性と、特定のフォルダーのすべてのリソースについてコンテンツ有効期限を指定できます。 CDN と、標準の HTTP ヘッダーを使用するクライアントのキャッシュ プロパティを指定することもできます。 サーバーとクライアントのキャッシュを既に管理している場合でも、CDN を使用すると、コンテンツのキャッシュ方法と場所を把握しやすくなります。

- 配信元 (BLOB コンテナーまたはアプリケーション **cdn** ルート フォルダー) から削除できるオブジェクトを CDN で使用できないようにするには、CDN エンドポイントを削除するか、(BLOB ストレージの場合は) コンテナーまたは BLOB を非公開にします。 ただし、アイテムが CDN から削除されるのは、有効期限が切れたときのみです。

- キャッシュの有効期限が指定されていない場合 (コンテンツを BLOB ストレージから読み込まれたときなど)、CDN には最長 72 時間キャッシュされます。

- Web アプリケーションの場合、すべてのコンテンツにキャッシュと有効期限を設定するには、web.config ファイルの **system.webServer/staticContent** セクションで **clientCache** 要素を使用します。 web.config ファイルは任意のフォルダーに配置できるので、そのフォルダー内のファイルとすべてのサブフォルダー内のファイルに影響があります。

- ASP.NET などの動的な手法を使用して CDN のコンテンツを作成するには、各ページに **Cache.SetExpires** プロパティを指定します。 CDN では、パブリックの既定のキャッシュ可能性設定を使用しているページからの出力をキャッシュしません。 コンテンツの破棄を防ぎ、ごく短い間隔でアプリケーションから読み込み直すようにキャッシュ有効期限を適切な値に設定します。

- **セキュリティ** CDN は、CDN から提供された証明書を使用して HTTPS (SSL) 上でコンテンツを配信できますが、HTTP 上で使用することもできます。 CDN のアイテムに対する HTTP アクセスはブロックできません。 HTTPS と HTTP が混合している場合のブラウザーの警告を回避するために、HTTPS 経由で読み込まれたページに表示されている静的コンテンツを要求するために HTTPS を使用する必要はありません。

- 現在、Azure CDN などの多くの CDN サービスでは、コンテンツに対するアクセスを保護するアクセス制御の設備を提供していません。 CDN では、Shared Access Signatures (SAS) を使用できません。

- CDN を使用してクライアント側スクリプトを配信する場合、データ、イメージ、フォントなど、他のリソースに対する HTTP 要求を送信する **XMLHttpRequest** 呼び出しを使用しているスクリプトの場合、問題が発生することがあります。 多くの Web ブラウザーは、適切な応答ヘッダーを設定するように Web サーバーが構成されていない場合、クロス オリジン リソース共有 (CORS) を回避します。 CORS の詳細については、ガイドの「脅威の軽減」セクションを参照してください。 <span class="highlight" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">API のセキュリティに関する考慮事項</span>します。 CORS をサポートするように CDN を構成できます。また、コンテンツを配信している配信元が Azure BLOB ストレージである場合、サービス プロパティに **CorsRule** を追加できます。 ルールには、CORS 要求に許可される配信元、GET などの許可されるメソッド、ルールの最長有効期間 (秒) (元のコンテンツを読み込んだ後に、リンクされているリソースをクライアントが要求する必要がある期間) を指定できます。 詳細については、次を参照してください。 [Azure ストレージ サービスのクロス オリジン リソース共有 (CORS) サポート](http://msdn.microsoft.com/library/azure/dn535601.aspx)します。

- コンテンツの配信元が、**cdn** ルート フォルダーなど、アプリケーション内のフォルダーである場合、アプリケーション構成ファイルで、すべての応答について **Access-Control-Allow-Origin** ヘッダーを設定するように発信規則を構成できます。 書き換えルールの使用に関する詳細については、次を参照してください。 [URL 書き換えモジュール](http://www.iis.net/learn/extensions/url-rewrite-module)します。 Azure Web サイトを使用しているときは、この手法を使用できません。

- **カスタム ドメイン**+ Azure CDN など、ほとんどの CDN では、カスタム ドメイン名を指定し、それを使用して CDN 経由でリソースにアクセスすることができます。 また、DNS の **CNAME** レコードを使用してカスタム サブドメインを設定することもできます。 このアプローチを使用すると、抽象化と制御の層を追加することができます。

- **CNAME** を使用している場合、(このガイドの執筆時点では) SSL も使用することはできません。これは、CDN は独自の単一 SSL 証明書を使用しており、カスタム ドメイン名/サブドメイン名とは一致しないためです。

- **CDN フォールバック** CDN のエラーや一時的な使用不能状態のときにアプリケーションで対処する方法を考慮する必要があります。 クライアント アプリケーションは、CDN を使用できない場合に、配信元 (リソースが保存されているアプリケーション フォルダーまたは Azure BLOB コンテナー) にリソースを要求するのではなく、前回の要求中に (クライアントの) ローカルにキャッシュされたリソースのコピーを使用したり、エラーを検出するコードを使用したりすることができます。

- **SEO** SEO が重要な考慮事項であるアプリケーションの場合、各ページまたはリソースに標準の **Rel** ヘッダーを含めます。

- **CNAME** サブドメイン レコードを使用し、その名前を使用してリソースにアクセスします。

- CDN の IP アドレスは、アプリケーションの国または地域とは異なる可能性があります。その影響を考慮してください。

- Azure BLOB ストレージを配信元として使用する場合、CDN のリソースについて、アプリケーション フォルダーと同じファイル構造を維持します。

- **監視とログ記録** アプリケーションの監視戦略の一部として CDN を含めて、エラーまたは長い待機時間の発生を検出して測定します。

- CDN のログ記録を有効にして、日常的な運用の一部に含めます。

- **コストの見込み** CDN からの発信データ転送と、CDN がアプリケーションからデータを読み込むときのストレージ トランザクションの両方が課金されます。 コンテンツに適した現実的なキャッシュ有効期間は、コンテンツの鮮度を確保し、アプリケーションまたは BLOB ストレージから CDN にコンテンツが繰り返し読み込まれない程度の短すぎない時間に設定する必要があります。 ただし、有効期間を長くすると、期限切れになるまで待つ必要があるので、CDN からアイテムを削除するのが困難になります。

- あまりダウンロードされないアイテムでも 2 つのトランザクション料金が発生し、サーバーの負荷が大きく減ることはありません。



## コード例

このセクションでは、CDN を使用する場合のコードと手法の例について説明します。


## URL の書き換え

以下は、クラウド サービスでホストされているアプリケーションのルートにある Web.config ファイルの例です。CDN を使用するときに URL の書き換えを実行する方法を示しています。 キャッシュするコンテンツの CDN の要求は、リソースの種類 (スクリプトやイメージなど) に基づいて、アプリケーション ルート内の特定のフォルダーに制限されます。

```XML
<system.webServer>
  ...
  <rewrite>
    <rules>
      <rule name="VersionedResource" stopProcessing="false">
        <match url="(.*)_v(.*)\.(.*)" ignoreCase="true" />
        <action type="Rewrite" url="{R:1}.{R:3}" appendQueryString="true" />
      </rule>
      <rule name="CdnImages" stopProcessing="true">
        <match url="cdn/Images/(.*)" ignoreCase="true" />
        <action type="Rewrite" url="/Images/{R:1}" appendQueryString="true" />
      </rule>
      <rule name="CdnContent" stopProcessing="true">
        <match url="cdn/Content/(.*)" ignoreCase="true" />
        <action type="Rewrite" url="/Content/{R:1}" appendQueryString="true" />
      </rule>
      <rule name="CdnScript" stopProcessing="true">
        <match url="cdn/Scripts/(.*)" ignoreCase="true" />
        <action type="Rewrite" url="/Scripts/{R:1}" appendQueryString="true" />
      </rule>
      <rule name="CdnScriptBundles" stopProcessing="true">
        <match url="cdn/bundles/(.*)" ignoreCase="true" />
        <action type="Rewrite" url="/bundles/{R:1}" appendQueryString="true" />
      </rule>
    </rules>
  </rewrite>
  ...
</system.webServer>
```

書き換えルールを追加すると、次のリダイレクトが実行されます。

- 最初のルールでは、リソースのファイル名にバージョンを埋め込むことができますが、これは無視されます。 たとえば、**Filename_v123.jpg** は **Filename.jpg** と書き換えられます。

- 次の 4 つのルールは、Web ロールのルートにある **cdn** というフォルダーにリソースを保存しない場合に、要求をリダイレクトする方法を示しています。 これらのルールは、**cdn/Images**、**cdn/Content**、**cdn/Scripts**、**cdn/bundles** URL を Web ロールの各ルート フォルダーにマッピングされます。
URL の書き換えを使用するには、リソースのバンドルにいくつかの変更を加える必要があります。


## バンドルと縮小

バンドルと縮小は、ASP.NET で処理することができます。 MVC プロジェクトでは、**BundleConfig.cs** でバンドルを定義します。 縮小されたスクリプト バンドルの参照は、一般的にコードのビュー クラスで **Script.Render** を呼び出して作成します。 この参照には、ハッシュを含むクエリ文字列が含まれます。ハッシュは、バンドルのコンテンツに基づいています。 バンドルの内容が変わると、生成されるハッシュも変わります。  
既定の Azure CDN のインスタンスでは、**クエリ文字列のステータス**設定が無効にされています。 更新されたスクリプトのバンドルを CDN で適切に処理できるように、CDN インスタンスの**クエリ文字列ステータス**を有効にする必要があります。 CDN を作成し、設定が有効になるまで、1 時間以上かかることがあります。


## 詳細

+ [Azure CDN](http://azure.microsoft.com/services/cdn/)
+ [Azure コンテンツ配信ネットワーク (CDN) の概要](http://msdn.microsoft.com/library/azure/ff919703.aspx)
+ [Web アプリケーションで Azure CDN からコンテンツを配信します。](cdn-serve-content-from-cdn-in-your-web-application.md)
+ [クラウド サービスと Azure CDN との統合します。](cdn-cloud-service-with-cdn.md)
+ [Azure コンテンツ配信ネットワークのベスト プラクティス](http://azure.microsoft.com/blog/2011/03/18/best-practices-for-the-windows-azure-content-delivery-network/)





