<properties
   pageTitle="Visual Studio からの Azure アプリケーションの発行またはデプロイの準備"
   description="クラウド サービスとストレージ アカウント サービスを設定し、Azure アプリケーションを構成する手順を説明します。"
   services="visual-studio-online"
   documentationCenter="na"
   authors="TomArcher"
   manager="douge"
   editor="" />
<tags
   ms.service="multiple"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="multiple"
   ms.date="09/28/2015"
   ms.author="tarcher" />


# Visual Studio からの Azure アプリケーションの発行またはデプロイの準備

## 概要

クラウド サービス プロジェクトを発行可能にするには、次のサービスを設定する必要があります。

- Azure 環境でロールを実行する**クラウド サービス**

- BLOB サービス、Queue サービス、および Table サービスへのアクセスを提供する**ストレージ アカウント**

これらのサービスを設定し、アプリケーションを構成するには、次の手順を使用します。


## クラウド サービスを作成する

Azure にクラウド サービスを発行するには、まず、Azure 環境でロールを実行するクラウド サービスを作成する必要があります。 このトピックの「**Microsoft Azure 管理ポータルを使用してクラウド サービスを作成するには**」セクションで説明しているように、Microsoft Azure 管理ポータルでクラウド サービスを作成できます。 クラウド サービスは、発行ウィザードを使用して Visual Studio を作成することもできます。

### Visual Studio を使用してクラウド サービスを作成するには

1. Azure プロジェクトのショートカット メニューを開き、**[発行]** をクリックします。

    ![VST_PublishMenu](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/vst-publish-menu.png)

1. サインインしていない場合は、Azure サブスクリプションに関連付けられている Microsoft アカウントまたは組織アカウントのユーザー名とパスワードを使用してサインインします。

1. **[次へ]** をクリックし、**[設定]** ページに進みます。

    ![Publishing Wizard Common Settings](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/publish-settings-page.png)

1. **[クラウド サービス]** 一覧で、**[新規作成]** をクリックします。 **[Azure サービスの作成]** ダイアログが表示されます。

1. クラウド サービスの名前を入力します。 この名前はサービスの URL の一部として使用されるため、グローバルに一意であることが必要です。 この名前では、大文字小文字が区別されません。

### Azure 管理ポータルを使用してクラウド サービスを作成するには

1. サインイン、 [Azure 管理ポータル](http://go.microsoft.com/fwlink/?LinkId=253103) 、Microsoft web サイトです。

1. (省略可能) 既に作成したクラウド サービスの一覧を表示するには、ページの左側にある [Cloud Services] リンクを選択します。

1. 左下隅にある **[+]** アイコンを選択し、表示されるメニューで **[クラウド サービス]** を選択します。 **[簡易作成]** と **[カスタム作成]** という 2 つのオプションがある別の画面が表示されます。 **[簡易作成]** を選択した場合、URL と物理的にホストするリージョンを指定するだけで、クラウド サービスを作成できます。 **[カスタム作成]** を選択した場合、パッケージ (.cspkg ファイル)、構成 (.cscfg) ファイル、および証明書を指定することで、クラウド サービスをすぐに発行できます。 Azure プロジェクトの **[発行]** コマンドを使用してクラウド サービスを発行する場合、カスタム作成は必須ではありません。 **[発行]** コマンドは、Azure プロジェクトのショートカット メニューで使用できます。

1. 後で Visual Studio を使用してクラウド サービスを発行する場合は、**[簡易作成]** を選択します。

1. クラウド サービスの名前を指定します。名前の隣に完全な URL が表示されます。

1. 一覧で、ユーザーが主に配置されているリージョンを選択します。

1. ウィンドウの下部にある **[クラウド サービスの作成]** リンクを選択します。

## ストレージ アカウントの作成

ストレージ アカウントを使用すると、BLOB サービス、Queue サービス、および Table サービスにアクセスできます。 ストレージ アカウントを作成するには Visual Studio を使用して、または [Azure 管理ポータル](http://go.microsoft.com/fwlink/?LinkId=253103)します。

### Visual Studio を使用して、ストレージ アカウントを作成するには

1. **ソリューション エクスプローラー**で **[Storage]** ノードのショートカット メニューを開き、**[ストレージ アカウントの作成]** を選択します。

    ![Create a new Azure storage account](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/IC744166.png)

1. **[ストレージ アカウントの作成]** ダイアログ ボックスで、新しいストレージ アカウントの次の情報を選択または入力します。
    - ストレージ アカウントを追加する Azure サブスクリプション。
    - 新しいストレージ アカウントに使用する名前。
    - リージョンまたはアフィニティ グループ (米国西部や東アジアなど)。
    - geo 冗長など、ストレージ アカウントで使用するレプリケーションの種類。

1. 終了したら **[作成]** を選択します。**サーバー エクスプローラー**の **[Storage]** 一覧に新しいストレージ アカウントが表示されます。

### Azure 管理ポータルを使用して、ストレージ アカウントを作成するには

1. サインイン、 [Azure 管理ポータル](http://go.microsoft.com/fwlink/?LinkId=253103) 、Microsoft web サイトです。

1. (省略可能) ストレージ アカウントを表示するには、ページの左側のパネルで **[Storage]** リンクを選択します。

1. ページの左下隅にある **[+]** アイコンをクリックします。

1. 表示されるメニューで、**[Storage]**、**[簡易作成]** の順にクリックします。

1. ストレージ アカウントに一意の URL となる名前を付けます。

1. クラウド サービスに名前を付けます。 名前の隣に完全な URL が表示されます。

1. リージョンの一覧で、ユーザーが主に配置されているリージョンを選択します。

1. geo レプリケーションを有効にするかどうかを指定します。 geo レプリケーションを有効にした場合は、データは複数の物理的な場所に保存され、損失の可能性が低減します。 この機能ではストレージは高価になりますが、機能を後で追加するのではなく、ストレージ アカウントを作成するときに geo ロケーションを有効にすると、コストを削減することができます。 詳細については、次を参照してください。 [Geo レプリケーション](http://go.microsoft.com/fwlink/?LinkId=253108)します。

1. ウィンドウの下部にある **[ストレージ アカウントの作成]** リンクをクリックします。

ストレージ アカウントを作成したら、各 Azure Storage サービスのリソースにアクセスするために使用できる URL が表示されます。また、アカウントのプライマリ アクセス キーとセカンダリ アクセス キーも表示されます。 これらのキーは、ストレージ サービスに対する要求を認証するために使用します。
>[AZURE.NOTE] セカンダリ アクセス キーは、プライマリ アクセス キーと同じようにストレージ アカウントにアクセスでき、プライマリ アクセス キーが侵害された場合の予備として生成されます。 また、定期的にアクセスのキーを再生成することをお勧めします。 プライマリ キーの再生成時にセカンダリ キーを使用するように接続文字列の設定を変更した後で、セカンダリ キーの再生成時に再生成したプライマリ キーを使用するように接続文字列の設定を変更できます。

## ストレージ アカウントによって提供されるサービスを使用するようアプリケーションを構成する

作成した Azure Storage サービスを使用するには、Storage サービスにアクセスするロールを構成する必要があります。 これを行うために、Azure プロジェクトの複数のサービス構成を使用できます。 既定では、Azure プロジェクトに 2 つのサービス構成が作成されます。 複数のサービス構成を使用すると、コード内では同じ接続文字列を使用しつつ、各サービス構成で定めた接続文字列に別の値を適用することができます。 たとえば、Azure ストレージ エミュレーターを使用してアプリケーションをローカルで実行およびデバッグするサービス構成と、Azure にアプリケーションを発行する別のサービス構成を使用できます。 サービス構成の詳細については、次を参照してください。 [を構成する、Azure プロジェクトを使用して複数のサービス構成](vs-azure-tools-multiple-services-project-configurations.md)します。

### ストレージ アカウントが提供するサービスを使用するようアプリケーションを構成するには

1. Visual Studio で Azure ソリューションを開きます。 ソリューション エクスプローラーで、ストレージ サービスにアクセスする Azure プロジェクトの各ロールのショートカット メニューを開き、**[プロパティ]** をクリックします。 ロールの名前のページが、Visual Studio エディターに表示されます。 ページには、**[構成]** タブのフィールドが表示されます。

1. ロールのプロパティ ページで **[設定]** を選択します。

1. **[サービスの構成]** ボックスの一覧で、編集するサービス構成の名前を選択します。 このロールのすべてのサービス構成を変更する場合は、**[すべての構成]** を選択できます。 サービス構成を更新する方法の詳細については、セクションを参照してください。 **のストレージ アカウント接続文字列の管理** 、トピックの「 [Visual Studio で Azure クラウド サービスの、役割を構成](vs-azure-tools-configure-roles-for-cloud-service.md)します。

1. 接続文字列の設定を変更するには、設定の隣にある **[...]** ボタンをクリックします。 **[ストレージ接続文字列の作成]** ダイアログ ボックスが表示されます。

1. **[接続方法]** で **[サブスクリプション]** オプションをクリックします。

1. **[サブスクリプション]** 一覧で、目的のサブスクリプションを選択します。 目的のサブスクリプションが一覧に含まれていない場合は、**[発行設定のダウンロード]** リンクを選択します。

1. **[アカウント名]** 一覧で、ストレージ アカウント名を選択します。 Azure Tools は .publishsettings ファイルを使用して、自動的にストレージ アカウントの資格情報を取得します。 ストレージ アカウントの資格情報を手動で指定するには、**[手動で入力された資格情報]** オプションを選択し、この手順を続行します。 ストレージ アカウント名とプライマリ キーを取得できます、 [Azure 管理ポータル](http://go.microsoft.com/fwlink/p/?LinkID=213885)します。 ストレージ アカウントの設定を手動で指定しない場合は、**[OK]** をクリックし、ダイアログ ボックスを閉じます。

1. **[ストレージ アカウントの資格情報の入力]** リンクをクリックします。

1. ストレージ アカウントの名前を **[アカウント名]** に入力します。
    >[AZURE.NOTE] 管理ポータルにログインし、**[Storage]** ボタンをクリックします。 ポータルでは、ストレージ アカウントの一覧が表示されます。 アカウントを選択すると、アカウント用のページが開きます。 このページからストレージ アカウントの名前をコピーできます。 以前のバージョンの管理ポータルを使用している場合は、ストレージ アカウントの名前が管理ポータルの **[ストレージ アカウント]** ビューに表示されます。 この名前をコピーするには、このビューの **[プロパティ]** ウィンドウで強調表示し、Ctrl キーを押しながら C キーを押します。 Visual Studio に名前を貼り付けるには、**[アカウント名]** ボックスを選択し、Ctrl キーを押しながら V キーを押します。

1. **アカウント キー** ボックスで、プライマリ キーを入力またはコピーして貼り付けますから、 [Azure 管理ポータル](http://go.microsoft.com/fwlink/?LinkID=213885)します。
    管理ポータルからこのキーをコピーするには:

    1. 該当するストレージ アカウントのページの下部で、**[キーの管理]** をクリックします。

    1. **[キーのアクセスを管理]** ページで、プライマリ アクセス キーのテキストを選択し、Ctrl キーを押しながら C キーを押します。

    1. Azure Tools で、**[アカウント キー]** ボックスにキーを貼り付けます。

    1. サービスがストレージ アカウントにアクセスする方法を決定するには、次のオプションのいずれかを選択する必要があります。
        - **[HTTP を使用する]**。これは、標準的なオプションです。たとえば、 `http://<account 名 >. >.blob.core.windows.net`します。
        - **[HTTPS を使用する]**。これは、セキュリティで保護された接続に使用します。たとえば、 `https://&lt;accountname&gt;.blob.core.windows.net`します。
        - **[カスタム エンドポイントを指定する]**。これは、3 つのサービスそれぞれに対してエンドポイントを指定するときに使用します。 このオプションを選択すると、特定のサービスのフィールドにエンドポイントを入力できます。
        >[AZURE.NOTE] カスタム エンドポイントを作成する場合は、より複雑な接続文字列を作成できます。 この文字列形式を使用する場合は、ストレージ アカウント用に BLOB サービスに登録したカスタム ドメイン名を含むストレージ サービス　エンドポイントを指定できます。 また、Shared Access Signature を介して単一コンテナーの BLOB リソースにのみアクセスを許可できます。 カスタム エンドポイントを作成する方法の詳細については、次を参照してください。 [Azure ストレージ接続文字列の構成](storage-configure-connection-string.md)します。

1. これらの接続文字列の変更を保存するには、**[OK]** をクリックし、ツール バーの **[保存]** ボタンをクリックします。 これらの変更を保存すると、コードの [この接続文字列の値を取得を使用することができます [GetConfigurationSettingValue](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.getconfigurationsettingvalue.aspx)します。 Azure にアプリケーションを発行するときに、接続文字列用の Azure ストレージ アカウントを含むサービス構成を選択します。 アプリケーションを発行した後、アプリケーションが Azure Storage サービスに対して期待どおりに動作することを確認します。

## 次のステップ

アプリの発行の詳細についてを Azure に Visual Studio からを参照してください [Azure ツールを使用してクラウド サービスの発行](vs-azure-tools-publishing-a-cloud-service.md)します。





