---
title: Komunikaty, ładunki i serializacja usługi Azure Service Bus | Dokumenty firmy Microsoft
description: Ten artykuł zawiera omówienie komunikatów usługi Azure Service Bus, ładunków, routingu wiadomości i serializacji.
services: service-bus-messaging
documentationcenter: ''
author: axisc
manager: timlt
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/24/2020
ms.author: aschhab
ms.openlocfilehash: 11e56ae2483a254fb00e3593da7841f3f3d844f3
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/27/2020
ms.locfileid: "76759401"
---
# <a name="messages-payloads-and-serialization"></a>Komunikaty, ładunki i serializacja

Usługa Microsoft Azure Service Bus obsługuje wiadomości. Wiadomości zawierają ładunek, a także metadane w postaci właściwości pary klucz-wartość, opisujące ładunek i dając instrukcje obsługi usługi Service Bus i aplikacji. Od czasu do czasu same metadane są wystarczające do przenoszenia informacji, które nadawca chce przekazać odbiorcom, a ładunek pozostaje pusty.

Model obiektu oficjalnych klientów usługi Service Bus dla platformy .NET i Java odzwierciedla abstrakcyjną strukturę komunikatów usługi Service Bus, która jest mapowana do i z protokołów sieciowej obsługiwanych przez usługę Service Bus.
 
Komunikat usługi Service Bus składa się z sekcji ładunku binarnego, która usługa Service Bus nigdy nie obsługuje w żadnej formie po stronie usługi, oraz dwóch zestawów właściwości. *Właściwości brokera* są wstępnie zdefiniowane przez system. Te wstępnie zdefiniowane właściwości albo kontrolować funkcje na poziomie komunikatu wewnątrz brokera lub mapują do wspólnych i standardowych elementów metadanych. *Właściwości użytkownika* są kolekcją par klucz-wartość, które mogą być definiowane i ustawiane przez aplikację.
 
Wstępnie zdefiniowane właściwości brokera są wymienione w poniższej tabeli. Nazwy są używane ze wszystkimi oficjalnymi interfejsami API klienta, a także w [obiekcie BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) JSON mapowania protokołu HTTP.
 
Równoważne nazwy używane na poziomie protokołu AMQP są wymienione w nawiasach. 

| Nazwa właściwości                         | Opis                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (typ zawartości)           | Opcjonalnie opisuje ładunek wiadomości, z deskryptorem zgodnie z formatem RFC2045, sekcja 5; na przykład `application/json`.                                                                                                                                                                                                                                                                                             |
|  [Identyfikator korelacji](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (identyfikator korelacji)       | Umożliwia aplikacji, aby określić kontekst dla wiadomości na potrzeby korelacji; na przykład odzwierciedlając **MessageId** wiadomości, która jest odpowiedzią.                                                                                                                                                                                                                                                                  |
| [Źródło deadlettersource](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Ustawiaj tylko w wiadomościach, które zostały zasysane z błędem, a następnie automatycznie przekazywane z kolejki utraconych wiadomości do innej jednostki. Wskazuje jednostkę, w której wiadomość została utracona. Ta właściwość jest tylko do odczytu.                                                                                                                                                                                                                                  |
| [Licznik dostaw](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Liczba dostaw, które zostały podjęte dla tej wiadomości. Liczba jest zwiększana po wygaśnięciu blokady wiadomości lub wiadomość jest jawnie porzucone przez odbiorcę. Ta właściwość jest tylko do odczytu.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | Dla wiadomości, które zostały automatycznie przekazywane, ta właściwość odzwierciedla numer sekwencyjny, który został po raz pierwszy przypisany do wiadomości w oryginalnym punkcie przesyłania. Ta właściwość jest tylko do odczytu.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | Moment UTC, w którym wiadomość została zaakceptowana i przechowywana w jednostce. Ta wartość może służyć jako miarodajny i neutralny wskaźnik czasu przybycia, gdy odbiorca nie chce ufać zegara nadawcy. Ta właściwość jest tylko do odczytu.                                                                                                                                                                                                   |
|  [ExpiresAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (czas bezwzględnego wygaśnięcia) | Chwila UTC, w którym wiadomość jest oznaczona do usunięcia i nie jest już dostępna do pobrania z jednostki z powodu jej wygaśnięcia. Expiry jest kontrolowana przez **TimeToLive** właściwości i ta właściwość jest obliczany z EnqueuedTimeUtc+TimeToLive. Ta właściwość jest tylko do odczytu.                                                                                                                                                                           |
| [ForcePersistence (Naleganie siłowe)](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | W przypadku kolejek lub tematów, które mają [enableExpress](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) flagi ustawioną, ta właściwość może być ustawiona, aby wskazać, że wiadomość musi być utrwalone na dysku, zanim zostanie potwierdzona. Jest to standardowe zachowanie dla wszystkich jednostek nie ekspresowych.                                                                                                                                                                                                         |
| [Etykieta](/dotnet/api/microsoft.azure.servicebus.message.label) (temat)                       | Ta właściwość umożliwia aplikacji, aby wskazać cel wiadomości do odbiornika w sposób standaryzowany, podobnie jak wiersz tematu wiadomości e-mail.                                                                                                                                                                                                                                                                                  |
| [ZablokowaneUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | Dla wiadomości pobranych w ramach blokady (tryb odbierania blokady wglądu, nie wstępnie rozliczone) ta właściwość odzwierciedla chwilówkę UTC, dopóki wiadomość jest utrzymywana zablokowane w kolejce/subskrypcji. Po wygaśnięciu blokady [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) jest zwiększany i komunikat jest ponownie dostępny do pobrania. Ta właściwość jest tylko do odczytu.                                                                                                                         |
| [BlokadaToken](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | Token blokady jest odwołaniem do blokady, która jest utrzymywana przez brokera w trybie odbierania *zaglądania.* Token może służyć do przypięcia blokady na stałe za pośrednictwem interfejsu API [odroczenia](message-deferral.md) i, w tym, wyjąć komunikat z przepływu stanu dostawy regularnych. Ta właściwość jest tylko do odczytu.                                                                                                                                                               |
| [Identyfikator wiadomości](/dotnet/api/microsoft.azure.servicebus.message.messageid) (identyfikator wiadomości)                | Identyfikator wiadomości jest wartością zdefiniowaną przez aplikację, która jednoznacznie identyfikuje wiadomość i jej ładunek. Identyfikator jest ciągiem swobodnym i może odzwierciedlać identyfikator GUID lub identyfikator pochodzący z kontekstu aplikacji. Jeśli ta opcja jest włączona, funkcja [wykrywania duplikatów](duplicate-detection.md) identyfikuje i usuwa drugie i kolejne przesyłanie wiadomości z tym samym **identyfikatorem messageid**.                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | W przypadku [jednostek podzielonych na partycje](service-bus-partitioning.md)ustawienie tej wartości umożliwia przypisywanie powiązanych wiadomości do tej samej partycji wewnętrznej, dzięki czemu kolejność sekwencji przesyłania jest poprawnie rejestrowana. Partycja jest wybierana przez funkcję mieszania nad tą wartością i nie może być wybrana bezpośrednio. W przypadku jednostek obsługujących sesję **właściwość SessionId** zastępuje tę wartość.                                                                                                       |
| [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (odpowiedź na)                    | Ta opcjonalna i zdefiniowana przez aplikację wartość jest standardowym sposobem wyrażania ścieżki odpowiedzi do odbiorcy wiadomości. Gdy nadawca oczekuje odpowiedzi, ustawia wartość na ścieżkę bezwzględną lub względną kolejki lub tematu, do który oczekuje odpowiedzi.                                                                                                                                           |
| [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (reply-to-group-id)  | Ta wartość zwiększa **replyTo** informacji i określa, które **SessionId** należy ustawić dla odpowiedzi podczas wysyłania do jednostki odpowiedzi.                                                                                                                                                                                                                                                                            |
| [ScheduledEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | Dla wiadomości, które są udostępniane tylko do pobrania po opóźnieniu, ta właściwość definiuje moment UTC, w którym wiadomość będzie logicznie w kolejce, sekwencjonowane i w związku z tym udostępnione do pobrania.                                                                                                                                                                                                                 |
| [Sequencenumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | Numer sekwencyjny jest unikatową 64-bitową liczbą całkowitą przypisaną do wiadomości, ponieważ jest akceptowana i przechowywana przez brokera i funkcjonuje jako jego prawdziwy identyfikator. W przypadku jednostek podzielonych na partycje najwyższej liczby 16 bitów odzwierciedla identyfikator partycji. Numery sekwencji monotonicznie zwiększają się i są bez przerw. Przewracają się do 0, gdy zakres 48-64 bitów jest wyczerpany. Ta właściwość jest tylko do odczytu.                                                                |
| [Identyfikator sesji](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (identyfikator grupy)                  | W przypadku jednostek obsługujących sesję ta wartość zdefiniowana przez aplikację określa przynależność do sesji wiadomości. Wiadomości z tym samym identyfikatorem sesji podlegają blokowaniu podsumowania i umożliwiają dokładne przetwarzanie w kolejności i demuliplexing. Dla jednostek, które nie są obsługujących sesję, ta wartość jest ignorowana.                                                                                                                                     |
| [Rozmiar](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Odzwierciedla przechowywany rozmiar wiadomości w dzienniku brokera jako liczbę bajtów, ponieważ liczy się do przydziału magazynu. Ta właściwość jest tylko do odczytu.                                                                                                                                                                                                                                                                                                       |
| [Stan](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Wskazuje stan komunikatu w dzienniku. Ta właściwość jest istotne tylko podczas przeglądania wiadomości ("wgląd"), aby ustalić, czy wiadomość jest "aktywny" i dostępne do pobrania, jak dociera do górnej części kolejki, czy jest odroczone lub oczekuje na zaplanowane. Ta właściwość jest tylko do odczytu.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Ta wartość jest względny czas trwania, po którym wiadomość wygasa, począwszy od momentu natychmiastowego wiadomość została zaakceptowana i przechowywana przez brokera, jak przechwycone w **EnqueueTimeUtc**. Jeśli nie jest ustawiona jawnie, zakładana wartość jest **DefaultTimeToLive** dla odpowiedniej kolejki lub tematu. Wartość **TimeToLive** na poziomie wiadomości nie może być dłuższa niż ustawienie **DefaultTimeToLive** jednostki. Jeśli jest dłuższy, jest po cichu regulowany. |
| [Do](/dotnet/api/microsoft.azure.servicebus.message.to) (do)                               | Ta właściwość jest zarezerwowana do wykorzystania w przyszłości w scenariuszach routingu i obecnie ignorowana przez samego brokera. Aplikacje mogą używać tej wartości w scenariuszach tworzenia łańcucha opartego na regułach do przodu, aby wskazać zamierzone logiczne miejsce docelowe wiadomości.                                                                                                                                                                                   |
| [ViaPartitionKey (Klucz ViaPartitionKey)](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Jeśli wiadomość jest wysyłana za pośrednictwem kolejki transferu w zakresie transakcji, ta wartość wybiera partycję kolejki transferu.                                                                                                                                                                                                                                                                                                                 |

Abstrakcyjny model wiadomości umożliwia wiadomość, która ma zostać wysłana do kolejki za pośrednictwem protokołu HTTP (w rzeczywistości zawsze HTTPS) i może być pobierana za pośrednictwem protokołu AMQP. W obu przypadkach wiadomość wygląda normalnie w kontekście odpowiedniego protokołu. Właściwości brokera są tłumaczone w razie potrzeby, a właściwości użytkownika są mapowane do najbardziej odpowiedniej lokalizacji w odpowiednim modelu komunikatu protokołu. W http, właściwości użytkownika mapowane bezpośrednio do i z nagłówków HTTP; w AMQP mapują do i z mapy **właściwości aplikacji.**

## <a name="message-routing-and-correlation"></a>Routing i korelacja wiadomości

Podzbiór właściwości brokera opisanych wcześniej, w szczególności [Do](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid), [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid)i [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid), są używane do pomocy aplikacji kierowania wiadomości do określonych miejsc docelowych. Aby to zilustrować, należy wziąć pod uwagę kilka wzorców:

- **Proste żądanie/odpowiedź:** wydawca wysyła wiadomość do kolejki i oczekuje odpowiedzi od konsumenta wiadomości. Aby otrzymać odpowiedź, wydawca jest właścicielem kolejki, do której oczekuje, że odpowiedzi zostaną dostarczone. Adres tej kolejki jest wyrażona w **ReplyTo** właściwości wiadomości wychodzącej. Gdy konsument odpowiada, kopiuje **MessageId** obsługiwanej wiadomości do **CorrelationId** właściwości wiadomości odpowiedzi i dostarcza wiadomość do miejsca docelowego wskazanego przez **ReplyTo** właściwości. Jedna wiadomość może przynieść wiele odpowiedzi, w zależności od kontekstu aplikacji.
- **Żądanie/odpowiedź multiemisji:** Jako odmiana poprzedniego wzorca wydawca wysyła wiadomość do tematu, a wielu subskrybentów kwalifikuje się do korzystania z wiadomości. Każdy z subskrybentów może odpowiedzieć w sposób opisany wcześniej. Ten wzorzec jest używany w scenariuszach odnajdywania lub wywołania rolowego, a respondent zazwyczaj identyfikuje się z właściwością użytkownika lub wewnątrz ładunku. Jeśli **ReplyTo** wskazuje na temat, taki zestaw odpowiedzi odnajdywania mogą być dystrybuowane do odbiorców.
- **Multipleksowanie:** Ta funkcja sesji umożliwia multipleksowanie strumieni powiązanych wiadomości za pośrednictwem jednej kolejki lub subskrypcji, tak aby każda sesja (lub grupa) powiązanych wiadomości, identyfikowana przez pasujące wartości **SessionId,** była kierowana do określonego odbiorcy, podczas gdy odbiorca przechowuje sesję w blokadzie. Przeczytaj więcej o szczegółach sesji [tutaj](message-sessions.md).
- **Multipleksowane żądanie/odpowiedź:** Ta funkcja sesji umożliwia multipleksowane odpowiedzi, umożliwiając kilku wydawcom udostępnianie kolejki odpowiedzi. Ustawiając **ReplyToSessionId,** wydawca może poinstruować konsumenta(ów) skopiować tę wartość do **SessionId** właściwości wiadomości odpowiedzi. Kolejka publikowania lub temat nie musi być obsługujących sesję. W miarę wysyłania wiadomości wydawca może w szczególności czekać na sesję z podanym **identyfikatorem SessionId,** aby zmaterializować się w kolejce, warunkowo akceptując odbiornik sesji. 

Routing wewnątrz obszaru nazw usługi Service Bus można zrealizować przy użyciu reguł tworzenia łańcucha do przodu i subskrypcji tematów. Routing między obszarami nazw można realizować [za pomocą usługi Azure LogicApps.](https://azure.microsoft.com/services/logic-apps/) Jak wskazano w poprzedniej liście, **Do** właściwość jest zarezerwowana do użytku w przyszłości i może ostatecznie być interpretowana przez brokera ze specjalnie włączoną funkcją. Aplikacje, które chcą zaimplementować routingu należy to zrobić na podstawie właściwości użytkownika i nie opierać się na **Do** właściwości; jednak teraz nie spowoduje to problemów ze zgodnością.

## <a name="payload-serialization"></a>Serializacja ładunku

Podczas przesyłania lub przechowywane wewnątrz usługi Service Bus, ładunek jest zawsze nieprzezroczyste, blok binarny. [Właściwość ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) umożliwia aplikacjom opisanie ładunku, przy czym sugerowany format wartości właściwości jest opisem zawartości MIME zgodnie z IETF RFC2045; na przykład `application/json;charset=utf-8`.

W przeciwieństwie do wariantów Java lub .NET Standard wersja .NET Framework interfejsu API usługi Service Bus obsługuje tworzenie **wystąpień BrokeredMessage** przez przekazywanie dowolnych obiektów .NET do konstruktora. 

Podczas korzystania ze starszego protokołu SBMP obiekty te są następnie serializowane z domyślnym serializatorem binarnym lub z serializatorem, który jest dostarczany zewnętrznie. Podczas korzystania z protokołu AMQP obiekt jest serializowany do obiektu AMQP. Odbiornik może pobrać te obiekty za pomocą [Metody GetBody\<T>(),](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) podając oczekiwany typ. Z AMQP, obiekty są serializowane do wykresu AMQP **ArrayList** i **IDictionary<string,obiekt>** obiektów, a każdy klient USŁUGI AMQP można je dekodować. 

Chociaż ta ukryta magia serializacji jest wygodna, aplikacje powinny przejąć wyraźną kontrolę nad serializacją obiektów i przekształcić wykresy obiektów w strumienie przed włączeniem ich do wiadomości i wykonać odwrotną stronę odbiornika. Daje to interoperacyjne wyniki. Należy również zauważyć, że podczas gdy AMQP ma potężny model kodowania binarnego, jest powiązany z ekosystemem obsługi wiadomości AMQP, a klienci HTTP będą mieli problemy z dekodowaniem takich ładunków. 

Ogólnie zalecamy JSON i Apache Avro jako formaty ładunku dla danych strukturalnych.

Warianty interfejsu API .NET Standard i Java akceptują tylko tablice bajtowe, co oznacza, że aplikacja musi obsługiwać kontrolę serializacji obiektów. 

## <a name="next-steps"></a>Następne kroki

Aby dowiedzieć się więcej o wiadomościach usługi Service Bus, zobacz następujące tematy:

* [Kolejki, tematy i subskrypcje usługi Service Bus](service-bus-queues-topics-subscriptions.md)
* [Wprowadzenie do kolejek usługi Service Bus](service-bus-dotnet-get-started-with-queues.md)
* [Jak używać tematów i subskrypcji usługi Service Bus](service-bus-dotnet-how-to-use-topics-subscriptions.md)
