<properties
    pageTitle="Eclipse での Azure アプリケーションのデバッグ"
    description="Azure Toolkit for Eclipse を使用する Azure アプリケーションのデバッグについて説明します。"
    services=""
    documentationCenter="java"
    authors="rmcmurray"
    manager="wpickett"
    editor=""/>

<tags
    ms.service="multiple"
    ms.workload="na"
    ms.tgt_pltfrm="multiple"
    ms.devlang="Java"
    ms.topic="article"
    ms.date="11/30/2015" 
    ms.author="robmcm"/>

<!-- Legacy MSDN URL = https://msdn.microsoft.com/library/azure/hh690949.aspx -->

# Eclipse での Azure アプリケーションのデバッグ #

Azure Toolkit for Eclipse を使用すると、Azure で実行しているアプリケーションでも、オペレーティング システムとして Windows を使用している場合はコンピューティング エミュレーター内のアプリケーションでも、デバッグできます。 次の図は、 **デバッグ** プロパティ] ダイアログ ボックスのリモート デバッグを有効にするために使用します。

![][ic719504]

このチュートリアルでは、アプリケーションが正常に作成されていて、コンピューティング エミュレーターおよび Azure へのデプロイを理解しているものとします。

アプリケーションを使用して、 [JSP で Azure サービス ランタイム ライブラリを使用して][] 」チュートリアルでは、このトピックの開始点です。 アプリケーションをまだ作成していない場合は、先に進む前に作成してください。

## Azure で実行しながらアプリケーションをデバッグするには ##

>[AZURE.WARNING] リモート Java デバッグ ツールキットの現在のサポートは、Azure コンピューティング エミュレーターで実行中のデプロイメントの主な目的としています。 デバッグ接続はセキュリティで保護されていないため、運用環境のデプロイメントではリモート デバッグを有効にしないでください。 Azure クラウドで実行しているアプリケーションをデバッグする必要がある場合は、ステージング デプロイメントを使用します。ただし、ステージング デプロイメントであっても、クラウド デプロイメントの IP アドレスがわかると、デバッグ セッションに不正アクセスできることを理解しておいてください。

1. エミュレーターでテストするためにプロジェクトをビルド: Eclipse の Project Explorer で、右クリック **MyAzureProject**, 、] をクリックして **プロパティ**, 、] をクリックして **Azure**, 、設定と **向けの構築** に **クラウドへのデプロイ**します。
1. プロジェクトをリビルド: Eclipse のメニューをクリックして **プロジェクト**, 、] をクリックし、 **すべてビルド**します。
1. アプリケーションをデプロイする *ステージング* azure です。
    >[AZURE.IMPORTANT] 前述のように、ほとんどの場合、コンピューティング エミュレーターでデバッグし、他のデバッグが必要な場合にのみ、ステージング環境でデバッグすることを強くお勧めします。 運用環境ではデバッグしないことをお勧めします。
1. デプロイの DNS 名を取得、配置の Azure の準備が、 [Azure 管理ポータル][]します。 ステージング デプロイの http://の形式で DNS 名*& lt; guid & gt;*します。.cloudapp.net、 *& lt; guid & gt;* Azure によって割り当てられる GUID 値は、です。
1. Eclipse の Project Explorer で、右クリック **WorkerRole1**, 、クリックして **Azure**, 、] をクリックし、 **デバッグ**します。
1.  **WorkerRole1 デバッグのプロパティ** ダイアログ。
    1. 確認 **このロールのリモート デバッグを有効にします。**
    1.  **を使用する入力エンドポイント**, を使用して **デバッグ (パブリック: 8090、プライベート: 8090)**します。
    1. 確認 **開始 JVM を中断モードで、デバッガーの接続を待機している** がオフになっています。
        >[AZURE.IMPORTANT]  **開始 JVM を中断モードで、デバッガーの接続を待機している** デバッグ シナリオのみ、コンピューティング エミュレーターで高度なオプションが適しています (クラウド デプロイ) 用ではありません。 場合、 **開始 JVM を中断モードで、デバッガーの接続を待機している** オプションを使用すると、Eclipse デバッガーが JVM に接続されるまで、サーバーの起動プロセスは中断されます。 コンピューティング エミュレーターを使用するデバッグ セッションにこのオプションを使用している間は、クラウド デプロイメントでのデバッグ セッションに使用しないでください。 Azure のスタートアップ タスクでサーバーの初期化が行われ、スタートアップ タスクが完了するまで、Azure クラウドはパブリック エンドポイントを利用できるようにしません。 したがって、クラウド デプロイメントでこのオプションを有効にした場合、外部 Eclipse クライアントからの接続を受けられないため、スタートアップ プロセスが正常に完了しません。
    1.クリックして **デバッグ構成の作成**します。
1.  **Azure デバッグ構成** ダイアログ。
    1.  **デバッグする Java プロジェクト**, を選択、 **MyHelloWorld** プロジェクトです。
    1.  **デバッグ構成の対象**, 、確認 **Azure クラウド (ステージング)**します。
    1. ように **Azure コンピューティング エミュレーター** がオフになっています。
    1.  **ホスト**, 、上記のことがなく、段階的な展開の DNS 名を入力 **http://**します。 たとえば (ここに示す GUID の代わりに、GUID を使用): **4e616d65 6f6e-6 d 65 6973 526f62657274.cloudapp.net**
1. をクリックして **OK** を閉じる、 **Azure デバッグ構成** ダイアログ。
1. をクリックして **OK** を閉じる、 **WorkerRole1 デバッグのプロパティ** ダイアログ。
1. index.jsp でブレークポイントをまだ設定していない場合は、設定します。
    1. Eclipse のプロジェクト エクスプ ローラーで、[ **MyHelloWorld**, 、展開 **WebContent**, をダブルクリックして **index.jsp**します。
    1. Index.jsp で Java コードの左側にある青いバー内を右クリックし、をクリックして **ブレークポイントの切り替え**, 、次に示すように。
        ![][ic551537]
1. Eclipse のメニュー内でクリックして **実行** ] をクリックし、 **デバッグ構成**します。
1.  **デバッグ構成** ダイアログ ボックスで、展開 **リモート Java アプリケーション** 左側のウィンドウで [ **Azure クラウド (WorkerRole1)**, 、] をクリック **デバッグ**します。
1. ブラウザー内で、ステージングされたアプリケーションを実行 **http://***& lt; guid & gt;***.cloudapp.net/MyHelloWorld**, 、DNS 名の GUID に置き換えて *& lt; guid (& a) gt;*します。 によってメッセージが表示されたら、 **パースペクティブ スイッチの確認** ダイアログ ボックスで、をクリックして **はい**します。 ブレークポイントを設定したコード行まで、デバッグ セッションが実行されます。

>[AZURE.NOTE] リモートを起動しようとしている場合を複数のロール インスタンスが実行されている、現在は制御できません対象のインスタンスを持つ展開への接続をデバッグ、デバッガーは最初に接続する、ように、Azure ロード バランサーは、インスタンスをランダムに選択されます。 そのインスタンスに接続されても、同じインスタンスのデバッグを続けます。 また、非アクティブな期間が 4 分を超えると (たとえば、ブレークポイントでの停止時間が長すぎた場合)、Azure が接続を閉じる場合があることにも注意してください。

## 複数インスタンス デプロイメントでの特定のロール インスタンスのデバッグ ##

デプロイメントをクラウドで実行する場合、ほとんどは複数のコンピューティング インスタンス (つまり、ロール インスタンス) で実行します。 これにより、Azure の 99.95% 可用性保証を利用でき、アプリケーションをスケールアウトできます。

このようなシナリオでは、特定のロール インスタンスの Java アプリケーションをリモート デバッグすることが必要になる場合があります。 ただし、標準の入力エンドポイントのみでデバッグを有効にした場合、Azure ロード バランサーにより、ユーザーが特定のロール インスタンスにデバッガーを接続することはほぼ不可能になります。 代わりに、ロード バランサーによってランダムに選択されたロール インスタンスに接続されます。

この種のシナリオでは、インスタンスの入力エンドポイントを利用すると、特定のロール インスタンスのデバッグが容易になります。

たとえば、デプロイメントの最大 5 つのロール インスタンスを実行するとします。 使用して、 **エンドポイント** ロール プロパティ ダイアログ ボックスで、プロパティ ページは、インスタンス入力エンドポイントを作成し、単一のポート番号ではなく、パブリック ポートの範囲を割り当てます。 たとえば、 **パブリック ポート** 入力ボックスで、指定 **81-85**します。

このインスタンス エンドポイントでアプリケーションをデプロイすると、Azure はこの範囲から一意のポート番号を各ロール インスタンスに割り当てます。 次に、対象のインスタンスには、どのポート番号が割り当てられてについては、使用する、 *InstanceEndpointName***_PUBLICPORT** 環境変数 (ここで *InstanceEndpointName* インスタンス エンドポイントを作成したときに割り当てた名前を指定します) (たとえばを参照するときに参照する可能性がありますので、web ページのフッター内の値を返す)、展開、toolkit によって自動的に構成されています。

インスタンスに割り当てられたパブリック ポート番号がわかったら、サービスのホスト名にそれを付加することによって、Eclipse のデバッグ構成で参照できます。 これにより、Eclipse デバッガーは、他のインスタンスではなく、その特定のインスタンスに接続できます。

## Windows のみ: コンピューティング エミュレーターで実行中のアプリケーションをデバッグするには ##

>[AZURE.NOTE] Azure エミュレーターは Windows でのみ使用できます。 Windows 以外のオペレーティング システムをご利用の場合、このセクションはスキップしてください。 

1. エミュレーターでテストするためにプロジェクトをビルド: Eclipse の Project Explorer で、右クリック **MyAzureProject**, 、] をクリックして **プロパティ**, 、] をクリックして **Azure**, 、設定と **向けの構築** に **エミュレーターでテスト**します。
1. プロジェクトをリビルド: Eclipse のメニューをクリックして **プロジェクト**, 、] をクリックし、 **すべてビルド**します。
1. Eclipse の Project Explorer で、右クリック **WorkerRole1**, 、クリックして **Azure**, 、] をクリックし、 **デバッグ**します。
1.  **WorkerRole1 デバッグのプロパティ** ダイアログ。
    1. 確認 **このロールのリモート デバッグを有効にします。**
    1.  **を使用する入力エンドポイント**, 、として一覧表示、toolkit によって自動的に生成する既定のエンドポイントを使用して **デバッグ (パブリック: 8090、プライベート: 8090)**します。
    1. 確認、 **開始 JVM を中断モードで、デバッガーの接続を待機している** オプションがオフになっています。
        >[AZURE.IMPORTANT]  **開始 JVM を中断モードで、デバッガーの接続を待機している** デバッグ シナリオのみ、コンピューティング エミュレーターで高度なオプションが適しています (クラウド デプロイ) 用ではありません。 場合、 **開始 JVM を中断モードで、デバッガーの接続を待機している** オプションを使用すると、Eclipse デバッガーが JVM に接続されるまで、サーバーの起動プロセスは中断されます。 コンピューティング エミュレーターを使用するデバッグ セッションにこのオプションを使用している間は、クラウド デプロイメントでのデバッグ セッションに使用しないでください。 Azure のスタートアップ タスクでサーバーの初期化が行われ、スタートアップ タスクが完了するまで、Azure クラウドはパブリック エンドポイントを利用できるようにしません。 したがって、クラウド デプロイメントでこのオプションを有効にした場合、外部 Eclipse クライアントからの接続を受けられないため、スタートアップ プロセスが正常に完了しません。
    1.クリックして **デバッグ構成の作成**します。
1.  **Azure デバッグ構成** ダイアログ。
    1.  **デバッグする Java プロジェクト**, を選択、 **MyHelloWorld** プロジェクトです。
    1.  **デバッグ構成の対象**, 、確認 **Azure コンピューティング エミュレーター**します。
1. をクリックして **OK** を閉じる、 **Azure デバッグ構成** ダイアログ。
1. をクリックして **OK** を閉じる、 **WorkerRole1 デバッグのプロパティ** ダイアログ。
1. index.jsp でブレークポイントを設定します。
    1. Eclipse のプロジェクト エクスプ ローラーで、[ **MyHelloWorld**, 、展開 **WebContent**, をダブルクリックして **index.jsp**します。
    1. Index.jsp で Java コードの左側にある青いバー内を右クリックし、をクリックして **ブレークポイントの切り替え**, 、次に示すように。
        ![][ic551537]
       Java コードの左側にある青いバー内でブレークポイント アイコンが表示する場合は、ブレークポイントを設定します。
1. クリックして、コンピューティング エミュレーターでアプリケーションを開始、 **Run in Azure Emulator** Azure ツールバーのボタンをクリックします。
1. Eclipse のメニュー内でクリックして **実行** ] をクリックし、 **デバッグ構成**します。
1.  **デバッグ構成** ダイアログ ボックスで、展開 **リモート Java アプリケーション** 左側のウィンドウで [ **Azure エミュレーター (WorkerRole1)**, 、] をクリック **デバッグ**します。
1. コンピューティング エミュレーターは、ブラウザー内で、アプリケーションを実行することを示す実行 **Http://localhost:8080/myhelloworld**します。
    によってメッセージが表示されたら、 **パースペクティブ スイッチの確認** ダイアログ ボックスで、をクリックして **はい**します。
    ブレークポイントを設定したコード行まで、デバッグ セッションが実行されます。

ここまでは、コンピューティング エミュレーターでのデバッグ方法を示しました。次のセクションでは、Azure にデプロイしたアプリケーションのデバッグ方法を示します。

## デバッグに関する注意事項 ##

* デバッグするには後からパースペクティブを切り替えることができます **デバッグ** に **Java** をクリックして、Eclipse のメニューをクリックするとを介して **ウィンドウ**, 、**パースペクティブを開く**, を使用するパースペクティブを選択します。
* GlassFish でリモート デバッグを有効にする場合は、Azure Toolkit for Eclipse のリモート デバッグ構成機能を使用しないでください。 代わりに、GlassFish を手動で構成します。 環境変数で定義済みの Java オプションを GlassFish が処理する方法により、Toolkit のリモート デバッグ構成機能は GlassFish では正しく動作しません。 Toolkit のリモート デバッグ構成機能が有効な場合、GlassFish が起動しない可能性があります。

## 関連項目 ##

[Azure Toolkit for Eclipse][]

[Azure 向け Hello World アプリケーションを Eclipse で作成する][]

[Azure Toolkit for Eclipse のインストール][] 

Java で Azure を使用する方法の詳細については、次を参照してください。、 [Azure Java デベロッパー センター][]します。

<!-- URL List -->

[Azure Java Developer Center]: http://go.microsoft.com/fwlink/?LinkID=699547
[Azure Management Portal]: http://go.microsoft.com/fwlink/?LinkID=512959
[Azure Toolkit for Eclipse]: http://go.microsoft.com/fwlink/?LinkID=699529
[Creating a Hello World Application for Azure in Eclipse]: http://go.microsoft.com/fwlink/?LinkID=699533
[Installing the Azure Toolkit for Eclipse]: http://go.microsoft.com/fwlink/?LinkId=699546
[Using the Azure Service Runtime Library in JSP]: http://go.microsoft.com/fwlink/?LinkID=699551

<!-- IMG List -->

[ic719504]: ./media/azure-toolkit-for-eclipse-debugging-azure-applications/ic719504.png
[ic551537]: ./media/azure-toolkit-for-eclipse-debugging-azure-applications/ic551537.png

