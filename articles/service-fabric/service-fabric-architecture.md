<properties
   pageTitle="Service Fabric のアーキテクチャ"
   description="Service Fabric とは、スケーラブルで信頼性が高く管理しやすいクラウド向けアプリケーションの構築に使用される分散型システム プラットフォームです。この記事は、Service Fabric のアーキテクチャを説明しています。"
   services="service-fabric"
   documentationCenter=".net"
   authors="rishirsinha"
   manager="timlt"
   editor="rishirsinha"/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="08/26/2015"
   ms.author="rsinha"/>


# Service Fabric のアーキテクチャ

Service Fabric は、他のプラットフォームと同様、多くのサブシステムによって構築されています。 これらのサブシステムが一まとまりに階層化されているため、アプリケーション開発者は Service Fabric で次のようなアプリケーションを作成できます。

* 可用性が高く、
* 拡張性が高く、
* 管理が容易で、
* テストが容易なアプリケーションです。

次の図は、Service Fabric のアーキテクチャと主要なサブシステムを示しています。

![](media/service-fabric-architecture/service-fabric-architecture.png)

分散システムの場合は、異なるノード間で安全に通信する機能が不可欠です。 最下層に、トランスポート サブシステムがあり、これにより異なるノード間で安全に通信する機能が提供されています。 トランスポート サブシステムの上に、フェデレーション サブシステムがあります。これは、さまざまなノードを 1 つのエンティティ (クラスター) にクラスター化し、これによりエラーの検出、リーダー選定の実行、およびルーティングをシステムが一貫して実行できるようにしています。 フェデレーション サブシステムの上層にある信頼性サブシステムは、Service Fabric のサービスの高い信頼性を、レプリケーション、リソース管理、およびフェールオーバー管理などのメカニズムを通じて管理しています。 フェデレーション サブシステムは、1 つのノード上のアプリケーションのライフサイクルを管理するホスティング サブシステムの基になります。 クラスター管理サブシステムは、アプリケーションとサービスの複数のコンピューターのライフサイクルを管理します。 テスト容易性サブシステムを使用すると、アプリケーション開発者は、アプリケーションやサービスを運用環境にデプロイする前に、エラーのシミュレーションによってサービスをテストすることができます。 Service Fabric では、通信サブシステムにより、サービスの場所を解決する機能も提供します。 開発者に公開されているアプリケーション プログラミング モデルは、これらのサブシステムの最上部の階層に配置されています。

## トランスポート サブシステム

トランスポート サブシステムには、ポイント ツー ポイントのデータグラム通信チャネルが実装されています。 このチャネルは、サービス ファブリック クラスター内の通信やサービス ファブリック クラスターとクライアント間の通信に使用されます。 一方向通信パターンと要求/応答通信パターンがサポートされており、これによってブロードキャストおよびマルチキャストを上位層に実装するための基盤が提供されています。 トランスポート サブシステムは、X509 証明書または Windows セキュリティを使用して通信を保護します。 このサブシステムは、Service Fabric によって内部的に使用されるもので、アプリケーション プログラミングの開発者は直接アクセスできません。

## フェデレーション サブシステム

分散システムのノードのセットを論理的に判断するには、一貫性のあるシステム観が必要です。 フェデレーション サブシステムは、トランスポートのサブシステムによって提供される通信プリミティブを使用し、さまざまなノードを論理的な判断が可能な 1 つの統一されたシステムに合成します。 これは、エラー検出、リーダー選定、および一貫性のあるルーティングなど、他のサブシステムで必要な分散システムのプリミティブを提供します。 フェデレーション サブシステムは、128 ビットのトークン領域を持つ分散ハッシュ テーブルの最上部にビルドされ、ノードに対するリング型トポロジを作成して、リングの各ノードに所有権のトークン領域のサブセットが割り当てられるようにします。 エラー検出のため、レイヤーはハート ビートと調停に基づく、リース メカニズムを使用します。 フェデレーション サブシステムは、複雑な結合と出発プロトコルにより、1 つのトークンに 1 人の所有者だけが常に存在するようにします。 これにより、リーダー選定と一貫性のあるルーティングの保証を提供できます。

## 信頼性サブシステム

信頼性サブシステムは、Service Fabric サービスの状態を使用する高可用性にする、 _レプリケーター_, 、_failover manager_ と _resource balancer_ します。

* レプリケーターは、プライマリ サービス レプリカの状態が変わると自動的にセカンダリ レプリカをレプリケートし、サービス レプリカ セット内のプライマリ レプリカとセカンダリ レプリカの一貫性が維持されるようにします。 レプリケーターは、レプリカ セット内のレプリカ間のクォーラム管理を担当します。 レプリケーターは、フェールオーバー ユニットとの対話処理によって、レプリケートする操作の一覧を取得します。Reconfiguration Agent (RA) は、どのレプリカに対して操作がレプリケートされる必要があるかを示すレプリカ セットの構成をレプリケーターに提供します。 Service Fabric は、Fabric Replicator と呼ばれる既定のレプリケーターを提供しており、サービス開発者はこれを使用して、サービス状態の高可用性と信頼性を実現できます。
* Failover Manager は、ノードがクラスターに追加されたり、クラスターから削除されたりすると、使用可能なノード間で負荷を自動的に再配分します。 クラスターのノードでエラーが発生した場合、クラスターは自動的にサービス レプリカを構成し、可用性が失われないようにします。
* リソース バランサーは、クラスター内の障害ドメイン全体にサービス レプリカを配置し、すべてのフェールオーバー ユニットの動作を保証します。 さらに、リソース バランサーは、基になるクラスター ノードの共有プール間でサービスのリソース バランス調整をし、最適な一様負荷分散を実現します。

## 管理サブシステム

管理サブシステムは、エンド ツー エンド サービス、およびアプリケーション ライフサイクルを管理します。 PowerShell コマンドレットと管理 API により、アプリケーションのプロビジョニング、デプロイ、パッチ、アップグレード、およびプロビジョニング解除が、可用性を失うことなく実現できます。 管理サブシステムは、次のサービスを使用してこれを実行します。

* クラスター マネージャー - これは、信頼性から Failover Manager との対話処理により、サービス配置に関する制約に基づいてさまざまなノードによりアプリケーションを配置するプライマリ サービスです。 フェールオーバーのリソース バランサーは、制約が破られていないことを確認します。 クラスター マネージャーは、プロビジョニングからプロビジョニング解除までの、アプリケーションのライフサイクルを管理します。 これは、次の手順で説明されているヘルス マネージャーと統合して、アプリケーションの可用性が、アップグレード中にセマンティック正常性パースペクティブから失われないようにします。
* ヘルス マネージャー - このサービスにより、アプリケーションやサービスの正常性監視、およびクラスター エンティティが可能になります。 クラスター エンティティ (ノード、サービス パーティション、レプリカなど) が正常性の情報をレポートし、集中型正常性ストアに集計されます。 この正常性の情報は、クラスター内の複数のノード間で分散されるサービスやノードの特定時点での正常性スナップショットを提供するもので、これにより、必要な修正操作を実行することが可能になります。 正常性クエリ API では、正常性サブシステムにレポートされた正常性イベントに対してクエリを実行できます。 正常性クエリ API は、正常性ストアに格納されている生の正常性データを返すか、特定のクラスター エンティティの集計解釈正常性データを返します。
* イメージ ストア - このサービスは、アプリケーション バイナリのストレージと配布を可能にします。 このサービスでは、アプリケーションのアップロード先およびダウンロード元となる単純な分散ファイル ストアを提供します。


## ホスティング サブシステム

クラスター マネージャーは、ホスティング サブシステム (各ノードで実行している) に対して、特定のノードで管理が必要なサービスを通知します。 ホスティング サブシステムは、そのノード上のアプリケーションのライフサイクルを管理します。 これは、信頼性コンポーネントおよび正常性コンポーネントと対話し、レプリカが適切に配置されて正常な状態にあることを確認します。

## 通信サブシステム

このサブシステムは、ネーム サービスを介して、クラスター検索やサービス検索内での信頼できるメッセージ処理を提供します。 ネーム サービスは、サービス名を解決してクラスター内の場所に対応付けて、ユーザーによるサービス名とプロパティの管理を可能にします。 ネーム サービスを使用することにより、クライアントはクラスター内の任意のノードと安全に通信して、サービス名を解決し、サービス メタデータを取得できます。 Service Fabric のユーザーは、単純な名前付けクライアント API を使用して、ノードのダイナミズムやクラスター サイズに関係なく、現在のネットワークの場所を解決する能力のあるサービスおよびクライアントを開発できます。

## テスト容易性サブシステム

テストの容易性とは、Service Fabric で構築されたサービスをテスト用に設計されたツール スイートです。 このツールを使用すると、開発者は検証意義のあるエラーを容易に誘発してテスト シナリオを実行することができ、サービスがその有効期間内に直面する可能性のあるさまざまな状態と遷移を、完全に管理下にある安全な方法で、試行および検証することが可能です。 テスト容易性により、予測されるさまざまなエラーを繰り返す長期実行テストを、可用性を失うことなく実行するメカニズムがユーザーに提供され、運用環境でのテストが可能です。






