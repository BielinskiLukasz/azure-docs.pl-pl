<properties
    pageTitle="Azure Search 開発の一般的ワークフロー | Microsoft Azure | ホステッド クラウド検索サービス"
    description="ホステッド クラウド検索サービスである Azure Search と統合されるプロトタイプと運用アプリケーションを構築するためのワークフローまたはロードマップ"
    services="search"
    documentationCenter=""
    authors="HeidiSteen"
    manager="mblythe"
    editor=""/>

<tags
    ms.service="search"
    ms.devlang="rest-api"
    ms.workload="search"
    ms.topic="get-started-article"
    ms.tgt_pltfrm="na"
    ms.date="11/04/2015"
    ms.author="heidist"/>


# Azure Search 開発の一般的ワークフロー

この記事は、カスタム アプリケーションに検索機能を実装するためのコンポーネントとして、ホステッド クラウド検索サービスである Azure Search を追加するためのロードマップです。 予備調査するのか、すぐに始めるのかにもよりますが、Azure Search をカスタム開発プロジェクトに統合する方法に関する準備的ガイダンスが必要になります。

次のセクションでは、Azure Search がアプリケーションの検索要件を満たすかどうかを評価する際に役立つ、最初のプロトタイプの一般的なワークフローを紹介します。 この記事の後半では、より重大なアプリケーション開発作業を考慮する、設計上の重要な決定について取り上げます。

または、次の入門チュートリアルのいずれかでランプアップ プロトタイプの作成を開始する前にお勧め [1 時間の詳細なプレゼンテーション動画](http://azure.microsoft.com/documentation/videos/tech-ed-europe-2014-azure-search-deep-dive/)します。 開始のチュートリアルは、これらの言語で提供される: [.NET](search-get-started-dotnet.md), 、[Java](search-get-started-java.md), 、[Node.JS](search-get-started-nodejs.md)します。

## プロトタイプの開発

プロトタイプの開発を成功させるには、このセクションの手順が一般的に利用されます。 サービスをプロビジョニングし、インデックスのスキーマを定義し、ドキュメントと共にインデックスを読み込み、インデックスのクエリを実行します。

揮発性データを含むアプリケーションの場合 (たとえば、通常、インベントリまたはコンテンツが急に変わる場合)、ドキュメントを更新するためのコンポーネントもプロトタイプに含める必要があります。

   ![][1]

### 手順 1: サービスをプロビジョニングする

Azure Search は Azure サブスクリプションで利用できる完全管理オンライン サービスです。 [Azure にサインアップした後](http://azure.microsoft.com/pricing/free-trial/), を簡単に検索サービスを追加します。 参照してください [ポータルで Search サービスの作成](search-create-service-portal.md) については、サブスクリプションに Search サービスを追加する方法です。

2 つの価格レベルから選択できます。 プロトタイプの作成には Shared (Free) サービスをお勧めします。注意点として、扱うデータの量が限られます。 既存の会員様 (試用版または通常の会員) は共有サービスを無料で利用し、短時間で設定できます。ただし、使用できるインデックスとドキュメントの数に制約があり、3 つのインデックス、インデックスごとに最大 10,000 ドキュメント、50 MB のストレージ合計のいずれかに到達した時点で上限となります。

### 手順 2: インデックスを作成する

サービスを作成したら、インデックスの作成を開始できます。スキーマの定義から始めます。

インデックスを作成する最も迅速かつ簡単な方法は Azure クラシック ポータルを利用することです。 少なくとも、各ドキュメントに一意のキーを含め、検索可能データが含まれるフィールドを 1 つ以上含める必要があります。 最初に、次を参照してください。 [、ポータルでインデックスの作成](search-create-index-portal.md)します。
> [AZURE.NOTE] Azure Search インデックス内
>
> *インデックス*とは整理された固定データであり、後続のすべての検索操作の*検索コーパス*として機能します。 検索コーパスは Search サービス サブスクリプションの一部としてクラウドに保存されます。それにより、一貫性のある検索操作をすばやく実行できます。 検索用語では、検索コーパスの項目は「*ドキュメント*」と呼ばれています。すべてのドキュメントの合計は*ドキュメント コレクション*です。
>
>*インデックス スキーマ*は、ドキュメント内のすべてのフィールドを名前別、データ型別、検索可能性、フィルタリング可能性、ファセット可能性を示す属性別に定義するものです。
>
> ドキュメントの構造に加え、インデックス スキーマはスコアリング プロファイルも指定します。これは検索スコアを押し上げる基準と、オートコンプリート クエリ (サジェスター) とドメイン間クエリ要求の CORS を可能にする構成設定を提供します。 *プロトタイプに関しては、最初にドキュメントのフィールドだけを指定することをお勧めします。*その後、他の機能を徐々に追加します (後で追加できる機能の一覧については手順 5 を参照してください)。  
>
> 実世界の例に当てはめ、電子商取引での利用を考えます。 検索インデックスにはアプリケーションで検索可能なすべての製品またはサービス (検索結果で返されるあらゆるもの) を含めます。 ドキュメントは SKU ごとに 1 つとなります。 各ドキュメントには製品名、ブランド、サイズ、価格、色、さらには検索結果内で返す画像やその他のリソースの参照を含めます。

### 手順 3: ドキュメントを読み込む

Azure Search にインデックスを保存したら、次の手順として、インデックスにドキュメントを入力します。 この手順では、データがアップロードされ、分析され、トークン化され、検索ワークロードのために設計されたデータ構造 (逆インデックスなど) に保存されます。

インデックスにアップロードするデータは前の手順で定義したスキーマに準拠する必要があります。 ドキュメント データはフィールドごとにキー/値のペアとして JSON 形式で表されます。 スキーマで ID (キー) フィールド、名前フィールド、番号フィールド、URL フィールド (外部イメージが検索結果に含まれる場合) が指定される場合、インデックスに入力するすべてのドキュメントにフィールド別の値 (null) を与える必要があります。

ドキュメントはいくつかの方法で読み込めますが、現在のところ、そのすべてにおいて API が必要となります。 ほとんどのプロトタイプの場合、コーディング要件に起因し、この手順が最も時間がかかります。 オプションは、この記事の後半で説明します。
> [AZURE.NOTE] Shared サービスの場合、インデックスごとに 10,000 ドキュメントに制限されることにご注意ください。 制限以内に収まるようにデータセットを減らしてください。 参照してください [制限および制約](search-limits-quotas-capacity.md) の詳細。

#### インデックスにデータを読み込む方法

1 つの方法としてインデクサーの使用があります。 使用することができます (具体的には、Azure SQL Database または Azure VM 内の SQL Server)、Azure で Azure DocumentDB または SQL Server リレーショナル データ ソースに [インデクサー](https://msdn.microsoft.com/library/dn946891.aspx) サポートされているデータ ソースからドキュメントを取得します。 ドキュメントの読み込みは記載されて次のいずれかを取得するためにインデクサーを使用するコード サンプルは、チュートリアルを開始します。 [.NET](search-get-started-dotnet.md), 、[Java](search-get-started-java.md), 、[Node.JS](search-get-started-nodejs.md)します。

2 つ目の選択肢は、REST API または .NET ライブラリを利用し、ドキュメントを読み込む簡単なプログラムを記述することです。

- [追加、更新、またはドキュメント (REST API) を削除します。](https://msdn.microsoft.com/library/dn798930.aspx)
- [DocumentOperationsExtensions クラス](https://msdn.microsoft.com/library/microsoft.azure.search.documentoperationsextensions.aspx)

動作は、非常に小規模なデータセットは、使用する 3 番目のオプション [Fiddler](search-fiddler.md) または [Chrome Postman](search-chrome-postman.md) ドキュメントをアップロードします。

4 番目のオプション、おそらく最も簡単なかは、いずれかからコードを借りる、 [Adventure Works c# REST API のサンプル](https://azuresearchadventureworksdemo.codeplex.com/) ソリューションでは、埋め込み型データベース (.mdf) からドキュメントを読み込むまたは [スコアリング プロファイル c# REST API のサンプル](https://azuresearchscoringprofiles.codeplex.com/) ソリューションに含まれる JSON データ ファイルからデータを読み込みます。
> [AZURE.TIP] 変更し、実行する、 [サンプルのスコア付けプロファイル](https://azuresearchscoringprofiles.codeplex.com/), 、アプリケーションに対して有効では、データをデータ JSON ファイルと schema.json ファイルを置換します。

### 手順 4: ドキュメントにクエリを実行する

ドキュメントがインデックスに読み込まれたら、最初のクエリを記述できます。

Search サービスから最初の検索結果を取得する最も簡単な方法を使用して [Fiddler](search-fiddler.md) または [Chrome Postman](search-chrome-postman.md) 現実的には、応答を表示するにはする読みやすい形式で結果を表示する簡単な UI コードを記述します。

検索操作のための API には次があります。

- [ドキュメント検索操作](https://msdn.microsoft.com/library/dn798927.aspx)
- [SearchIndexClient クラス](https://msdn.microsoft.com/library/microsoft.azure.search.searchindexclient.aspx)

Azure Search のクエリは非常に簡単です。含む `検索 = *` 、URI では、最初の 50 個の項目が返さ検索コーパス; を指定する `検索 = < いくつかの語句 >` 、入力された用語に一致するには、少なくとも 50 のドキュメントがあれば、最大で 50 個のドキュメントを返す、フレーズで全文検索を実行します。

50 ドキュメントは既定値です。 使用して返される項目数を変更することができます、 `$Count` クエリ パラメーターです。 このパラメーターの詳細は「 [ドキュメントの検索](https://msdn.microsoft.com/library/dn798927.aspx)します。
> [AZURE.TIP] クエリ サンプルの最も包括的な一覧は記載されて [ドキュメントの検索](https://msdn.microsoft.com/library/dn798927.aspx), 、ただし、確認する場合も、 [構文リファレンス](https://msdn.microsoft.com/library/dn798920.aspx) サポートされている演算子の一覧を確認します。

### 手順 5: 他の機能を試す

サービスとインデックスが与えられたので、検索をさらに充実させるような各種機能を試すことができます。 試すべき機能の簡単な一覧を次に示します。

**検索ページ**では、多くの場合、結果セットにドキュメント カウントが表示されます。あるいは、改ページを使用し、結果をもっと管理しやすい数に分割します。 参照してください [改ページ調整](search-pagination-page-layout.md) 詳細です。

**searchMode=all** は Azure Search による NOT 演算子の評価方法を変更するクエリ パラメーターです。 既定では、NOT (-) を含むクエリは結果を絞り込まず、拡大します。 このパラメーターを設定し、NOT 演算子の評価方法を変更できます。 詳細は「 [ドキュメントの検索](https://msdn.microsoft.com/library/dn798927.aspx) または [SearchMode 列挙](https://msdn.microsoft.com/library/microsoft.azure.search.models.searchmode.aspx)します。

**スコアリング プロファイル**は検索スコアの押し上げに使用されます。事前定義基準に一致する項目が検索結果の上位に表示されます。 参照してください [スコアリング プロファイルを使ってみる](search-get-started-scoring-profiles.md) この機能の手順をします。

**フィルター**は選択に基準を追加し、検索結果を絞り込むために使用されます。 フィルターの式はクエリ内に配置されます。 参照してください [ドキュメントの検索](https://msdn.microsoft.com/library/dn798927.aspx) 詳細です。

**ファセット ナビゲーション**は自律フィルター処理のために使用されます。 Azure Search が構造を構築して返し、コードがファセット ナビゲーション構造を検索結果ページに表示します。 参照してください [ファセット ナビゲーション](search-faceted-navigation.md) 詳細です。

**サジェスター**は先行入力またはオートコンプリートのクエリであり、検索語句の最初の文字が入力されると、検索語句の候補を返します。 参照してください [Suggestions 操作](https://msdn.microsoft.com/library/dn798936.aspx) または [Suggesters クラス](https://msdn.microsoft.com/library/microsoft.azure.search.models.suggester.aspx) の詳細。

**言語アナライザー**は、テキストの解析中に、使用される言語の規則を提供します。 Azure Search の既定の言語アナライザーは Lucene English です。ただし、インデックスに指定すれば、別のアナライザーまたは複数のアナライザーを使用できます。 Lucene アナライザーはすべての API で使用できます。 Microsoft 自然言語プロセッサのみで利用 [2015年-02-28-プレビューの REST API](search-api-2015-02-28-preview.md)します。 参照してください [言語サポート](https://msdn.microsoft.com/library/dn879793.aspx) の詳細。

### 手順 6: インデックスとドキュメントの更新

評価する一部の機能でインデックスの更新が必要になる場合があります。そのとき、多くの場合、ドキュメントの更新も必要となります。

インデックスまたはドキュメントの更新が必要な場合、たとえば、サジェスターを追加したり、その目的で追加したフィールドで言語アナライザーを指定したりするには、指示を次のリンクで確認してください。

- [インデックス操作 (REST API) の更新します。](https://msdn.microsoft.com/library/dn800964.aspx)
- [インデクサー操作 (REST API) の更新します。](https://msdn.microsoft.com/library/dn946892.aspx)
- [追加、更新、またはドキュメントの操作 (REST API) を削除](https://msdn.microsoft.com/library/dn798930.aspx)
- [Index クラス (.NET ライブラリ)](https://msdn.microsoft.com/library/microsoft.azure.search.models.index.aspx)
- [Documents クラス (.NET ライブラリ)](https://msdn.microsoft.com/library/microsoft.azure.search.models.document.aspx)

概念実証を確立するプロトタイプを作成したら、学習した内容を次のレベルに移すことができます。つまり、運用環境の作業負荷をサポートできる開発プロジェクトを設計します。

## アプリケーション開発

次の段階に進むとき、使用する API、ドキュメントの管理方法と更新頻度、検索結果に外部リソースを含めるかどうかを決める必要があります。

ソリューションの設計にはプロトタイプで説明したすべての手順を含める必要があります。ただし、最も目的に適った方針を優先する代わりに、全体的なソリューションに最も適合する手法を検討するべき場合もあります。

### API を選択する

Azure Search は 2 つのプログラミング モデルを提供します。.NET ライブラリはマネージ コードに、REST API は Java、JavaScript、あるいは Microsoft .NET Framework を対象としない別の言語などのプログラミング言語に使用されます。

現在のところ、.NET ライブラリには機能の少量のサブセットがありません。そのため、マネージ コードの記述を希望しても、場合によっては、必要な機能を得るためには REST API を使用しなければなりません。 REST API でのみ利用できる機能は次のとおりです。

- [Microsoft 自然言語プロセッサ - プレビューのみ](../search-api-2015-02-28-preview/)
- [moreLikeThis 機能 - プレビューのみ](../search-api-2015-02-28-preview/)
- [管理 API](https://msdn.microsoft.com/library/dn832684.aspx)

定期的に確認することができます、 [What's New](search-latest-updates.md) 機能の状態の変更を監視する記事です。

### データの同期方法としてプッシュまたはプルを選択する

プッシュ モデルとプル モデルの違いはインデックスのドキュメントの更新方法にあります。 多くの場合、シナリオによって適切なモデルが決まります。

オンライン小売りビジネスの場合、おそらく、プッシュ モデルが必要となります。OLTP データベースと Azure Search インデックスの両方に在庫の変化をプッシュまたは二重書き込みできます。 特定の SKU が売り切れたとき、あるいはサイズまたは色がなくなったとき、インデックスを可能な限り早急に更新し、顧客の不満を回避します。 プッシュ モデルだけが検索インデックスをほぼリアルタイムで更新できます。

Azure Search にはプッシュ モデルを実装するためのメカニズムはありません。 データ層、アプリケーション コードでは、いずれかを使用してドキュメントの更新操作を処理する必要があります、 [REST API](https://msdn.microsoft.com/library/dn798935.aspx) または [.NET ライブラリ](https://msdn.microsoft.com/library/dn951165.aspx) コレクション内のドキュメントを更新します。 実装の詳細として、ドキュメント キーに製品 SKU を使用するとこの作業が楽になります。

プル モデルは外部データ ソースからデータを取得する操作であり、通常は、スケジュールされル操作です。 Azure Search では、プル モデルは使用 [インデクサー](https://msdn.microsoft.com/library/azure/dn946891.aspx), 、さらに、特定のデータ ソースの使用可能な: Azure DocumentDB または Azure SQL Database (および Azure Vm 上の SQL Server)。

### ドキュメントの一括読み込み

スループットを向上させるために、ドキュメントをバッチで追加することをお勧めします。 ドキュメントの平均サイズが 1 ～ 2 KB として、最大 1,000 件のドキュメントをバッチで追加できます。

POST 要求に対する全体的な状態コードがあります。 状態コードは、HTTP 200 (Success) または HTTP 207 (Multi-Status) (成功したドキュメントと失敗したドキュメントの組み合わせがある場合) です。 POST 要求に対する状態コードに加えて、Azure Search では各ドキュメントの状態フィールドが維持されます。 バッチ アップロードの場合、各ドキュメントの挿入が成功したか失敗したかを示す、ドキュメントごとのステータスを取得する方法が必要です。 その情報は、ステータス フィールドで提供されます。 ドキュメントの読み込みが失敗すると、このフィールドは false に設定されます。

負荷が大きい場合、一部のアップロードが失敗することがよくあります。 このような失敗が発生したときは、全体的な状態コードが 207 となり、部分的な成功が示されます。インデックス作成に失敗したドキュメントでは、"status" プロパティが false に設定されます。
> [AZURE.NOTE]  サービスがドキュメントを受け取ると、ドキュメントはインデックス作成のためにキューに配置され、即座に検索結果に含まれない場合があります。 負荷が大きくない場合は、通常、ドキュメントのインデックスは数秒間で作成されます。

インデックスを更新するときに、複数のアクション (挿入、マージ、削除) を同一のバッチに組み合わせることで、複数のラウンド トリップの必要がなくなります。 現在、Azure Search では部分的な更新 (HTTP PATCH) がサポートされていないため、インデックスを更新する必要がある場合はインデックスの定義を再送信する必要があります。

### 外部データを検索結果に統合する

Azure Search は、検索操作で使用するインデックスおよびドキュメントの内部ストレージを使用します。 テキスト分析およびインデックス解析は、すべての検索可能なフィールドおよび関連付けられた属性が既に利用可能であることを前提としています。

ただし、ドキュメント内のすべてのフィールドを検索できるわけではありません。 たとえば、アプリケーションが音楽やビデオのオンライン カタログである場合は、Azure BLOB サービスやその他のストレージ形式にバイナリ ファイルを格納することをお勧めします。 バイナリ ファイル自体は検索可能ではないため、Azure Search ストレージにそれらを保存する必要はありません。 その他のサービスや場所にイメージ、ビデオ、およびオーディオ ファイルを格納する必要がありますが、ファイルの場所への URL を参照するフィールドを含める必要があります。 この方法で、検索結果の一部として、外部データを返すことができます。

外部データを使用するには、外部データ ファイルの URL ポインターを格納するインデックスでフィールドを定義する必要があります。 発行した場合、 [Lookup Documents](https://msdn.microsoft.com/library/dn798929.aspx) 要求、またはドキュメントのコンテキストにバイナリ ファイルが表示、検索結果にフィールドを含めます。

### 容量計画

Azure Search の優れた機能の 1 つは、要求に応じてリソースを簡単にスケールアップ、またはスケールダウンできることです。 この機能で容量計画の必要性がなくなるわけではありませんが、ほとんどのリスクを最小限に抑えます。 検索の作業負荷を実行するために、追加のハードウェアや不適切なハードウェアで行き詰まることがありません。

最後の手順として、レプリカとパーティションの両方の既存のリソース レベルを確認し、調整が必要かどうかを決定します。 容量を調整する最も簡単な方法は、 [Azure Classic Portal](https://ms.portal.azure.com/)します。

Standard 価格レベルのみをスケールアップまたはスケールダウンできることに注意してください。 また、調整の程度によっては、サービスの追加クラスターをデプロイするために数分から数時間かかることがあります。
> [AZURE.NOTE] 容量は管理 REST API を使用してプログラミングで調整できます。 詳細については、次を参照してください。 [管理 REST API](https://msdn.microsoft.com/library/azure/dn832684.aspx)します。




[1]: ./media/search-workflow/AzSearch-Workflow.png 

