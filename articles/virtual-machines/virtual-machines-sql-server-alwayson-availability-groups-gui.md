<properties
    pageTitle="AlwaysOn 可用性グループの構成 (GUI) | Microsoft Azure"
    description="Azure Virtual Machines で AlwaysOn 可用性グループを作成します。 このチュートリアルでは、スクリプトではなく、主にユーザー インターフェイスとツールを使用します。"
    services="virtual-machines"
    documentationCenter="na"
    authors="rothja"
    manager="jeffreyg"
    editor="monicar"
    tags="azure-service-management" />
<tags
    ms.service="virtual-machines"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="vm-windows-sql-server"
    ms.workload="infrastructure-services"
    ms.date="12/04/2015"
    ms.author="jroth" />

# Azure VM での AlwaysOn 可用性グループの構成 (GUI)

> [AZURE.SELECTOR]
- [Azure クラシック ポータル](virtual-machines-sql-server-alwayson-availability-groups-gui.md)
- [PowerShell](virtual-machines-sql-server-alwayson-availability-groups-powershell.md)

<br/>

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-classic-include.md)] リソース マネージャーのモデルです。


このエンド ツー エンドのチュートリアルでは、Azure の仮想マシン上で実行されている SQL Server AlwaysOn を使用して可用性グループを実装する方法について説明します。

>[AZURE.NOTE] Azure の管理ポータルでは、AlwaysOn 可用性グループ リスナーを含む新しいギャラリーの設定です。 これを使用すると、AlwaysOn 可用性グループに必要なものすべてが自動的に構成されます。 詳細については、次を参照してください。 [Microsoft Azure クラシック ポータル ギャラリーで提供する SQL Server AlwaysOn](http://blogs.technet.com/b/dataplatforminsider/archive/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery.aspx)します。 PowerShell を使用して、同じシナリオのチュートリアルを参照してください。 [PowerShell を使用した Azure で AlwaysOn 可用性グループを構成する](virtual-machines-sql-server-alwayson-availability-groups-powershell.md)です。

チュートリアルの最後には、次の要素で構成された SQL Server AlwaysOn ソリューションが Azure で完成します。

- 複数のサブネットから成る仮想ネットワーク (フロントエンドのサブネットとバックエンドのサブネットを含む)

- Active Directory (AD) ドメインを持つドメイン コントローラー

- バックエンド サブネットにデプロイされ、AD ドメインに参加している 2 つの SQL Server VM

- 3 ノードの WSFC クラスター (ノード マジョリティ クォーラム モデル)

- 可用性データベースの 2 つの同期コミット レプリカを含む可用性グループ

このソリューションをグラフィカルに表すと、次の図のようになります。

![Azure での AG 向けテスト ラボ アーキテクチャ](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC791912.png)

これは、考えられる 1 つの構成であることに注意してください。 たとえば、Azure でのコンピューティング時間を節約するために、ドメイン コントローラーを 2 つのノードの WSFC クラスターでクォーラム ファイル共有監視として使用することで、2 つのレプリカを持つ可用性グループ用の VM 数を最小限に抑えることができます。 この方法では、上記の構成よりも VM 数が 1 つ減少します。

このチュートリアルでは、次のことを前提としています。

- Azure アカウントを既に所有している。

- GUI を使用して、仮想マシン ギャラリーから SQL Server VM をプロビジョニングする方法を知っている。 詳細については、次を参照してください [Azure で SQL Server 仮想マシンのプロビジョニング。](virtual-machines-provision-sql-server.md)

- AlwaysOn 可用性グループについて十分に理解している。 詳細については、次を参照してください。 [AlwaysOn 可用性グループ (SQL Server)](https://msdn.microsoft.com/library/hh510230.aspx)します。

>[AZURE.NOTE] SharePoint で AlwaysOn 可用性グループを使用する場合は、関連 [を構成する SQL Server 2012 AlwaysOn 可用性グループを SharePoint 2013 用](https://technet.microsoft.com/library/jj715261.aspx)します。

## Virtual Network とドメイン コントローラー サーバーの作成

最初に新しい Azure 試用版アカウントを作成します。 アカウントのセットアップが完了したら、Azure クラシック ポータルのホーム画面が表示されます。

1. クリックして、 **新規** 次に示すように、ページの左上隅にあるボタンをクリックします。

    ![ポータルで [新規] をクリックします](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665511.gif)

1. をクリックして **ネットワーク サービス**, 、順にクリックして **仮想ネットワークは、** 順にクリック **カスタム作成**, 、次のようにします。

    ![Virtual Network の作成](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665512.gif)

1.  **仮想ネットワークの作成** ダイアログ ボックスで、各ページで次の設定によって、新しい仮想ネットワークを作成します。 

  	|Page|Settings|
|---|---|
|仮想ネットワークの詳細 |**名前 = ContosoNET**<br/>**リージョン = 米国西部**|
|DNS サーバーおよび VPN Connectivity|None|
|仮想ネットワーク アドレス Spaces|設定は、次のスクリーン ショットで表示: ![仮想ネットワークの作成](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784620.png)|

1. 次に、ドメイン コントローラー (DC) として使用する VM を作成します。 をクリックして **新規** ここでも、し **コンピューティング**, 、し、 **仮想マシン**, 、し **ギャラリーから**, 次のように、します。

    ![VM を作成します](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784621.png)

1.  **仮想マシンの作成** ダイアログ ボックスで、各ページで次の設定で新しい VM を構成します。 

  	|Page|Settings|
|---|---|
|System| を運用仮想マシンを選択します。Windows Server 2012 R2 Datacenter|
|バーチャル マシン構成**バージョンのリリース日** = (最新)<br/>**仮想マシン名** = ContosoDC<br/>**層** = 標準<br/>**サイズ** = A2 (2 コア)<br/>**新しいユーザー名** = AzureAdmin<br/>**新しいパスワード** = Contoso! 000<br/>**確認** = Contoso! システム
|バーチャル マシン構成**クラウド サービス** = 新しいクラウド サービスの作成<br/>**クラウド サービス DNS 名** = 一意のクラウド サービス名<br/>**DNS 名** = 一意の名前 (例: ContosoDC123)<br/>**リージョン/アフィニティ グループ/仮想ネットワーク** = ContosoNET<br/>**仮想ネットワーク サブネット** Back(10.10.2.0/24) =<br/>**ストレージ アカウント** = 自動的に生成されたストレージ アカウントを使用します。<br/>**可用性セット** = (なし) |
|仮想マシンのオプションDefaults| を使用します。

新しい VM の構成が完了したら、VM がプロビジョニングされるまで待ちます。 このプロセスを完了に時間がかかるにした場合と、 **仮想マシン** タブ Azure クラシック ポータルでから ContosoDC サイクルの状態を確認できます **開始中 (プロビジョニング)** に **停止**, 、**開始**, 、**実行中 (プロビジョニング)**, 、し、最後に **を実行している**します。

これで、DC サーバーは正常にプロビジョニングされました。 次に、この DC サーバー上の Active Directory ドメインを構成します。

## ドメイン コントローラーの構成

次の手順では、corp.contoso.com のドメイン コントローラーとして ContosoDC コンピューターを構成します。

1. ポータルで、選択、 **ContosoDC** マシンです。  **ダッシュ ボード** ] タブ、[ **接続** をリモート デスクトップ アクセス用の RDP ファイルを開きます。

    ![仮想マシンに接続](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784622.png)

1. 構成した管理者アカウントでログイン (**\AzureAdmin**) とパスワード (**Contoso! 000**)。

1. 既定では、 **サーバー マネージャー** ダッシュ ボードを表示する必要があります。

1. クリックして、 **の役割と機能の追加** ダッシュ ボードのリンク。

    ![サーバー エクスプローラー、ロールの追加](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784623.png)

1. 選択 **次** が表示されるまで、 **サーバーの役割** セクションです。

1. 選択、 **Active Directory ドメイン サービス** と **DNS サーバー** ロールです。 メッセージが表示されたら、これらの役割に必要なその他の機能を追加します。

    >[AZURE.NOTE] 静的 IP アドレスがないことを警告検証が表示されます。 構成をテストしている場合は、[続行] をクリックします。 本稼働 [PowerShell を使用して、ドメイン コント ローラー マシンの静的 IP アドレスを設定する](./virtual-network/virtual-networks-reserved-private-ip.md)です。

    ![ロールの追加の図表](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784624.png)

1. クリックして **次** に到達するまで、 **確認** セクションです。 選択、 **ために必要な場合は、移行先サーバーを自動的に再起動** チェック ボックスをオンします。

1. クリックして **インストール**します。

1. 機能のインストールが完了した後に戻って、 **サーバー マネージャー** ダッシュ ボード。

1. 新しい選択 **AD DS** 、左側のペインでオプションです。

1. クリックして、 **詳細** 黄色の警告バーのリンク。

    ![DNS サーバー VM の AD DS の図表](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784625.png)

1.  **アクション** の列、 **すべてのサーバー タスクの詳細** ダイアログ ボックスで、をクリックして **このサーバーをドメイン コント ローラーを昇格**します。

1.  **Active Directory ドメイン サービス構成ウィザード**, 、次の値を使用します。

  	|Page|Setting|
|---|---|
|展開構成**新しいフォレストの追加** = 選択<br/>**ルート ドメイン名** corp.contoso.com| =
|ドメイン コント ローラーのオプション |**パスワード** = Contoso! 000<br/>**パスワードの確認入力** = Contoso! システム

1. クリックして **次** ウィザードの他のページを通過します。  **前提条件の確認** ] ページで、次のメッセージを表示することを確認します。 **すべての前提条件チェックに合格しました**します。 関連する警告メッセージを確認する必要がありますが、インストールは続行できます。

1. クリックして **インストール**します。  **ContosoDC** 仮想マシンが自動的に再起動します。

## ドメイン アカウントの構成

次の手順では、後で使用するために Active Directory (AD) アカウントを構成します。

1. ログインし直す、 **ContosoDC** マシンです。

1.  **サーバー マネージャー** 選択 **ツール** ] をクリックし、 **Active Directory 管理センター**します。

    ![Active Directory 管理センター](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784626.png)

1.  **Active Directory 管理センター** 選択 **corp (ローカル)** 左側のペインからです。

1. 右側の **タスク** ] ウィンドウの [ **新規** ] をクリックし、 **ユーザー**します。 次の設定を使用します。

  	|Setting|値 |
|---|---|
|**姓**|Install|
|**ユーザーの SamAccountName**|Install|
|**パスワード**|Contoso! システム
|**パスワードの確認入力**|Contoso! システム
|**その他のパスワード オプション**|Selected|
|**パスワードを無期限**|Checked|

1. クリックして **OK** を作成する、 **インストール** ユーザーです。 このアカウントは、フェールオーバー クラスターと可用性グループの構成に使用されます。

1. 同じ手順を含むその他の 2 つのユーザーを作成します。 **corp \sqlsvc1** と **corp \sqlsvc2**します。 これらのアカウントは、SQL Server インスタンスに使用されます。次に、付与する必要があります **corp \install** Windows サービスのフェールオーバー クラスタ リング (WSFC) を構成するために必要な権限。

1.  **Active Directory 管理センター**, [ **corp (ローカル)** 左側のウィンドウでします。 その後、右側の [ **タスク** ] ウィンドウで、をクリックして **プロパティ**します。

    ![CORP ユーザー プロパティ](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784627.png)

1. 選択 **拡張機能**, 、順にクリック、 **[詳細設定]** のボタンでは、 **セキュリティ** ] タブをクリックします。

1.  **Corp のセキュリティの詳細設定** ダイアログ。 クリックして **追加**します。

1. クリックして **プリンシパルの選択**します。 検索し、 **corp \install**します。 Click **OK**.

1. 選択、 **すべてのプロパティを読み取る** と **コンピューター オブジェクトの作成** アクセス許可。

    ![CORP ユーザー権限](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784628.png)

1. をクリックして **[ok]**, 、順にクリック **OK** もう一度です。 corp のプロパティ ウィンドウを閉じます。

これで Active Directory とユーザー オブジェクトの構成が完了したので、3 つの SQL Server VM を作成してこのドメインに参加させます。

## SQL Server VM の作成

次に、3 つの VM (WSFC クラスター ノードと 2 つの SQL Server VM) を作成します。 各 Vm を作成するには、Azure 旧ポータルに戻り、] をクリックして **新規**, 、**コンピューティング**, 、**仮想マシン**, 、し **ギャラリーから**します。 その後、次の表のテンプレートを使用すると、VM の作成に役立ちます。

|ページ|VM1|VM2|VM3|
|---|---|---|---|
|仮想マシンのオペレーティング システムの選択|**Windows Server 2012 R2 Datacenter**|**SQL Server 2014 RTM Enterprise**|**SQL Server 2014 RTM Enterprise**|
|仮想マシンの構成|**バージョンのリリース日** = (最新)<br/>**仮想マシン名** = ContosoWSFCNode<br/>**層** = 標準<br/>**サイズ** = A2 (2 コア)<br/>**新しいユーザー名** = AzureAdmin<br/>**新しいパスワード** = Contoso! 000<br/>**確認** = Contoso! 000|**バージョンのリリース日** = (最新)<br/>**仮想マシン名** = ContosoSQL1<br/>**層** = 標準<br/>**サイズ** = A3 (4 コア)<br/>**新しいユーザー名** = AzureAdmin<br/>**新しいパスワード** = Contoso! 000<br/>**確認** = Contoso! 000|**バージョンのリリース日** = (最新)<br/>**仮想マシン名** = ContosoSQL2<br/>**層** = 標準<br/>**サイズ** = A3 (4 コア)<br/>**新しいユーザー名** = AzureAdmin<br/>**新しいパスワード** = Contoso! 000<br/>**確認** = Contoso! 000|
|仮想マシンの構成|**クラウド サービス** = 以前に作成された一意のクラウド サービス DNS 名 (例: ContosoDC123)<br/>**リージョン/アフィニティ グループ/仮想ネットワーク** = ContosoNET<br/>**仮想ネットワーク サブネット** Back(10.10.2.0/24) =<br/>**ストレージ アカウント** = 自動的に生成されたストレージ アカウントを使用します。<br/>**可用性セット** = 作成可用性セット<br/>**可用性セット名** = SQLHADR|**クラウド サービス** = 以前に作成された一意のクラウド サービス DNS 名 (例: ContosoDC123)<br/>**リージョン/アフィニティ グループ/仮想ネットワーク** = ContosoNET<br/>**仮想ネットワーク サブネット** Back(10.10.2.0/24) =<br/>**ストレージ アカウント** = 自動的に生成されたストレージ アカウントを使用します。<br/>**可用性セット** = SQLHADR (ことも構成する可用性セットをマシンが作成された後です。 3 つの仮想マシンはすべて SQLHADR 可用性セットに割り当てる必要があります。)|**クラウド サービス** = 以前に作成された一意のクラウド サービス DNS 名 (例: ContosoDC123)<br/>**リージョン/アフィニティ グループ/仮想ネットワーク** = ContosoNET<br/>**仮想ネットワーク サブネット** Back(10.10.2.0/24) =<br/>**ストレージ アカウント** = 自動的に生成されたストレージ アカウントを使用します。<br/>**可用性セット** = SQLHADR (ことも構成する可用性セットをマシンが作成された後です。 3 つの仮想マシンはすべて SQLHADR 可用性セットに割り当てる必要があります。)|
|仮想マシンのオプション|既定値を使用|既定値を使用|既定値を使用|

<br/>

>[AZURE.NOTE] 以前の構成では、基本的な層のマシンでは、後で可用性グループ リスナーを作成するために必要な負荷分散エンドポイントをサポートしていないために、標準的な層の仮想マシンがお勧めします。 また、ここで示されるマシンのサイズは、Azure VM での可用性グループのテストに対応しています。 実稼働ワークロードに最適なパフォーマンスを SQL Server マシンのサイズと構成に関する推奨事項を参照してください。 [Azure 仮想マシンにおける SQL Server のパフォーマンスのベスト プラクティス](virtual-machines-sql-server-performance-best-practices.md)します。

結合にする必要がある 3 つの Vm が完全にプロビジョニングされたら、 **corp.contoso.com** マシンにドメインと許可の corp \install 管理者権限。 この操作を行うには、3 つの VM それぞれで、次の手順を実行します。

1. まず、優先 DNS サーバー アドレスを変更します。 により、一覧で VM を選択し、クリックすると、ローカルのディレクトリを各 VM のリモート デスクトップ (RDP) ファイルをダウンロード、 **接続** ] ボタンをクリックします。 VM を選択するには、次に示すように、選択する行で最初のセル以外の任意の場所をクリックします。

    ![RDP ファイルのダウンロード](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC664953.jpg)

1. ダウンロードした RDP ファイルを起動し、構成した管理者アカウントを使用して VM にログイン (**builtin \azureadmin**) とパスワード (**Contoso! 000**)。

1. ログインすると表示する必要があります、 **サーバー マネージャー** ダッシュ ボード。 クリックして **ローカル サーバー** 左側のウィンドウでします。

1. 選択、 **、IPv6 が有効な DHCP によって割り当てられた IPv4 アドレス** リンクします。

1.  **ネットワーク接続** ウィンドウで、ネットワーク アイコンを選択します。

    ![VM 優先 DNS サーバーの変更](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784629.png)

1. コマンド バー] をクリックして **この接続の設定を変更する** (によっては、ウィンドウのサイズ、ありますこのコマンドを表示する場合は、二重右矢印をクリックする)。

1. 選択 **インターネット プロトコル バージョン 4 (Tcp/ipv4)** プロパティ] をクリックします。

1. 選択は、次の DNS サーバーのアドレスを使用し、指定 **10.10.2.4** で **優先 DNS サーバー**します。

1. アドレス **10.10.2.4** Azure の仮想ネットワーク内の 10.10.2.0/24 サブネットに VM にアドレスが割り当てられ、その VM は **ContosoDC**します。 確認する **ContosoDC**の IP アドレスを使用して、 **nslookup contosodc** コマンド プロンプトで次のようにします。

    ![NSLOOKUP を使用して DC の IP アドレスを検索](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC664954.jpg)

1. O] をクリックして**K** し **閉じる** 変更を確定します。 VM を参加させることができるよう **corp.contoso.com**します。

1. 戻り、 **ローカル サーバー** ] ウィンドウをクリックして、 **ワークグループ** リンクします。

1.  **コンピューター名** ] をクリックして **変更**します。

1. 選択、 **ドメイン** ] チェック ボックス **corp.contoso.com** 、テキスト ボックスにします。 Click **OK**.

1.  **Windows セキュリティ** ポップアップ ダイアログ ボックスで、既定のドメイン管理者アカウントの資格情報を指定 (**corp \azureadmin**) とパスワード (**Contoso! 000**)。

1. "Corp.contoso.com ドメインにようこそ] メッセージが表示されたらクリックして **OK**します。

1. をクリックして **閉じる**, 、] をクリックし、 **今すぐ再起動** ] ポップアップ ダイアログ ボックス。

### 各 VM で Corp \Install ユーザーを管理者として追加する

1. VM が再起動されるまで待機し、RDP ファイルをもう一度を使用して VM にログインを起動し、 **builtin \azureadmin** アカウントです。

1.  **サーバー マネージャー** 選択 **ツール**, 、クリックして **コンピューターの管理**します。

    ![コンピューター管理](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784630.png)

1.  **コンピューターの管理** ウィンドウで、展開 **ローカル ユーザーとグループ**, 、し、[ **グループ**します。

1. ダブルクリックして、 **管理者** グループです。

1.  **Administrators のプロパティ** ダイアログ ボックスで、をクリックして、 **追加** ] ボタンをクリックします。

1. ユーザー名を入力 **corp \install**, 、] をクリックし、 **OK**します。 資格情報が表示されたらを使用して、 **AzureAdmin** を持つアカウント、 **Contoso! 000** パスワードです。

1. をクリックして **OK** を閉じる、 **Administrator のプロパティ** ダイアログ。

### 追加、 **フェールオーバー クラスタ リング** を各 VM に機能します。

1.  **サーバー マネージャー** ダッシュ ボード] をクリックして **役割と機能の追加**します。

1.  **追加の役割と機能ウィザード**, 、] をクリックして **次** が表示されるまで、 **機能** ページです。

1. 選択 **フェールオーバー クラスタ リング**します。 メッセージが表示されたら、その他の依存する機能を追加します。

    ![フェールオーバー クラスタリング機能を VM に追加](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784631.png)

1. をクリックして **次**, 、] をクリックし、 **インストール** 上、 **確認** ページです。

1. ときに、 **フェールオーバー クラスタ リング** 機能のインストールが完了したら、クリックして **閉じる**します。

1. VM からログアウトします。

1. -3 つのサーバーのこのセクションの手順を繰り返して **ContosoWSFCNode**, 、**ContosoSQL1**, 、および **ContosoSQL2**します。

これで SQL Server VM がプロビジョニングされ、実行されている状態になりましたが、これらは SQL Server と共に既定のオプションでインストールされています。

## WSFC クラスターの作成

このセクションでは、後で作成する可用性グループをホストする WSFC クラスターを作成します。 ここまでに、WSFC クラスター内で使用する 3 つの VM に対して、次の操作を行いました。

- Azure で完全にプロビジョニングする

- VM をドメインに参加させる

- 追加 **corp \install** ローカルの Administrators グループに

- フェールオーバー クラスタリング機能を追加する

これらはすべて、WSFC クラスターに参加させるための各 VM の前提条件です。

また、Azure Virtual Network の動作は、オンプレミス ネットワークとは異なることに注意してください。 クラスターは、次の順序で作成する必要があります。

1. ノードのいずれかでシングル ノード クラスターを作成 (**ContosoSQL1**)。

1. クラスター IP アドレスは、未使用の IP アドレスを変更 (**10.10.2.101**)。

1. クラスター名をオンラインにします。

1. その他のノードを追加 (**ContosoSQL2** と **ContosoWSFCNode**)。

次の手順に従って、クラスターを完全に構成する上記のタスクを完了してください。

1. RDP ファイルを起動 **ContosoSQL1** ドメイン アカウントを使用してログイン **corp \install**します。

1.  **サーバー マネージャー** ダッシュ ボードで、[ **ツール**, 、クリックして **フェールオーバー クラスター マネージャー**します。

1. 左側のウィンドウで右クリックし **フェールオーバー クラスター マネージャー**, 、順にクリック **クラスターを作成する**, 、次のようにします。

    ![クラスターを作成](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784632.png)

1. クラスターの作成ウィザードの各ページで、次の設定を使用して、単一ノード クラスターを作成します。

  	|Page|Settings|
|---|---|
|Begin| する前にDefaults| を使用します。
|サーバー | を選択します。型 **ContosoSQL1** で **サーバー名の入力** ] をクリック **追加**|
|検証の注意選択 **いいえこのクラスターでは、マイクロソフトのサポートは必要ありませんし、したがってしないように検証テストを実行します。次をクリックすると、クラスターの作成を続行**. |
|Cluster| を管理するためのアクセス ポイント型 **Cluster1** で **クラスター名**|
|Confirmation|記憶域スペースを使用している場合を除き、既定値を使用します。 次の表の後の注を参照してください |。

    >[AZURE.WARNING] 使用している場合 [記憶域スペース](https://technet.microsoft.com/library/hh831739), 、複数のディスクを記憶域プールにグループ化、オフにする必要があります、 **すべての可能な記憶域をクラスターに追加** チェック ボックス、 **確認** ページです。 このチェック ボックスをオフにしないと、クラスタリング処理中に仮想ディスクがデタッチされます。 その結果、記憶域スペースがクラスターから削除され、PowerShell を使用して再アタッチされるまで、仮想ディスクはディスク マネージャーやエクスプローラーにも表示されなくなります。

1. 左側のウィンドウで [ **フェールオーバー クラスター マネージャー**, 、クリックして **[cluster1.corp.contoso.com]**します。

1. 中央のペインで下にスクロールして **クラスター コア リソース** セクションし、展開、 **名: Clutser1** 詳細です。 両方を表示する必要があります、 **名前** と **IP アドレス** 内のリソース、 **失敗** 状態です。 クラスターにコンピューター自体と同じ IP アドレスが割り当てられていて、アドレスが重複するため、IP アドレス リソースをオンラインにすることができません。

1. 障害が発生したを右クリックし **IP アドレス** リソース、およびクリック **プロパティ**します。

    ![クラスターのプロパティ](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784633.png)

1. 選択 **静的 IP アドレス** し指定 **10.10.2.101** アドレス テキスト ボックスにします。 クリックして **OK**します。

1.  **クラスター コア リソース** セクションを右クリックして **名前: Cluster1** ] をクリック **オンライン**します。 両方のリソースがオンラインになるまで待ちます。 クラスター名リソースがオンラインになると、新しい AD コンピューター アカウントで DC サーバーが更新されます。 この AD アカウントは、後で可用性グループのクラスター化サービスを実行する際に使用されます。

1. 最後に、残りのノードをクラスターに追加します。 ブラウザー ツリーで、右クリック **[cluster1.corp.contoso.com]** ] をクリック **ノードの追加**, をクリックします。

    ![クラスターにノードを追加](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784634.png)

1.  **ノードの追加ウィザード**, をクリックして **次**します。  **サーバーの選択** ] ページで、追加 **ContosoSQL2** と **ContosoWSFCNode** サーバー名を入力して一覧に **サーバー名の入力** クリックし、 **追加**します。 完了したら、クリックして **次**します。

1.  **検証の警告** ] ページで [ **いいえ** (実稼働のシナリオでは検証テストを実行する)。 クリックして **次**します。

1.  **確認** ] ページで [ **次** 、ノードを追加します。

    >[AZURE.WARNING] 使用している場合 [記憶域スペース](https://technet.microsoft.com/library/hh831739), 、複数のディスクを記憶域プールにグループ化、オフにする必要があります、 **すべての可能な記憶域をクラスターに追加** チェック ボックスをオンします。 このチェック ボックスをオフにしないと、クラスタリング処理中に仮想ディスクがデタッチされます。 その結果、記憶域スペースがクラスターから削除され、PowerShell を使用して再アタッチされるまで、仮想ディスクはディスク マネージャーやエクスプローラーにも表示されなくなります。

1. クリックして、クラスターには、ノードが追加される、 **完了**します。 フェールオーバー クラスター マネージャーが、クラスターは 3 つのノードがおよびでそれらのリストは表示されます、 **ノード** コンテナーです。

1. リモート デスクトップ セッションからログアウトします。

## 可用性グループの SQL Server インスタンスの準備

このセクションでは、両方で、次を実行します **ContosoSQL1** と **contosoSQL2**:

- ログインを追加 **NT authority \system** 既定の SQL Server インスタンスを設定するために必要なアクセス許可を持つ

- 追加 **corp \install** 既定の SQL Server インスタンスの sysadmin ロールとして

- ファイアウォールを解放し、SQL Server のリモート アクセスを許可する

- AlwaysOn 可用性グループ機能を有効にする

- SQL Server サービス アカウントを変更 **corp \sqlsvc1** と **corp \sqlsvc2**, 、それぞれ

上記の操作は、任意の順序で実行できます。 ただし、次の手順はこの順序どおりに実行します。 両方の手順を実行 **ContosoSQL1** と **ContosoSQL2**:

1. VM のリモート デスクトップ セッションからログアウトしていない場合は、今すぐログアウトしてください。

1. RDP ファイルを起動 **ContosoSQL1** と **ContosoSQL2** としてログインし、 **builtin \azureadmin**します。

1. 最初に、追加 **NT authority \system** を SQL Server ログインに必要なアクセス許可を使用します。 起動 **SQL Server Management Studio**します。

1. クリックして **接続** 既定の SQL Server インスタンスに接続します。

1.  **オブジェクト エクスプ ローラー**, 、展開 **セキュリティ**, 、順に展開 **ログイン**します。

1. 右クリックし、 **NT authority \system** ログイン、およびクリック **プロパティ**します。

1.  **セキュリティ保護可能な** ] ページで、[ローカル サーバーの **Grant** 次のアクセス許可およびクリック **[ok]**します。

    - 可用性グループの変更

    - SQL の接続

    - サーバー状態の表示

1. 次に、追加 **corp \install** として、 **sysadmin** 既定の SQL Server インスタンスにロールです。  **オブジェクト エクスプ ローラー**, を右クリックして **ログイン** ] をクリック **新しいログイン**します。

1. 型 **corp \install** で **ログイン名**します。

1.  **サーバーの役割** ] ページで、[ **sysadmin**します。 クリックして **OK**します。 ログインが作成されると、表示順に展開する **ログイン** で **オブジェクト エクスプ ローラー**します。

1. 次に、SQL Server のファイアウォール規則を作成します。  **開始** 画面で、起動 **セキュリティが強化された Windows ファイアウォール**します。

1. 左側のウィンドウで [ **受信の規則**します。 右側のウィンドウをクリックして **新しいルール**します。

1.  **規則の種類** ] ページで、[ **プログラム**, 、] をクリックし、 **次**します。

1.  **プログラム** ] ページで、[ **このプログラムのパス** と種類 **%ProgramFiles%\Microsoft SQL Server\MSSQL12 します。MSSQLSERVER\MSSQL\Binn\sqlservr.exe** 、テキスト ボックスに (SQL Server ディレクトリは、次の手順は、SQL Server 2012 を使用するが場合、 **MSSQL11 します。MSSQLSERVER**)。 クリックして **次**します。

1.  **アクション** ] ページで、保持 **接続を許可する** を選択し、クリックして **次**します。

1.  **プロファイル** ] ページで、既定の設定をそのまま使用してクリックして **次**します。

1.  **名前** ] ページで、ルールの名前を指定します。 **SQL Server (Program Rule)** で、 **名前** テキスト ボックスをクリックして **完了**します。

1. 有効にした次に、 **AlwaysOn 可用性グループ** 機能します。  **開始** 画面で、起動 **SQL Server 構成マネージャー**します。

1. ブラウザー ツリーでクリックして **SQL Server サービス**, を右クリックし、 **SQL Server (MSSQLSERVER)** サービスを提供し、をクリックして **プロパティ**します。

1. をクリックして、 **AlwaysOn 高可用性** ] タブのを選択 **AlwaysOn 可用性グループを有効にする**, 以下に示すように、クリックして **適用**します。 をクリックして **OK** ポップアップ ダイアログで、まだ [プロパティ] ウィンドウを閉じないでとします。 サービス アカウントを変更した後に SQL Server サービスを再起動します。

    ![AlwaysOn 可用性グループを有効にする ](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665520.gif)

1. 次に、SQL Server サービス アカウントを変更します。 をクリックして、 **ログオン** ] タブのボックスに入力して **corp \sqlsvc1** (の **ContosoSQL1**) または **corp \sqlsvc2** (の **ContosoSQL2**) で **アカウント名**, を入力して、パスワードの確認し、順にクリックして **OK**します。

1. ポップアップ ウィンドウで [ **はい** SQL Server サービスを再起動します。 SQL Server サービスが再起動されると、プロパティ ウィンドウで行った変更が有効になります。

1. VM からログアウトします。

## 可用性グループの作成

これで、可用性グループを構成できるようになりました。 この後の操作の概要は以下のとおりです。

- 新しいデータベースの作成 (**MyDB1**) で **ContosoSQL1**

- データベースの完全バックアップとトランザクション ログ バックアップの両方を作成する

- 完全バックアップと復元のログをバックアップ **ContosoSQL2** で、 **NORECOVERY** オプション

- 可用性グループの作成 (**AG1**) した同期コミット、自動フェールオーバーは、読み取り可能なセカンダリ レプリカ

### ContosoSQL1 に MyDB1 データベースを作成する

1. かどうかは、既にログアウトしていないのリモート デスクトップ セッション **ContosoSQL1** と **ContosoSQL2**, はここで作成します。

1. RDP ファイルを起動 **ContosoSQL1** としてログインし、 **corp \install**します。

1.  **ファイル エクスプ ローラー**, [**C:\**, 、というディレクトリを作成 **バックアップ**します。 このディレクトリは、データベースのバックアップと復元に使用します。

1. 新しいディレクトリを右クリックし、[ **と共有**, 、] をクリックし、 **特定のユーザー**, 、次のようにします。

    ![バックアップ フォルダーの作成](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665521.gif)

1. 追加 **corp \sqlsvc1** し、 **読み取り/書き込み** アクセス許可を追加し、 **corp \sqlsvc2** し、 **読み取り** クリックして、次のように、アクセス許可 **共有**します。 ファイル共有プロセスが完了したら、クリックして **実行**します。

    ![バックアップ フォルダーの権限を付与](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665522.gif)

1. 次に、データベースを作成します。  **開始** ] メニューの [起動 **SQL Server Management Studio**, 、順にクリックして **接続** 既定の SQL Server インスタンスに接続します。

1.  **オブジェクト エクスプ ローラー**, を右クリックして **データベース** ] をクリック **新しいデータベース**します。

1.  **データベース名**, 、型 **MyDB1**, 、] をクリックし、 **OK**します。

### MyDB1 の完全バックアップを作成して ContosoSQL2 に復元する

1. 次に、データベースの完全バックアップを作成します。  **オブジェクト エクスプ ローラー**, 、展開 **データベース**, を右クリックし、 **MyDB1**, 、] をポイントし、 **タスク**, 、順にクリック **バックアップ**します。

1.  **ソース** セクションで、保持 **バックアップの種類** 設定 **完全**します。  **宛先** ] をクリックして **削除** 、バックアップ ファイルの既定のファイル パスを削除します。

1.  **宛先** ] をクリックして **追加**します。

1.  **ファイル名** テキスト ボックスに「 **\\ContosoSQL1\backup\MyDB1.bak**します。 をクリックし、 **[ok]**, 、順にクリック **[ok]** もう一度、データベースをバックアップします。 バックアップ操作が完了したら、クリックして **OK** もう一度ダイアログを閉じます。

1. 次に、データベースのトランザクション ログ バックアップを作成します。  **オブジェクト エクスプ ローラー**, 、展開 **データベース**, を右クリックし、 **MyDB1**, 、] をポイントし、 **タスク**, 、順にクリック **バックアップ**します。

1.  **バックアップ** 型で、 **トランザクション ログ**します。 保持、 **宛先** には、前に指定したファイル パスを **[ok]**します。 バックアップ操作が完了すると、クリックして **OK** 再度します。

1. 次に、全体を復元して、トランザクション ログのバックアップ **ContosoSQL2**します。 RDP ファイルを起動 **ContosoSQL2** としてログインし、 **corp \install**します。 リモート デスクトップ セッションのままにして **ContosoSQL1** を開きます。

1.  **開始** ] メニューの [起動 **SQL Server Management Studio**, 、順にクリックして **接続** 既定の SQL Server インスタンスに接続します。

1.  **オブジェクト エクスプ ローラー**, を右クリックして **データベース** ] をクリック **Restore Database**します。

1.  **ソース** ] セクションの [ **デバイス**, 、] をクリックし、 **.** をクリックしてください。

1.  **バックアップ デバイスの選択**, 、クリックして **追加**します。

1. バックアップ ファイルの場所で \\ContosoSQL1\backup を入力し、更新] をクリックし、[mydb1.bak] を選択して [ok] をクリックし、もう一度 [ok] をクリックします。 [復元するバックアップ セット] ウィンドウに完全バックアップとログ バックアップが表示されます。

1. [オプション] ページに移動し、[復旧状態] で [RESTORE WITH NORECOVERY] を選択し、[OK] をクリックしてデータベースを復元します。 復元操作が完了したら、[OK] をクリックします。

### 可用性グループを作成する

1. リモート デスクトップ セッションに戻り **ContosoSQL1**します。  **オブジェクト エクスプ ローラー** SSMS を右クリックし **AlwaysOn 高可用性** ] をクリック **新しい可用性グループ ウィザード**, 、次のようにします。

    ![[新しい可用性グループ ウィザード] の起動](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665523.gif)

1.  **概要** ] ページで [ **次**します。  **[可用性グループ名** ] ページで入力 **AG1** で **可用性グループ名**, 、] をクリックし、 **次** もう一度です。

    ![新しい AG ウィザード、AG 名の指定](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665524.gif)

1.  **データベースの選択** ] ページで選択 **MyDB1** ] をクリック **次**します。 対象とするプライマリ レプリカで完全バックアップを少なくとも 1 つは作成しているため、このデータベースは可用性グループの前提条件を満たしています。

    ![新しい AG ウィザード、データベースの選択](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665525.gif)

1.  **レプリカの指定** ] ページで [ **のレプリカ追加**します。

    ![新しい AG ウィザード、レプリカの指定](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665526.gif)

1.  **サーバーへの接続** ダイアログ ボックスがポップアップします。 型 **ContosoSQL2** で **サーバー名**, 、クリックして **接続**します。

    ![新しい AG ウィザード、サーバーに接続](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665527.gif)

1. 戻り、 **レプリカの指定** ] ページのことを確認 **ContosoSQL2** に示されている **使用可能なレプリカ**します。 次に示すようにレプリカを構成します。 終了したら、クリックして **次**します。

    ![新しい可用性グループ ウィザード、レプリカの指定 (完了)](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665528.gif)

1.  **[初期データの同期** ] ページで選択 **参加のみ** ] をクリック **次**します。 完了したデータの同期手動で完全バックアップとトランザクション バックアップを行ったときに **ContosoSQL1** でそれらを復元および **ContosoSQL2**します。 代わりにせずにバックアップおよび復元操作を選択し、データベースを選択できます **完全** 新しい可用性グループ ウィザードがデータの同期を実行できるようにします。 ただし、一部の企業で使用されている大規模なデータベースではこの方法はお勧めしません。

    ![新しい可用性グループ ウィザード、最初のデータの同期を選択](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665529.gif)

1.  **検証** ] ページで [ **次**します。 このページは、次のようになっています。 可用性グループ リスナーを構成していないため、リスナー構成に関する警告が表示されます。 このチュートリアルではリスナーを構成しないため、この警告を無視できます。 このチュートリアルを完了した後、リスナーを構成するを参照してください。 [Azure で AlwaysOn 可用性グループ用の ILB リスナーを構成する](virtual-machines-sql-server-configure-ilb-alwayson-availability-group-listener.md)です。

    ![新しい AG ウィザード、検証](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665530.gif)

1.  **概要** ] ページで [ **完了**, 、ウィザードにより新しい可用性グループが構成されるを待ちます。  **進行状況** クリックすることができます] ページで、 **詳細** 詳細な進捗状況を確認します。 ウィザードを終了する、検査、 **結果** 、次のように、可用性グループが正常に作成されたことを確認するページでをクリックし、 **閉じる** ウィザードを終了します。

    ![新しい AG ウィザード、結果](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665531.gif)

1.  **オブジェクト エクスプ ローラー**, 、展開 **AlwaysOn 高可用性**, の順に展開 **可用性グループ**します。 このコンテナー内に新しい可用性グループが表示されます。 右クリック **AG1 (プライマリ)** ] をクリック **ダッシュ ボードの表示**します。

    ![AG ダッシュボードの表示](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665532.gif)

1.  **AlwaysOn ダッシュ ボード** よう次のようになります。 レプリカ、各レプリカのフェールオーバー モード、および同期の状態を確認できます。

    ![AG ダッシュボード](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665533.gif)

1. 戻る **サーバー マネージャー**, [ **ツール**, 、起動し、起動 **フェールオーバー クラスター マネージャー**します。

1. 展開 **[cluster1.corp.contoso.com]**, 、順に展開 **サービスとアプリケーション**します。 選択 **ロール** して、 **AG1** 可用性グループのロールを作成します。 リスナーを構成していないため、AG1 には、データベース クライアントが可用性グループに接続する際に使用する IP アドレスがありません。 読み取り/書き込み操作の場合はプライマリ ノードに、読み取り専用クエリの場合はセカンダリ ノードに直接接続できます。

    ![フェールオーバー クラスター マネージャー内のAG](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665534.gif)

>[AZURE.WARNING] フェールオーバー クラスター マネージャーから可用性グループをフェールオーバーしないでください。 内からすべてのフェールオーバー操作を実行する必要があります **AlwaysOn ダッシュ ボード** SSMS でします。 詳細については、次を参照してください。 [制限を使用して、WSFC フェールオーバー クラスター マネージャーに可用性グループで](https://msdn.microsoft.com/library/ff929171.aspx)します。

## 次のステップ
これで、Azure に可用性グループを作成して、SQL Server AlwaysOn を実装できました。 この可用性グループのリスナーを構成するのを参照してください。 [Azure で AlwaysOn 可用性グループ用の ILB リスナーを構成する](virtual-machines-sql-server-configure-ilb-alwayson-availability-group-listener.md)です。

Azure での SQL Server の使用についての他の情報を参照してください。 [Azure 仮想マシン上の SQL Server](../articles/virtual-machines/virtual-machines-sql-server-infrastructure-services.md)します。


