<properties 
   pageTitle="StorSimple デバイスの MPIO の構成 | Microsoft Azure"
   description="Windows Server 2012 R2 を実行するホストに接続されている、StorSimple デバイスのマルチパス I/O (MPIO) を構成する方法を説明します。"
   services="storsimple"
   documentationCenter=""
   authors="alkohli"
   manager="carolz"
   editor="" />
<tags 
   ms.service="storsimple"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="08/31/2015"
   ms.author="alkohli" />


# StorSimple デバイスのマルチパス IO の構成

Microsoft では、フォールト トレランスと可用性に優れた SAN を構成するために、Windows Server でマルチパス I/O (MPIO) 機能をサポートしています。 MPIO では、アダプター、ケーブル、スイッチなどの冗長な物理パス コンポーネントを使用して、サーバーとストレージ デバイスの間に論理パスを作成します。 コンポーネントのエラーによって論理パスに障害が発生した場合は、マルチパス ロジックで I/O の代替パスが使用され、アプリケーションから引き続きデータにアクセスできるようにします。 さらに構成によっては、これらのパスの間で負荷を分散することで、パフォーマンスの向上にも貢献します。 詳細については、次を参照してください。 [MPIO の概要](https://technet.microsoft.com/library/cc725907.aspx "MPIO の概要と機能")します。

StorSimple ソリューションの可用性を高めるためには、StorSimple デバイスで MPIO を構成する必要があります。 Windows Server 2012 R2 を実行するホスト サーバーに MPIO をインストールすると、サーバーでリンク、ネットワーク、またはインターフェイスのフォールト トレランスが有効になります。

MPIO はオプションの機能であり、Windows サーバーに既定ではインストールされていません。 サーバー マネージャーを使用して、機能としてインストールする必要があります。 このトピックでは、Windows Server 2012 R2 が実行され、StorSimple 物理デバイスに接続されているホストに MPIO 機能をインストールし、その機能を使用するための手順を説明します。
>[AZURE.NOTE] **StorSimple 仮想デバイスでは、MPIO がサポートされていません。**

次の手順に従って、StorSimple デバイスに MPIO を構成します。

- 手順 1. Windows Server ホストに MPIO をインストールする

- 手順 2. StorSimple ボリュームの MPIO を構成する

- 手順 3. ホストに StorSimple ボリュームをマウントする

- 手順 4. 高可用性と負荷分散のために MPIO を構成する

これらの各手順を以下のセクションで説明します。

## 手順 1. Windows Server ホストに MPIO をインストールする

Windows Server ホストにこの機能をインストールするには、次の手順を実行します。

#### ホストに MPIO をインストールするには

1. Windows Server ホストでサーバー マネージャーを開きます。 既定では、Windows Server 2012 R2 または Windows Server 2012 を実行しているコンピューターに Administrators グループのメンバーがログオンすると、サーバー マネージャーが起動します。 サーバー マネージャーがまだ開いていない場合はクリックして **開始 > サーバー マネージャー**します。
![サーバー マネージャー](./media/storsimple-configure-mpio-windows-server/IC740997.png)
2. **[サーバー マネージャー]、[ダッシュボード]、[役割と機能の追加]** の順にクリックします。 起動、 **追加の役割と機能の** ウィザード。
![役割と機能の追加ウィザード 1](./media/storsimple-configure-mpio-windows-server/IC740998.png)
3. **役割と機能の追加**ウィザードで、次の手順を実行します。

    - **[開始する前に]** ページで **[次へ]** をクリックします。
    - **[インストールの種類の選択]** ページで、**[役割ベースまたは機能ベースのインストール]** の既定の設定をそのまま使用します。 クリックして **次**.![役割と機能のウィザード 2 追加](./media/storsimple-configure-mpio-windows-server/IC740999.png)
    - **[対象サーバーの選択]** ページで、**[サーバー プールからサーバーを選択]** を選択します。 使用中のホスト サーバーが自動的に検出されます。 **[次へ]** をクリックします。
    - **[サーバーの役割の選択]** ページで、**[次へ]** をクリックします。
    - **機能の選択** ] ページで選択 **マルチパス I/O**, 、] をクリック **次**.![役割と機能のウィザード 5 の追加](./media/storsimple-configure-mpio-windows-server/IC741000.png)
    - **[インストール オプションの確認]** ページで、オプションの設定内容を確認し、次のように **[必要に応じて対象サーバーを自動的に再起動する]** を選択します。 クリックして **インストール**.![役割と機能のウィザード 8 追加](./media/storsimple-configure-mpio-windows-server/IC741001.png)
    - インストールが完了すると、通知が表示されます。 クリックして **閉じる** を閉じますウィザードの![。役割と追加機能ウィザード 9](./media/storsimple-configure-mpio-windows-server/IC741002.png)

## 手順 2. StorSimple ボリュームの MPIO を構成する

StorSimple ボリュームを識別するには、MPIO を構成する必要があります。 StorSimple ボリュームを認識するように MPIO を構成するには、次の手順を実行します。

#### StorSimple ボリュームの MPIO を構成する

1. **[MPIO の構成]** を開きます。 **[サーバー マネージャー]、[ダッシュボード]、[ツール]、[MPIO]** の順にクリックします。

2. **[MPIO のプロパティ]** ダイアログ ボックスで、**[マルチパスの検出]** タブを選択します。

3. 選択 **iSCSI デバイスのサポートを追加**, 、クリックして **追加**します。  
![MPIO プロパティ、マルチパスの検出](./media/storsimple-configure-mpio-windows-server/IC741003.png)

4. メッセージが表示されたら、サーバーを再起動します。
5. **[MPIO のプロパティ]** ダイアログ ボックスで、**[MPIO デバイス]** タブをクリックします。 **[追加]** をクリックします。
    </br>![MPIO プロパティの MPIO デバイス](./media/storsimple-configure-mpio-windows-server/IC741004.png)
6. **[MPIO サポートの追加]** ダイアログ ボックスで、**[デバイスのハードウェア ID]** にデバイスのシリアル番号を入力します。StorSimple Manager サービスにアクセスし、**[デバイス]、[ダッシュボード]** の順に移動することによって、デバイスのシリアル番号を取得できます。 デバイスのシリアル番号は右に表示される **概要** デバイス ダッシュ ボードのウィンドウです。
    </br>![MPIO サポートを追加します。](./media/storsimple-configure-mpio-windows-server/IC741005.png)
7. メッセージが表示されたら、サーバーを再起動します。

## 手順 3. ホストに StorSimple ボリュームをマウントする

Windows Server で MPIO が構成されると、StorSimple デバイスに作成されたボリュームをマウントし、MPIO を活用して冗長性を確保できます。 ボリュームをマウントするには、次の手順を実行します。

#### ホストにボリュームをマウントするには

1. Windows Server ホストで、**[iSCSI イニシエーターのプロパティ]** ウィンドウを開きます。 **[サーバー マネージャー]、[ダッシュボード]、[ツール]、[iSCSI イニシエーター]** の順にクリックします。
2. **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスで、[探索] タブをクリックし、**[ターゲット ポータルの探索]** をクリックします。
3. **[ターゲット ポータルの探索]** ダイアログ ボックスで、次の手順を実行します。

    - StorSimple デバイスの DATA ポートの IP アドレスを入力してください (たとえば、DATA 0 を入力します)。
    - **[OK]** をクリックして、**[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスに戻ります。
    >[AZURE.IMPORTANT] **iSCSI 接続のプライベート ネットワークを使用している場合は、プライベート ネットワークに接続されている DATA ポートの IP アドレスを入力します。**

4. デバイスでは、2 つ目のネットワーク インターフェイス (DATA 1 など) に対して手順 2 ~ 3 を繰り返します。 これらのインターフェイスは iSCSI に対応している必要があることに注意してください。 詳細については、次を参照してください。 [ネットワーク インターフェイスの変更](storsimple-modify-device-config.md#modify-network-interfaces)します。
5. **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスで、**[ターゲット]** タブを選択します。 StorSimple デバイスを表示する必要がありますターゲット IQN [ **検出されたターゲット**します。
 ![iSCSI イニシエーターのプロパティ、](./media/storsimple-configure-mpio-windows-server/IC741007.png)
6. **[接続]** をクリックして、StorSimple デバイスとの iSCSI セッションを確立します。 **[ターゲットへの接続]** ダイアログ ボックスが表示されます。

7. **[ターゲットへの接続]** ダイアログ ボックスで、**[複数パスを有効にする]** チェック ボックスをオンにします。 **[詳細設定]** をクリックします。

8. **[詳細設定]** ダイアログ ボックスで、次の手順を実行します。
    -    On the **Local Adapter** drop-down list, select **Microsoft iSCSI Initiator**.

    -    On the **Initiator IP** drop-down list, select the IP address of the host.

    -    On the **Target Portal** IP drop-down list, select the IP of device interface.

    -    Click **OK** to return to the **iSCSI Initiator Properties** dialog box.


9. **[プロパティ]** をクリックします。 **[プロパティ]** ダイアログ ボックスで、**[セッションの追加]** をクリックします。
10. **[ターゲットへの接続]** ダイアログ ボックスで、**[複数パスを有効にする]** チェック ボックスをオンにします。 **[詳細設定]** をクリックします。
11. **[詳細設定]** ダイアログ ボックスで、次の手順を実行します。
    -  **[ローカル アダプター]** ボックスの一覧で、[Microsoft iSCSI イニシエーター] を選択します。
    -  **[イニシエーター IP]** ボックスの一覧で、ホストに対応する IP アドレスを選択します。 この場合、デバイスの 2 つのネットワーク インターフェイスを、ホスト上の 1 つのネットワーク インターフェイスに接続しています。 そのため、このインターフェイスは最初のセッションで指定されたものと同じです。
    -  **[ターゲット ポータル IP]** ボックスの一覧で、デバイスで有効になっている 2 番目のデータ インターフェイスの IP アドレスを選択します。
    -  **[OK]** をクリックして、[iSCSI イニシエーターのプロパティ] ダイアログ ボックスに戻ります。 2 番目のセッションをターゲットに追加しました。

12. **[サーバー マネージャー]、[ダッシュボード]、[コンピューターの管理]** の順に移動して、**[コンピューターの管理]** を開きます。 左側のウィンドウで、**[ストレージ] の [ディスクの管理]** をクリックします。 このホストに表示される StorSimple デバイス上で作成したボリュームは、新しいディスクとして **[ディスクの管理]** に表示されます。

13. ディスクを初期化して、新しいボリュームを作成します。 フォーマット処理中に 64 KB のブロック サイズを選択します。
![クリックし](./media/storsimple-configure-mpio-windows-server/IC741008.png)
14. **[ディスクの管理]** で、**[ディスク]** を右クリックし、**[プロパティ]** を選択します。
15. StorSimple モデル ### **マルチパス ディスクのデバイス プロパティ** ダイアログ ボックスで、をクリックして、 **MPIO タブ**します。
![StorSimple 8100 マルチパス ディスクのデバイス プロパティ](./media/storsimple-configure-mpio-windows-server/IC741009.png)

16. **[DSM 名]** セクションで、**[詳細]** をクリックし、パラメーターに既定のパラメーターが設定されていることを確認します。既定のパラメーターは次のとおりです。

    - パス確認期間 = 30
    - 再試行回数 = 3
    - PDO 削除期間 = 20
    - 再試行間隔 = 1
    - パス確認を有効化する = オフ


>[AZURE.NOTE] **既定のパラメーターは変更しないでください。**

## 手順 4. 高可用性と負荷分散のために MPIO を構成する

高可用性と負荷分散を基にしたマルチパスでは、複数のセッションを手動で追加し、利用可能なさまざまなパスを宣言する必要があります。 たとえば、ホストの 2 つのインターフェイスが SAN に接続されていて、デバイスの 2 つのインターフェイスが SAN に接続されている場合は、4 つのセッションに適切なパスの順列を構成する必要があります (各 DATA インターフェイスおよびホスト インターフェイスが異なる IP サブネット上にあってルーティング可能ではない場合は、必要なセッションは 2 つだけです)。
>[AZURE.IMPORTANT] * * 1 GbE と 10 GbE ネットワーク インターフェイスを混合しないことをお勧めします。 2 つのネットワーク インターフェイスを使用する場合は、両方のインターフェイスがある必要がありますと同一の type.* *

次の手順では、2 つのネットワーク インターフェイスを持つ StorSimple デバイスが 2 つのネットワーク インターフェイスを持つホストに接続されている場合に、セッションを追加する方法について説明します。

### 高可用性と負荷分散のために MPIO を構成するには

1. ターゲットの検出を実行します。**[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスの **[探索]** タブで、**[ポータルの探索]** をクリックします。
2. **[ターゲットへの接続]** ダイアログ ボックスで、いずれかのデバイス ネットワーク インターフェイスの IP アドレスを入力します。
3. **[OK]** をクリックして、**[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスに戻ります。

4. **[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスの **[ターゲット]** タブで、検出したターゲットを強調表示し、**[接続]** をクリックします。 **[ターゲットへの接続]** ダイアログ ボックスが表示されます。

5. **[ターゲットへの接続]** ダイアログ ボックスで、次の手順を実行します。

    - **[この接続をお気に入りのターゲットの一覧に追加する]** を既定の選択したターゲット設定のままにします。 この設定により、デバイスはこのコンピューターが起動するたびに、接続を自動的に再起動します。
    - **[複数パスを有効にする]** チェック ボックスをオンにします。
    - **[詳細設定]** をクリックします。

6. **[詳細設定]** ダイアログ ボックスで、次の手順を実行します。
    - **[ローカル アダプター]** ボックスの一覧で、**[Microsoft iSCSI イニシエーター]** を選択します。
    - **[イニシエーター IP]** ボックスの一覧で、ホストの IP アドレスを選択します。
    - **[ターゲット ポータル IP]** ボックスの一覧で、デバイスで有効になっているデータ インターフェイスの IP アドレスを選択します。
    - **[OK]** をクリックして、[iSCSI イニシエーターのプロパティ] ダイアログ ボックスに戻ります。

7. **[プロパティ]** をクリックし、**[プロパティ]** ダイアログ ボックスで、**[セッションの追加]** をクリックします。

8. **[ターゲットへの接続]** ダイアログ ボックスで、**[複数パスを有効にする]** チェック ボックスをオンにし、**[詳細設定]** をクリックします。

9. **[詳細設定]** ダイアログ ボックスで、次の手順を実行します。
    1. **[ローカル アダプター]** ボックスの一覧で、**[Microsoft iSCSI イニシエーター]** を選択します。
    2. **[イニシエーター IP]** ボックスの一覧で、ホストの 2 番目のインターフェイスに対応する IP アドレスを選択します。
    3. **[ターゲット ポータル IP]** ボックスの一覧で、デバイスで有効になっている 2 番目のデータ インターフェイスの IP アドレスを選択します。
    4. **[OK]** をクリックして、**[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスに戻ります。 これで 2 番目のセッションがターゲットに追加されました。

10. 追加のセッション (パス) をターゲットに追加するには、手順 8. ～ 10. を繰り返します。 ホスト上の 2 つのインターフェイスとデバイス上の 2 つのインターフェイスを使用して、合計 4 つのセッションを追加できます。

11. 目的のセッション (パス) を追加した後、**[iSCSI イニシエーターのプロパティ]** ダイアログ ボックスで、ターゲットを選択し、**[プロパティ]** をクリックします。 **[プロパティ]** ダイアログ ボックスの [セッション] タブで、可能なパスの順列に対応する 4 つのセッション ID を確認します。 セッションを取り消すには、セッション ID の横にあるチェック ボックスをオンにして、**[切断]** をクリックします。

12. セッション内に示されるデバイスを表示するには、**[デバイス]** タブを選択します。 選択したデバイスの MPIO ポリシーを構成するには、**[MPIO]** をクリックします。 **[デバイスの詳細]** ダイアログ ボックスが表示されます。 **[MPIO]** タブで、適切な **[負荷分散ポリシー]** の設定を選択できます。 **[アクティブ]** または **[スタンバイ]** のパスの種類も表示することができます。

## 次のステップ

詳細について [StorSimple Manager サービスを使用して、StorSimple デバイスの構成を変更する](storsimple-modify-device-config.md)します。





