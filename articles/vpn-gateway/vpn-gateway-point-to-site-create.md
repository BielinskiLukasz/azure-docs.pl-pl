<properties
   pageTitle="Azure Virtual Network へのポイント対サイト VPN 接続の構成 | Microsoft Azure"
   description="ポイント対サイト VPN 接続を作成することで、Azure Virtual Network に安全に接続します。Service Management (クラシック) のデプロイ モデルを使用して作成された VNet を対象とする手順です。"
   services="vpn-gateway"
   documentationCenter="na"
   authors="cherylmc"
   manager="carolz"
   editor=""
   tags="azure-service-management"/>

<tags
   ms.service="vpn-gateway"
   ms.devlang="na"
   ms.topic="hero-article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="11/16/2015"
   ms.author="cherylmc"/>


# VNet へのポイント対サイト VPN 接続の構成

この記事は、クラシック デプロイ モデル (サービス管理) を使用して作成された仮想ネットワークのポイント対サイト接続に適用されます。

**現時点では、Azure リソース マネージャー デプロイ モデルを使用して作成された仮想ネットワークへのポイント対サイト接続はサポートされていません。**このページは、この機能がリソース マネージャーのデプロイ モデルでサポートされた時点で更新されます。

[AZURE.INCLUDE [vpn-gateway-sm-rm](../../includes/vpn-gateway-sm-rm-include.md)]

次の手順では、仮想ネットワークに対してセキュリティで保護されたポイント対サイト接続を作成する方法を説明します。 ポイント対サイト接続の構成には複数の手順が必要ですが、これはコンピューターから仮想ネットワークに安全に接続するための優れた手法です。VPN デバイスを購入し、構成する必要はありません。

ポイント対サイト接続の構成は 3 つのセクションに分けられる: 仮想ネットワークと VPN ゲートウェイ、認証に使用する証明書、仮想ネットワークへの接続に使用する VPN クライアント。 各部分を構成する順序が重要です。手順をスキップしたり、先に進んだりすることはできません。

## セクション 1 - 仮想ネットワークと VPN ゲートウェイの作成

ポイント対サイト接続には、仮想ネットワークと動的ルーティング ゲートウェイが必要です。 この後、次の手順について説明します。

手順 1. 仮想ネットワークの作成

手順 2. 動的ルーティング ゲートウェイの作成

### 仮想ネットワークの作成

1. **Azure クラシック ポータル**にログインします (Azure ポータルではありません)。
1. 画面の左下隅で **[新規]** をクリックします。 ナビゲーション ウィンドウで **[Network Services]** をクリックし、**[Virtual Network]** をクリックします。 **[カスタム作成]** をクリックして、構成ウィザードを開始します。
1. **[仮想ネットワークの詳細]** ページで、次の情報を入力し、右下にある次へ進む矢印をクリックします。
    - **[名前]**: 仮想ネットワークの名前を指定します。 たとえば、「VNetEast」と指定します。 これは、この VNet に VM と PaaS インスタンスをデプロイするときに参照する名前です。
    - **[場所]**: 場所は、リソース (VM) を配置する物理的な場所 (リージョン) に直接関連します。 たとえば、この仮想ネットワークにデプロイする VM を物理的に米国東部に配置する場合は、場所として米国東部を選択します。 仮想ネットワークを作成した後で、その仮想ネットワークに関連付けられたリージョンを変更することはできません。
1. **[DNS サーバーおよび VPN 接続]** ページで次の情報を入力し、右下にある次へ進む矢印をクリックします。
    - **[DNS サーバー]**: DNS サーバー名と IP アドレスを入力するか、以前に登録した DNS サーバーをショートカット メニューから選択します。 この設定は、この仮想ネットワークの名前解決に使用する DNS サーバーを指定するものであり、DNS サーバーが作成されるわけではありません。 Azure の既定の名前解決サービスを使用する場合は、このセクションは空白のままにします。
    - **[ポイント対サイト VPN の構成]**: チェック ボックスをオンにします。
1. **ポイント対サイト接続** ] ページで、VPN クライアントが接続されている場合に、IP アドレスを受信元となる IP アドレスの範囲を指定します。 指定可能なアドレスの範囲については、いくつかの規則があります。 指定した範囲が、オンプレミス ネットワーク上のどの範囲とも重複しないことを確認することは非常に重要です。
1. 次の情報を入力して、次へ進む矢印をクリックします。
 - **[アドレス空間]**: 開始 IP と CIDR (アドレス数) を指定します。
 - **[アドレス空間の追加]**: ネットワーク設計に必要な場合にのみ追加します。
1. **[仮想ネットワーク アドレス空間]** ページで、仮想ネットワークに使用するアドレス範囲を指定します。 これらが動的 IP アドレス (DIPS) として、この仮想ネットワークにデプロイする VM や各種ロール インスタンスに割り当てられます。 オンプレミス ネットワークに使用されている範囲と重複しない範囲を選択することが特に重要です。 仮想ネットワークに使用するオンプレミス ネットワークのアドレス空間から、ネットワーク管理者が IP アドレスの範囲を分割しなければならない可能性があるため、ネットワーク管理者と調整する必要があります。
1. 次の情報を入力し、チェックマークをクリックして仮想ネットワークの作成を開始します。
 - **[アドレス空間]**: 開始 IP や数など、この仮想ネットワークで使用する内部 IP アドレスの範囲を追加します。 オンプレミス ネットワークに使用されている範囲と重複しない範囲を選択することが重要です。 仮想ネットワークに使用するオンプレミス ネットワークのアドレス空間から、ネットワーク管理者が IP アドレスの範囲を分割しなければならない可能性があるため、ネットワーク管理者と調整する必要があります。
 - **[サブネットの追加]**: 追加サブネットは必須ではありませんが、VM 用に静的 DIP を持つ別のサブネットを作成することをお勧めします。 または、他のロール インスタンスとは分離したサブネットに VM を配置することができます。
 - **[ゲートウェイ サブネットの追加]**: ゲートウェイ サブネットはポイント対サイト VPN に必須です。 クリックして、ゲートウェイ サブネットを追加します。 ゲートウェイ サブネットは仮想ネットワーク ゲートウェイにのみ使用されます。
1. 仮想ネットワークが作成されると、Azure クラシック ポータルの [Networks] ページの **[状態]** に **[作成済み]** と表示されます。 仮想ネットワークが作成されると、動的ルーティング ゲートウェイを作成できます。

### 動的ルーティング ゲートウェイの作成

ゲートウェイの種類として、動的ゲートウェイを構成する必要があります。 静的ルーティング ゲートウェイでは、この機能に対応できません。

1. Azure クラシック ポータルの **[Networks]** ページで、作成した仮想ネットワークをクリックし、**[ダッシュボード]** ページに移動します。
1. **[ダッシュボード]** ページの下部にある **[ゲートウェイの作成]** をクリックします。 **"仮想ネットワーク 'yournetwork' にゲートウェイを作成しますか?"** というメッセージが表示されます。 **[はい]** をクリックして、ゲートウェイの作成を開始します。 ゲートウェイの作成には 15 分ほどかかることがあります。

## セクション 2 - 証明書の生成とアップロード

証明書は、ポイント対サイト VPN の VPN クライアントの認証に使用されます。 以前は、独自の自己署名証明書を生成する必要がありました。 しかし現在は、エンタープライズ ソリューションを使用して生成した証明書を使用できます。 Azure には最大で 20 個のルート証明書をアップロードできます。

自己署名証明書を使用する場合は、次の手順でプロセスを確認してください。 エンタープライズ証明書ソリューションを使用することを計画している場合は、各セクションの手順は違ってきますが、次の作業は必須です。


手順 1. ルート証明書の識別または生成。

手順 2. Azure へのルート証明書 .cer ファイルのアップロード。

手順 3. クライアント証明書の生成

手順 4. クライアント証明書のエクスポートとインストール


### ルート証明書の識別または生成

エンタープライズ証明書ソリューションを使用していない場合は、自己署名ルート証明書を生成する必要があります。 以下の手順は Windows 8 向けのものです。 Windows 10 向けの新しい手順については現在準備中です。

1. X.509 証明書を作成する方法の 1 つは、証明書作成ツール (makecert.exe) を使用することです。 Makecert、ダウンロードとインストールを使用する [Microsoft Visual Studio Express](https://www.visualstudio.com/products/visual-studio-express-vs.aspx), 、これは無料です。
2. Visual Studio Tools フォルダーに移動して、管理者としてコマンド プロンプトを起動します。
3. 下の例のコマンドを使用すると、ルート証明書が作成され、コンピューターの個人用証明書ストアにインストールされます。また、対応する *.cer* ファイルも作成されます。このファイルは、後で Azure クラシック ポータルにアップロードします。
4. .cer ファイルを格納するディレクトリに移動して、下のコマンドを実行します。*RootCertificateName* は、証明書に使用する名前です。 何も変更せずに次の例を実行した場合、ルート証明書と、対応する *RootCertificateName.cer* ファイルが作成されます。

>[AZURE.NOTE] クライアント証明書の生成元となるルート証明書を作成したので、この証明書を秘密キーと共にエクスポートし、回復できる安全な場所に保存します。

    makecert -sky exchange -r -n "CN=RootCertificateName" -pe -a sha1 -len 2048 -ss My "RootCertificateName.cer"

### Azure クラシック ポータルへのルート証明書 .cer ファイルのアップロード

各ルート証明書に対応する .cer ファイルを Azure にアップロードする必要があります。 最大 20 個の証明書をアップロードすることができます。

1. 前の手順でルート証明書を生成したときに、*.cer* ファイルも作成されています。 そのファイルを Azure クラシック ポータルにアップロードします。 .cer ファイルには、ルート証明書の秘密キーは含まれていません。 最大 20 個のルート証明書をアップロードすることができます。
1. Azure クラシック ポータルで、仮想ネットワークの **[証明書]** ページにある **[ルート証明書のアップロード]** をクリックします。
1. **[証明書のアップロード]** ページで、.cer ルート証明書を参照して、チェックマークをクリックします。

### クライアント証明書を生成

次の手順は、自己署名ルート証明書からクライアント証明書を生成するためのものです。 エンタープライズ証明書ソリューションを使用している場合は、使用しているソリューションのガイドラインに従ってください。

1. 自己署名ルート証明書の作成に使用した同じコンピューターで、管理者として Visual Studio コマンド プロンプト ウィンドウを開きます。
2. クライアント証明書ファイルを保存するディレクトリに移動します。 *RootCertificateName* は、生成した自己署名ルート証明書を指します。 下の例 (RootCertificateName を自分のルート証明書の名前に変更します) を実行すると、個人用証明書ストアに "ClientCertificateName" という名前のクライアント証明書が作成されます。
3. 次のコマンドを入力します。

    makecert.exe -n "CN=ClientCertificateName" -pe -sky exchange -m 96 -ss My -in "RootCertificateName" -is my -a sha1

4. すべての証明書は、コンピューター上の個人用証明書ストアに格納されます。 *certmgr* で確認します。 この手順に基づいて、必要な数のクライアント証明書を生成することができます。 仮想ネットワークに接続する各コンピューターに、一意のクライアント証明書を作成することをお勧めします。

### クライアント証明書をエクスポートしてインストール

仮想ネットワークに接続する各コンピューターへのクライアント証明書のインストールは、必須の手順です。 次の手順では、クライアント証明書の手動インストールについて説明します。

1. クライアント証明書は、仮想ネットワークに接続する各コンピューターにインストールする必要があります。 つまり、ほとんどの場合、複数のクライアント証明を作成して、エクスポートする必要があります。 クライアント証明書をエクスポートするには、*certmgr.msc* を使用します。 エクスポートするクライアント証明書を右クリックして、**[すべてのタスク]**、**[エクスポート]** の順にクリックします。
2. *クライアント証明書*と秘密キーをエクスポートします。 これが *.pfx* ファイルになります。 この証明書に設定したパスワード (キー) を記録するか、覚えておいてください。
3. *.pfx* ファイルをクライアント コンピューターにコピーします。 クライアント コンピューターで、*.pfx* ファイルをダブルクリックしてインストールします。 要求された場合は、パスワードを入力します。 インストール先は変更しないでください。

## セクション 3 - VPN クライアントの構成

仮想ネットワークに接続するには、VPN クライアントも構成する必要があります。 クライアントが接続するために、クライアント証明書と適切な VPN クライアント構成の両方が必要です。

VPN クライアントを構成するには、次の手順に順番に従います。

手順 1. VPN クライアント構成パッケージの作成。

手順 2. VPN 構成パッケージをクライアントにインストールして接続を開始。

手順 3. 接続の確認。

### VPN クライアント構成パッケージの作成

1. Azure クラシック ポータルで、仮想ネットワークの **[ダッシュボード]** ページにアクセスし、右隅にある [概要] メニューに移動して、仮想ネットワークに接続するクライアントに関連する VPN パッケージをクリックします。
2. 
次のクライアント オペレーティング システムがサポートされます。
 - Windows 7 (32 ビットと 64 ビット)
 - Windows Server 2008 R2 (64 ビットのみ)
 - Windows 8 (32 ビットと 64 ビット)
 - Windows 8.1 (32 ビットと 64 ビット)
 - Windows Server 2012 (64 ビットのみ)
 - Windows Server 2012 R2 (64 ビットのみ)
 - Windows 10

1. インストール先のクライアントのオペレーティング システムに対応するダウンロード パッケージを選択します。
 - 32 ビットのクライアントの場合は、**[32 ビットのクライアント VPN パッケージのダウンロード]** を選択します。
 - 64 ビットのクライアントの場合は、**[64 ビットのクライアント VPN パッケージのダウンロード]** を選択します。
1. クライアント パッケージの作成には数分かかる場合があります。 パッケージの作成が完了したら、ファイルをダウンロードすることができます。 ダウンロードした *.exe* ファイルは、ローカル コンピューターに安全に格納することができます。
1. Azure クラシック ポータルで VPN クライアント パッケージを生成してダウンロードした後、仮想ネットワークに接続するクライアント コンピューターにクライアント パッケージをインストールすることができます。 複数のクライアント コンピューターに VPN クライアント パッケージをインストールする場合は、各コンピューターにクライアント証明書がインストールされていることを確認します。 VPN クライアント パッケージには、Windows に組み込まれた VPN クライアント ソフトウェアを構成する構成情報が含まれています。 このパッケージでは、追加のソフトウェアはインストールされません。

### VPN 構成パッケージをクライアントにインストールして接続を開始

1. 仮想ネットワークに接続するコンピューターのローカルに構成ファイルをコピーして、.exe ファイルをダブルクリックします。 パッケージがインストールされると、VPN 接続を開始できます。
構成パッケージは Microsoft によって署名されていないことに注意してください。 可能性があります、組織の署名サービスを使用してパッケージに署名するか自分で署名を使用して [SignTool](http://go.microsoft.com/fwlink/p/?LinkId=699327)します。 署名なしでパッケージを使用することもできます。 ただし、パッケージが署名されていない場合は、パッケージのインストール時に警告が表示されます。
2. クライアント コンピューターで [VPN 接続] に移動し、作成した VPN 接続を見つけます。 仮想ネットワークと同じ名前が付いています。 **[接続]** をクリックします。
3. ゲートウェイ エンドポイントの自己署名証明書の作成に使用されるポップアップ メッセージが表示されます。 **[続行]** をクリックして、昇格された特権を使用します。
4. **接続**の状態ページで、**[接続]** をクリックして接続を開始します。
5. **[証明書の選択]** 画面が表示された場合は、表示されているクライアント証明書が接続に使用する証明書であることを確認します。 そうでない場合は、ドロップダウン矢印を使用して適切な証明書を選択し、**[OK]** をクリックします。
6. これで、仮想ネットワークに接続し、その仮想ネットワークのすべてのサービスとホストされている仮想マシンへのフル アクセスが可能になります。

### VPN 接続の確認

1. VPN 接続がアクティブであることを確認するには、管理者特権でのコマンド プロンプトを開いて、*ipconfig/all* を実行します。
2. 結果を表示します。 受信した IP アドレスが、VNet の作成時に指定したポイント対サイト接続アドレス範囲内のアドレスのいずれかであることに注意してください。 結果は、次のようになります。

例:



    PPP adapter VNetEast:
        Connection-specific DNS Suffix .:
        Description.....................: VNetEast
        Physical Address................:
        DHCP Enabled....................: No
        Autoconfiguration Enabled.......: Yes
        IPv4 Address....................: 192.168.130.2(Preferred)
        Subnet Mask.....................: 255.255.255.255
        Default Gateway.................:
        NetBIOS over Tcpip..............: Enabled

## 次のステップ

この記事で仮想ネットワーク間のクロスプレミス接続についての詳細については、: [仮想ネットワークはクロスプレミス接続をセキュリティで保護](vpn-gateway-cross-premises-options.md)します。

サイト間 VPN 接続を構成する場合は、「 [サイト間 VPN ゲートウェイの接続と仮想ネットワークの構成](vpn-gateway-site-to-site-create.md)します。

仮想ネットワークに仮想マシンを追加できます。 参照してください [カスタム仮想マシンを作成する方法](../virtual-machines/virtual-machines-create-custom.md)します。

仮想ネットワークの詳細にする場合は、「、 [Virtual Network ドキュメント](https://azure.microsoft.com/documentation/services/virtual-network/) ページです。





