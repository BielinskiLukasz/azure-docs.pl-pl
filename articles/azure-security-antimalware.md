<properties
   pageTitle="Azure Cloud Services および Virtual Machines 向け Microsoft マルウェア対策 | Microsoft Azure"
   description="この記事では、Azure 向けの Microsoft マルウェア対策のアーキテクチャの概要を説明します。Azure Cloud Services および Virtual Machines の保護の有効化、構成、デプロイに関するサポートされるシナリオと構成などについて説明します。Microsoft Azure サービス管理 API、PowerShell スクリプト、Microsoft Azure 管理ポータル、Visual Studio でアクセスできる基本的な構成、管理、監視の機能を説明します。"
   services="virtual-machines, cloud-services, storage"
   documentationCenter="na"
   authors="YuriDio"
   manager="swadhwa"
   editor=""/>

<tags
   ms.service="azure-security"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="12/10/2015"
   ms.author="yuridio"/>


# Azure Cloud Services および Virtual Machines 向け Microsoft マルウェア対策

最近のクラウド環境に対する脅威は非常に変化が激しく、コンプライアンスとセキュリティの要件を満たすために効果的な保護を維持しなければならないというビジネス IT クラウドのサブスクライバーに対する圧力はますます大きくなっています。 Azure Cloud Services および Virtual Machines 向けの Microsoft マルウェア対策は、ウイルスやスパイウェアなどの悪意のあるソフトウェアを識別して削除するリアルタイム保護機能であり、既知のマルウェアや不要なソフトウェアが Azure システムへのインストールまたは実行を試みた場合に警告する構成可能なアラートを備えています。

ソリューションをビルド、同じマルウェア対策とプラットフォームを Microsoft Security Essentials \[MSE\]、Microsoft Forefront Endpoint Protection、Microsoft System Center Endpoint Protection、Windows Intune、および Windows 8.0 以降の Windows Defender します。 Azure 向け Microsoft マルウェア対策は、アプリケーションおよびテナント環境のための単一エージェント ソリューションであり、ユーザーの介入なしにバック グラウンドで実行するように作られています。 アプリケーションのワークロードのニーズに基づいて、マルウェア対策監視など、基本的な既定のセキュリティまたは高度なカスタム構成で、保護をデプロイできます。

Azure 向け Microsoft マルウェア対策をアプリケーションにデプロイして有効にすると、次のコア機能を使用できるようになります。

**リアルタイム保護** - Cloud Services および Virtual Machines でのアクティビティを監視し、マルウェアの実行を検出してブロックします。

**スケジュールに基づくスキャン** - 特定対象のスキャンを定期的に実行し、マルウェアや活動量の多いプログラムを検出します。

**マルウェアの駆除** - 悪意のあるファイルの削除や検疫、悪意のあるレジストリ エントリのクリーンアップなど、検出されたマルウェアへの対処を自動的に行います。

**シグネチャの更新** - 最新の保護シグネチャ (ウイルスの定義) を自動的にインストールし、事前に定義された頻度で保護を最新の状態に更新します。

**マルウェア対策エンジンの更新** - Microsoft マルウェア対策エンジンを自動的に更新します。

**マルウェア対策プラットフォームの更新** - Microsoft マルウェア対策プラットフォームを自動的に更新します。

**アクティブ保護** - 検出された脅威および疑わしいリソースに関するテレメトリ メタデータを Microsoft Azure に報告して発生中の脅威に迅速に対応すると共に、Microsoft Active Protection System (MAPS) を使用して同期されたシグネチャをリアルタイムで配信できるようにします。

**サンプルのレポート** - Microsoft マルウェア対策サービスにサンプルを提供および報告し、サービスの調整およびトラブルシューティングを可能にします。

**除外** – パフォーマンスやその他の理由で、アプリケーションおよびサービスの管理者が特定のファイル、プロセス、ドライブを保護から除外できるようにします。

**マルウェア対策イベントの収集** - マルウェア対策サービスの状態、疑わしいアクティビティ、および実行された修復アクションをオペレーティング システムのイベント ログに記録し、顧客の Azure ストレージ アカウントにそれらを収集します。

## アーキテクチャ

Azure Cloud Services および Virtual Machines 向け Microsoft マルウェア対策ソリューションには、Microsoft マルウェア対策クライアントとサービス、マルウェア対策サービス管理拡張機能、マルウェア対策 PowerShell コマンドレット、および Azure 診断拡張機能が含まれます。 Microsoft マルウェア対策ソリューションは、Windows Server 2008 R2、Windows Server 2012、および Windows Server 2012 R2 の各オペレーティング システム ファミリでサポートされます。 Windows Server 2008 オペレーティング システムではサポートされません。 現時点では Windows Server Technical Preview はサポートされていませんが、将来的にはサポートされる予定です。

Microsoft マルウェア対策クライアントおよびサーバーは、既定では、Cloud Services プラットフォームのすべてのサポートされる Azure ゲスト オペレーティング システム ファミリに無効状態でインストールされます。

Microsoft マルウェア対策クライアントおよびサービスは既定では Virtual Machines プラットフォームにはインストールされず、Microsoft Azure 管理ポータルおよび Visual Studio 仮想マシン構成のセキュリティ拡張機能でオプション機能として使用できます。

### Microsoft マルウェア対策のワークフロー

Azure サービスの管理者は、既定の構成で、または以下のオプションを使用してカスタム構成で、Virtual Machines および Cloud Services に対する Azure 向けマルウェア対策を有効にできます。

-   Virtual Machines – Microsoft Azure 管理ポータルの [セキュリティ拡張機能]

-   Virtual Machines – Visual Studio のサーバー エクスプローラーの仮想マシン構成

-   Virtual Machines および Cloud Services – マルウェア対策サービス管理 API (SMAPI)

-   Virtual Machines および Cloud Services – マルウェア対策 PowerShell コマンドレット

Microsoft Azure 管理ポータルまたは PowerShell コマンドレットは、あらかじめ決められている固定の場所にある Azure システムに、マルウェア対策拡張機能パッケージ ファイルをプッシュします。 Azure ゲスト エージェント (またはファブリック エージェント) は、マルウェア対策拡張機能を起動し、入力として提供されたマルウェア対策の構成設定を適用します。 これにより、マルウェア対策サービスは既定またはカスタムの構成設定で有効になります。 カスタム構成を指定しないと、マルウェア対策サービスは既定の構成設定で有効になります。 参照してください、 *マルウェア対策の構成* セクション、 [Azure クラウド サービスと仮想マシン-コード サンプルの Microsoft マルウェア対策](http://aka.ms/amazsamples "Microsoft マルウェア対策の Azure クラウド サービスと Vm のコード サンプル") 詳細です。

Microsoft マルウェア対策クライアントは実行すると、最新の保護エンジンとシグネチャ定義をインターネットからダウンロードして、Azure システムに読み込みます。 Microsoft マルウェア対策サービスは、サービス関連のイベントをシステム OS イベント ログの "Microsoft マルウェア対策" イベント ソースに書き込みます。 イベントには、マルウェア対策クライアントの正常性状態、保護と修復の状態、新旧の構成設定、エンジンの更新とシグネチャの定義、その他が含まれます。

生成されたマルウェア対策イベント ログ イベントを Azure ストレージ アカウントに書き込むように、Cloud Service または Virtual Machine のマルウェア対策監視を構成できます。 マルウェア対策サービスは、Azure 診断拡張機能を使用して、Azure システムから顧客の Azure ストレージ アカウントのテーブルにマルウェア対策イベントを収集できます。

構成手順と、上記のシナリオについては、「でサポートされているオプションの展開ワークフロー [マルウェア対策の展開シナリオ](#_Antimalware_Deployment_Scenarios) このドキュメントの「します。

![Azure での Microsoft マルウェア対策](./media/azure-security-antimalware/sec-azantimal-fig1.PNG)

### マルウェア対策の既定の構成とカスタム構成

カスタム構成設定を指定しない場合、Azure Cloud Services または Virtual Machines のマルウェア対策は既定の構成設定を適用して有効になります。 既定の構成設定は、Azure 環境での実行に合わせてあらかじめ最適化されています。 Azure アプリケーションまたはサービスのデプロイメントでの必要に応じて既定の構成設定をカスタマイズし、他のデプロイメント シナリオに適用できます。

次の表は、マルウェア対策サービスで使用できる構成設定をまとめたものです。 「既定値」列は既定の構成設定です。

![表 1](./media/azure-security-antimalware/sec-azantimal-tb18.PNG)

## マルウェア対策のデプロイ シナリオ

ここでは、Azure Cloud Services および Virtual Machines の監視など、マルウェア対策を有効にして構成するシナリオについて説明します。

### Virtual Machines - マルウェア対策の有効化と構成

**Azure プレビュー ポータルを使用したデプロイ**

マルウェア対策サービスを有効にするには、[拡張機能] ブレードの **[追加]** をクリックし、[新しいリソース] ブレードで **[Microsoft マルウェア対策]** を選択して、[Microsoft マルウェア対策] ブレードの **[作成]** をクリックします。 既定の設定でマルウェア対策を有効にするには、構成の値を入力しないで **[作成]** をクリックします。または、下の図 2 に示すように、構成されている Virtual Machine に対するマルウェア対策の構成設定を入力します。 サポートされる構成値については、[拡張機能の追加] ブレードの各構成設定の**ツールヒント**を参照してください。

![Microsoft マルウェア対策用の Virtual Machine の構成設定](./media/azure-security-antimalware/sec-azantimal-fig2.PNG)

**Microsoft Azure 管理ポータルを使用したデプロイ**

Azure Virtual Machines のプロビジョニングの間に Microsoft Azure 管理ポータルを使用して Virtual Machines の Microsoft マルウェア対策を有効化および構成するには、次の手順のようにします。

1.Azure 管理ポータルにログオン <https://manage.windowsazure.com>

2.新しいバーチャル マシンを作成する] をクリックして **新規**, 、**コンピューティング**, 、**仮想** **マシン**, 、**ギャラリーから** (使用しない簡易作成) 次のようにします。

![新しい仮想マシン](./media/azure-security-antimalware/sec-azantimal-fig3.PNG)


3.選択、 **Microsoft Windows Server** でイメージ、 **イメージの選択** ページです。

4.右矢印をクリックし、仮想マシンの構成を入力します。

5.チェック、 **Microsoft マルウェア対策** 下のチェック ボックス **セキュリティ拡張機能** 仮想マシンの構成] ページ。

6.有効にして既定の構成設定を Azure の仮想マシンの Microsoft マルウェア対策を構成するには、送信ボタンをクリックします。

![仮想マシンの構成](./media/azure-security-antimalware/sec-azantimal-fig4.PNG)

**Visual Studio の仮想マシン構成を使用したデプロイメント**

Visual Studio を使用して Microsoft マルウェア対策サービスを有効化および構成するには:

1.Visual Studio での Microsoft Azure に接続します。

2.仮想マシンを選択して、 **仮想マシン** 内のノード **サーバー エクスプ ローラー**

![Visual Studio での仮想マシンの構成](./media/azure-security-antimalware/sec-azantimal-fig5.PNG)

3.右クリックして **構成** を仮想マシンの構成ページを表示するには

4.選択 **Microsoft マルウェア対策** 下にあるドロップダウン リストから拡張 **インストールされた拡張機能** ] をクリック **追加** マルウェア対策の既定の構成を構成します。

![インストール済み拡張機能](./media/azure-security-antimalware/sec-azantimal-fig6.PNG)

5.既定のマルウェア対策の構成をカスタマイズするには、インストールされている拡張機能の一覧の (強調表示)、マルウェア対策の拡張機能を選択し、クリックして **構成**します。

6.サポートされている JSON 形式でカスタムの構成に既定のマルウェア対策の構成を置き換える、 **パブリック構成** textbox OK] をクリックします。

7.をクリックして、 **更新** 仮想マシンに構成の更新をプッシュするボタンをクリックします。

![仮想マシン構成拡張機能](./media/azure-security-antimalware/sec-azantimal-fig7.PNG)

**注:** Visual Studio でのマルウェア対策の Virtual Machines 構成は、JSON 形式の構成のみをサポートします。 マルウェア対策の JSON の構成設定のテンプレートが含まれている、 [Microsoft マルウェア対策の Azure クラウド サービスと仮想マシンのコード サンプル](http://aka.ms/amazsamples "Microsoft マルウェア対策の Azure クラウド サービスと仮想マシンのコード サンプル"), 、サポートされているマルウェア対策の構成設定を表示します。

**PowerShell コマンドレットを使用したデプロイ**

Azure のアプリケーションまたはサービスでは、PowerShell コマンドレットを使用して Azure Virtual Machines の Microsoft マルウェア対策を有効化および構成できます。

マルウェア対策 PowerShell コマンドレットを使用して Microsoft マルウェア対策を有効化および構成するには:

1. PowerShell 環境を設定するのには、ドキュメントを参照してください <https://github.com/Azure/azure-sdk-tools#get-started>

2. セット AzureVMMicrosoftAntimalwareExtension マルウェア対策コマンドレットを使用して有効にして」の説明に従って、仮想マシンの Microsoft マルウェア対策を構成 <http://msdn.microsoft.com/library/azure/dn771718.aspx>

**注:** Azure Virtual Machines でのマルウェア対策の構成は、JSON 形式の構成のみをサポートします。 マルウェア対策の JSON の構成設定のテンプレートが含まれている、 [Microsoft マルウェア対策の Azure クラウド サービスと仮想マシンのコード サンプル](http://aka.ms/amazsamples "Microsoft マルウェア対策の Azure クラウド サービスと仮想マシンのコード サンプル"), 、サポートされているマルウェア対策の構成設定を表示します。

### PowerShell コマンドレットを使用したマルウェア対策の有効化と構成

Azure のアプリケーションまたはサービスでは、PowerShell コマンドレットを使用して Azure Cloud Services 向けの Microsoft マルウェア対策を有効化および構成できます。 Microsoft マルウェア対策は Cloud Services プラットフォームに無効状態でインストールされるので、Azure アプリケーションで有効化する必要があることに注意してください。

PowerShell コマンドレットを使用して Microsoft マルウェア対策を有効化および構成するには:

1.  PowerShell 環境を設定するのには、ドキュメントを参照してください <https://github.com/Azure/azure-sdk-tools#get-started>

2.  セット AzureServiceAntimalwareExtension マルウェア対策コマンドレットを使用して有効にして」の説明に従って、Microsoft マルウェア対策をクラウド サービスの構成 <http://msdn.microsoft.com/library/azure/dn771718.aspx>

マルウェア対策の XML 構成の設定テンプレートが含まれている、 [Microsoft マルウェア対策の Azure クラウド サービスと仮想マシンのコード サンプル](http://aka.ms/amazsamples "Microsoft マルウェア対策の Azure クラウド サービスと仮想マシンのコード サンプル"), 、サポートされているマルウェア対策の構成設定を表示します。

### Cloud Services と Virtual Machines - PowerShell コマンドレットを用いた構成

Azure のアプリケーションまたはサービスでは、PowerShell コマンドレットを使用して、Cloud Services および Virtual Machines 向けの Microsoft マルウェア対策の構成を取得できます。

PowerShell コマンドレットを使用して Microsoft マルウェア対策の構成を取得するには:

1.  PowerShell 環境を設定するのには、ドキュメントを参照してください <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **Virtual Machines の**:」の説明に従って、マルウェア対策の構成を取得する Get AzureVMMicrosoftAntimalwareExtension マルウェア対策コマンドレットを使用 <http://msdn.microsoft.com/library/azure/dn771719.aspx>

3.  **クラウド サービスの**:」の説明に従って、マルウェア対策の構成を取得する Get AzureServiceAntimalwareConfig マルウェア対策コマンドレットを使用 <http://msdn.microsoft.com/library/azure/dn771722.aspx>

### PowerShell コマンドレットを使用したマルウェア対策の構成の削除

Azure アプリケーションまたはサービスでは、Cloud Service または Virtual Machine に関連付けられている関連する Azure マルウェア対策および診断サービスの拡張機能から、マルウェア対策の構成および関連付けられているマルウェア対策監視構成を削除できます。

PowerShell コマンドレットを使用して Microsoft マルウェア対策を削除するには:

1.  PowerShell 環境を設定するのには、ドキュメントを参照してください <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **Virtual Machines の**:」の説明に従って削除 AzureVMMicrosoftAntimalwareExtension マルウェア対策のコマンドレットを使用して <http://msdn.microsoft.com/library/azure/dn771720.aspx>

3.  **のクラウド サービス:** 」の説明に従って削除 AzureServiceAntimalwareExtension マルウェア対策のコマンドレットを使用して <http://msdn.microsoft.com/library/azure/dn771717.aspx>

Azure プレビュー ポータルを使用して仮想マシンのマルウェア対策イベント収集を**有効にする**には:

1.  [仮想マシン] ブレードの監視レンズのどこかをクリックします。

2.  [メトリック] ブレードの [診断] コマンドをクリックします。

3.  **[状態]** で [ON] を選択し、Windows イベント システム ログのオプションをオンにします。 一覧の他のオプションは、すべてオフにしても、アプリケーション サービスのニーズに応じて有効のままにしてもかまいません。

4.  「エラー」、「警告」、「情報」などのマルウェア対策イベント カテゴリが、Azure ストレージ アカウントに収集されます。

マルウェア対策のイベントが、Windows イベント システム ログから Azure ストレージ アカウントに収集されます。 適切なストレージ アカウントを選択することにより、マルウェア対策のイベントを収集するように仮想マシンのストレージ アカウントを構成できます。

![メトリックと診断](./media/azure-security-antimalware/sec-azantimal-fig8.PNG)

### PowerShell コマンドレットを使用したマルウェア対策の監視の有効化と構成

マルウェア対策 PowerShell コマンドレットを使用して、Azure 診断を用いた Cloud Service または Virtual Machine の Microsoft マルウェア対策イベントの収集を有効にできます。 システム イベント ログ ソース “Microsoft マルウェア対策” から Azure ストレージ アカウントにイベントをキャプチャするように、Azure 診断拡張機能を構成できます。 「エラー」、「警告」、「情報」などのマルウェア対策イベント カテゴリが、Azure ストレージ アカウントに収集されます。

PowerShell コマンドレットを使用して Azure ストレージ アカウントへのマルウェア対策イベント収集を有効にするには:

1.  PowerShell 環境での設定を参照してください <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **Virtual Machines の** -」の説明に従って、セット AzureVMMicrosoftAntimalwareExtension マルウェア対策コマンドレットを監視 ON オプションを使用します。 <http://msdn.microsoft.com/library/azure/dn771716.aspx>

3.  **クラウド サービスの** -」の説明に従って、セット AzureServiceAntimalwareExtension マルウェア対策コマンドレットを監視 ON オプションを使用します。 <http://msdn.microsoft.com/library/azure/dn771718.aspx>

マルウェア対策の監視を有効にするために構成した Azure ストレージ アカウントの WADWindowsEventLogsTable テーブルで、マルウェア対策の未加工のイベントを見ることができます。 これにより、マルウェア対策サービスの正常性の詳細など、マルウェア対策イベント収集が動作していることを確認できます。 ストレージ アカウントからマルウェア対策のイベントを抽出する方法のサンプル コードを含め、詳細についてを参照してください [Microsoft マルウェア対策の Azure クラウド サービスと仮想マシンのコード サンプル](http://aka.ms/amazsamples "Microsoft マルウェア対策の Azure クラウド サービスと仮想マシンのコード サンプル")します。





