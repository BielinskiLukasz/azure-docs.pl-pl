<properties 
    pageTitle="Azure App Service Web アプリにおけるオペレーティング システムの機能" 
    description="Azure App Service 上の Web アプリで使用できる OS の機能について学習します。" 
    services="app-service\web" 
    documentationCenter="" 
    authors="cephalin" 
    manager="wpickett" 
    editor="mollybos"/>

<tags 
    ms.service="app-service-web" 
    ms.workload="web" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="09/29/2015" 
    ms.author="cephalin"/>


# Azure App Service Web アプリにおけるオペレーティング システムの機能

この記事の説明、基本的なオペレーティング システム機能で実行されているすべてのアプリケーションに提供される [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714) Web アプリです。 これらの機能には、ファイル アクセス、ネットワーク アクセス、レジストリ アクセス、診断ログ、イベントがあります。

<a id="tiers"></a>
## App Service プランの階層

Web アプリは、マルチ テナント ホスティング環境で、顧客のアプリケーションを実行します。 **無料**または**共有**の階層でデプロイされた Web アプリは、共有仮想マシン上のワーカー プロセスで実行されます。一方、**標準**や**プレミアム**階層でデプロイされた Web アプリは、その顧客専用の仮想マシン上で実行されます。

Web アプリはどの階層でもシームレスに規模設定 (スケーリング) されるので、Web アプリのセキュリティ構成は選択するモードに左右されません。 これにより、Web アプリを別の階層に切り替えたとき、Web アプリの動作が突然が変わって予期しないエラーが発生するのを防ぐことができます。

<a id="developmentframeworks"></a>
## 開発フレームワーク

Web アプリの階層で使用できるコンピューティング リソース (CPU、ディスク ストレージ、メモリ、ネットワーク) は、Web アプリのモードによって異なります。 ただし、アプリケーションで使用できるフレームワーク機能はどのスケーリング階層でも変わりません。

Web アプリは、ASP.NET、クラシック ASP、node.js、PHP、python などの各種の開発フレームワークをサポートしています。これらはすべて、IIS 内で拡張機能として実行されます。 セキュリティ構成を標準化して単純にするために、Web アプリでは通常、各種の開発フレームワークが既定の設定で実行されます。 Web アプリでは、API へのアクセスと機能を開発フレームワークごとにカスタマイズするのではなく、 より汎用的なアプローチをとっています。つまり、Web アプリの開発フレームワークにかかわらず使用できる、共通の基本的なオペレーティング システム機能が用意されています。

この後の各セクションでは、Azure の Web アプリで使用できる汎用オペレーティング システム機能について概説します。

<a id="FileAccess"></a>
## ファイル アクセス

Web アプリには、ローカル ドライブやネットワーク ドライブなど、さまざまなドライブが存在します。

<a id="LocalDrives"></a>
### ローカル ドライブ

根本的に、Web アプリは、Azure PaaS (Platform as a Service) インフラストラクチャ上で動作するサービスです。 したがって、仮想マシンに "接続" されるローカル ドライブは、Azure 上の worker ロールで使用するドライブと同じ種類です。 これには、オペレーティング システム ドライブ (D:\ ドライブ)、Web アプリのみ使用する (顧客はアクセスできない) Azure パッケージ cspkg ファイルを保存するアプリケーション ドライブ、"ユーザー" ドライブ (C:\ ドライブ) があり、そのサイズは仮想マシンのサイズによって異なります。

<a id="NetworkDrives"></a>
### ネットワーク ドライブ ("UNC 共有" とも呼ばれます)

Web アプリケーションのデプロイとメンテナンスを容易にする Web アプリの特長の 1 つは、すべてのユーザー コンテンツが一連の UNC 共有に保存されることです。 このモデルは、複数の負荷分散サーバーを配した内部設置型 Web ホスティング環境で使用される共通のコンテンツ ストレージ パターンに対応します。

Web アプリ内で、各データ センターに複数の UNC 共有が作成されます。 データ センターごとに、すべての顧客のユーザーコンテンツの割合が各 UNC 共有に反映されます。 さらに、個々の顧客のサブスクリプションのすべてのファイル コンテンツは、必ず同じ UNC 共有に配置されます。

クラウド サービスの性質上、UNC 共有をホストする仮想マシンはその時々で変わります。 通常のクラウド運用で仮想マシンが起動または停止するたびに、必要な仮想マシンに UNC 共有が確実にマウントされます。 したがって、UNC ファイル パスのマシン情報が常に変わらないことを前提として Web アプリケーションをハードコーディングしないでください。 代わりに、Web Apps に用意されている*偽の*絶対パス**D:\home\site** を使用してください。 この "偽" の絶対パスを使用すれば、アプリとユーザーが変わっても常に目的のアプリを表すことができます。 つまり、**D:\home\site** を使用することで、共有ファイルを別のアプリへ移動するたびに新しい絶対パスを構成する必要がなくなります。

<a id="TypesOfFileAccess"></a>
### Web アプリケーションに付与されるファイル アクセスの種類

顧客のサブスクリプションごとに、データ センター内の UNC 共有上にディレクトリ構造が確保されます。 顧客が同じデータ センター内に複数の Web アプリを作成している場合は、その顧客サブスクリプションに属するすべてのディレクトリが同じ UNC 共有上に作成されます。 この共有には、コンテンツ ログ、エラー ログ、診断ログのためのディレクトリや、ソース管理によって作成された以前のバージョンの Web アプリのディレクトリなどが配置されます。 もちろん、顧客の Web アプリのディレクトリは、実行時に Web アプリのアプリケーション コードから読み書きできます。

Web アプリでは、Web アプリを実行する仮想マシンに接続されたローカル ドライブ (C:\ ドライブ) 上に、そのアプリケーション専用の一時的なローカル ストレージ領域が確保されます。 Web アプリはこの一時ローカル ストレージを自由に読み書きできますが、アプリケーション コードからの直接アクセスは本来の使用方法ではありません。 このストレージの目的は、IIS および Web アプリケーション フレームワークに一時的なファイル ストレージを提供することです。 さらに、Web アプリでは、各 Web アプリで使用できる一時ローカル ストレージの容量も制限されます。これは、それぞれのアプリケーションがローカル ファイル ストレージを過度に消費するのを防ぐためです。

Web アプリでの一時ローカル ストレージの使用例として、ASP.NET 一時ファイルのディレクトリと IIS 圧縮ファイルのディレクトリがあります。 ASP.NET コンパイル システムは、"Temporary ASP.NET Files" ディレクトリをコンパイルの一時的なキャッシュ場所として使用します。 IIS は、"IIS Temporary Compressed Files" ディレクトリを使用して圧縮済みの応答出力を保存します。 これらはいずれも、Web アプリではアプリケーションごとの一時ローカル ストレージに再マッピングされます。 この再マッピングにより、引き続き適切に機能させることができます。

Web Apps の各アプリは、"アプリケーション プール id"、さらにここで説明したと呼ばれるランダムな一意の低権限ワーカー プロセス id として実行: [http://www.iis.net/learn/manage/configuring-security/application-pool-identities](http://www.iis.net/learn/manage/configuring-security/application-pool-identities)します。 アプリケーション コードはこの ID を使用し、オペレーティング システム ドライブ (D:\ ドライブ) に読み取り専用でアクセスします。 つまり、アプリケーション コードは、オペレーティング システム ドライブ上の共通ディレクトリ構造を参照し、共通ファイルを読み取ることができます。 少々広範なアクセス レベルに思えるかもしれませんが、Azure でホストされるサービスに worker ロールをプロビジョニングしてドライブ コンテンツを読み取る場合も、同じディレクトリとファイルにアクセスできます。

<a name="multipleinstances"></a>
### 複数のインスタンス間でのファイル アクセス

ホーム ディレクトリにはアプリケーションのコンテンツが含まれ、Web アプリケーションからの書き込みが可能です。 Web アプリが複数のインスタンスで実行される場合、ホーム ディレクトリはすべてのインスタンスで共有されるため、すべてのインスタンスが同じディレクトリを参照することになります。 たとえば、アップロードされたファイルを Web アプリがホーム ディレクトリに保存すると、それらのファイルはすぐにすべてのインスタンスから利用できるようになります。

<a id="NetworkAccess"></a>
## ネットワーク アクセス

アプリケーション コードは、TCP/IP ベースおよび UDP ベースのプロトコルを使用してインターネットに接続し、外部サービスを公開しているエンドポイントにアクセスできます。 アプリケーションでは、同じプロトコルを使用して Azure 内のサービスにも接続できます。たとえば、SQL Azure への HTTPS 接続を確立できます。

アプリケーションでローカル ループバック接続を確立し、そのローカル ループバック ソケットでリッスンするための機能も限定的に用意されています。 主な目的は、アプリケーション機能の一環として、ローカル ループバック ソケットでリッスンできるようにすることです。 ループバック接続は顧客のアプリケーションごとに "非公開" である点に注意してください。つまり、アプリケーション "A" は、アプリケーション "B" が設定したローカル ループバック ソケットではリッスンできません。

1 つの Web アプリの実行に複数のプロセスがかかわっている場合、それらのプロセスが互いに通信する手段 (プロセス間通信: IPC) として、名前付きパイプもサポートされています。 たとえば、IIS FastCGI モジュールは、名前付きパイプを利用して PHP ページを実行する複数のプロセスを調整します。


<a id="Code"></a>
## コードの実行、プロセス、メモリ

既に説明したように、Web アプリは、ランダムなアプリケーション プール ID を使用して低権限のワーカー プロセス内で実行されます。 アプリケーション コードは、ネットワーク プロセス、および CGI プロセスや他のアプリケーションが生成する子プロセスに関連付けられたメモリ空間にアクセスできます。 ただし、ある顧客の Web アプリから、別の顧客の Web アプリのメモリやデータにアクセスすることはできません。これは、別の Web アプリが同じ仮想マシン上に配置されている場合でも同じです。

アプリケーションは、サポート対象の Web アプリケーション開発フレームワークで記述されたスクリプトやページを実行できます。 Web アプリでは、Web アプリケーションのフレームワークがより限定的なモードに構成されることはありません。 たとえば、Web アプリ上の ASP.NET アプリケーションは、限定的な信頼モードではなく "完全信頼" で実行されます。 アプリケーション フレームワークでは、クラシック ASP と ASP.NET も含めて、Windows オペレーティング システムに既定で登録されている ADO (ActiveX Data オブジェクト) などのインプロセス COM コンポーネントを呼び出すことができます (アウトプロセス COM コンポーネントは対象外)。

Web アプリケーションは任意のコードを生成して実行できます。 たとえば、コマンド シェルを生成したり、PowerShell スクリプトを実行したりできます。 ただし、Web アプリケーションで任意のコードとプロセスを生成できる場合でも、実行形式のプログラムやスクリプトに与えられる権限は親アプリケーション プールと同じになります。 たとえば、Web アプリは外部へのHTTP 呼び出しを行う実行可能ファイルを生成できますが、その実行可能ファイルは、仮想マシンの IP アドレスを NIC から解除することはできません。 外部へのネットワーク呼び出しは低権限のコードでも実行できますが、仮想マシンのネットワーク設定を再構成するには管理者権限が必要です。


<a id="Diagnostics"></a>
## 診断ログとイベント

一部の Web アプリケーションは、ログ情報というデータ セットにアクセスします。 Web アプリ上のコードが使用できるログ情報には診断ログがあります。これは、Web アプリによって生成され、Web アプリから簡単にアクセスできるログ情報です。

たとえば、アクティブな Web アプリによって生成される W3C HTTP ログは、その Web アプリのネットワーク共有場所にあるログ ディレクトリか、顧客が W3C ログを設定している場合は BLOB ストレージに格納されます。 BLOB ストレージを使用すると、ネットワーク共有のファイル ストレージ制限を気にすることなく大量のログを収集できます。

同様に、.NET のトレース/診断インフラストラクチャを使用すれば、.NET アプリケーションの診断情報をリアルタイムに記録できます。その際、トレース情報を Web アプリのネットワーク共有に書き込むか、BLOB ストレージに書き込むかを選択できます。

Azure 上の Web アプリケーションが使用できない診断情報ログ機能とトレース機能は、Windows ETW イベントと標準の Windows イベント ログ (システム ログ、アプリケーション ログ、セキュリティ イベント ログ) です。 (適切な ACL があれば) マシン上で ETW トレース情報を参照できるので、ETW イベントへの読み取りアクセスと書き込みアクセスがブロックされます。 アプリケーションの開発時には、ETW イベントや標準の Windows イベント ログを読み書きする API 呼び出しが機能するように見えるかもしれませんが、これは、Web アプリがそのように見せかけているにすぎません。 実際には、Web アプリのコードはこれらのイベント データにアクセスできません。

<a id="RegistryAccess"></a>
## レジストリ アクセス

アプリケーションは、実行基盤となる仮想マシンの多くのレジストリ (すべてのレジストリではありません) に読み取り専用でアクセスできます。 つまり、Web アプリケーションは、ローカル ユーザー グループへの読み取り専用アクセスを許可するレジストリ キーにアクセスできることになります。 現在、読み取りアクセスまたは書き込みアクセスがサポートされていないレジストリ領域の 1 つに、HKEY\_CURRENT\_USER ハイブがあります。

レジストリへの書き込みアクセスはブロックされます。ユーザーごとのレジストリ キーにも一切アクセスできません。 クラウド環境の場合、アプリケーションが他の仮想マシンへ移行される可能性があるので、レジストリへの書き込みアクセスを前提にしてコードを開発しないでください。 Web アプリで利用できる唯一の書き込み可能な永続ストレージは、Web アプリの UNC 共有に格納される Web アプリケーション別のコンテンツ ディレクトリ構造です。
>[AZURE.NOTE] 場合は、Azure アカウントがサインアップする前に Azure App Service の使用を開始するには、 [App Service の試用](http://go.microsoft.com/fwlink/?LinkId=523751), 、App Service で有効期間の短いスターター web アプリをすぐに作成する場所です。 このサービスの利用にあたり、クレジット カードは必要ありません。契約も必要ありません。

[AZURE.INCLUDE [app-service-web-whats-changed](../../includes/app-service-web-whats-changed.md)]







