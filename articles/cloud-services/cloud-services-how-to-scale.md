<properties 
    pageTitle="クラウド サービスの自動スケールの構成 | Microsoft Azure" 
    description="ポータルを使用して、クラウド サービスおよび Azure のリンク済みリソースの自動スケール ルールを構成する方法について説明します。" 
    services="cloud-services" 
    documentationCenter="" 
    authors="Thraka" 
    manager="timlt" 
    editor=""/>

<tags 
    ms.service="cloud-services" 
    ms.workload="tbd" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="12/07/2015"
    ms.author="adegeo"/>






# アプリケーションの規模の自動設定方法

Azure クラシック ポータルの [スケール] ページで、アプリケーションの規模を手動で設定するか、パラメーターを指定して自動的に規模を設定することができます。 Web ロール、worker ロール、または Virtual Machines を実行しているアプリケーションの規模を設定できます。 Web ロールまたは worker ロールのインスタンスを実行しているアプリケーションの規模を設定するには、ロール インスタンスを追加または削除してワーク ロードを調整します。

Virtual Machines を実行しているアプリケーションの規模を増減しても、マシンが新たに作成されたり削除されたりすることはなく、以前に作成された仮想マシンの可用性セットでオン/オフされるだけです。 平均 CPU 使用率 (%)、またはキュー内のメッセージの数に基づいて規模の設定を指定できます。

アプリケーションの規模の設定を構成する前に、以下に示す情報を考慮してください。

- Virtual Machines を使用するアプリケーションの規模を設定するには、作成するマシンを可用性セットに追加する必要があります。 追加する Virtual Machines は最初はオンでもオフでもかまいませんが、規模拡大操作ではオンに、規模縮小操作ではオフに設定されます。 仮想マシンと可用性セットの詳細については、次を参照してください。 [仮想マシンの可用性を管理](../virtual-machines-manage-availability.md)します。

- 規模設定はコア使用量の影響を受けます。 より大きいロール インスタンスまたは Virtual Machines は、より多くのコアを使用します。 アプリケーションの規模の設定は、サブスクリプションのコア数の制限内でのみ行うことができます。 たとえば、サブスクリプションにコア数 20 の制限があり、アプリケーションを 2 つの中規模の Virtual Machines で実行している場合 (合計 4 コア)、サブスクリプション内の他のクラウド サービスのデプロイメントは 16 コアまでしかスケールアップできません。 アプリケーションの規模の設定に使用される可用性セット内のすべての Virtual Machines は、同じサイズである必要があります。 コア使用量とマシンのサイズの詳細については、次を参照してください。 [仮想マシンと Azure のクラウド サービスのサイズ](http://msdn.microsoft.com/library/dn197896.aspx)します。

- メッセージのしきい値に基づいてアプリケーションの規模を設定する前に、キューを作成してロールまたは可用性セットに関連付ける必要があります。 詳細については、次を参照してください。 [キュー ストレージ サービスを使用する方法](../storage-dotnet-how-to-use-queues.md)します。

- クラウド サービスにリンクされたリソースの規模を設定できます。 リソースのリンクの詳細については、次を参照してください。 [方法: クラウド サービスに対するリソースのリンク](cloud-services-how-to-manage.md#how-to-link-a-resource-to-a-cloud-service)します。

- アプリケーションの高可用性を可能にするには、アプリケーションを 2 つ以上のロール インスタンスまたは Virtual Machines と共にデプロイする必要があります。 詳細については、次を参照してください。 [サービス レベル アグリーメント](http://azure.microsoft.com/support/legal/sla/)します。


## Web ロールまたは worker ロールを実行しているアプリケーションの規模の手動設定

[スケール] ページで、クラウド サービスで実行中のインスタンスの数を手動で増減できます。

1. [Azure クラシック ポータル](https://manage.windowsazure.com/), 、] をクリックして **クラウド サービス**, 、ダッシュ ボードをクラウド サービスの名前をクリックします。

2. **[スケール]** をクリックします。 既定では、すべてのロールに対して自動的な規模の設定は無効になっていますが、アプリケーションで使用するインスタンスの数を手動で変更できます。

    ![[スケール] ページ][manual_scale]

3. クラウド サービス内の各ロールには、使用するインスタンスの数を変更するスライダーがあります。 ロール インスタンスを追加するには、垂直バーを右にドラッグします。 インスタンスを削除するには、バーを左にドラッグします。

    ![ロールの規模の設定][slider_role]

    増やすことができるのは、インスタンスをサポートするために適切な数のコアを使用できる場合に使用されるインスタンスの数だけです。 スライダーの色は、サブスクリプションで使用しているコアと使用できるコアを表します。

    - ブルーは、選択したロールで使用されているコアを表します

    - ダーク グレーは、サブスクリプションのすべてのロールと Virtual Machines で使用されているコアを表します

    - ライト グレーは、規模の設定に使用できるコアを表します

    - ピンクは、保存されていない変更を表します

4. **[保存]** をクリックします。 選択に応じて、ロール インスタンスが追加または削除されます。

## Web ロール、worker ロール、または Virtual Machines を実行しているアプリケーションの規模の自動設定

[スケール] ページで、アプリケーションで使用するインスタンスまたは Virtual Machines の数を自動的に増減するようにクラウド サービスを構成できます。 以下のパラメーターに基づいて、規模の設定を構成できます。

- [平均 CPU 使用率](#averagecpu) - CPU 使用率の割合の平均値を超えたか、指定されたしきい値を下回ってロール インスタンスが作成または削除すると、または仮想マシンがオンにするか、可用性セットで無効になっています。
- [キュー メッセージ](#queuemessages) - キュー内のメッセージの数を超えたまたは指定されたしきい値以下のロール インスタンスが作成または削除すると、または仮想マシンがオンにするか、可用性セットで無効になっています。

## 平均 CPU 使用率

1. [Azure クラシック ポータル](https://manage.windowsazure.com/), 、] をクリックして **クラウド サービス**, 、ダッシュ ボードをクラウド サービスの名前をクリックします。

2. **[スケール]** をクリックします。

3. ロールまたは可用性セットのセクションにスクロールし、**[CPU]** をクリックします。 これで、アプリケーションが使用する CPU リソースの平均パーセンテージに基づいて、アプリケーションの規模が自動的に設定されます。

    ![規模の自動設定オン][autoscale_on]

4. 各ロールまたは可用性セットには、使用できるインスタンスの数を変更するスライダーがあります。 使用できるインスタンスの最大数を設定するには、右側のバーを右にドラッグします。 使用できるインスタンスの最小数を設定するには、左側のバーを左にドラッグします。

    **注:** [スケール] ページの **[インスタンス]** は、ロール インスタンスまたは仮想マシンのインスタンスを表します。

    ![インスタンス範囲][instance_range]

    インスタンスの最大数は、サブスクリプションで使用できるコア数で制限されます。 スライダーの色は、サブスクリプションで使用しているコアと使用できるコアを表します。

    - ブルーは、ロールが使用できる最大コア数を表します。

    - ダーク グレーは、サブスクリプションのすべてのロールと Virtual Machines で使用されているコアを表します この値がロールで使用するコア数と重なると、色はダーク ブルーに変わります。

    - ライト グレーは、規模の設定に使用できるコアを表します。

    - ピンクは、保存されていない変更を表します。

5. スライダーが、平均 CPU 使用率 (%) の範囲を指定するために使用されます。 平均 CPU 使用率 (%) が最大設定を上回った場合、より多くのロール インスタンスが作成されるか、Virtual Machines がオンになります。 平均 CPU 使用率 (%) が最小設定を下回った場合、ロール インスタンスが削除されるか、Virtual Machines がオフになります。 平均 CPU 使用率の最大値を設定するには、右側のバーを右にドラッグします。 平均 CPU 使用率の最小値を設定するには、左側のバーを左にドラッグします。

    ![ターゲット CPU][target_cpu]

6. アプリケーションの規模が拡大するたびに追加またはオンにするインスタンスの数を指定できます。 アプリケーションの規模が拡大したときに作成またはオンにするインスタンスの数を増やすには、バーを右にドラッグします。 数を減らすには、バーを左にドラッグします。

    ![CPU の規模拡大][scale_cpuup]

7. 最後の規模設定操作と次の規模拡大操作の間の待機時間 (分) を設定します。 最後の規模設定操作は、規模拡大または規模縮小です。

    ![稼働時間][scale_uptime]

    平均 CPU 使用率 (%) の計算時にはすべてのインスタンスが含まれ、平均はその前の 1 時間の使用状況に基づきます。 アプリケーションで使用しているインスタンスの数によっては、待機時間が非常に低く設定されている場合、規模設定操作が行われるまでに指定した待機時間よりも長い時間がかかることがあります。 規模設定操作の間の最小時間は 5 分です。 いずれかのインスタンスが移行中の状態にある場合、規模設定操作は実行できません。

8. アプリケーションの規模が縮小したときに削除またはオフにするインスタンスの数も指定できます。 アプリケーションの規模が縮小したときに削除またはオフにするインスタンスの数を増やすには、バーを右にドラッグします。 数を減らすには、バーを左にドラッグします。

    ![CPU の規模縮小][scale_cpudown]

    アプリケーションで CPU 使用率の突然の増加がある場合は、インスタンスの最低数がそれらを処理するために十分であることを確認する必要があります。

9. 最後の規模設定操作と次の規模縮小操作の間の待機時間 (分) を設定します。 最後の規模設定操作は、規模拡大または規模縮小です。

    ![休止時間][scale_downtime]

10. **[保存]** をクリックします。 規模設定操作は、終了までに最大で 5 分かかります。

## キュー メッセージ

1. [Azure クラシック ポータル](https://manage.windowsazure.com/), 、] をクリックして **クラウド サービス**, 、ダッシュ ボードをクラウド サービスの名前をクリックします。
2. **[スケール]** をクリックします。
3. ロールまたは可用性セットのセクションにスクロールし、**[キュー]** をクリックします。 これで、キュー メッセージの目標数に基づいて、アプリケーションの規模が自動的に設定されます。

    ![キューの規模の設定][scale_queue]

4. クラウド サービス内の各ロールまたは可用性セットには、使用できるインスタンスの数を変更するスライダーがあります。 使用できるインスタンスの最大数を設定するには、右側のバーを右にドラッグします。 使用できるインスタンスの最小数を設定するには、左側のバーを左にドラッグします。

    ![キューの範囲][queue_range]

    **注:** [スケール] ページの **[インスタンス]** は、ロール インスタンスまたは仮想マシンのインスタンスを表します。

    インスタンスの最大数は、サブスクリプションで使用できるコア数で制限されます。 スライダーの色は、サブスクリプションで使用しているコアと使用できるコアを表します。
    - ブルーは、ロールが使用できる最大コア数を表します。
    - ダーク グレーは、サブスクリプションのすべてのロールと Virtual Machines で使用されているコアを表します この値がロールで使用するコア数と重なると、色はダーク ブルーに変わります。
    - ライト グレーは、規模の設定に使用できるコアを表します。
    - ピンクは、保存されていない変更を表します。

5. 使用するキューに関連付けられたストレージ アカウントを選択します。

    ![ストレージ名][storage_name]

6. キューを選択します

    ![キュー名][queue_name]

7. 各インスタンスがサポートするメッセージ数を指定します。 インスタンスは、マシンあたりの目標メッセージ数で割られた合計メッセージ数に基づいて規模が設定されます。

    ![メッセージ数][message_number]

8. アプリケーションの規模が拡大するたびに追加またはオンにするインスタンスの数を指定できます。 アプリケーションの規模が拡大したときに追加またはオンにするインスタンスの数を増やすには、バーを右にドラッグします。 数を減らすには、バーを左にドラッグします。

    ![CPU の規模拡大][scale_cpuup]

9. 最後の規模設定操作と次の規模拡大操作の間の待機時間 (分) を設定します。 最後の規模設定操作は、規模拡大または規模縮小です。

    ![稼働時間][scale_uptime]

    規模設定操作の間の最小時間は 5 分です。 いずれかのインスタンスが移行中の状態にある場合、規模設定操作は実行できません。

10. アプリケーションの規模が縮小したときに削除するインスタンス、または使用しないインスタンスの数も指定できます。 スライダーを使用して、規模設定の増分を指定します。 アプリケーションの規模が縮小したときに削除するインスタンス、または使用しないインスタンスの数を増やすには、バーを右にドラッグします。 数を減らすには、バーを左にドラッグします。

    ![CPU の規模縮小][scale_cpudown]

11. 最後の規模設定操作と次の規模縮小操作の間の待機時間 (分) を設定します。 最後の規模設定操作は、規模拡大または規模縮小です。

    ![休止時間][scale_downtime]

12. **[保存]** をクリックします。 規模設定操作は、終了までに最大で 5 分かかります。

## リンク済みリソースの規模の設定

多くの場合、ロールの規模を設定するときに、アプリケーションが使用しているデータベースの規模もあわせて変更するのが得策です。 データベースをクラウド サービスにリンクする場合、[スケール] ページで SQL Database のエディションを変更し、データベースの規模を変更します。

1. [Azure クラシック ポータル](https://manage.windowsazure.com/), 、] をクリックして **クラウド サービス**, 、ダッシュ ボードをクラウド サービスの名前をクリックします。
2. **[スケール]** をクリックします。
3. [リンク済みリソース] セクションで、データベースに使用するエディションを選択します。

    ![リンク済みリソース][linked_resources]

4. データベースのサイズを選択します。
5. **[保存]** をクリックして、リンクされたリソースを更新します。

## アプリケーションのスケールのスケジュール

さまざまな時間のスケジュールを構成することで、アプリケーションの自動規模設定をスケジュールできます。 自動規模設定では、次のオプションを使用できます。

- **スケジュールなし**: これは既定のオプションで、常に同じ方法でアプリケーションを自動的に規模設定できるようにします。

- **昼夜**: このオプションを使用すると、昼夜の特定の時刻に規模設定を指定できます。

**注:** Virtual Machines を使用するアプリケーションには、現在のところスケジュールを使用できません。

1. [Azure クラシック ポータル](https://manage.windowsazure.com/), 、] をクリックして **クラウド サービス**, 、ダッシュ ボードをクラウド サービスの名前をクリックします。
2. **[スケール]** をクリックします。
3. [スケール] ページで、**[スケジュール時間の設定]** をクリックします。

    ![スケールのスケジュール][scale_schedule]

4. 設定するスケール スケジュールの種類を選択します。

5. 昼の開始時刻と終了時刻を指定し、タイム ゾーンを設定します。 昼夜スケジュールの場合、これらの時刻は昼の開始と終了を表し、残りの時間は夜を表します。

6. ページの下部にあるチェック マークをオンにして、スケジュールを保存します。

7. スケジュールは、保存すると一覧に表示されます。 使用する時間スケジュールを選択すると、スケール設定を変更できます。 スケール設定は、選択したスケジュール中のみ適用されます。 スケジュールは、**[スケジュール時間の設定]** をクリックすることで編集できます。


[manual_scale]: ./media/cloud-services-how-to-scale/CloudServices_ManualScaleRoles.png 
[slider_role]: ./media/cloud-services-how-to-scale/CloudServices_SliderRole.png 
[autoscale_on]: ./media/cloud-services-how-to-scale/CloudServices_AutoscaleOn.png 
[instance_range]: ./media/cloud-services-how-to-scale/CloudServices_InstanceRange.png 
[target_cpu]: ./media/cloud-services-how-to-scale/CloudServices_TargetCPURange.png 
[scale_cpuup]: ./media/cloud-services-how-to-scale/CloudServices_ScaleUpBy.png 
[scale_uptime]: ./media/cloud-services-how-to-scale/CloudServices_ScaleUpWaitTime.png 
[scale_cpudown]: ./media/cloud-services-how-to-scale/CloudServices_ScaleDownBy.png 
[scale_downtime]: ./media/cloud-services-how-to-scale/CloudServices_ScaleDownWaitTime.png 
[scale_queue]: ./media/cloud-services-how-to-scale/CloudServices_QueueScale.png 
[queue_range]: ./media/cloud-services-how-to-scale/CloudServices_QueueRange.png 
[storage_name]: ./media/cloud-services-how-to-scale/CloudServices_StorageAccountName.png 
[queue_name]: ./media/cloud-services-how-to-scale/CloudServices_QueueName.png 
[message_number]: ./media/cloud-services-how-to-scale/CloudServices_TargetMessageNumber.png 
[linked_resources]: ./media/cloud-services-how-to-scale/CloudServices_ScaleLinkedResources.png 
[scale_schedule]: ./media/cloud-services-how-to-scale/CloudServices_SetUpSchedule.png 

