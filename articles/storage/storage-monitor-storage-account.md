<properties
    pageTitle="ストレージ アカウントの監視方法 | Microsoft Azure"
    description="Azure ポータルを使用して Azure でストレージ アカウントを監視する方法について説明します。"
    services="storage"
    documentationCenter=""
    authors="tamram"
    manager="adinah"
    editor="cgronlun"/>

<tags
    ms.service="storage"
    ms.workload="storage"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="12/01/2015"
    ms.author="tamram"/>

# Azure ポータルでのストレージ アカウントの監視

## 概要

ストレージ アカウントを監視する、 [Azure ポータル](portal.azure.com)します。 Azure ストレージを使用して、ポータルを通じて監視するため、ストレージ アカウントを構成するときに [Storage Analytics](http://msdn.microsoft.com/library/azure/hh343270.aspx) 、アカウントのメトリックを追跡し、要求データを記録します。

> [AZURE.NOTE] 監視データを調査すると、追加のコストが関連付けられている、 [Azure ポータル](portal.azure.com)します。 詳細については、次を参照してください。 <a href="http://msdn.microsoft.com/library/azure/hh360997.aspx">Storage Analytics と課金</a>します。 <br />

> 現在、Azure File ストレージは、Storage Analytics のメトリックをサポートしますが、ログ記録はまだサポートされていません。 経由で Azure File ストレージのメトリックを有効にすることができます、 [Azure ポータル](portal.azure.com)します。

> Storage Analytics やその他のツールを使用して、識別、診断、および Azure Storage 関連の問題をトラブルシューティングする詳細なガイドを参照してください。 [モニター、診断、および Microsoft Azure Storage のトラブルシューティングを行う](storage-monitoring-diagnosing-troubleshooting.md)します。


## 方法: ストレージ アカウントの監視の設定

1.  [Azure ポータル](portal.azure.com), 、] をクリックして **ストレージ**, 、ダッシュ ボードをストレージ アカウント名をクリックします。

2. クリックして **構成**, 、まで下へスクロールし、 **監視** blob、テーブル、およびキュー サービスの設定です。

    ![MonitoringOptions](./media/storage-monitor-storage-account/Storage_MonitoringOptions.png)

3.  **監視**, 、監視レベルおよび各サービスのデータ保有ポリシーを設定します。

    -  監視レベルを設定するには、以下のいずれかを選択します。

      **最小** -blob、テーブル、およびキュー サービスに対して集計される、受信/送信、可用性、待機時間、および成功のパーセンテージなどのメトリックを収集します。

      **詳細な** - 最小レベルのメトリックでは、Azure Storage サービス API のストレージ操作ごとのメトリックの同じ収集に加えてします。 詳細メトリックにより、アプリケーションの操作中に発生する問題を詳しく分析できます。

      **オフ** の監視をオフにします。 既存の監視データは、保有期間が経過するまで残ります。

- データの保持ポリシーを設定する **保有期間 (日)**, 、データを 1 から 365 日を保持する日数の番号を入力します。 保有ポリシーを設定しない場合は、「0」(ゼロ) を入力します。 保有ポリシーがない場合、監視データを削除する責任はユーザーが負います。 古くて使用しない分析データがコストをかけずに自動的に削除されるように、アカウントのストレージ分析データをどの程度の期間保持するかに基づいて、データ保有ポリシーを設定することをお勧めします。

4. 監視の構成が完了したら、クリックして **保存**します。

監視ダッシュ ボード上のデータが表示されるようになり、 **モニター** 約 1 時間後にページです。

ストレージ アカウントの監視を構成するまで監視データは収集されず、およびダッシュ ボードのメトリック チャートと **モニター** ページが空です。

監視レベルと保有ポリシーを設定すると後で監視する使用可能なメトリックのどれを選択できます、 [Azure ポータル](portal.azure.com), 、およびメトリック チャートにプロットするメトリックです。 監視レベルごとに既定のメトリック セットが表示されます。 使用する **メトリックの追加** を追加またはメトリック一覧からメトリックを削除します。

メトリックは、ストレージ アカウントの $MetricsTransactionsBlob、$MetricsTransactionsTable、$MetricsTransactionsQueue、$MetricsCapacityBlob という名前の 4 つのテーブルに保存されます。 詳細については、次を参照してください。 [Storage Analytics Metrics について](http://msdn.microsoft.com/library/azure/hh343258.aspx)します。


## 方法: ダッシュボードの監視用のカスタマイズ

ダッシュボードで、利用できる 9 個のメトリックから最大 6 個のメトリックを選択してメトリック チャートにプロットできます。 サービスごとに (BLOB、テーブル、およびキュー)、空き時間情報、成功のパーセンテージ、および要求数合計のメトリックが利用できます。 ダッシュボードで利用できるメトリックは、最少監視でも詳細監視でも同じです。

1.  [Azure ポータル](portal.azure.com), 、] をクリックして **ストレージ**, 、ダッシュ ボードをストレージ アカウントの名前をクリックします。

2. チャートにプロットされるメトリックを変更するには、以下のいずれかを実行します。

    - 新しいメトリックをチャートに追加するには、チャートの下にあるテーブルでメトリック ヘッダーの横にある色つきのチェック ボックスをオンにします。

    - チャートにプロットされているメトリックを非表示にするには、メトリック ヘッダーの横にある色つきのチェック ボックスをオフにします。

        ![Monitoring_nmore](./media/storage-monitor-storage-account/storage_Monitoring_nmore.png)

3. 既定では、グラフは各メトリックの現在の値だけを表示する傾向を示しています (、 **相対** 、チャートの上部にあるオプション)。 絶対値を確認できるように、Y 軸を表示する [ **絶対**します。

4. メトリック チャートに表示する期間を変更するには、チャートの上部で 6 時間、24 時間、または 7 日を選択します。


## 方法: [監視] ページのカスタマイズ

 **モニター** ] ページで、ストレージ アカウントのメトリックの完全なセットを表示することができます。

- ストレージ アカウントが最小監視に構成されている場合は、受信/送信、空き時間情報、遅延時間、成功のパーセンテージなどのメトリックが BLOB、テーブル、キューの各サービスから集計されれます。

- ストレージ アカウントが詳細監視に構成されている場合は、サービス単位の集計に加えて、もっときめ細かい個々のストレージ操作のメトリックも利用できます。

表示されるメトリック グラフに表示すると、テーブルには、どのストレージ メトリックを選択する、次の手順を使用して、 **モニター** ページです。 この設定は、ストレージ アカウント監視データの収集、集計、および保存には影響しません。

## How to: メトリック テーブルへのメトリックの追加


1.  [Azure ポータル](portal.azure.com), 、] をクリックして **ストレージ**, 、ダッシュ ボードをストレージ アカウントの名前をクリックします。

2. クリックして **モニター**します。

     **モニター** ページが表示されます。 既定で、メトリック テーブルには監視に使用できるメトリックのサブセットが表示されます。 図は、3 つのサービスすべてに詳細監視を構成したストレージ アカウントで表示される既定の [監視] ページを示しています。 使用 **メトリックの追加** できるすべてのメトリックから監視するメトリックを選択します。

    ![Monitoring_VerboseDisplay](./media/storage-monitor-storage-account/Storage_Monitoring_VerboseDisplay.png)

    > [AZURE.NOTE] メトリックを選択すると、コストを検討してください。 監視の表示を更新すると、トランザクションと送信のコストがかかります。 詳細については、次を参照してください。 [Storage Analytics と課金](http://msdn.microsoft.com/library/azure/hh360997.aspx)します。

3. クリックして **メトリックの追加**します。

    最少監視で使用できる集計メトリックは一覧の上部に表示されています。 チェック ボックスをオンにすると、そのメトリックがメトリック一覧に表示されます。

    ![AddMetricsInitialDisplay](./media/storage-monitor-storage-account/Storage_AddMetrics_InitialDisplay.png)

4. ダイアログ ボックスの右側をポイントするとスクロール バーが表示され、ドラッグして追加のメトリックを表示できます。

    ![AddMetricsScrollbar](./media/storage-monitor-storage-account/Storage_AddMetrics_Scrollbar.png)


5. メトリックの横にある下向き矢印をクリックして、メトリックの対象となる操作の一覧を展開します。 メトリック テーブルに表示する各操作を選択して、 [Azure ポータル](portal.azure.com)します。

    下図では、承認エラーのパーセンテージ メトリックが展開されています。

    ![ExpandCollapse](./media/storage-monitor-storage-account/Storage_AddMetrics_ExpandCollapse.png)


6. すべてのサービスについてメトリックを選択したら、[OK] (チェックマーク) をクリックして監視の構成を更新します。 選択したメトリックがメトリック テーブルに追加されます。

7. テーブルからメトリックを削除する、メトリックをクリックして選択し、クリックして **メトリックの削除]**します。

    ![DeleteMetric](./media/storage-monitor-storage-account/Storage_DeleteMetric.png)

## 方法: [監視] ページのメトリック チャートのカスタマイズ

1.  **モニター** メトリック チャートにプロットするメトリックを最大 6 ページ メトリック テーブルでのストレージ アカウント] を選択します。 メトリックを選択するには、メトリックの左側にあるチェック ボックスをオンにします。 チャートからメトリックを削除するには、チェック ボックスをオフにします。

2. チャートで相対値 (最終値だけ表示) と絶対値 (Y 軸が表示されます) を切り替えるは、選択 **相対** または **絶対** グラフの上部にあります。

3.  メトリック チャートの期間を変更するが表示されたら、選択 **6 時間**, 、**24 時間**, 、または **7 日間** グラフの上部にあります。



## 方法: ログの構成

ストレージ アカウントで利用できるストレージ サービス (BLOB、テーブル、およびキュー) ごとに、読み取り要求、書き込み要求、および削除要求の診断ログを保存でき、サービスごとにデータ保有ポリシーを設定できます。

1.  [Azure ポータル](portal.azure.com), 、] をクリックして **ストレージ**, 、ダッシュ ボードをストレージ アカウントの名前をクリックします。

2. クリックして **構成**, 、キーボードの下方向キーを使用まで下へスクロールして **ログ**します。

    ![Storagelogging](./media/storage-monitor-storage-account/Storage_LoggingOptions.png)


3. サービス (BLOB、テーブル、およびキュー) ごとに、次のように構成します。

    - ログを記録する要求の種類: 読み取り要求、書き込み要求、および削除要求。

    - ログ データを保持する日数。 保有ポリシーを設定しない場合は、「0」(ゼロ) を入力します。 保有ポリシーを設定しない場合、ログを削除する責任はユーザーが負います。

4. クリックして **保存**します。

診断ログは、ストレージ アカウントの $logs という名前の BLOB コンテナーに保存されます。 $Logs コンテナーへのアクセス方法については、次を参照してください。 [Storage Analytics Logging について](http://msdn.microsoft.com/library/azure/hh343262.aspx)します。

