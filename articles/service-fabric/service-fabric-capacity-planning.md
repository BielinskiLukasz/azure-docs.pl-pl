<properties
   pageTitle="Service Fabric アプリの容量計画 | Microsoft Azure"
   description="Service Fabric アプリケーションに必要なコンピューティング ノードの数を特定する方法について説明します。"
   services="service-fabric"
   documentationCenter=".net"
   authors="mani-ramaswamy"
   manager="coreysa"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="11/12/2015"
   ms.author="subramar"/>


# Service Fabric アプリケーションの容量計画


このドキュメントでは、Service Fabric アプリケーションを実行するために必要なリソース (CPU、RAM、ディスク ストレージ) の量を見積もる方法について説明します。 リソース要件は、通常、時の経過と共に変化します。 一般的に、サービスの開発およびテスト中はリソースをあまり必要とせず、運用を開始したりアプリケーションが多くのユーザーに使用され始めたりすると、より多くのリソースが必要になります。 アプリケーションを設計するときは、長期的な要件を考慮し、高い顧客要求を満たすためにサービスを簡単に拡張できるようにしておくことをお勧めします。 Service Fabric クラスターを作成するときは、どのような種類の仮想マシン (VM) でクラスターを構成するかを判断します。 各 VM は、CPU (コア数と速度)、ネットワーク帯域幅、RAM、ディスク ストレージなどの面で、リソースの量が制限されます。 サービスが成長すると共に、より多くのリソースを提供する VM にアップグレードしたり、より多くの VM をクラスターに追加したりすることができます。 もちろん、後者の場合は、クラスターに動的に追加される新しい VM を活用できるように、サービスを設計しておく必要があります。

一部のサービスは、VM 自体ではデータをほとんどあるいはまったく管理しないため、容量計画は主にパフォーマンスに重点を置きます。 つまり、コードのアルゴリズムのパフォーマンスと、アルゴリズムを実行するために必要な VM CPU (コア数および速度) を慎重に検討する必要があります。 また、ネットワーク帯域幅と、ネットワーク転送の頻度や転送されるデータの量も検討する必要があります。 サービスの使用量が増加してもサービスのパフォーマンスを良好に保つには、クラスターに VM を追加し、ネットワーク要求の負荷をすべての VM に分散します。

VM で大量のデータを管理するサービスの場合は、容量計画で主にサイズに重点を置きます。 つまり、VM の RAM とディスク ストレージの容量を慎重に検討する必要があります。 Windows の仮想メモリ管理システムにより、アプリケーション コードからはディスク領域が RAM のように見えます。 そのため、アプリケーションは VM で物理的に利用可能なメモリより多いメモリを利用できます。 RAM を増やすと、VM がより多くのディスク ストレージを RAM に保持できるため、パフォーマンスが向上します。 VM を選択するときは、VM で必要なすべてのデータを格納できるディスク領域がある VM を選び、必要な速度でそのデータにアクセスできる RAM サイズを選びます。 サービスのデータがしだいに増加する場合は、クラスターに VM を追加し、すべての VM 間でデータをパーティション分割できます。

## 必要なノードの数

サービスをパーティション分割を使用すると、スケール アウト サービスのデータ (を参照してください [Service Fabric のパーティション分割](service-fabric-concepts-partitioning.md) パーティション分割の詳細については)。 各パーティションは、1 つの VM 内に収まる必要がありますが、複数の (小さい) パーティションを 1 つの VM に配置することができます。 そのため、多くの数の小さなパーティションがある方が、少ない数の大きなパーティションがある場合よりも柔軟性が高くなります。 トレードオフは、多数のパーティションがあると Service Fabric オーバーヘッドが増えることと、パーティション間のトランザクション操作ができないことです。 異なるパーティションにあるデータにサービス コードが頻繁にアクセスする必要がある場合は、潜在的なネットワーク トラフィックも多くなります。 サービスを設計するときは、効果的なパーティション分割戦略を立てるために、これらの長所と短所を慎重に検討する必要があります。

アプリケーションに 1 つのステートフル サービスがあり、そのサービスのストア サイズが 1 年間に DB_Size GB に増えると予想され、翌年以降も成長する場合はアプリケーション (およびパーティション) を増やすとします。  すべてのレプリカにわたる合計 DB サイズを確認するには、レプリケーション係数 (RF) も考慮する必要があります。この係数によって、サービスのレプリカ数が決まります (すべてのレプリカにわたる合計 DB サイズは、レプリケーション係数と DB_size の積です)。  Node_Size は、サービスのために使用するノードごとのディスク領域/RAM を表します。 最適なパフォーマンスを得るには、DB がクラスター全体のメモリに収まるようにして、選択した VM の RAM 容量程度の Node_Size で配置します。 RAM 容量より大きい Node_Size を割り当てると、OS のページングに依存するため、パフォーマンスは最適ではありませんが、サービスにとっては十分である場合もあります。

そのため、パフォーマンスを最大にするために必要なノードの数は、次のようにして計算できます。

```
Number of Nodes = (DB_Size * RF)/Node_Size

```


## 増加への対応

必要以上の数のノードをプロビジョニングしないように、開始時の DB サイズと、サービスの成長を見込んだ DB サイズに基づいてノードの数を計算し、サービスの成長に合わせてノードの数を増やそうと思うかもしれません。 しかし、パーティションの数は、最大に成長した状態のサービスを実行するときに必要なノードの数に基づく必要があります。
予期しないスパイクやインフラストラクチャの障害 (いくつかの VM がダウンするなど) に対処できるように、いつでも利用できるいくつかの予備のコンピュータ (余分な容量) を用意しておくことをお勧めします。  予期されるスパイクに基づいて判断する必要がありますが、とりあえず、いくつかの余分な VM (5 ～ 10% の余剰) を予約しておくのがよいでしょう。

ここで前提としているのは、単一のステートフル サービスです。 - 複数のステートフル サービスがある場合は、他のサービスに関連する DB サイズも式に追加するか、ステートフル サービスごとにノードの数を計算する必要があります。  サービスには、バランスが取れていないレプリカやパーティションがある場合があります (たとえば、一部のパーティションに他のパーティションより多くのデータがあるなど。 - ベスト プラクティスについては、パーティション分割に関する記事を参照してください)。ただし、上の式は、パーティションやレプリカの数に依存しません。Service Fabric では、最適化された方法でレプリカがノード間に分散されるためです。 


## コスト計算用のスプレッドシート

ここで、上の式にいくつかの具体的な数を当てはめてみましょう。 例スプレッドシート [ここで指定した](https://servicefabricsdkstorage.blob.core.windows.net/publicrelease/SF%20VM%20Cost%20calculator-NEW.xlsx) 3 種類のデータ オブジェクトを含むアプリケーションの容量計画を作成する方法を示します。 各オブジェクトで、サイズと、予期されるオブジェクトの数を概算します。 オブジェクトの種類ごとに、必要なレプリカの数も選択しました。 スプレッドシートは、クラスターに格納されるメモリ量の合計を計算します。 次に、VM サイズと毎月のコストを入力します。 スプレッドシートは、VM サイズに基づいて、物理的にノードに収めるためにデータを分割する場合のパーティションの最小数を示します。 アプリケーションの固有の計算とネットワーク トラフィックのニーズに対応するために、多数のパーティションが必要な場合があります。 スプレッドシートは、ユーザー プロファイル オブジェクトを管理するパーティションの数が 1 から 6 に増加することを示しています。 

ここでスプレッドシートは、このすべての情報に基づき、26 のノード クラスター上の希望するパーティションとレプリカで、物理的にすべてのデータを取得できることを示しています。 ただし、このクラスターは高密度になっているので、ノードの障害やアップグレードに対応するために、ノードをいくつか追加した方がよい場合もあります。 また、スプレッドシートは、57 個を超えるノードを用意しても、空のノードができるだけで意味がないことも示しています。 この場合も、ノードの障害やアップグレードに対応するために、57 個を超えるノードを用意した方がよいこともあります。 アプリケーションの固有のニーズに合わせて、スプレッドシートを調整できます。   

![Image1]



## 次のステップ

[Service Fabric サービスのパーティション分割] [10]、サービスをパーティション分割について詳しく知ることを確認します。



<!--Image references-->
[Image1]: ./media/SF-Cost.png

<!--Link references--In actual articles, you only need a single period before the slash-->
[10]: service-fabric-concepts-partitioning.md

