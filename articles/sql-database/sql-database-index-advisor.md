<properties 
   pageTitle="Azure SQL Database Index Advisor" 
   description="Azure SQL Database Index Advisor は、現在のクエリのパフォーマンスを向上できる、既存の SQL Database に向けた新しいインデックスを推奨します。" 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jeffreyg" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management" 
   ms.date="12/01/2015"
   ms.author="sstein"/>


# SQL Database Index Advisor

Azure SQL Database Index Advisor は、現在のクエリのパフォーマンスを向上できる、既存の SQL Database に向けた新しいインデックスを推奨します。

SQL Database サービスは、SQL Database の過去のリソース配分状況を分析することで、インデックスのパフォーマンスを評価し、データベースの一般的なワークロードを実行するのに最も適したインデックスをお勧めします。

Index Advisor は、インデックスを作成する上での推奨事項を提供することで、インデックスをより一層管理しやすくします。 V12 サーバーでは、Index advisor できますも作成および検証を数回クリックするだけであるインデックスを [Azure ポータル](https://portal.azure.com/)します。 インデックスを作成した後、SQL Database サービスは、データベースのワークロードのパフォーマンスを分析し、新しいインデックスの影響に関する詳細情報を提供します。 分析により、推奨されるインデックスがパフォーマンスを低下させると判断された場合、インデックスが自動的に元の状態に戻されます。

Index Advisor では、データベースのパフォーマンスを調整する時間を短縮することができます。

> [AZURE.NOTE] Index Advisor は現在プレビュー段階で、のみで使用できる、 [Azure ポータル](https://portal.azure.com/)します。


## プレビューの考慮事項

Index Advisor は現在プレビューの段階にあるため、次の制限があります。

- 推奨インデックスは自動的に作成され、V12 サーバーについてのみ (お勧め候補とインデックス作成スクリプトが V12 サーバー用に用意されています) 検証することができます。
- お勧め候補と管理は、非クラスター化インデックスにのみ利用できます。

## 前提条件

表示し、推奨インデックスを作成する必要がある正しい [ロールベースのアクセス制御](role-based-access-control-configure.md) Azure でのアクセスを許可します。

- 推奨インデックスを表示するには、**リーダー**権限と **SQL DB の共同作成者**権限が必要です。
- インデックスの作成またはドロップおよびインデックス作成のキャンセルなどのアクションを実行するには、**所有者**権限と **SQL DB の共同作成者**権限が必要です。


## Index Advisor の使用

Index Advisor は使いやすいツールです。 データベースのインデックス管理を簡略化するには、次のガイドラインに従ってください。

- まず、推奨インデックスの一覧を確認し、どのインデックスを作成または無視するかを決定します。 推奨インデックスの一覧が、パフォーマンスへの推測される影響ごとに並べ替えられ、ラベル付けされます (以下で詳述)。
- 推奨インデックスを作成または無視します。 ポータルで **[インデックスの作成]** をクリックしてインデックスを自動的に作成するか、またはインデックス作成スクリプトを実行して手動でインデックスを作成します。
- 手動で作成したインデックスの場合、作成プロセスを監視し、パフォーマンスへの影響を測定します。 自動的に作成されたインデックスの場合、監視とパフォーマンスへの影響の分析は、Azure SQL Database サービスによって自動的に実行します。



## 推奨インデックスの確認

インデックス アドバイザーをデータベース ブレードに推奨インデックスの一覧を提供する、 [Azure ポータル](https://portal.azure.com/)します。 選択したデータベースのテーブルごとに上位に選ばれたお勧め候補が表示されます。これらは、新しいインデックスを作成することでパフォーマンスが向上する可能性があります。

### 現在使用可能な推奨インデックスの確認方法 :

1. サインイン、 [Azure ポータル](https://portal.azure.com/)します。
2. 左側のメニューの **[参照]** をクリックします。
3. **[参照]** ブレードで、**[SQL データベース]** をクリックします。
4. **[SQL データベース]** ブレードで、推奨インデックスを確認するデータベースをクリックします。
5. **[Index Advisor]** をクリックし、選択したデータベースで使用可能な **[推奨インデックス]** を開いて表示します。

> [AZURE.NOTE] 推奨インデックスを得るには、データベースを約 1 週間使用し、さらにその週内にいくつかのアクティビティを行う必要があります。 さらに、一貫性のアクティビティも行う必要もあります。 Index Advisor は、ランダムでむらのある瞬間的なアクティビティよりも一貫性のあるアクティビティのクエリ パターンをより簡単に最適化できます。

![推奨インデックス][3]

お勧め候補は、パフォーマンスへの潜在的な影響ごとに、次の 4 つのカテゴリに並べ替えられます。

| 影響| 説明|
| :--- | :--- |
| 高| 高い影響を及ぼすお勧め候補は、パフォーマンスに最も重要な影響を与えます。|
| 相当| 相当な影響を及ぼすお勧め候補は、パフォーマンスを著しく向上します。|
| 中| 中程度の影響を及ぼすお勧め候補は、パフォーマンスを向上しますが、それほど著しい向上ではありません。|
| 低| 低いの影響を及ぼすお勧め候補は、インデックスのない場合よりも優れたパフォーマンスを提供しますが、重要ではない可能性があります。

新しいインデックスを作成するための最適な候補を判断するには、影響に関するタグを使用します。

### 推奨インデックス一覧の管理

Index Advisor では、インデックスのお勧め候補一覧に役立たないと思われるインデックスが含まれる場合、推奨インデックスを破棄できます (破棄したインデックスは、必要に応じて後で **[推奨インデックス]** 一覧に加えることができます)。

#### 推奨インデックスを破棄する

1. **[推奨インデックス]** の一覧にあるインデックスを選択します。
1. **[インデックスの詳細]** ブレードの **[インデックスを破棄]** をクリックします。

#### 破棄したインデックスの表示、およびメインの一覧への追加

1. **[推奨インデックス]** ブレードで **[破棄した推奨インデックスを表示]** をクリックします。
1. 破棄したインデックスを一覧から選択し、その詳細を表示します。
1. 必要に応じて、**[破棄を元に戻す]** をクリックしてインデックスを **[推奨インデックス]** の主な一覧に戻します。



## 新しいインデックスを作成する

Index Advisor では、インデックスの作成方法を完全に制御できます。 それぞれのお勧め候補では、T-SQL のインデックス作成スクリプトが提供されるため、データベースで任意のアクションを行う前に、インデックスを作成する方法の詳細を確認することができます。

推奨インデックスはすべての Azure SQL Database サーバーで使用できますが、自動化されたインデックス作成を実行できるのは V12 サーバーのみです。 V12 以外のサーバーでも Index Advisor の利点を得ることはできますが、次に説明するようにインデックスを手動で作成する必要があります。

自動および手動のインデックスの作成については、**[推奨インデックス]** ブレードから推奨インデックスを選択して次の操作を行うだけです。

### 自動インデックス作成 (V12 サーバーのみ)

データベースが V12 サーバー上にある場合、ポータルで目的のインデックスを選択し、**[インデックスの作成]** をクリックするだけで簡単に推奨インデックスを作成できます です。

ただし、データベースはインデックス作成中はオンラインのままで、インデックスを作成するために Index Advisor を使用してもデータベースはオフラインになりません。

さらに、**[インデックスの作成]** で作成されたインデックスは、パフォーマンスの監視が必要ありません。 インデックスがパフォーマンスを低下させる場合、そのインデックスは自動的に戻されます。 [インデックスの作成] を使用した後、新しいインデックスの影響に関するメトリックは、ポータルで使用できます。


### 手動インデックス作成 (すべてのサーバー)

ポータルで任意の推奨インデックスを選択し、**[スクリプトの表示]** をクリックします。 お使いのデータベースでこのスクリプトを実行し、推奨インデックスを作成します。 手動で作成されたインデックスは、実際のパフォーマンスへの影響について監視や検証が行われません。そのため、作成後にこれらのインデックスを監視して、パフォーマンスが向上するか検証し、必要に応じて調整または削除を行うことをお勧めします。 インデックス作成に関する詳細については、「 [CREATE INDEX (TRANSACT-SQL)](https://msdn.microsoft.com/library/ms188783.aspx)します。


### インデックス作成を取り消す

**[保留中]** 状態にあるインデックスを取り消すことができます。 作成中のインデックス (**[実行中]** の状態) はキャンセルできません。

1. **[インデックス操作]** 領域にある任意の **[保留中]** のインデックスを選択して、**[インデックスの詳細]** ブレードを開きます。
1. **[キャンセル]** をクリックすると、インデックス作成の処理が中止されます。

## インデックス作成後のインデックス操作の監視

インデックスの作成は、瞬時に行われません。 ポータルには、インデックス操作の状態に関する詳細情報が表示されます。 インデックスを管理しているとき、インデックスは次のいずれかの状態になります。

| 状態| 説明|
| :--- | :--- |
| Pending| インデックスの作成コマンドが受信され、インデックスの作成が予定されています。|
| を実行しています| Create index コマンドの実行中で、インデックスを現在作成中です。|
| 成功| インデックスが正常に作成されました。|
| Failed| インデックスが作成されていません。一時的な問題か、またはテーブルおよびスクリプトへのスキーマの変更が無効になっている可能性があります。|
| 復元| インデックス作成の処理が取り消されたか、または実行されないと見なされたため自動的に元に戻されています。|



![推奨インデックス][4]



## インデックスの削除

Index Advisor で作成したインデックスを削除できます。


1. **[インデックス操作]** の一覧で、正常に作成されたインデックスを選択します。
1. **[インデックスの詳細]** ブレードで **[インデックスを削除]** をクリックするか、または **[スクリプトの表示]** をクリックして DROP INDEX スクリプトを表示します。



## 概要

推奨インデックスは、インデックス作成と各 SQL Database の分析を管理し、最適なインデックスを推奨するための自動化されたエクスペリエンスを提供します。 データベース ブレードで **[Index Advisor]** タイルをクリックして、推奨インデックスをご覧ください。



## 次のステップ

推奨インデックスを監視し、引き続きパフォーマンスの調整対象とします。 データベースのワークロードは動的であり、継続的に変化します。 Index Advisor では、お使いのデータベースのパフォーマンスを向上させる可能性があるインデックスの監視と推奨を継続します。




[1]: ./media/sql-database-index-advisor/index-recommendations.png 
[2]: ./media/sql-database-index-advisor/index-details.png 
[3]: ./media/sql-database-index-advisor/recommended-indexes.png 
[4]: ./media/sql-database-index-advisor/index-operations.png 

